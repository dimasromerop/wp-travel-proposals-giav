"use strict";(globalThis.webpackChunkwp_travel_giav_admin=globalThis.webpackChunkwp_travel_giav_admin||[]).push([[432],{432(e,a,t){t.r(a),t.d(a,{default:()=>y});var l=t(609),n=t(863);const s={"01":"Ene","02":"Feb","03":"Mar","04":"Abr","05":"May","06":"Jun","07":"Jul","08":"Ago","09":"Sep",10:"Oct",11:"Nov",12:"Dic"},r=(e,a="EUR")=>{const t=Number(e||0);try{return new Intl.NumberFormat("es-ES",{style:"currency",currency:a,maximumFractionDigits:0}).format(t)}catch(e){return`${t.toFixed(0)} ${a}`}},o=e=>{if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?"—":a.toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})},d=e=>{if(!e||"string"!=typeof e)return"—";const[,a]=e.split("-");return s[a]||e},c=(e,a="EUR")=>{const t=Number.isFinite(e)?e:0;try{return new Intl.NumberFormat("es-ES",{style:"currency",currency:a,maximumFractionDigits:0}).format(t)}catch(e){return`${t.toFixed(0)} ${a}`}},m=({type:e})=>{const a={ventas:(0,l.createElement)("svg",{viewBox:"0 0 24 24",role:"presentation"},(0,l.createElement)("rect",{x:"4",y:"8",width:"16",height:"10",rx:"3",fill:"none"}),(0,l.createElement)("path",{d:"M4 8h16l-2-4H6z",fill:"none"})),margen:(0,l.createElement)("svg",{viewBox:"0 0 24 24",role:"presentation"},(0,l.createElement)("path",{d:"M6 16l4-6 4 5 4-8",fill:"none"}),(0,l.createElement)("path",{d:"M4 20h16",fill:"none"})),expedientes:(0,l.createElement)("svg",{viewBox:"0 0 24 24",role:"presentation"},(0,l.createElement)("rect",{x:"5",y:"6",width:"14",height:"12",rx:"2",fill:"none"}),(0,l.createElement)("path",{d:"M8 10h8",fill:"none"}),(0,l.createElement)("path",{d:"M8 14h6",fill:"none"})),riesgo:(0,l.createElement)("svg",{viewBox:"0 0 24 24",role:"presentation"},(0,l.createElement)("path",{d:"M12 4l7 12H5z",fill:"none"}),(0,l.createElement)("path",{d:"M12 12v4",fill:"none"}),(0,l.createElement)("path",{d:"M12 18h.01"}))};return a[e]||a.ventas},i=({icon:e,label:a,value:t,helper:n})=>(0,l.createElement)("article",{className:"dashboard-summary-card"},(0,l.createElement)("div",{className:`dashboard-summary-card__icon dashboard-summary-card__icon--${e}`,"aria-hidden":"true"},(0,l.createElement)(m,{type:e})),(0,l.createElement)("div",null,(0,l.createElement)("p",{className:"dashboard-summary-card__label"},a),(0,l.createElement)("p",{className:"dashboard-summary-card__value"},t),(0,l.createElement)("p",{className:"dashboard-summary-card__helper"},n))),u=({className:e="",style:a={}})=>(0,l.createElement)("span",{className:`dashboard-skeleton ${e}`.trim(),style:a,"aria-hidden":"true"}),h=()=>(0,l.createElement)("article",{className:"dashboard-summary-card dashboard-summary-card--skeleton","aria-hidden":"true"},(0,l.createElement)(u,{className:"dashboard-skeleton--icon"}),(0,l.createElement)("div",{className:"dashboard-summary-card__body"},(0,l.createElement)(u,{className:"dashboard-skeleton--label"}),(0,l.createElement)(u,{className:"dashboard-skeleton--value"}),(0,l.createElement)(u,{className:"dashboard-skeleton--helper"}))),b=()=>(0,l.createElement)("div",{className:"dashboard-chart-skeleton","aria-hidden":"true"},(0,l.createElement)("div",{className:"dashboard-chart-skeleton__axis"},Array.from({length:5}).map((e,a)=>(0,l.createElement)(u,{key:`axis-${a}`,className:"dashboard-skeleton--axis"}))),(0,l.createElement)("div",{className:"dashboard-chart-skeleton__plot"},(0,l.createElement)("div",{className:"dashboard-chart-skeleton__grid"},[0,1,2].map(e=>(0,l.createElement)("span",{key:`grid-${e}`,className:"dashboard-chart-skeleton__grid-line"}))),(0,l.createElement)(u,{className:"dashboard-chart-skeleton__line"}),(0,l.createElement)("div",{className:"dashboard-chart-skeleton__dots"},Array.from({length:8}).map((e,a)=>(0,l.createElement)(u,{key:`dot-${a}`,className:"dashboard-chart-skeleton__dot"}))))),p=()=>(0,l.createElement)("div",{className:"dashboard-chart-skeleton__labels","aria-hidden":"true"},Array.from({length:12}).map((e,a)=>(0,l.createElement)(u,{key:`label-${a}`,className:"dashboard-skeleton--label-xs"}))),E=({label:e,onClick:a,isActive:t,order:n})=>(0,l.createElement)("button",{type:"button",className:"dashboard-table__sort-button"+(t?" is-active":""),onClick:a,"aria-pressed":t,"aria-label":`${e} ${t?"asc"===n?"orden ascendente":"orden descendente":"ordenar ascendente"}`},(0,l.createElement)("span",{className:"dashboard-table__sort-label"},e),(0,l.createElement)("span",{className:"dashboard-table__sort-icon","data-order":t?n:"none"},(0,l.createElement)("svg",{viewBox:"0 0 12 14",role:"presentation",focusable:"false"},(0,l.createElement)("path",{className:"dashboard-table__sort-arrow dashboard-table__sort-arrow--up",d:"M3 8.5L6 5l3 3.5"}),(0,l.createElement)("path",{className:"dashboard-table__sort-arrow dashboard-table__sort-arrow--down",d:"M3 5.5L6 9l3-3.5"})))),_=({data:e,currency:a})=>{if(!e||0===e.length)return(0,l.createElement)("div",{className:"dashboard-chart__empty"},"Sin datos mensuales");const t=[...e].sort((e,a)=>(e.month||"").localeCompare(a.month||"")),n=Math.max(420,70*t.length),s=320,r=t.map(e=>{var a;return null!==(a=e.ventas)&&void 0!==a?a:0}),o=Math.max(1,...r),m=t.length>1?n/(t.length-1):n/2,i=t.map((e,a)=>{var t;const l=a*m,n=(null!==(t=e.ventas)&&void 0!==t?t:0)/o;return`${l},${s-n*s}`}),u=[1,.75,.5,.25,0].map(e=>e*o);return(0,l.createElement)("div",{className:"dashboard-chart",role:"img","aria-label":"Ventas por mes"},(0,l.createElement)("div",{className:"dashboard-chart__axis","aria-hidden":"true"},u.map(e=>(0,l.createElement)("span",{key:`tick-${e}`},c(e,a)))),(0,l.createElement)("svg",{viewBox:`0 0 ${n} 320`,preserveAspectRatio:"none",role:"presentation"},(0,l.createElement)("g",{className:"dashboard-chart__grid"},[.25,.5,.75].map(e=>(0,l.createElement)("line",{key:`grid-${e}`,x1:0,x2:n,y1:s-e*s,y2:s-e*s,stroke:"#e2e8f0",strokeDasharray:"4 6",strokeWidth:1}))),(0,l.createElement)("polygon",{points:`${i.join(" ")} ${n},320 0,320`}),(0,l.createElement)("polyline",{points:i.join(" ")}),(0,l.createElement)("g",{className:"dashboard-chart__dots"},t.map((e,t)=>{var n,r,i,u;const h=t*m,b=(null!==(n=e.ventas)&&void 0!==n?n:0)/o,p=s-b*s;return(0,l.createElement)("circle",{key:`dot-${e.month}-${t}`,cx:h,cy:p,r:5},(0,l.createElement)("title",null,`Ventas ${c(null!==(r=e.ventas)&&void 0!==r?r:0,a)} · ${d(e.month)} · ${null!==(i=e.expedientes)&&void 0!==i?i:0} expediente${1===(null!==(u=e.expedientes)&&void 0!==u?u:0)?"":"s"}`))}))),(0,l.createElement)("div",{className:"dashboard-chart__labels"},t.map(e=>(0,l.createElement)("span",{key:`label-${e.month}`},d(e.month)))))},v=({index:e})=>(0,l.createElement)("tr",{key:`row-skel-${e}`,className:"dashboard-table__row is-skeleton","aria-hidden":"true"},(0,l.createElement)("td",null,(0,l.createElement)(u,{className:"dashboard-skeleton--text dashboard-skeleton--short"})),(0,l.createElement)("td",null,(0,l.createElement)(u,{className:"dashboard-skeleton--text dashboard-skeleton--long"})),(0,l.createElement)("td",null,(0,l.createElement)(u,{className:"dashboard-skeleton--text dashboard-skeleton--medium"})),(0,l.createElement)("td",null,(0,l.createElement)(u,{className:"dashboard-skeleton--text dashboard-skeleton--long"})),(0,l.createElement)("td",null,(0,l.createElement)(u,{className:"dashboard-skeleton--text dashboard-skeleton--medium"})),(0,l.createElement)("td",null,(0,l.createElement)(u,{className:"dashboard-skeleton--text dashboard-skeleton--medium"})),(0,l.createElement)("td",null,(0,l.createElement)("div",{className:"dashboard-day-status"},(0,l.createElement)(u,{className:"dashboard-skeleton--pill"}),(0,l.createElement)(u,{className:"dashboard-skeleton--subline"}))),(0,l.createElement)("td",null,(0,l.createElement)("div",{className:"dashboard-payments"},(0,l.createElement)(u,{className:"dashboard-skeleton--pill"}),(0,l.createElement)(u,{className:"dashboard-skeleton--subline"}),(0,l.createElement)(u,{className:"dashboard-skeleton--subline dashboard-skeleton--subline-short"}))),(0,l.createElement)("td",{className:"dashboard-table__align-right"},(0,l.createElement)(u,{className:"dashboard-skeleton--text dashboard-skeleton--short"})),(0,l.createElement)("td",{className:"dashboard-table__align-right"},(0,l.createElement)("div",{className:"dashboard-margin-cell"},(0,l.createElement)(u,{className:"dashboard-skeleton--text dashboard-skeleton--short"}),(0,l.createElement)(u,{className:"dashboard-skeleton--pill dashboard-skeleton--pill-small"}))),(0,l.createElement)("td",null,(0,l.createElement)(u,{className:"dashboard-skeleton--text dashboard-skeleton--short"})),(0,l.createElement)("td",null,(0,l.createElement)("div",{className:"dashboard-actions is-skeleton"},(0,l.createElement)(u,{className:"dashboard-skeleton--button"}),(0,l.createElement)(u,{className:"dashboard-skeleton--button"})))),y=()=>{var e,a,t,s,d;const c=(new Date).getFullYear(),[m,u]=(0,l.useState)(c),[y,g]=(0,l.useState)({page:1,sortBy:"fecha_inicio",order:"asc",agent:"",client:"",expediente:"",paymentStatus:"",paymentDueDays:null,tripDueDays:null,showCompleted:!1}),[N,k]=(0,l.useState)(null),[x,f]=(0,l.useState)(!1),[D,w]=(0,l.useState)(""),C=(0,l.useCallback)(async({force:e}={})=>{f(!0),w("");try{var a,t;const l=await(0,n.ZW)({year:m,force:e,page:y.page,perPage:25,sortBy:y.sortBy,order:y.order,agent:y.agent||void 0,client:y.client||void 0,expediente:y.expediente||void 0,paymentStatus:y.paymentStatus||void 0,paymentDueDays:null!==(a=y.paymentDueDays)&&void 0!==a?a:void 0,tripDueDays:null!==(t=y.tripDueDays)&&void 0!==t?t:void 0,showCompleted:y.showCompleted});k(l)}catch(e){w(e?.message||"No se pudo cargar el dashboard."),k(null)}finally{f(!1)}},[m,y]);(0,l.useEffect)(()=>{C()},[C]),(0,l.useEffect)(()=>{g(e=>({...e,page:1}))},[m]);const $=null!==(e=N?.summary)&&void 0!==e?e:{},S=null!==(a=N?.chart)&&void 0!==a?a:[],A=(0,l.useMemo)(()=>(S||[]).map(e=>{var a,t;const l="number"==typeof e.ventas?e.ventas:Number(null!==(a=null!==(t=e.value)&&void 0!==t?t:e.valor)&&void 0!==a?a:0);return{month:e.month||e.mes||e.label||"",ventas:Number.isFinite(l)?l:0,expedientes:Number.isFinite(e.expedientes)?e.expedientes:Number.isFinite(e.count)?e.count:0}}).filter(e=>e.month),[S]),M=null!==(t=N?.expedientes?.items)&&void 0!==t?t:[],B=N?.expedientes?.meta,j=Math.max(1,null!==(s=B?.total_pages)&&void 0!==s?s:1),F=Math.min(Math.max(1,y.page),j),P=(0,l.useMemo)(()=>[{label:"Ventas estimadas",value:r($.ventas_estimadas_total||0,N?.currency),helper:"Basado en viajes iniciados",icon:"ventas"},{label:"Margen estimado",value:r($.margen_estimado_total||0,N?.currency),helper:"Margen operativo previsto",icon:"margen"},{label:"Expedientes",value:String($.expedientes_total||0),helper:"Expedientes aceptados",icon:"expedientes"},{label:"Riesgo de cobro",value:String($.expedientes_riesgo_cobro||0),helper:"Pagos con alertas",icon:"riesgo"}],[$,N?.currency]),V=e=>{g(a=>{const t=a.sortBy===e&&"asc"===a.order?"desc":"asc";return{...a,sortBy:e,order:t,page:1}})},z=e=>{g(a=>"overdue"===e?{...a,paymentStatus:"vencido",paymentDueDays:null,tripDueDays:null,page:1}:"upcoming"===e?{...a,paymentStatus:"",paymentDueDays:15,tripDueDays:null,page:1}:"soon"===e?{...a,paymentStatus:"",paymentDueDays:null,tripDueDays:30,page:1}:"clear"===e?{...a,paymentStatus:"",paymentDueDays:null,tripDueDays:null,agent:"",client:"",expediente:"",showCompleted:!1,page:1}:a)},L=Boolean(y.agent||y.client||y.expediente||y.paymentStatus||null!==y.paymentDueDays||null!==y.tripDueDays||y.showCompleted),T=Boolean(y.agent||y.client||y.expediente||y.paymentStatus||null!==y.paymentDueDays||null!==y.tripDueDays),H=e=>{g(a=>({...a,agent:e,page:1}))},I=e=>{g(a=>{const t=Math.max(1,Math.min(j,a.page+e));return{...a,page:t}})},R=(0,l.useMemo)(()=>{const e={overdue:0,upcoming:0,soon:0};return M.forEach(a=>{"vencido"===(a.pagos?.estado||"").toString().toLowerCase()&&(e.overdue+=1);const t="number"==typeof a.pagos?.dias_para_vencer?a.pagos.dias_para_vencer:null;null!==t&&t>=0&&t<=15&&(e.upcoming+=1);const l="number"==typeof a.dias_hasta_viaje?a.dias_hasta_viaje:null;null!==l&&l>=0&&l<=30&&(e.soon+=1)}),e},[M]),O=(0,l.useMemo)(()=>{const e={};return M.forEach(a=>{var t;const l=(a.agente_comercial||"Sin agente").trim()||"Sin agente",n=null!==(t=e[l])&&void 0!==t?t:{agent:l,expedientes:0,total:0,overdue:0};n.expedientes+=1,n.total+=Number(a.total_pvp||0),"vencido"===(a.pagos?.estado||"").toString().toLowerCase()&&(n.overdue+=1),e[l]=n}),Object.values(e).sort((e,a)=>a.total-e.total)},[M]);return(0,l.createElement)("div",{className:"dashboard-page"},(0,l.createElement)("header",{className:"dashboard-page__header"},(0,l.createElement)("div",null,(0,l.createElement)("p",{className:"dashboard-eyebrow"},"Resumen"),(0,l.createElement)("h1",null,"Dashboard ",m),(0,l.createElement)("p",{className:"dashboard-page__subtitle"},"Ventas y pagos por año natural.")),(0,l.createElement)("div",{className:"dashboard-page__actions"},(0,l.createElement)("label",{className:"dashboard-page__year-picker"},(0,l.createElement)("span",null,"Año"),(0,l.createElement)("select",{value:m,onChange:e=>u(Number(e.target.value))},Array.from({length:5}).map((e,a)=>{const t=c-a;return(0,l.createElement)("option",{key:t,value:t},t)}))),(0,l.createElement)("button",{type:"button",className:"button-secondary dashboard-page__refresh",onClick:()=>C({force:!0}),disabled:x},x?"Actualizando...":"Actualizar"))),(0,l.createElement)("section",{className:"dashboard-section dashboard-section--chart-summary"},(0,l.createElement)("div",{className:"dashboard-section__header"},(0,l.createElement)("div",null,(0,l.createElement)("p",{className:"dashboard-section__eyebrow"},"Ventas por mes"),(0,l.createElement)("h2",null,"Ventas por mes"),(0,l.createElement)("p",{className:"dashboard-section__hint"},"Basado en fecha de inicio del viaje."))),(0,l.createElement)("div",{className:"dashboard-chart-summary"},(0,l.createElement)("div",{className:"dashboard-chart-summary__layout"},(0,l.createElement)("div",{className:"dashboard-chart-summary__chart"},x?(0,l.createElement)(l.Fragment,null,(0,l.createElement)(b,null),(0,l.createElement)(p,null)):(0,l.createElement)(_,{data:A,currency:N?.currency})),(0,l.createElement)("div",{className:"dashboard-chart-summary__cards"},x?Array.from({length:4}).map((e,a)=>(0,l.createElement)(h,{key:`summary-skel-${a}`})):P.map(e=>(0,l.createElement)(i,{key:e.label,...e})))))),(0,l.createElement)("div",{className:"dashboard-ops"},(0,l.createElement)("section",{className:"dashboard-section dashboard-section--today"},(0,l.createElement)("div",{className:"dashboard-section__header"},(0,l.createElement)("div",null,(0,l.createElement)("p",{className:"dashboard-section__eyebrow"},"Hoy"),(0,l.createElement)("h2",null,"Prioridades"))),(0,l.createElement)("div",{className:"dashboard-today-block"},(0,l.createElement)("button",{type:"button",className:"dashboard-today-pill dashboard-today-pill--overdue "+("vencido"===y.paymentStatus?"is-active":""),onClick:()=>z("overdue")},(0,l.createElement)("span",{className:"dashboard-today-pill__label"},"Pagos vencidos"),(0,l.createElement)("strong",null,R.overdue)),(0,l.createElement)("button",{type:"button",className:"dashboard-today-pill dashboard-today-pill--upcoming "+(15===y.paymentDueDays?"is-active":""),onClick:()=>z("upcoming")},(0,l.createElement)("span",{className:"dashboard-today-pill__label"},"Pagos próximos"),(0,l.createElement)("strong",null,R.upcoming)),(0,l.createElement)("button",{type:"button",className:"dashboard-today-pill dashboard-today-pill--soon "+(30===y.tripDueDays?"is-active":""),onClick:()=>z("soon")},(0,l.createElement)("span",{className:"dashboard-today-pill__label"},"Viajes en 30 días"),(0,l.createElement)("strong",null,R.soon)),0===R.overdue&&0===R.upcoming&&M.length>0&&(0,l.createElement)("span",{className:"dashboard-today-pill dashboard-today-pill--healthy"},"Todo al día"))),(0,l.createElement)("section",{className:"dashboard-section dashboard-section--agents"},(0,l.createElement)("div",{className:"dashboard-section__header"},(0,l.createElement)("div",null,(0,l.createElement)("p",{className:"dashboard-section__eyebrow"},"Agentes"),(0,l.createElement)("h2",null,"Cartera por agente"),(0,l.createElement)("p",{className:"dashboard-section__hint"},"Ordenado por ventas estimadas."))),(0,l.createElement)("div",{className:"dashboard-agent-table-wrapper"},0===O.length?(0,l.createElement)("p",{className:"dashboard-agent-table__empty"},"No hay datos de agentes disponibles."):(0,l.createElement)("table",{className:"dashboard-agent-table"},(0,l.createElement)("thead",null,(0,l.createElement)("tr",null,(0,l.createElement)("th",null,"Agente"),(0,l.createElement)("th",null,"Expedientes"),(0,l.createElement)("th",null,"Ventas"),(0,l.createElement)("th",null,"Vencidos"))),(0,l.createElement)("tbody",null,O.map(e=>(0,l.createElement)("tr",{key:e.agent,className:e.overdue>0?"dashboard-agent-table__row--alert":"",onClick:()=>H(e.agent),tabIndex:0,role:"button",onKeyDown:a=>{"Enter"!==a.key&&" "!==a.key||(a.preventDefault(),H(e.agent))}},(0,l.createElement)("td",null,e.agent),(0,l.createElement)("td",null,e.expedientes),(0,l.createElement)("td",null,r(e.total,N?.currency)),(0,l.createElement)("td",null,e.overdue>0?(0,l.createElement)("span",{className:"dashboard-agent-table__badge"},e.overdue):"—")))))))),(0,l.createElement)("section",{className:"dashboard-section dashboard-section--table"},(0,l.createElement)("div",{className:"dashboard-section__header"},(0,l.createElement)("div",null,(0,l.createElement)("p",{className:"dashboard-section__eyebrow"},"Expedientes"),(0,l.createElement)("h2",null,"Gestión de pagos y riesgos"),(0,l.createElement)("p",{className:"dashboard-section__hint"},"Priorización operativa."))),(0,l.createElement)("div",{className:"dashboard-table__controls"},(0,l.createElement)("label",{className:"dashboard-table__filter"},(0,l.createElement)("span",null,"Agente comercial"),(0,l.createElement)("input",{type:"search",placeholder:"Buscar agente",value:y.agent,onChange:e=>H(e.target.value)})),(0,l.createElement)("label",{className:"dashboard-table__filter"},(0,l.createElement)("span",null,"Cliente"),(0,l.createElement)("input",{type:"search",placeholder:"Buscar cliente",value:y.client,onChange:e=>{return a=e.target.value,void g(e=>({...e,client:a,page:1}));var a}})),(0,l.createElement)("label",{className:"dashboard-table__filter"},(0,l.createElement)("span",null,"Expediente"),(0,l.createElement)("input",{type:"search",placeholder:"Buscar expediente",value:y.expediente,onChange:e=>{return a=e.target.value,void g(e=>({...e,expediente:a,page:1}));var a}})),(0,l.createElement)("div",{className:"dashboard-table__chips"},(0,l.createElement)("button",{type:"button",className:"dashboard-chip "+("vencido"===y.paymentStatus?"is-active":""),onClick:()=>z("overdue")},"Pagos vencidos"),(0,l.createElement)("button",{type:"button",className:"dashboard-chip "+(15===y.paymentDueDays?"is-active":""),onClick:()=>z("upcoming")},"Próximos pagos"),(0,l.createElement)("button",{type:"button",className:"dashboard-chip "+(y.showCompleted?"is-active":""),onClick:()=>{g(e=>({...e,showCompleted:!e.showCompleted,page:1}))},"aria-pressed":y.showCompleted},y.showCompleted?"Ocultar finalizados":"Ver finalizados"),(0,l.createElement)("button",{type:"button",className:"dashboard-chip "+(L?"is-active":""),onClick:()=>z("clear")},"Limpiar filtros"))),D&&(0,l.createElement)("div",{className:"dashboard-error"},D),(0,l.createElement)("div",{className:"dashboard-table-wrapper"},(0,l.createElement)("table",{className:"dashboard-table"},(0,l.createElement)("thead",null,(0,l.createElement)("tr",null,(0,l.createElement)("th",null,(0,l.createElement)(E,{label:"Expediente",onClick:()=>V("giav_id_humano"),isActive:"giav_id_humano"===y.sortBy,order:y.order})),(0,l.createElement)("th",null,(0,l.createElement)(E,{label:"Cliente",onClick:()=>V("cliente_nombre"),isActive:"cliente_nombre"===y.sortBy,order:y.order})),(0,l.createElement)("th",null,(0,l.createElement)(E,{label:"Agente",onClick:()=>V("agente_comercial"),isActive:"agente_comercial"===y.sortBy,order:y.order})),(0,l.createElement)("th",null,(0,l.createElement)(E,{label:"Viaje",onClick:()=>V("nombre_viaje"),isActive:"nombre_viaje"===y.sortBy,order:y.order})),(0,l.createElement)("th",null,(0,l.createElement)(E,{label:"Inicio",onClick:()=>V("fecha_inicio"),isActive:"fecha_inicio"===y.sortBy,order:y.order})),(0,l.createElement)("th",null,"Fin"),(0,l.createElement)("th",null,(0,l.createElement)(E,{label:"Días hasta el viaje",onClick:()=>V("dias_hasta_viaje"),isActive:"dias_hasta_viaje"===y.sortBy,order:y.order})),(0,l.createElement)("th",null,"Pagos"),(0,l.createElement)("th",null,"Pendiente"),(0,l.createElement)("th",null,"Margen est."),(0,l.createElement)("th",null,(0,l.createElement)(E,{label:"Total PVP",onClick:()=>V("total_pvp"),isActive:"total_pvp"===y.sortBy,order:y.order})),(0,l.createElement)("th",null,"Acciones"))),(0,l.createElement)("tbody",null,x&&Array.from({length:6}).map((e,a)=>(0,l.createElement)(v,{key:`table-skel-${a}`,index:a})),!x&&0===M.length&&(0,l.createElement)("tr",null,(0,l.createElement)("td",{colSpan:12,className:"dashboard-table__status"},T?"No hay expedientes que coincidan con los filtros actuales.":y.showCompleted?"No hay expedientes registrados para este año.":'No hay expedientes activos para este año. Activa "Ver finalizados" para ver viajes cerrados.')),!x&&M.map(e=>{var a;const t=(e.riesgo||"ok").toString().toLowerCase(),n=(e.pagos?.estado||"pendiente").toString().toLowerCase(),s="number"==typeof e.margen_estimado&&"number"==typeof e.total_pvp&&e.total_pvp>0&&e.margen_estimado/e.total_pvp<.1;return(0,l.createElement)("tr",{key:`${e.giav_id_humano}-${e.fecha_inicio}-${e.total_pvp}-${e.nombre_viaje}`,className:`dashboard-table__row dashboard-table__row--risk-${t}`},(0,l.createElement)("td",null,(0,l.createElement)("strong",null,e.giav_id_humano||"—")),(0,l.createElement)("td",null,(0,l.createElement)("div",{className:"dashboard-table__name"},e.cliente_nombre||"—")),(0,l.createElement)("td",null,e.agente_comercial||"—"),(0,l.createElement)("td",null,(0,l.createElement)("div",{className:"dashboard-table__travel"},e.nombre_viaje||"—")),(0,l.createElement)("td",null,o(e.fecha_inicio)),(0,l.createElement)("td",null,o(e.fecha_fin)),(0,l.createElement)("td",null,(e=>{const a="number"==typeof e.dias_hasta_viaje?e.dias_hasta_viaje:null,t=e.fecha_inicio?new Date(e.fecha_inicio):null,n=e.fecha_fin?new Date(e.fecha_fin):null,s=new Date;return t&&n&&s>=t&&s<=n?(0,l.createElement)("div",{className:"dashboard-day-status"},(0,l.createElement)("span",{className:"dashboard-day-status__badge dashboard-day-status__badge--active"},"En curso")):null!==a&&a<0?(0,l.createElement)("div",{className:"dashboard-day-status"},(0,l.createElement)("span",{className:"dashboard-day-status__badge dashboard-day-status__badge--past"},"Finalizado"),(0,l.createElement)("small",null,"Hace ",Math.abs(a)," días")):0===a?(0,l.createElement)("div",{className:"dashboard-day-status"},(0,l.createElement)("span",{className:"dashboard-day-status__badge dashboard-day-status__badge--today"},"Hoy")):null!==a?(0,l.createElement)("div",{className:"dashboard-day-status"},(0,l.createElement)("span",{className:"dashboard-day-status__badge"},"En ",a," días")):(0,l.createElement)("div",{className:"dashboard-day-status"},(0,l.createElement)("span",{className:"dashboard-day-status__badge"},"Fecha pendiente"))})(e)),(0,l.createElement)("td",null,(0,l.createElement)("div",{className:"dashboard-payments"},(0,l.createElement)("span",{className:`dashboard-badge dashboard-badge--${n}`},(d=n)?d.charAt(0).toUpperCase()+d.slice(1):"—"),(e=>{const a=e?.proximo_vencimiento;return a?(0,l.createElement)("small",{className:"dashboard-payments__amounts"},"Próximo pago: ",o(a)):null})(e.pagos),(e=>{const a=e?.pagado_total;return null==a?null:(0,l.createElement)("small",{className:"dashboard-payments__amounts"},"Pagado: ",r(a,N?.currency))})(e.pagos))),(0,l.createElement)("td",{className:"dashboard-table__align-right"},r(null!==(a=e.pagos?.pendiente_total)&&void 0!==a?a:0,N?.currency)),(0,l.createElement)("td",{className:"dashboard-table__align-right"},(0,l.createElement)("div",{className:"dashboard-margin-cell"},(0,l.createElement)("span",null,r(e.margen_estimado||0,N?.currency)),s&&(0,l.createElement)("span",{className:"dashboard-badge dashboard-badge--margin-low"},"Bajo"))),(0,l.createElement)("td",null,r(e.total_pvp||0,N?.currency)),(0,l.createElement)("td",null,(0,l.createElement)("div",{className:"dashboard-actions"},(0,l.createElement)("button",{type:"button",className:"dashboard-action",onClick:()=>(async e=>{if(e&&navigator.clipboard)try{await navigator.clipboard.writeText(e)}catch(e){}})(e.giav_id_humano)},"Copiar ID"))));var d})))),(0,l.createElement)("footer",{className:"dashboard-pagination"},(0,l.createElement)("div",{className:"dashboard-pagination__meta"},(0,l.createElement)("span",null,"Página ",F," de ",j),(0,l.createElement)("span",null,"Mostrando ",M.length," de ",null!==(d=B?.total)&&void 0!==d?d:0," expedientes")),(0,l.createElement)("div",{className:"dashboard-pagination__actions"},(0,l.createElement)("button",{type:"button",onClick:()=>I(-1),disabled:F<=1||x},"Anterior"),(0,l.createElement)("button",{type:"button",onClick:()=>I(1),disabled:F>=j||x},"Siguiente")))))}}}]);