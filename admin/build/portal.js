(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var l in t)e.o(t,l)&&!e.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:t[l]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.React,t=window.wp.element,l=window.ReactDOM;function n(){return n=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},n.apply(this,arguments)}var r;!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(r||(r={}));const o="popstate";function s(e,a){if(!1===e||null==e)throw new Error(a)}function i(e,a){if(!e){"undefined"!=typeof console&&console.warn(a);try{throw new Error(a)}catch(e){}}}function c(e,a){return{usr:e.state,key:e.key,idx:a}}function u(e,a,t,l){return void 0===t&&(t=null),n({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof a?d(a):a,{state:t,key:a&&a.key||l||Math.random().toString(36).substr(2,8)})}function p(e){let{pathname:a="/",search:t="",hash:l=""}=e;return t&&"?"!==t&&(a+="?"===t.charAt(0)?t:"?"+t),l&&"#"!==l&&(a+="#"===l.charAt(0)?l:"#"+l),a}function d(e){let a={};if(e){let t=e.indexOf("#");t>=0&&(a.hash=e.substr(t),e=e.substr(0,t));let l=e.indexOf("?");l>=0&&(a.search=e.substr(l),e=e.substr(0,l)),e&&(a.pathname=e)}return a}var m;function _(e,a,t){return void 0===t&&(t="/"),function(e,a,t,l){let n=k(("string"==typeof a?d(a):a).pathname||"/",t);if(null==n)return null;let r=v(e);!function(e){e.sort((e,a)=>e.score!==a.score?a.score-e.score:function(e,a){return e.length===a.length&&e.slice(0,-1).every((e,t)=>e===a[t])?e[e.length-1]-a[a.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),a.routesMeta.map(e=>e.childrenIndex)))}(r);let o=null;for(let e=0;null==o&&e<r.length;++e){let a=P(n);o=w(r[e],a,l)}return o}(e,a,t,!1)}function v(e,a,t,l){void 0===a&&(a=[]),void 0===t&&(t=[]),void 0===l&&(l="");let n=(e,n,r)=>{let o={relativePath:void 0===r?e.path||"":r,caseSensitive:!0===e.caseSensitive,childrenIndex:n,route:e};o.relativePath.startsWith("/")&&(s(o.relativePath.startsWith(l),'Absolute route path "'+o.relativePath+'" nested under path "'+l+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(l.length));let i=$([l,o.relativePath]),c=t.concat(o);e.children&&e.children.length>0&&(s(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+i+'".'),v(e.children,a,c,i)),(null!=e.path||e.index)&&a.push({path:i,score:C(i,e.index),routesMeta:c})};return e.forEach((e,a)=>{var t;if(""!==e.path&&null!=(t=e.path)&&t.includes("?"))for(let t of g(e.path))n(e,a,t);else n(e,a)}),a}function g(e){let a=e.split("/");if(0===a.length)return[];let[t,...l]=a,n=t.endsWith("?"),r=t.replace(/\?$/,"");if(0===l.length)return n?[r,""]:[r];let o=g(l.join("/")),s=[];return s.push(...o.map(e=>""===e?r:[r,e].join("/"))),n&&s.push(...o),s.map(a=>e.startsWith("/")&&""===a?"/":a)}!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(m||(m={})),new Set(["lazy","caseSensitive","path","id","index","children"]);const h=/^:[\w-]+$/,b=3,E=2,f=1,y=10,N=-2,S=e=>"*"===e;function C(e,a){let t=e.split("/"),l=t.length;return t.some(S)&&(l+=N),a&&(l+=E),t.filter(e=>!S(e)).reduce((e,a)=>e+(h.test(a)?b:""===a?f:y),l)}function w(e,a,t){void 0===t&&(t=!1);let{routesMeta:l}=e,n={},r="/",o=[];for(let e=0;e<l.length;++e){let s=l[e],i=e===l.length-1,c="/"===r?a:a.slice(r.length)||"/",u=x({path:s.relativePath,caseSensitive:s.caseSensitive,end:i},c),p=s.route;if(!u&&i&&t&&!l[l.length-1].route.index&&(u=x({path:s.relativePath,caseSensitive:s.caseSensitive,end:!1},c)),!u)return null;Object.assign(n,u.params),o.push({params:n,pathname:$([r,u.pathname]),pathnameBase:B($([r,u.pathnameBase])),route:p}),"/"!==u.pathnameBase&&(r=$([r,u.pathnameBase]))}return o}function x(e,a){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[t,l]=function(e,a,t){void 0===a&&(a=!1),void 0===t&&(t=!0),i("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let l=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,a,t)=>(l.push({paramName:a,isOptional:null!=t}),t?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(l.push({paramName:"*"}),n+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":""!==e&&"/"!==e&&(n+="(?:(?=\\/|$))"),[new RegExp(n,a?void 0:"i"),l]}(e.path,e.caseSensitive,e.end),n=a.match(t);if(!n)return null;let r=n[0],o=r.replace(/(.)\/+$/,"$1"),s=n.slice(1);return{params:l.reduce((e,a,t)=>{let{paramName:l,isOptional:n}=a;if("*"===l){let e=s[t]||"";o=r.slice(0,r.length-e.length).replace(/(.)\/+$/,"$1")}const i=s[t];return e[l]=n&&!i?void 0:(i||"").replace(/%2F/g,"/"),e},{}),pathname:r,pathnameBase:o,pattern:e}}function P(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(a){return i(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+a+")."),e}}function k(e,a){if("/"===a)return e;if(!e.toLowerCase().startsWith(a.toLowerCase()))return null;let t=a.endsWith("/")?a.length-1:a.length,l=e.charAt(t);return l&&"/"!==l?null:e.slice(t)||"/"}const T=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function M(e,a){let t=a.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?t.length>1&&t.pop():"."!==e&&t.push(e)}),t.length>1?t.join("/"):"/"}function A(e,a,t,l){return"Cannot include a '"+e+"' character in a manually specified `to."+a+"` field ["+JSON.stringify(l)+"].  Please separate it out to the `to."+t+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function I(e,a){let t=function(e){return e.filter((e,a)=>0===a||e.route.path&&e.route.path.length>0)}(e);return a?t.map((e,a)=>a===t.length-1?e.pathname:e.pathnameBase):t.map(e=>e.pathnameBase)}function R(e,a,t,l){let r;void 0===l&&(l=!1),"string"==typeof e?r=d(e):(r=n({},e),s(!r.pathname||!r.pathname.includes("?"),A("?","pathname","search",r)),s(!r.pathname||!r.pathname.includes("#"),A("#","pathname","hash",r)),s(!r.search||!r.search.includes("#"),A("#","search","hash",r)));let o,c=""===e||""===r.pathname,u=c?"/":r.pathname;if(null==u)o=t;else{let e=a.length-1;if(!l&&u.startsWith("..")){let a=u.split("/");for(;".."===a[0];)a.shift(),e-=1;r.pathname=a.join("/")}o=e>=0?a[e]:"/"}let p=function(e,a){void 0===a&&(a="/");let t,{pathname:l,search:n="",hash:r=""}="string"==typeof e?d(e):e;if(l)if(o=l,T.test(o))t=l;else{if(l.includes("//")){let e=l;l=l.replace(/\/\/+/g,"/"),i(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+l)}t=l.startsWith("/")?M(l.substring(1),"/"):M(l,a)}else t=a;var o;return{pathname:t,search:G(n),hash:D(r)}}(r,o),m=u&&"/"!==u&&u.endsWith("/"),_=(c||"."===u)&&t.endsWith("/");return p.pathname.endsWith("/")||!m&&!_||(p.pathname+="/"),p}const $=e=>e.join("/").replace(/\/\/+/g,"/"),B=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),G=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",D=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;const L=["post","put","patch","delete"],F=(new Set(L),["get",...L]);function U(){return U=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},U.apply(this,arguments)}new Set(F),new Set([301,302,303,307,308]),new Set([307,308]),Symbol("deferred");const V=a.createContext(null),O=a.createContext(null),j=a.createContext(null),q=a.createContext(null),z=a.createContext({outlet:null,matches:[],isDataRoute:!1}),H=a.createContext(null);function W(){return null!=a.useContext(q)}function K(){return W()||s(!1),a.useContext(q).location}function J(e){a.useContext(j).static||a.useLayoutEffect(e)}function Z(){let{isDataRoute:e}=a.useContext(z);return e?function(){let{router:e}=function(){let e=a.useContext(V);return e||s(!1),e}(ne.UseNavigateStable),t=oe(re.UseNavigateStable),l=a.useRef(!1);return J(()=>{l.current=!0}),a.useCallback(function(a,n){void 0===n&&(n={}),l.current&&("number"==typeof a?e.navigate(a):e.navigate(a,U({fromRouteId:t},n)))},[e,t])}():function(){W()||s(!1);let e=a.useContext(V),{basename:t,future:l,navigator:n}=a.useContext(j),{matches:r}=a.useContext(z),{pathname:o}=K(),i=JSON.stringify(I(r,l.v7_relativeSplatPath)),c=a.useRef(!1);return J(()=>{c.current=!0}),a.useCallback(function(a,l){if(void 0===l&&(l={}),!c.current)return;if("number"==typeof a)return void n.go(a);let r=R(a,JSON.parse(i),o,"path"===l.relative);null==e&&"/"!==t&&(r.pathname="/"===r.pathname?t:$([t,r.pathname])),(l.replace?n.replace:n.push)(r,l.state,l)},[t,n,i,o,e])}()}function Y(){let{matches:e}=a.useContext(z),t=e[e.length-1];return t?t.params:{}}function Q(e,t){let{relative:l}=void 0===t?{}:t,{future:n}=a.useContext(j),{matches:r}=a.useContext(z),{pathname:o}=K(),s=JSON.stringify(I(r,n.v7_relativeSplatPath));return a.useMemo(()=>R(e,JSON.parse(s),o,"path"===l),[e,s,o,l])}function X(e,t,l,n){W()||s(!1);let{navigator:o}=a.useContext(j),{matches:i}=a.useContext(z),c=i[i.length-1],u=c?c.params:{},p=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let m,v=K();if(t){var g;let e="string"==typeof t?d(t):t;"/"===p||(null==(g=e.pathname)?void 0:g.startsWith(p))||s(!1),m=e}else m=v;let h=m.pathname||"/",b=h;if("/"!==p){let e=p.replace(/^\//,"").split("/");b="/"+h.replace(/^\//,"").split("/").slice(e.length).join("/")}let E=_(e,{pathname:b}),f=function(e,t,l,n){var r;if(void 0===t&&(t=[]),void 0===l&&(l=null),void 0===n&&(n=null),null==e){var o;if(!l)return null;if(l.errors)e=l.matches;else{if(!(null!=(o=n)&&o.v7_partialHydration&&0===t.length&&!l.initialized&&l.matches.length>0))return null;e=l.matches}}let i=e,c=null==(r=l)?void 0:r.errors;if(null!=c){let e=i.findIndex(e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id]));e>=0||s(!1),i=i.slice(0,Math.min(i.length,e+1))}let u=!1,p=-1;if(l&&n&&n.v7_partialHydration)for(let e=0;e<i.length;e++){let a=i[e];if((a.route.HydrateFallback||a.route.hydrateFallbackElement)&&(p=e),a.route.id){let{loaderData:e,errors:t}=l,n=a.route.loader&&void 0===e[a.route.id]&&(!t||void 0===t[a.route.id]);if(a.route.lazy||n){u=!0,i=p>=0?i.slice(0,p+1):[i[0]];break}}}return i.reduceRight((e,n,r)=>{let o,s=!1,d=null,m=null;var _;l&&(o=c&&n.route.id?c[n.route.id]:void 0,d=n.route.errorElement||ae,u&&(p<0&&0===r?(se[_="route-fallback"]||(se[_]=!0),s=!0,m=null):p===r&&(s=!0,m=n.route.hydrateFallbackElement||null)));let v=t.concat(i.slice(0,r+1)),g=()=>{let t;return t=o?d:s?m:n.route.Component?a.createElement(n.route.Component,null):n.route.element?n.route.element:e,a.createElement(le,{match:n,routeContext:{outlet:e,matches:v,isDataRoute:null!=l},children:t})};return l&&(n.route.ErrorBoundary||n.route.errorElement||0===r)?a.createElement(te,{location:l.location,revalidation:l.revalidation,component:d,error:o,children:g(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):g()},null)}(E&&E.map(e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:$([p,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?p:$([p,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),i,l,n);return t&&f?a.createElement(q.Provider,{value:{location:U({pathname:"/",search:"",hash:"",state:null,key:"default"},m),navigationType:r.Pop}},f):f}function ee(){let e=function(){var e;let t=a.useContext(H),l=function(){let e=a.useContext(O);return e||s(!1),e}(re.UseRouteError),n=oe(re.UseRouteError);return void 0!==t?t:null==(e=l.errors)?void 0:e[n]}(),t=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),l=e instanceof Error?e.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return a.createElement(a.Fragment,null,a.createElement("h2",null,"Unexpected Application Error!"),a.createElement("h3",{style:{fontStyle:"italic"}},t),l?a.createElement("pre",{style:n},l):null,null)}const ae=a.createElement(ee,null);class te extends a.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,a){return a.location!==e.location||"idle"!==a.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:a.error,location:a.location,revalidation:e.revalidation||a.revalidation}}componentDidCatch(e,a){console.error("React Router caught the following error during render",e,a)}render(){return void 0!==this.state.error?a.createElement(z.Provider,{value:this.props.routeContext},a.createElement(H.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function le(e){let{routeContext:t,match:l,children:n}=e,r=a.useContext(V);return r&&r.static&&r.staticContext&&(l.route.errorElement||l.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=l.route.id),a.createElement(z.Provider,{value:t},n)}var ne=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ne||{}),re=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(re||{});function oe(e){let t=function(){let e=a.useContext(z);return e||s(!1),e}(),l=t.matches[t.matches.length-1];return l.route.id||s(!1),l.route.id}const se={};function ie(e){let{to:t,replace:l,state:n,relative:r}=e;W()||s(!1);let{future:o,static:i}=a.useContext(j),{matches:c}=a.useContext(z),{pathname:u}=K(),p=Z(),d=R(t,I(c,o.v7_relativeSplatPath),u,"path"===r),m=JSON.stringify(d);return a.useEffect(()=>p(JSON.parse(m),{replace:l,state:n,relative:r}),[p,m,r,l,n]),null}function ce(e){s(!1)}function ue(e){let{basename:t="/",children:l=null,location:n,navigationType:o=r.Pop,navigator:i,static:c=!1,future:u}=e;W()&&s(!1);let p=t.replace(/^\/*/,"/"),m=a.useMemo(()=>({basename:p,navigator:i,static:c,future:U({v7_relativeSplatPath:!1},u)}),[p,u,i,c]);"string"==typeof n&&(n=d(n));let{pathname:_="/",search:v="",hash:g="",state:h=null,key:b="default"}=n,E=a.useMemo(()=>{let e=k(_,p);return null==e?null:{location:{pathname:e,search:v,hash:g,state:h,key:b},navigationType:o}},[p,_,v,g,h,b,o]);return null==E?null:a.createElement(j.Provider,{value:m},a.createElement(q.Provider,{children:l,value:E}))}function pe(e){let{children:a,location:t}=e;return X(de(a),t)}function de(e,t){void 0===t&&(t=[]);let l=[];return a.Children.forEach(e,(e,n)=>{if(!a.isValidElement(e))return;let r=[...t,n];if(e.type===a.Fragment)return void l.push.apply(l,de(e.props.children,r));e.type!==ce&&s(!1),e.props.index&&e.props.children&&s(!1);let o={id:e.props.id||r.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=de(e.props.children,r)),l.push(o)}),l}function me(){return me=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},me.apply(this,arguments)}function _e(e,a){if(null==e)return{};var t,l,n={},r=Object.keys(e);for(l=0;l<r.length;l++)t=r[l],a.indexOf(t)>=0||(n[t]=e[t]);return n}function ve(e){return void 0===e&&(e=""),new URLSearchParams("string"==typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((a,t)=>{let l=e[t];return a.concat(Array.isArray(l)?l.map(e=>[t,e]):[[t,l]])},[]))}a.startTransition,new Promise(()=>{}),a.Component,new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const ge=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],he=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"];try{window.__reactRouterVersion="6"}catch(e){}const be=a.createContext({isTransitioning:!1});new Map;const Ee=a.startTransition;function fe(e){let{basename:t,children:l,future:m,window:_}=e,v=a.useRef();var g;null==v.current&&(v.current=(void 0===(g={window:_,v5Compat:!0})&&(g={}),function(e,a,t,l){void 0===l&&(l={});let{window:i=document.defaultView,v5Compat:d=!1}=l,m=i.history,_=r.Pop,v=null,g=h();function h(){return(m.state||{idx:null}).idx}function b(){_=r.Pop;let e=h(),a=null==e?null:e-g;g=e,v&&v({action:_,location:f.location,delta:a})}function E(e){let a="null"!==i.location.origin?i.location.origin:i.location.href,t="string"==typeof e?e:p(e);return t=t.replace(/ $/,"%20"),s(a,"No window.location.(origin|href) available to create URL for href: "+t),new URL(t,a)}null==g&&(g=0,m.replaceState(n({},m.state,{idx:g}),""));let f={get action(){return _},get location(){return e(i,m)},listen(e){if(v)throw new Error("A history only accepts one active listener");return i.addEventListener(o,b),v=e,()=>{i.removeEventListener(o,b),v=null}},createHref:e=>a(i,e),createURL:E,encodeLocation(e){let a=E(e);return{pathname:a.pathname,search:a.search,hash:a.hash}},push:function(e,a){_=r.Push;let l=u(f.location,e,a);t&&t(l,e),g=h()+1;let n=c(l,g),o=f.createHref(l);try{m.pushState(n,"",o)}catch(e){if(e instanceof DOMException&&"DataCloneError"===e.name)throw e;i.location.assign(o)}d&&v&&v({action:_,location:f.location,delta:1})},replace:function(e,a){_=r.Replace;let l=u(f.location,e,a);t&&t(l,e),g=h();let n=c(l,g),o=f.createHref(l);m.replaceState(n,"",o),d&&v&&v({action:_,location:f.location,delta:0})},go:e=>m.go(e)};return f}(function(e,a){let{pathname:t="/",search:l="",hash:n=""}=d(e.location.hash.substr(1));return t.startsWith("/")||t.startsWith(".")||(t="/"+t),u("",{pathname:t,search:l,hash:n},a.state&&a.state.usr||null,a.state&&a.state.key||"default")},function(e,a){let t=e.document.querySelector("base"),l="";if(t&&t.getAttribute("href")){let a=e.location.href,t=a.indexOf("#");l=-1===t?a:a.slice(0,t)}return l+"#"+("string"==typeof a?a:p(a))},function(e,a){i("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")},g)));let h=v.current,[b,E]=a.useState({action:h.action,location:h.location}),{v7_startTransition:f}=m||{},y=a.useCallback(e=>{f&&Ee?Ee(()=>E(e)):E(e)},[E,f]);return a.useLayoutEffect(()=>h.listen(y),[h,y]),a.useEffect(()=>{return null==(e=m)||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!a||a.v7_relativeSplatPath),void(a&&(a.v7_fetcherPersist,a.v7_normalizeFormMethod,a.v7_partialHydration,a.v7_skipActionErrorRevalidation));var e,a},[m]),a.createElement(ue,{basename:t,children:l,location:b.location,navigationType:b.action,navigator:h,future:m})}l.flushSync,a.useId;const ye="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,Ne=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Se=a.forwardRef(function(e,t){let l,{onClick:n,relative:r,reloadDocument:o,replace:i,state:c,target:u,to:d,preventScrollReset:m,viewTransition:_}=e,v=_e(e,ge),{basename:g}=a.useContext(j),h=!1;if("string"==typeof d&&Ne.test(d)&&(l=d,ye))try{let e=new URL(window.location.href),a=d.startsWith("//")?new URL(e.protocol+d):new URL(d),t=k(a.pathname,g);a.origin===e.origin&&null!=t?d=t+a.search+a.hash:h=!0}catch(e){}let b=function(e,t){let{relative:l}=void 0===t?{}:t;W()||s(!1);let{basename:n,navigator:r}=a.useContext(j),{hash:o,pathname:i,search:c}=Q(e,{relative:l}),u=i;return"/"!==n&&(u="/"===i?n:$([n,i])),r.createHref({pathname:u,search:c,hash:o})}(d,{relative:r}),E=function(e,t){let{target:l,replace:n,state:r,preventScrollReset:o,relative:s,viewTransition:i}=void 0===t?{}:t,c=Z(),u=K(),d=Q(e,{relative:s});return a.useCallback(a=>{if(function(e,a){return!(0!==e.button||a&&"_self"!==a||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(a,l)){a.preventDefault();let t=void 0!==n?n:p(u)===p(d);c(e,{replace:t,state:r,preventScrollReset:o,relative:s,viewTransition:i})}},[u,c,d,n,r,l,e,o,s,i])}(d,{replace:i,state:c,target:u,preventScrollReset:m,relative:r,viewTransition:_});return a.createElement("a",me({},v,{href:l||b,onClick:h||o?n:function(e){n&&n(e),e.defaultPrevented||E(e)},ref:t,target:u}))}),Ce=a.forwardRef(function(e,t){let{"aria-current":l="page",caseSensitive:n=!1,className:r="",end:o=!1,style:i,to:c,viewTransition:u,children:p}=e,d=_e(e,he),m=Q(c,{relative:d.relative}),_=K(),v=a.useContext(O),{navigator:g,basename:h}=a.useContext(j),b=null!=v&&function(e,t){void 0===t&&(t={});let l=a.useContext(be);null==l&&s(!1);let{basename:n}=function(){let e=a.useContext(V);return e||s(!1),e}(we.useViewTransitionState),r=Q(e,{relative:t.relative});if(!l.isTransitioning)return!1;let o=k(l.currentLocation.pathname,n)||l.currentLocation.pathname,i=k(l.nextLocation.pathname,n)||l.nextLocation.pathname;return null!=x(r.pathname,i)||null!=x(r.pathname,o)}(m)&&!0===u,E=g.encodeLocation?g.encodeLocation(m).pathname:m.pathname,f=_.pathname,y=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;n||(f=f.toLowerCase(),y=y?y.toLowerCase():null,E=E.toLowerCase()),y&&h&&(y=k(y,h)||y);const N="/"!==E&&E.endsWith("/")?E.length-1:E.length;let S,C=f===E||!o&&f.startsWith(E)&&"/"===f.charAt(N),w=null!=y&&(y===E||!o&&y.startsWith(E)&&"/"===y.charAt(E.length)),P={isActive:C,isPending:w,isTransitioning:b},T=C?l:void 0;S="function"==typeof r?r(P):[r,C?"active":null,w?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let M="function"==typeof i?i(P):i;return a.createElement(Se,me({},d,{"aria-current":T,className:S,ref:t,style:M,to:c,viewTransition:u}),"function"==typeof p?p(P):p)});var we,xe;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(we||(we={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(xe||(xe={}));const Pe=window.wp.apiFetch;var ke=e.n(Pe);const Te=window.CASANOVA_GESTION_RESERVAS||{},Me=(Te.restUrl||`${window.location.origin}/wp-json/travel/v1`).replace(/\/$/,""),Ae=(()=>{let e=!1;return()=>{if(e)return;const a=Te.restUrl?Te.restUrl.replace(/\/travel\/v1\/?$/,"/"):Te.apiUrl?Te.apiUrl.replace(/\/travel\/v1\/?$/,"/"):`${window.location.origin}/wp-json/`;a&&ke().use(ke().createRootURLMiddleware(a)),Te.nonce&&ke().use(ke().createNonceMiddleware(Te.nonce)),e=!0}})(),Ie=async(e,a={})=>{const t={"X-WP-Nonce":Te.nonce||"",...a.headers},l={method:a.method||"GET",credentials:"include",headers:t};void 0!==a.body&&(t["Content-Type"]="application/json",l.body=JSON.stringify(a.body));const n=await fetch((e=>{const a=e.replace(/^\/+/,"");return new URL(a,`${Me}/`).toString()})(e),l);return(async e=>{const a=-1!==(e.headers.get("content-type")||"").indexOf("application/json")?await e.json():null;if(e.ok)return a;const t=new Error(a?.message||"No se pudo completar la solicitud");throw t.status=e.status,t})(n)},Re=async(e={})=>{var a,t;const l=await Ie(((e={})=>{var a,t;const l=new URLSearchParams,n=(e,a)=>{null!=a&&""!==a&&l.set(e,String(a))};return n("q",e.search),n("status",e.status),n("sort",e.sortBy||"updated_at"),n("order",e.order||"desc"),n("page",null!==(a=e.page)&&void 0!==a?a:1),n("per_page",null!==(t=e.perPage)&&void 0!==t?t:50),`proposals?${l.toString()}`})(e)),n=Array.isArray(l?.items)?l.items:[];return{items:n,total:"number"==typeof l?.total?l.total:n.length,page:null!==(a=l?.page)&&void 0!==a?a:1,per_page:null!==(t=l?.per_page)&&void 0!==t?t:50}},$e=e=>Ie(`proposals/${e}/detail`),Be=async e=>e?(Ae(),ke()({path:`/travel/v1/versions/${e}/giav-preflight`,method:"GET"})):Promise.reject(new Error("Versión inválida")),Ge=async e=>e?(Ae(),ke()({path:`/travel/v1/proposals/${e}/giav-retry`,method:"POST"})):Promise.reject(new Error("ID de propuesta inválido")),De=async(e={})=>{var a,t,l;const n=await Ie(((e={})=>{var a,t;const l=new URLSearchParams,n=(e,a)=>{null!=a&&""!==a&&l.set(e,String(a))};return n("q",e.search),n("status",e.status),n("lang",e.lang),n("form",e.form),n("page",null!==(a=e.page)&&void 0!==a?a:1),n("per_page",null!==(t=e.perPage)&&void 0!==t?t:20),`requests?${l.toString()}`})(e));return{items:Array.isArray(n?.items)?n.items:[],total:"number"==typeof n?.total?n.total:0,page:null!==(a=n?.page)&&void 0!==a?a:1,per_page:null!==(t=n?.per_page)&&void 0!==t?t:20,total_pages:null!==(l=n?.total_pages)&&void 0!==l?l:0}},Le=e=>Ie(`requests/${e}`),Fe=(e,a)=>Ie(`requests/${e}/status`,{method:"POST",body:a}),Ue=e=>Ie(`requests/${e}/convert`,{method:"POST"});function Ve(e){return(0,a.createElement)("svg",{viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",...e},(0,a.createElement)("path",{d:"M12 20h9",stroke:"currentColor",strokeLinecap:"round"}),(0,a.createElement)("path",{d:"M16.5 3.5a2.1 2.1 0 0 1 3 3L8 18l-4 1 1-4L16.5 3.5Z",stroke:"currentColor",strokeLinejoin:"round"}))}function Oe(e){return(0,a.createElement)("svg",{viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",...e},(0,a.createElement)("path",{d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z",stroke:"currentColor"}),(0,a.createElement)("path",{d:"M3 12h18",stroke:"currentColor",strokeLinecap:"round"}),(0,a.createElement)("path",{d:"M12 3c2.8 3 4.2 6 4.2 9s-1.4 6-4.2 9c-2.8-3-4.2-6-4.2-9S9.2 6 12 3Z",stroke:"currentColor",strokeLinejoin:"round"}))}function je(e){return(0,a.createElement)("svg",{viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",...e},(0,a.createElement)("path",{d:"M10 13a5 5 0 0 0 7.1 0l1.4-1.4a5 5 0 0 0-7.1-7.1L10.6 4",stroke:"currentColor",strokeLinecap:"round"}),(0,a.createElement)("path",{d:"M14 11a5 5 0 0 0-7.1 0L5.5 12.4a5 5 0 0 0 7.1 7.1L13.4 20",stroke:"currentColor",strokeLinecap:"round"}))}function qe({proposal:e}){const t=e?.public_url||"",l=(0,a.useMemo)(()=>`/propuesta/${e?.id}/editar`,[e?.id]),n="undefined"!=typeof navigator&&!!navigator.clipboard,r=!t||!n,o=t?n?"Copiar enlace":"Tu navegador no permite copiar al portapapeles":"No hay enlace público disponible";return(0,a.createElement)("div",{className:"cg-row-actions-inline"},(0,a.createElement)(Se,{to:l,className:"cg-row-actions-inline__icon",title:"Editar propuesta","aria-label":"Editar propuesta"},(0,a.createElement)(Ve,{className:"cg-row-actions-inline__svg"})),t?(0,a.createElement)("a",{href:t,target:"_blank",rel:"noreferrer",className:"cg-row-actions-inline__icon",title:"Vista pública","aria-label":"Vista pública"},(0,a.createElement)(Oe,{className:"cg-row-actions-inline__svg"})):(0,a.createElement)("button",{type:"button",className:"cg-row-actions-inline__icon cg-row-actions-inline__icon--disabled",disabled:!0,title:"No hay vista pública disponible","aria-label":"Vista pública no disponible"},(0,a.createElement)(Oe,{className:"cg-row-actions-inline__svg"})),(0,a.createElement)("button",{type:"button",className:"cg-row-actions-inline__icon",onClick:async()=>{if(t&&n)try{await navigator.clipboard.writeText(t)}catch(e){}},disabled:r,title:o,"aria-label":o},(0,a.createElement)(je,{className:"cg-row-actions-inline__svg"})))}function ze(e="",a="",t=""){const l=[(e||"").trim(),(a||"").trim()].filter(Boolean).join(" ").trim();return l||(t||"").trim()}function He(e=""){const a=(e||"").trim();if(!a)return{firstName:"",lastName:""};const t=a.split(/\s+/);return{firstName:t.shift()||"",lastName:t.join(" ")}}const We={draft:"Borrador",sent:"Enviada",accepted:"Aceptada",queued:"En cola",synced:"Sincronizada",error:"Error",revoked:"Revocada",lost:"Perdida"},Ke=[{value:"all",label:"Todos los estados"},...Object.entries(We).map(([e,a])=>({value:e,label:a}))],Je=[{key:"id",label:"ID"},{key:"proposal_title",label:"Título"},{key:"customer_name",label:"Cliente"},{key:"author_name",label:"Autor"},{key:"status",label:"Estado"},{key:"updated_at",label:"Última actualización"},{key:"totals_sell_price",label:"Total"}],Ze=({column:e,sortBy:t,order:l})=>{const n=t===e?l:"none";return(0,a.createElement)("span",{className:`casanova-portal-table__sort-icon is-${n}`,"aria-hidden":"true"})},Ye=()=>{const[e,l]=function(e){let t=a.useRef(ve(e)),l=a.useRef(!1),n=K(),r=a.useMemo(()=>function(e,a){let t=ve(e);return a&&a.forEach((e,l)=>{t.has(l)||a.getAll(l).forEach(e=>{t.append(l,e)})}),t}(n.search,l.current?null:t.current),[n.search]),o=Z(),s=a.useCallback((e,a)=>{const t=ve("function"==typeof e?e(r):e);l.current=!0,o("?"+t,a)},[o,r]);return[r,s]}(),n=Je.map(e=>e.key),r=e.get("q")||"",o=e.get("status")||"all",s=e.get("sort")||"updated_at",i=(e.get("order")||"desc").toLowerCase(),c=e=>n.includes(e)?e:"updated_at",[u,p]=(0,t.useState)(r),[d,m]=(0,t.useState)(r),[_,v]=(0,t.useState)(o),[g,h]=(0,t.useState)(c(s)),[b,E]=(0,t.useState)("asc"===i?"asc":"desc"),[f,y]=(0,t.useState)([]),[N,S]=(0,t.useState)(!1),[C,w]=(0,t.useState)(""),x=(0,t.useCallback)(async()=>{S(!0),w("");try{const e=await Re({search:d,status:"all"!==_?_:void 0,sortBy:g,order:b});y(e.items)}catch(e){w(e.message||"No se pudo cargar el listado.")}finally{S(!1)}},[d,_,g,b]);return(0,t.useEffect)(()=>{const e=setTimeout(()=>{m(u.trim())},350);return()=>clearTimeout(e)},[u]),(0,t.useEffect)(()=>{const e={};d&&(e.q=d),_&&"all"!==_&&(e.status=_),g&&(e.sort=g),b&&(e.order=b),l(e,{replace:!0}),x()},[d,_,g,b,x,l]),(0,a.createElement)("div",{className:"casanova-portal-section"},(0,a.createElement)("header",{className:"casanova-portal-section__header"},(0,a.createElement)("div",null,(0,a.createElement)("h2",null,"Repositorio de propuestas"),(0,a.createElement)("p",null,"Revisa estados, clientes y detalles sin salir del portal.")),(0,a.createElement)("div",{className:"casanova-portal-section__actions"},(0,a.createElement)(Se,{className:"button-secondary",to:"/nueva"},"Nueva propuesta"),(0,a.createElement)("button",{className:"button-primary",onClick:x,disabled:N},"Refrescar"))),(0,a.createElement)("div",{className:"casanova-portal-filters"},(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Buscar"),(0,a.createElement)("input",{type:"search",value:u,onChange:e=>p(e.target.value),placeholder:"Cliente, email, token o ID"})),(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Estado"),(0,a.createElement)("select",{value:_,onChange:e=>v(e.target.value)},Ke.map(e=>(0,a.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Ordenar por"),(0,a.createElement)("select",{value:g,onChange:e=>h(c(e.target.value))},Je.map(e=>(0,a.createElement)("option",{key:e.key,value:e.key},e.label)))),(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Orden"),(0,a.createElement)("select",{value:b,onChange:e=>E("asc"===e.target.value?"asc":"desc")},(0,a.createElement)("option",{value:"desc"},"Descendente"),(0,a.createElement)("option",{value:"asc"},"Ascendente"))),(0,a.createElement)("div",{className:"casanova-portal-filters__actions"},(0,a.createElement)("button",{className:"button-secondary",onClick:()=>{p(""),v("all"),h("updated_at"),E("desc")}},"Limpiar filtros"))),C?(0,a.createElement)("div",{className:"casanova-portal-section__notice"},(0,a.createElement)("span",null,C)):null,(0,a.createElement)("div",{className:"casanova-portal-table"},(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--header"},Je.map(e=>(0,a.createElement)("span",{key:e.key},(0,a.createElement)("button",{type:"button",className:"casanova-portal-table__sort-button",onClick:()=>(e=>{g!==e?(h(e),E("desc")):E(e=>"asc"===e?"desc":"asc")})(e.key)},e.label,(0,a.createElement)(Ze,{column:e.key,sortBy:g,order:b})))),(0,a.createElement)("span",null,"Acciones")),N?(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--loading"},"Cargando propuestas…"):null,N||0!==f.length?null:(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--empty"},"No hay propuestas que coincidan con los filtros seleccionados."),!N&&f.map(e=>{var t;return(0,a.createElement)("div",{key:e.id,className:"casanova-portal-table__row casanova-portal-table__row--item"},(0,a.createElement)("span",null,"#",e.id),(0,a.createElement)("span",null,e.display_title||e.proposal_title||"Propuesta sin título"),(0,a.createElement)("span",null,ze(e.first_name,e.last_name,e.customer_name)||e.customer_email||"—"),(0,a.createElement)("span",null,e.author_name||"—"),(0,a.createElement)("span",null,(0,a.createElement)("span",{className:`status-chip status-chip--${(e.status||"draft").replace(/[^a-z0-9_-]/gi,"-")}`},We[e.status]||e.status||"—")),(0,a.createElement)("span",null,(e=>{if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString("es-ES",{dateStyle:"medium",timeStyle:"short"})})(e.updated_at)),(0,a.createElement)("span",null,((e,a)=>{if(null==e)return"—";const t=Number(e);return Number.isNaN(t)?String(e):new Intl.NumberFormat("es-ES",{style:"currency",currency:a||"EUR",maximumFractionDigits:2}).format(t)})(null!==(t=e.current_version_total)&&void 0!==t?t:e.totals_sell_price,e.currency)),(0,a.createElement)("span",{className:"casanova-portal-table__actions"},(0,a.createElement)(Se,{className:"button-secondary casanova-portal-table__action",to:`/propuesta/${e.id}`},"Ver detalle"),(0,a.createElement)(qe,{proposal:e})))})))},Qe={admin:"Admin",client:"Cliente"},Xe={none:"No iniciado",pending:"En proceso",ok:"Creado",error:"Error"},ea=e=>{if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString("es-ES",{dateStyle:"medium",timeStyle:"short"})};function aa(){var e;const{proposalId:l}=Y(),n=Z(),[r,o]=(0,t.useState)(null),[s,i]=(0,t.useState)(!1),[c,u]=(0,t.useState)(""),[p,d]=(0,t.useState)(""),[m,_]=(0,t.useState)(""),[v,g]=(0,t.useState)(!1),[h,b]=(0,t.useState)(""),[E,f]=(0,t.useState)(!1),[y,N]=(0,t.useState)(!1),[S,C]=(0,t.useState)(""),w=async()=>{i(!0),u("");try{const e=await $e(l);o(e)}catch(e){u(e?.message||"No se pudo cargar la propuesta.")}finally{i(!1)}};(0,t.useEffect)(()=>{if(!l)return o(null),void u("Propuesta no encontrada.");w()},[l]),(0,t.useEffect)(()=>{const e=r?.proposal?.current_version_id;b(e?String(e):"")},[r?.proposal?.current_version_id]),(0,t.useEffect)(()=>{let e=!1;const a=r?.proposal?.accepted_version_id;if(a)return Be(a).then(()=>{e||C("")}).catch(a=>{e||(503===(a?.data?.status||a?.status)||(a?.message||a?.data?.message||"").includes("DB"))&&C("La base de datos no está actualizada. Ejecuta migraciones.")}),()=>{e=!0};C("")},[r?.proposal?.accepted_version_id]);const x=r?.proposal,P=r?.versions||[],k=x&&ze(x.first_name,x.last_name,x.customer_name)||"Sin nombre";(0,t.useEffect)(()=>{x&&(x.public_url||r?.current_snapshot?.public_url)&&g(!1)},[x?.public_url]);const T=P.find(e=>Number(e.id)===Number(x?.accepted_version_id)),M=P.find(e=>String(e.id)===h),A=[{value:"",label:"Selecciona una versión"}].concat(P.map(e=>{var a;return{value:String(e.id),label:`#${null!==(a=e.version_number)&&void 0!==a?a:e.id} · ${ea(e.created_at)}`}})),I="confirmed"===x?.confirmation_status?"Confirmada":"pending"===x?.confirmation_status?"Pendiente":"-",R="accepted"===x?.status,$=x?.giav_sync_status||"none",B=Xe[$]||$||"-",G=Boolean(x?.giav_expediente_id),D="pending"===$,L="error"===$,F=[{label:"ID cliente",value:x?.giav_client_id},{label:"ID expediente",value:x?.giav_expediente_id},{label:"ID reserva PQ",value:x?.giav_pq_reserva_id}].filter(e=>e.value),U=async()=>{if(x){N(!0),d(""),_("");try{await Ge(x.id),_("error"===x.giav_sync_status?"Solicitud de reintento en GIAV enviada correctamente.":"Expediente solicitado en GIAV."),await w()}catch(e){d(e?.message||"No se pudo crear el expediente en GIAV.")}finally{N(!1)}}};return s&&!x?(0,a.createElement)("div",{className:"casanova-portal-section"},"Cargando detalle…"):c&&!x?(0,a.createElement)("div",{className:"casanova-portal-section"},(0,a.createElement)("div",{className:"casanova-portal-section__notice"},c)):x?(0,a.createElement)("div",{className:"casanova-portal-section"},(0,a.createElement)("header",{className:"casanova-portal-detail__header"},(0,a.createElement)("div",null,(0,a.createElement)("p",{className:"casanova-portal__eyebrow"},"Propuesta #",x.id),(0,a.createElement)("h2",null,x.proposal_title||"Nueva propuesta"),(0,a.createElement)("p",null,k," · ",x.customer_email)),(0,a.createElement)("div",{className:"casanova-portal-detail__actions"},(0,a.createElement)("button",{type:"button",className:"button-secondary",onClick:()=>{const e=x.public_url||r?.current_snapshot?.public_url;e&&window.open(e,"_blank","noopener,noreferrer")},disabled:!x.public_url&&!r?.current_snapshot?.public_url},"Abrir vista pública"),(0,a.createElement)("button",{type:"button",className:"button-secondary",onClick:async()=>{const e=x?.public_url||r?.current_snapshot?.public_url;if(e)try{await navigator.clipboard.writeText(e),g(!0),window.setTimeout(()=>g(!1),1500)}catch(e){console.error(e)}},disabled:!x.public_url&&!r?.current_snapshot?.public_url},v?"Copiado":"Copiar enlace"),(0,a.createElement)("button",{type:"button",className:"button-primary",onClick:()=>n("/proposals")},"Volver al listado"))),p&&(0,a.createElement)("div",{className:"casanova-portal-section__notice casanova-portal-section__notice--error"},p),m&&(0,a.createElement)("div",{className:"casanova-portal-section__notice casanova-portal-section__notice--success"},m),(0,a.createElement)("div",{className:"casanova-portal-detail__grid"},(0,a.createElement)("div",{className:"casanova-portal-card"},(0,a.createElement)("h3",null,"Resumen"),(0,a.createElement)("p",null,"Fechas: ",x.start_date||"—"," — ",x.end_date||"—"),(0,a.createElement)("p",null,"Estado: ",x.status||"—"),(0,a.createElement)("p",null,"PAX: ",x.pax_total||0),(0,a.createElement)("p",null,"Jugadores: ",x.players_count||0),(0,a.createElement)("p",null,"Total estimado:"," ",r?.current_version?.totals_sell_price?`${r.current_version.totals_sell_price} ${x.currency||""}`:"—")),(0,a.createElement)("div",{className:"casanova-portal-card"},(0,a.createElement)("h3",null,"Aceptación"),(0,a.createElement)("p",{className:"proposal-detail__helper"},"Estado: ",x.confirmation_status?x.confirmation_status:"Pendiente"),R?(0,a.createElement)("div",{className:"proposal-detail__grid"},(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"proposal-detail__label"},"Versión aceptada"),(0,a.createElement)("div",{className:"proposal-detail__value"},T?`#${null!==(e=T.version_number)&&void 0!==e?e:T.id}`:x.accepted_version_id||"—")),(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"proposal-detail__label"},"Aceptada por"),(0,a.createElement)("div",{className:"proposal-detail__value"},Qe[x.accepted_by]||x.accepted_by||"—")),(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"proposal-detail__label"},"Fecha de aceptación"),(0,a.createElement)("div",{className:"proposal-detail__value"},ea(x.accepted_at))),(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"proposal-detail__label"},"Confirmación"),(0,a.createElement)("div",{className:"proposal-detail__value"},I))):(0,a.createElement)("div",{className:"proposal-detail__block"},(0,a.createElement)("label",{htmlFor:"proposal-accept-version",className:"proposal-detail__label"},"Versión a aceptar"),(0,a.createElement)("select",{id:"proposal-accept-version",className:"proposal-detail__select",value:h,onChange:e=>b(e.target.value),disabled:E||0===A.length},A.map(e=>(0,a.createElement)("option",{key:e.value,value:e.value},e.label))),(0,a.createElement)("div",{className:"proposal-detail__button-row"},(0,a.createElement)("button",{type:"button",className:"button-primary",onClick:async()=>{if(!x?.id)return void d("No se encontró la propuesta.");if(!M?.id)return void d("Selecciona una versión para aceptar.");const e=M.version_number?`#${M.version_number}`:`#${M.id}`;if(window.confirm(`¿Confirmas que la versión ${e} se marcará como aceptada? Esta acción no se puede deshacer fácilmente.`)){f(!0),d(""),_("");try{await(async(e,a)=>e?a?(Ae(),ke()({path:`/travel/v1/proposals/${e}/accept`,method:"POST",data:{version_id:a}})):Promise.reject(new Error("Selecciona una versión a aceptar")):Promise.reject(new Error("ID de propuesta inválido")))(x.id,M.id),_(`Versión ${e} marcada como aceptada.`),await w()}catch(e){d(e?.message||"No se pudo marcar como aceptada.")}finally{f(!1)}}},disabled:E||!M},E?"Procesando…":"Marcar como aceptada")))),(0,a.createElement)("div",{className:"casanova-portal-card"},(0,a.createElement)("h3",null,"Integración GIAV"),(0,a.createElement)("div",{className:"proposal-detail__section-title"},(0,a.createElement)("span",{className:"proposal-detail__pill proposal-detail__pill--"+("ok"===$?"success":"error"===$?"danger":"pending"===$?"warning":"neutral")},B)),(0,a.createElement)("div",{className:"proposal-detail__block"},F.length>0?(0,a.createElement)("div",{className:"proposal-detail__grid"},F.map(e=>(0,a.createElement)("div",{key:e.label},(0,a.createElement)("div",{className:"proposal-detail__label"},e.label),(0,a.createElement)("div",{className:"proposal-detail__value"},e.value))),x.giav_sync_updated_at&&(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"proposal-detail__label"},"Última actualización"),(0,a.createElement)("div",{className:"proposal-detail__value"},ea(x.giav_sync_updated_at)))):(0,a.createElement)("p",{className:"proposal-detail__helper"},"Aún no hay identificadores de GIAV vinculados."),x.giav_sync_error&&(0,a.createElement)("div",{className:"proposal-detail__error"},(0,a.createElement)("strong",null,"Error:")," ",x.giav_sync_error),(0,a.createElement)("div",{className:"proposal-detail__cta"},R?L&&!G?(0,a.createElement)("button",{type:"button",className:"button-primary",disabled:y||Boolean(S),onClick:U,title:S||"Se reintentará la creación del expediente en GIAV y se actualizará el estado."},y?"Creando…":"Reintentar GIAV"):G||D?D?(0,a.createElement)("span",{className:"proposal-detail__helper"},"En proceso de creación en GIAV."):(0,a.createElement)("span",{className:"proposal-detail__helper"},"Expediente creado y sincronizado."):(0,a.createElement)("button",{type:"button",className:"button-primary",disabled:y||Boolean(S),onClick:U,title:S||"Crear expediente en GIAV. Esta acción puede tardar varios segundos."},y?"Creando…":"Crear expediente en GIAV"):(0,a.createElement)("span",{className:"proposal-detail__helper"},"Necesitas aceptar una versión antes de crear expediente en GIAV."),S&&(0,a.createElement)("p",{className:"proposal-detail__helper"},S))))),(0,a.createElement)("div",{className:"casanova-portal-detail__actions-row"},(0,a.createElement)("button",{type:"button",className:"button-primary",onClick:()=>n("/proposals")},"Editar propuesta"),(0,a.createElement)("button",{type:"button",className:"button-secondary",onClick:()=>{window.open(((e={})=>{const a=new URL(window.location.href);return a.searchParams.set("page","travel_proposals"),a.searchParams.delete("proposal_id"),a.searchParams.delete("action"),Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t?a.searchParams.set(e,t):a.searchParams.delete(e)}),a.toString()})({proposal_id:l,action:"edit"}),"_blank")}},"Abrir wizard en wp-admin")),(0,a.createElement)("div",{className:"casanova-portal-card"},(0,a.createElement)("h3",null,"Versiones"),(0,a.createElement)("div",{className:"casanova-portal-table"},(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--header"},(0,a.createElement)("span",null,"Versión"),(0,a.createElement)("span",null,"Fecha"),(0,a.createElement)("span",null,"Total"),(0,a.createElement)("span",null,"Publicación")),P.length?P.map(e=>{var t,l;return(0,a.createElement)("div",{key:e.id,className:"casanova-portal-table__row"},(0,a.createElement)("span",null,null!==(t=e.version_number)&&void 0!==t?t:e.id),(0,a.createElement)("span",null,ea(e.created_at)),(0,a.createElement)("span",null,null!==(l=e.totals_sell_price)&&void 0!==l?l:"—"),(0,a.createElement)("span",null,e.public_url?(0,a.createElement)("a",{href:e.public_url,target:"_blank",rel:"noreferrer"},"Vista pública"):"—"))}):(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--empty"},"No hay versiones registradas.")))):null}const ta=window.wp.components,la=window.WP_TRAVEL_GIAV||window.CASANOVA_GESTION_RESERVAS||{};if(!ke().__WP_TRAVEL_GIAV_CONFIGURED){const e=la.nonce||"",a=(e=>{if(e.wpRestRoot)return e.wpRestRoot;const a=e.apiUrl||e.restUrl;return a?a.replace(/\/travel\/v1\/?$/,"/"):"/wp-json/"})(la);a&&ke().use(ke().createRootURLMiddleware(a)),e&&ke().use(ke().createNonceMiddleware(e)),ke().__WP_TRAVEL_GIAV_CONFIGURED=!0}const na={createProposal:e=>ke()({path:"/travel/v1/proposals",method:"POST",data:e}),listProposals:({orderBy:e="updated_at",order:a="desc",limit:t=50,offset:l=0,search:n,author:r,page:o,per_page:s}={})=>{const i=new URLSearchParams;return i.set("order_by",e),i.set("order",a),i.set("limit",t),i.set("offset",l),void 0!==n&&i.set("search",n),void 0!==r&&i.set("author",r),void 0!==o&&i.set("page",o),void 0!==s&&i.set("per_page",s),ke()({path:`/travel/v1/proposals?${i.toString()}`,method:"GET"})},getProposal:e=>ke()({path:`/travel/v1/proposals/${e}`,method:"GET"}),getProposalDetail:e=>ke()({path:`/travel/v1/proposals/${e}/detail`,method:"GET"}),updateProposal:(e,a)=>ke()({path:`/travel/v1/proposals/${e}`,method:"PUT",data:a}),deleteProposal:e=>ke()({path:`/travel/v1/proposals/${e}`,method:"DELETE"}),bulkDeleteProposals:e=>ke()({path:"/travel/v1/proposals/bulk-delete",method:"POST",data:{ids:e}}),sendProposal:(e,a,t)=>ke()({path:`/travel/v1/proposals/${e}/send`,method:"POST",data:{snapshot:a,version_number:t}}),createProposalVersion:(e,a,t)=>ke()({path:`/travel/v1/proposals/${e}/versions`,method:"POST",data:{snapshot:a,version_number:t}}),setCurrentVersion:(e,a)=>ke()({path:`/travel/v1/proposals/${e}/current-version`,method:"POST",data:{version_id:a}}),acceptProposal:(e,a)=>ke()({path:`/travel/v1/proposals/${e}/accept`,method:"POST",data:{version_id:a}}),retryGiavSync:e=>ke()({path:`/travel/v1/proposals/${e}/giav-retry`,method:"POST"}),searchCatalog:({type:e,q:a})=>ke()({path:`/travel/v1/catalog/search?type=${encodeURIComponent(e)}&q=${encodeURIComponent(a||"")}`,method:"GET"}),getGiavMapping:({wp_object_type:e,wp_object_id:a})=>ke()({path:`/travel/v1/giav-mapping?wp_object_type=${encodeURIComponent(e)}&wp_object_id=${encodeURIComponent(a)}`,method:"GET"}),listGiavMappings:({type:e,q:a,limit:t=50,offset:l=0})=>ke()({path:`/travel/v1/giav-mapping/list?type=${encodeURIComponent(e)}&q=${encodeURIComponent(a||"")}&limit=${encodeURIComponent(t)}&offset=${encodeURIComponent(l)}`,method:"GET"}),upsertGiavMapping:e=>ke()({path:"/travel/v1/giav-mapping/upsert",method:"POST",data:e}),batchUpsertGiavMappings:({wp_object_type:e,giav_supplier_id:a,items:t,status:l="active",match_type:n="batch"})=>ke()({path:"/travel/v1/giav-mapping/batch-upsert",method:"POST",data:{wp_object_type:e,giav_supplier_id:a,items:t,status:l,match_type:n}}),listRequests:({status:e,lang:a,form:t,q:l,page:n=1,per_page:r=20}={})=>{const o=new URLSearchParams;return e&&o.set("status",e),a&&o.set("lang",a),t&&o.set("form",t),l&&o.set("q",l),o.set("page",n),o.set("per_page",r),ke()({path:`/travel/v1/requests?${o.toString()}`,method:"GET"})},convertRequest:e=>ke()({path:`/travel/v1/requests/${e}/convert`,method:"POST"}),searchGiavProviders:async({q:e,pageSize:a=20,pageIndex:t=0,includeDisabled:l=!1})=>{const n=await ke()({path:`/travel/v1/giav/providers/search?q=${encodeURIComponent(e)}&pageSize=${encodeURIComponent(a)}&pageIndex=${encodeURIComponent(t)}&includeDisabled=${encodeURIComponent(l)}`,method:"GET"});return{items:(Array.isArray(n)?n:Array.isArray(n?.items)?n.items:[]).map(e=>{var a,t,l,n,r,o,s,i;return{id:String(null!==(a=null!==(t=null!==(l=null!==(n=e.id)&&void 0!==n?n:e.ID)&&void 0!==l?l:e.Id)&&void 0!==t?t:e.proveedorId)&&void 0!==a?a:""),label:String(null!==(r=null!==(o=null!==(s=null!==(i=e.label)&&void 0!==i?i:e.NombreAlias)&&void 0!==s?s:e.Nombre)&&void 0!==o?o:e.title)&&void 0!==r?r:""),raw:e}}).filter(e=>e.id&&e.label)}},giavPreflight:e=>ke()({path:`/travel/v1/versions/${e}/giav-preflight`,method:"GET"}),confirmGiav:e=>ke()({path:`/travel/v1/versions/${e}/confirm`,method:"POST"}),getRequestMappingConfig:()=>ke()({path:"/travel/v1/requests/mapping",method:"GET"}),saveRequestFormsMapping:e=>ke()({path:"/travel/v1/requests/mapping",method:"POST",data:e}),getRequestFormMapping:e=>ke()({path:`/travel/v1/requests/mapping/${e}`,method:"GET"}),saveRequestFormMapping:(e,a)=>ke()({path:`/travel/v1/requests/mapping/${e}`,method:"POST",data:a})},ra=[{label:"Español",value:"es"},{label:"English",value:"en"}],oa=[{label:"EUR",value:"EUR"},{label:"USD",value:"USD"},{label:"GBP",value:"GBP"}],sa=[{value:"AF",label:"Afghanistan (AF)"},{value:"AL",label:"Albania (AL)"},{value:"DZ",label:"Algeria (DZ)"},{value:"AS",label:"American Samoa (AS)"},{value:"AD",label:"Andorra (AD)"},{value:"AO",label:"Angola (AO)"},{value:"AI",label:"Anguilla (AI)"},{value:"AQ",label:"Antarctica (AQ)"},{value:"AG",label:"Antigua and Barbuda (AG)"},{value:"AR",label:"Argentina (AR)"},{value:"AM",label:"Armenia (AM)"},{value:"AW",label:"Aruba (AW)"},{value:"AU",label:"Australia (AU)"},{value:"AT",label:"Austria (AT)"},{value:"AZ",label:"Azerbaijan (AZ)"},{value:"BS",label:"Bahamas (BS)"},{value:"BH",label:"Bahrain (BH)"},{value:"BD",label:"Bangladesh (BD)"},{value:"BB",label:"Barbados (BB)"},{value:"BY",label:"Belarus (BY)"},{value:"BE",label:"Belgium (BE)"},{value:"BZ",label:"Belize (BZ)"},{value:"BJ",label:"Benin (BJ)"},{value:"BM",label:"Bermuda (BM)"},{value:"BT",label:"Bhutan (BT)"},{value:"BO",label:"Bolivia (BO)"},{value:"BQ",label:"Bonaire, Sint Eustatius and Saba (BQ)"},{value:"BA",label:"Bosnia and Herzegovina (BA)"},{value:"BW",label:"Botswana (BW)"},{value:"BV",label:"Bouvet Island (BV)"},{value:"BR",label:"Brazil (BR)"},{value:"IO",label:"British Indian Ocean Territory (IO)"},{value:"BN",label:"Brunei (BN)"},{value:"BG",label:"Bulgaria (BG)"},{value:"BF",label:"Burkina Faso (BF)"},{value:"BI",label:"Burundi (BI)"},{value:"KH",label:"Cambodia (KH)"},{value:"CM",label:"Cameroon (CM)"},{value:"CA",label:"Canada (CA)"},{value:"CV",label:"Cape Verde (CV)"},{value:"KY",label:"Cayman Islands (KY)"},{value:"CF",label:"Central African Republic (CF)"},{value:"TD",label:"Chad (TD)"},{value:"CL",label:"Chile (CL)"},{value:"CN",label:"China (CN)"},{value:"CX",label:"Christmas Island (CX)"},{value:"CC",label:"Cocos (Keeling) Islands (CC)"},{value:"CO",label:"Colombia (CO)"},{value:"KM",label:"Comoros (KM)"},{value:"CG",label:"Congo (CG)"},{value:"CD",label:"Congo (Democratic Republic) (CD)"},{value:"CK",label:"Cook Islands (CK)"},{value:"CR",label:"Costa Rica (CR)"},{value:"CI",label:"Côte d’Ivoire (CI)"},{value:"HR",label:"Croatia (HR)"},{value:"CU",label:"Cuba (CU)"},{value:"CW",label:"Curaçao (CW)"},{value:"CY",label:"Cyprus (CY)"},{value:"CZ",label:"Czechia (CZ)"},{value:"DK",label:"Denmark (DK)"},{value:"DJ",label:"Djibouti (DJ)"},{value:"DM",label:"Dominica (DM)"},{value:"DO",label:"Dominican Republic (DO)"},{value:"EC",label:"Ecuador (EC)"},{value:"EG",label:"Egypt (EG)"},{value:"SV",label:"El Salvador (SV)"},{value:"GQ",label:"Equatorial Guinea (GQ)"},{value:"ER",label:"Eritrea (ER)"},{value:"EE",label:"Estonia (EE)"},{value:"ET",label:"Ethiopia (ET)"},{value:"FK",label:"Falkland Islands (FK)"},{value:"FO",label:"Faroe Islands (FO)"},{value:"FJ",label:"Fiji (FJ)"},{value:"FI",label:"Finland (FI)"},{value:"FR",label:"France (FR)"},{value:"GF",label:"French Guiana (GF)"},{value:"PF",label:"French Polynesia (PF)"},{value:"TF",label:"French Southern Territories (TF)"},{value:"GA",label:"Gabon (GA)"},{value:"GM",label:"Gambia (GM)"},{value:"GE",label:"Georgia (GE)"},{value:"DE",label:"Germany (DE)"},{value:"GH",label:"Ghana (GH)"},{value:"GI",label:"Gibraltar (GI)"},{value:"GR",label:"Greece (GR)"},{value:"GL",label:"Greenland (GL)"},{value:"GD",label:"Grenada (GD)"},{value:"GP",label:"Guadeloupe (GP)"},{value:"GU",label:"Guam (GU)"},{value:"GT",label:"Guatemala (GT)"},{value:"GG",label:"Guernsey (GG)"},{value:"GN",label:"Guinea (GN)"},{value:"GW",label:"Guinea-Bissau (GW)"},{value:"GY",label:"Guyana (GY)"},{value:"HT",label:"Haiti (HT)"},{value:"HM",label:"Heard Island and McDonald Islands (HM)"},{value:"HN",label:"Honduras (HN)"},{value:"HK",label:"Hong Kong (HK)"},{value:"HU",label:"Hungary (HU)"},{value:"IS",label:"Iceland (IS)"},{value:"IN",label:"India (IN)"},{value:"ID",label:"Indonesia (ID)"},{value:"IR",label:"Iran (IR)"},{value:"IQ",label:"Iraq (IQ)"},{value:"IE",label:"Ireland (IE)"},{value:"IM",label:"Isle of Man (IM)"},{value:"IL",label:"Israel (IL)"},{value:"IT",label:"Italy (IT)"},{value:"JM",label:"Jamaica (JM)"},{value:"JP",label:"Japan (JP)"},{value:"JE",label:"Jersey (JE)"},{value:"JO",label:"Jordan (JO)"},{value:"KZ",label:"Kazakhstan (KZ)"},{value:"KE",label:"Kenya (KE)"},{value:"KI",label:"Kiribati (KI)"},{value:"KP",label:"Korea (North) (KP)"},{value:"KR",label:"Korea (South) (KR)"},{value:"KW",label:"Kuwait (KW)"},{value:"KG",label:"Kyrgyzstan (KG)"},{value:"LA",label:"Laos (LA)"},{value:"LV",label:"Latvia (LV)"},{value:"LB",label:"Lebanon (LB)"},{value:"LS",label:"Lesotho (LS)"},{value:"LR",label:"Liberia (LR)"},{value:"LY",label:"Libya (LY)"},{value:"LI",label:"Liechtenstein (LI)"},{value:"LT",label:"Lithuania (LT)"},{value:"LU",label:"Luxembourg (LU)"},{value:"MO",label:"Macao (MO)"},{value:"MG",label:"Madagascar (MG)"},{value:"MW",label:"Malawi (MW)"},{value:"MY",label:"Malaysia (MY)"},{value:"MV",label:"Maldives (MV)"},{value:"ML",label:"Mali (ML)"},{value:"MT",label:"Malta (MT)"},{value:"MH",label:"Marshall Islands (MH)"},{value:"MQ",label:"Martinique (MQ)"},{value:"MR",label:"Mauritania (MR)"},{value:"MU",label:"Mauritius (MU)"},{value:"YT",label:"Mayotte (YT)"},{value:"MX",label:"Mexico (MX)"},{value:"FM",label:"Micronesia (FM)"},{value:"MD",label:"Moldova (MD)"},{value:"MC",label:"Monaco (MC)"},{value:"MN",label:"Mongolia (MN)"},{value:"ME",label:"Montenegro (ME)"},{value:"MS",label:"Montserrat (MS)"},{value:"MA",label:"Morocco (MA)"},{value:"MZ",label:"Mozambique (MZ)"},{value:"MM",label:"Myanmar (MM)"},{value:"NA",label:"Namibia (NA)"},{value:"NR",label:"Nauru (NR)"},{value:"NP",label:"Nepal (NP)"},{value:"NL",label:"Netherlands (NL)"},{value:"NC",label:"New Caledonia (NC)"},{value:"NZ",label:"New Zealand (NZ)"},{value:"NI",label:"Nicaragua (NI)"},{value:"NE",label:"Niger (NE)"},{value:"NG",label:"Nigeria (NG)"},{value:"NU",label:"Niue (NU)"},{value:"NF",label:"Norfolk Island (NF)"},{value:"MK",label:"North Macedonia (MK)"},{value:"MP",label:"Northern Mariana Islands (MP)"},{value:"NO",label:"Norway (NO)"},{value:"OM",label:"Oman (OM)"},{value:"PK",label:"Pakistan (PK)"},{value:"PW",label:"Palau (PW)"},{value:"PS",label:"Palestine (PS)"},{value:"PA",label:"Panama (PA)"},{value:"PG",label:"Papua New Guinea (PG)"},{value:"PY",label:"Paraguay (PY)"},{value:"PE",label:"Peru (PE)"},{value:"PH",label:"Philippines (PH)"},{value:"PN",label:"Pitcairn (PN)"},{value:"PL",label:"Poland (PL)"},{value:"PT",label:"Portugal (PT)"},{value:"PR",label:"Puerto Rico (PR)"},{value:"QA",label:"Qatar (QA)"},{value:"RE",label:"Réunion (RE)"},{value:"RO",label:"Romania (RO)"},{value:"RU",label:"Russia (RU)"},{value:"RW",label:"Rwanda (RW)"},{value:"BL",label:"Saint Barthélemy (BL)"},{value:"SH",label:"Saint Helena (SH)"},{value:"KN",label:"Saint Kitts and Nevis (KN)"},{value:"LC",label:"Saint Lucia (LC)"},{value:"MF",label:"Saint Martin (MF)"},{value:"PM",label:"Saint Pierre and Miquelon (PM)"},{value:"VC",label:"Saint Vincent and the Grenadines (VC)"},{value:"WS",label:"Samoa (WS)"},{value:"SM",label:"San Marino (SM)"},{value:"ST",label:"São Tomé and Príncipe (ST)"},{value:"SA",label:"Saudi Arabia (SA)"},{value:"SN",label:"Senegal (SN)"},{value:"RS",label:"Serbia (RS)"},{value:"SC",label:"Seychelles (SC)"},{value:"SL",label:"Sierra Leone (SL)"},{value:"SG",label:"Singapore (SG)"},{value:"SX",label:"Sint Maarten (SX)"},{value:"SK",label:"Slovakia (SK)"},{value:"SI",label:"Slovenia (SI)"},{value:"SB",label:"Solomon Islands (SB)"},{value:"SO",label:"Somalia (SO)"},{value:"ZA",label:"South Africa (ZA)"},{value:"GS",label:"South Georgia and the South Sandwich Islands (GS)"},{value:"SS",label:"South Sudan (SS)"},{value:"ES",label:"Spain (ES)"},{value:"LK",label:"Sri Lanka (LK)"},{value:"SD",label:"Sudan (SD)"},{value:"SR",label:"Suriname (SR)"},{value:"SJ",label:"Svalbard and Jan Mayen (SJ)"},{value:"SE",label:"Sweden (SE)"},{value:"CH",label:"Switzerland (CH)"},{value:"SY",label:"Syria (SY)"},{value:"TW",label:"Taiwan (TW)"},{value:"TJ",label:"Tajikistan (TJ)"},{value:"TZ",label:"Tanzania (TZ)"},{value:"TH",label:"Thailand (TH)"},{value:"TL",label:"Timor-Leste (TL)"},{value:"TG",label:"Togo (TG)"},{value:"TK",label:"Tokelau (TK)"},{value:"TO",label:"Tonga (TO)"},{value:"TT",label:"Trinidad and Tobago (TT)"},{value:"TN",label:"Tunisia (TN)"},{value:"TR",label:"Turkey (TR)"},{value:"TM",label:"Turkmenistan (TM)"},{value:"TC",label:"Turks and Caicos Islands (TC)"},{value:"TV",label:"Tuvalu (TV)"},{value:"UG",label:"Uganda (UG)"},{value:"UA",label:"Ukraine (UA)"},{value:"AE",label:"United Arab Emirates (AE)"},{value:"GB",label:"United Kingdom (GB)"},{value:"US",label:"United States (US)"},{value:"UM",label:"United States Minor Outlying Islands (UM)"},{value:"UY",label:"Uruguay (UY)"},{value:"UZ",label:"Uzbekistan (UZ)"},{value:"VU",label:"Vanuatu (VU)"},{value:"VA",label:"Vatican City (VA)"},{value:"VE",label:"Venezuela (VE)"},{value:"VN",label:"Vietnam (VN)"},{value:"VG",label:"Virgin Islands (British) (VG)"},{value:"VI",label:"Virgin Islands (US) (VI)"},{value:"WF",label:"Wallis and Futuna (WF)"},{value:"EH",label:"Western Sahara (EH)"},{value:"YE",label:"Yemen (YE)"},{value:"ZM",label:"Zambia (ZM)"},{value:"ZW",label:"Zimbabwe (ZW)"}];function ia(){return(new Date).toISOString().slice(0,10)}function ca({id:e,label:l,value:n,onChange:r,className:o="",fieldRef:s}){const[i,c]=(0,t.useState)(!1),[u,p]=(0,t.useState)(null),d=function(e){if(!e)return"";const[a,t,l]=e.split("-");return a&&t&&l?`${l}/${t}/${a}`:e}(n);return(0,a.createElement)("div",{className:`proposal-basics__field ${o}`.trim(),ref:e=>{"function"==typeof s&&s(e)}},(0,a.createElement)(ta.TextControl,{id:e,label:l,value:d,onClick:e=>{p(e.currentTarget),c(!0)},onFocus:e=>{p(e.currentTarget),c(!0)},readOnly:!0,placeholder:"DD/MM/AAAA"}),i&&u&&(0,a.createElement)(ta.Popover,{anchor:u,placement:"bottom-start",className:"proposal-basics__date-popover",onClose:()=>{c(!1),p(null)}},(0,a.createElement)(ta.DatePicker,{currentDate:n||ia(),onChange:e=>{const a=function(e){if(!e)return"";if(e instanceof Date&&!Number.isNaN(e.getTime()))return e.toISOString().slice(0,10);if("string"==typeof e){if(e.includes("/")){const[a,t,l]=e.split("/");if(a&&t&&l)return`${l.padStart(4,"0")}-${t.padStart(2,"0")}-${a.padStart(2,"0")}`}return e.slice(0,10)}return""}(e);a&&r(a),c(!1)},minDate:ia()})))}function ua({initialValues:e={},onCreated:l,onNext:n,proposalId:r}){var o;const s=(0,t.useMemo)(()=>{var a,t,l,n;const r={proposal_title:"",customer_name:e.customer_name||"",customer_email:"",customer_country:"",customer_language:"es",start_date:ia(),end_date:ia(),pax_total:1,players_count:null!==(a=null!==(t=e.players_count)&&void 0!==t?t:e.pax_total)&&void 0!==a?a:1,currency:"EUR",first_name:null!==(l=e.first_name)&&void 0!==l?l:"",last_name:null!==(n=e.last_name)&&void 0!==n?n:"",...e},o=r.customer_name||e.customer_name||"",s=He(o),i=r.first_name||s.firstName,c=r.last_name||s.lastName;return r.first_name=i,r.last_name=c,r.customer_name=ze(i,c,o),r},[e]),[i,c]=(0,t.useState)(s),[u,p]=(0,t.useState)(!1),[d,m]=(0,t.useState)(""),[_,v]=(0,t.useState)(""),[g,h]=(0,t.useState)(""),b=(0,t.useRef)({});(0,t.useEffect)(()=>{c(e=>{const a={...e,...s};return a.customer_name=ze(a.first_name,a.last_name,s.customer_name),a})},[s]),(0,t.useEffect)(()=>(window.fillProposalBasics=(e={})=>{c(a=>{const t="string"==typeof e.name?e.name:a.customer_name,l=He(t),n="string"==typeof e.first_name?e.first_name:l.firstName||a.first_name,r="string"==typeof e.last_name?e.last_name:l.lastName||a.last_name;return{...a,proposal_title:"string"==typeof e.title?e.title:a.proposal_title,first_name:n,last_name:r,customer_name:ze(n,r,t),customer_email:"string"==typeof e.email?e.email:a.customer_email,customer_country:"string"==typeof e.country?e.country.toUpperCase():a.customer_country,customer_language:"string"==typeof e.language?e.language:a.customer_language}})},()=>{delete window.fillProposalBasics}),[]);const E=e=>a=>{c(t=>{const l={...t,[e]:a};if("first_name"===e||"last_name"===e){const n="first_name"===e?a:t.first_name,r="last_name"===e?a:t.last_name;l.customer_name=ze(n,r,t.customer_name)}return l}),v(a=>a===e?"":a)},f=e=>a=>{a&&(b.current[e]=a)},y=(0,t.useMemo)(()=>{if(!g)return sa;const e=g.toLowerCase();return sa.filter(a=>a.label.toLowerCase().includes(e)||a.value.toLowerCase().includes(e))},[g]),N=parseInt(i.pax_total,10),S=parseInt(i.players_count,10),C=Number.isFinite(N)?Math.max(0,N-(Number.isFinite(S)?S:0)):0;return(0,a.createElement)(ta.Card,null,(0,a.createElement)(ta.CardHeader,null,(0,a.createElement)("strong",null,"Datos básicos")),(0,a.createElement)(ta.CardBody,null,d&&(0,a.createElement)(ta.Notice,{status:"error",isDismissible:!0,onRemove:()=>{m(""),v("")}},d),(0,a.createElement)("div",{className:"proposal-basics"},(0,a.createElement)("div",{className:"proposal-basics__section"},(0,a.createElement)("div",{className:"proposal-basics__section-title"},"Identidad de la propuesta"),(0,a.createElement)("div",{className:"proposal-basics__grid"},(0,a.createElement)("div",{className:("proposal-basics__field proposal-basics__field--full "+("proposal_title"===_?"is-error":"")).trim(),ref:f("proposal_title")},(0,a.createElement)(ta.TextControl,{label:"Título de la propuesta",value:i.proposal_title,onChange:E("proposal_title"),placeholder:"Escapada a la Costa del Sol"})),(0,a.createElement)("div",{className:("proposal-basics__field "+("first_name"===_?"is-error":"")).trim(),ref:f("first_name")},(0,a.createElement)(ta.TextControl,{label:"Nombre *",value:i.first_name,onChange:E("first_name"),placeholder:"John"})),(0,a.createElement)("div",{className:"proposal-basics__field",ref:f("last_name")},(0,a.createElement)(ta.TextControl,{label:"Apellidos",value:i.last_name,onChange:E("last_name"),placeholder:"Doe"})),(0,a.createElement)("div",{className:("proposal-basics__field "+("customer_email"===_?"is-error":"")).trim(),ref:f("customer_email")},(0,a.createElement)(ta.TextControl,{label:"Email",value:i.customer_email,onChange:E("customer_email"),placeholder:"john@email.com"})))),(0,a.createElement)("div",{className:"proposal-basics__section"},(0,a.createElement)("div",{className:"proposal-basics__section-title"},"Fechas y pasajeros"),(0,a.createElement)("div",{className:"proposal-basics__grid proposal-basics__grid--dates"},(0,a.createElement)(ca,{label:"Fecha inicio *",value:i.start_date,onChange:e=>{c(a=>{const t={...a,start_date:e};return t.end_date&&e&&t.end_date<e&&(t.end_date=e),t}),window.setTimeout(()=>{const e=document.getElementById("wp-travel-end-date");if(e&&(e.focus(),"function"==typeof e.showPicker))try{e.showPicker()}catch(e){}},0)},className:"start_date"===_?"is-error":"",fieldRef:f("start_date")}),(0,a.createElement)("div",{className:"proposal-basics__date-arrow","aria-hidden":"true"},"→"),(0,a.createElement)(ca,{id:"wp-travel-end-date",label:"Fecha fin *",value:i.end_date,onChange:e=>{c(a=>a.start_date&&e&&e<a.start_date?{...a,end_date:a.start_date}:{...a,end_date:e})},className:"end_date"===_?"is-error":"",fieldRef:f("end_date")}),(0,a.createElement)("div",{className:("proposal-basics__field proposal-basics__field--pax "+("pax_total"===_?"is-error":"")).trim(),ref:f("pax_total")},(0,a.createElement)(ta.TextControl,{label:"Pax *",type:"number",min:1,value:String(i.pax_total),onChange:E("pax_total")})),(0,a.createElement)("div",{className:("proposal-basics__field proposal-basics__field--pax "+("players_count"===_?"is-error":"")).trim(),ref:f("players_count")},(0,a.createElement)(ta.TextControl,{label:"Jugadores",type:"number",min:0,value:String(null!==(o=i.players_count)&&void 0!==o?o:""),onChange:E("players_count"),help:`No jugadores: ${C}`})))),(0,a.createElement)("div",{className:"proposal-basics__section"},(0,a.createElement)("div",{className:"proposal-basics__section-title"},"Preferencias"),(0,a.createElement)("div",{className:"proposal-basics__grid"},(0,a.createElement)("div",{className:("proposal-basics__field "+("customer_language"===_?"is-error":"")).trim(),ref:f("customer_language")},(0,a.createElement)(ta.SelectControl,{label:"Idioma",value:i.customer_language,options:ra,onChange:E("customer_language")})),(0,a.createElement)("div",{className:("proposal-basics__field "+("customer_country"===_?"is-error":"")).trim(),ref:f("customer_country")},(0,a.createElement)(ta.ComboboxControl,{label:"País",value:i.customer_country,options:y,onFilterValueChange:h,onChange:e=>E("customer_country")(e?e.toUpperCase():""),placeholder:"Busca país o código"})),(0,a.createElement)("div",{className:("proposal-basics__field "+("currency"===_?"is-error":"")).trim(),ref:f("currency")},(0,a.createElement)(ta.SelectControl,{label:"Moneda",value:i.currency,options:oa,onChange:E("currency")}))))),(0,a.createElement)("div",{className:"proposal-basics__actions"},(0,a.createElement)(ta.Button,{variant:"primary",onClick:async()=>{const e=(()=>{if(!i.first_name?.trim())return{message:"El nombre del cliente es obligatorio.",field:"first_name"};if(!i.start_date)return{message:"La fecha de inicio es obligatoria.",field:"start_date"};if(!i.end_date)return{message:"La fecha de fin es obligatoria.",field:"end_date"};if(i.end_date<i.start_date)return{message:"La fecha fin no puede ser anterior a la fecha inicio.",field:"end_date"};const e=parseInt(i.pax_total,10);if(Number.isNaN(e)||e<1)return{message:"Pax debe ser un numero >= 1.",field:"pax_total"};const a=parseInt(i.players_count,10);return Number.isNaN(a)||a<0?{message:"Jugadores debe ser un numero >= 0.",field:"players_count"}:a>e?{message:"Jugadores no puede ser mayor que Pax.",field:"players_count"}:i.customer_email&&!/^\S+@\S+\.\S+$/.test(i.customer_email)?{message:"El email no parece valido (si lo rellenas, que sea correcto).",field:"customer_email"}:i.customer_country&&2!==i.customer_country.length?{message:"Pais debe ser ISO2 (2 letras) o vacio.",field:"customer_country"}:null})();if(e)return m(e.message),v(e.field||""),void(e=>{const a=b.current[e];if(!a)return;a.scrollIntoView({behavior:"smooth",block:"center"});const t=a.querySelector("input, select, textarea, button");t&&"function"==typeof t.focus&&t.focus()})(e.field);p(!0),m("");const a=ze(i.first_name,i.last_name,i.customer_name),t={...i,customer_name:a,pax_total:parseInt(i.pax_total,10),players_count:Math.max(0,parseInt(i.players_count,10)),customer_country:i.customer_country?i.customer_country.toUpperCase():""};try{if(r)return await na.updateProposal(r,t),void n?.({basics:t});const e=await na.createProposal(t);l?.({proposalId:e.proposal_id,basics:t})}catch(e){m(e?.message||"Error creando la propuesta.")}finally{p(!1)}},disabled:u},d?"Revisa los campos marcados":"Continuar"),u&&(0,a.createElement)(ta.Spinner,null))))}function pa({label:e,type:l,valueTitle:n,onPick:r}){const[o,s]=(0,t.useState)(n||""),[i,c]=(0,t.useState)(!1),[u,p]=(0,t.useState)(!1),[d,m]=(0,t.useState)([]);return(0,t.useEffect)(()=>{s(n||"")},[n]),(0,t.useEffect)(()=>{if(!i)return;let e=!0;return p(!0),na.searchCatalog({type:l,q:o}).then(a=>e&&m(Array.isArray(a)?a:[])).catch(()=>e&&m([])).finally(()=>e&&p(!1)),()=>{e=!1}},[o,i,l]),(0,a.createElement)("div",{style:{position:"relative",width:"100%",maxWidth:320,minWidth:0}},(0,a.createElement)(ta.TextControl,{label:e,value:o,onChange:e=>{s(e),c(!0)},onFocus:()=>c(!0),placeholder:"hotel"===l?"Buscar hotel…":"Buscar campo…"}),i&&(0,a.createElement)("div",{style:{position:"absolute",zIndex:30,background:"#fff",border:"1px solid #ddd",borderRadius:8,width:"100%",maxHeight:220,overflow:"auto",boxShadow:"0 6px 18px rgba(0,0,0,.08)"}},u&&(0,a.createElement)("div",{style:{padding:8}},(0,a.createElement)(ta.Spinner,null)),!u&&0===d.length&&(0,a.createElement)("div",{style:{padding:8,fontSize:12,opacity:.6}},"Sin resultados"),!u&&d.map(e=>(0,a.createElement)("button",{key:e.id,type:"button",onClick:()=>{r(e),c(!1)},style:{display:"block",width:"100%",padding:"8px 10px",border:0,background:"transparent",textAlign:"left",cursor:"pointer"}},e.title))))}function da({valueId:e,valueLabel:t,onSelect:l,disabled:n=!1,placeholder:r="Buscar proveedor en GIAV..."}){const[o,s]=(0,a.useState)(t||""),[i,c]=(0,a.useState)([]),[u,p]=(0,a.useState)(!1),[d,m]=(0,a.useState)(!1),[_,v]=(0,a.useState)(""),g=(0,a.useRef)(null);(0,a.useEffect)(()=>{t&&t!==o&&s(t)},[t]);return(0,a.createElement)("div",{style:{position:"relative"}},(0,a.createElement)("input",{type:"text",value:o,onChange:e=>{return a=e.target.value,s(a),p(!0),clearTimeout(g.current),void(g.current=setTimeout(()=>(async e=>{const a=(e||"").trim();if(a.length<2)return c([]),v(""),void p(!1);m(!0),v("");try{const e=await na.searchGiavProviders({q:a,pageSize:20,pageIndex:0,includeDisabled:!1}),t=(Array.isArray(e)?e:Array.isArray(e?.items)?e.items:[]).map(e=>{var a,t,l,n,r,o,s,i;return{id:String(null!==(a=null!==(t=null!==(l=null!==(n=e.id)&&void 0!==n?n:e.Id)&&void 0!==l?l:e.ID)&&void 0!==t?t:e.proveedorId)&&void 0!==a?a:""),label:String(null!==(r=null!==(o=null!==(s=null!==(i=e.label)&&void 0!==i?i:e.NombreAlias)&&void 0!==s?s:e.Nombre)&&void 0!==o?o:e.title)&&void 0!==r?r:"")}}).filter(e=>e.id&&e.label);c(t),p(t.length>0)}catch(e){v(e?.message||"Error buscando proveedores en GIAV"),c([]),p(!1)}finally{m(!1)}})(a),250));var a},onFocus:()=>{i.length>0&&p(!0)},placeholder:r,disabled:n,style:{width:"100%"}}),(0,a.createElement)("div",{style:{fontSize:12,marginTop:6,opacity:.8}},e?(0,a.createElement)(a.Fragment,null,"ID seleccionado: ",(0,a.createElement)("strong",null,e)):null,d?(0,a.createElement)("span",{style:{marginLeft:10}},"Buscando…"):null,_?(0,a.createElement)("span",{style:{marginLeft:10,color:"crimson"}},_):null),u&&i.length>0&&(0,a.createElement)("div",{style:{position:"absolute",zIndex:20,top:"100%",left:0,right:0,background:"#fff",border:"1px solid #ddd",borderTop:"none",maxHeight:260,overflow:"auto"}},i.map(e=>(0,a.createElement)("div",{key:e.id,onMouseDown:a=>{a.preventDefault(),(e=>{s(e.label),p(!1),c([]),v(""),l?.(e)})(e)},style:{padding:"10px 12px",cursor:"pointer",borderBottom:"1px solid #f0f0f0"}},(0,a.createElement)("div",{style:{fontWeight:600}},e.label),(0,a.createElement)("div",{style:{fontSize:12,opacity:.75}},"ID: ",e.id)))))}const ma="1734698",_a="Proveedores varios",va=(new Date).toISOString().slice(0,10),ga=[{label:"Hotel",value:"hotel"},{label:"Golf",value:"golf"},{label:"Transfer",value:"transfer"},{label:"Extra",value:"extra"},{label:"Paquete",value:"package"}],ha=[{label:"Alojamiento y Desayuno",value:"AD"},{label:"Solo Alojamiento",value:"SA"},{label:"Media Pensión",value:"MP"},{label:"Pensión Completa",value:"PC"},{label:"Todo Incluido",value:"TI"},{label:"Según Programa",value:"SP"}];function ba(e){const a=parseFloat(String(e).replace(",","."));return Number.isFinite(a)?a:0}function Ea(e,a=1){const t=parseInt(e,10);return Number.isFinite(t)?t:a}function fa(e){return Math.round(100*(e+Number.EPSILON))/100}function ya(e,a){return function(e,a){if(!e||!a)return 0;const t=new Date(`${e}T00:00:00`),l=new Date(`${a}T00:00:00`)-t;return!Number.isFinite(l)||l<=0?0:Math.round(l/864e5)}(e.start_date||a?.start_date||"",e.end_date||a?.end_date||"")}function Na(e=0){return{double:{enabled:!0,rooms:1,pricing_basis:"per_room",net_price_per_night:"",margin_pct:e,pvp_manual_enabled:!1,pvp_price_per_night:"",nights_payable:0,free_nights_applied:0,discount_pct_applied:0,total_net:0,total_pvp:0},single:{enabled:!1,rooms:0,pricing_basis:"per_room",net_price_per_night:"",margin_pct:e,pvp_manual_enabled:!1,pvp_price_per_night:"",nights_payable:0,free_nights_applied:0,discount_pct_applied:0,total_net:0,total_pvp:0}}}function Sa(e,a,t){const l=Math.max(0,Ea(null!=a?a:0,0)),n=Math.max(0,Ea(null!=t?t:0,0));if(l<=0||n<=0||e<=0)return{freeNights:0,nightsPayable:Math.max(0,e)};const r=Math.floor(e/l),o=Math.min(e,r*n);return{freeNights:o,nightsPayable:Math.max(0,e-o)}}function Ca(e,a=0){var t,l;const n=e?.start_date||"",r=e?.end_date||"",o=Na(a);return{service_type:"hotel",title:"",start_date:n,end_date:r,hotel_room_type:"",hotel_regimen:"",hotel_rooms:0,hotel_rate_basis:null,hotel_regimen:"",quantity:1,green_fees_per_person:1,number_of_players:null!==(t=null!==(l=e?.players_count)&&void 0!==l?l:e?.pax_total)&&void 0!==t?t:1,total_green_fees:0,unit_cost_net:"",unit_sell_price:"",use_markup:!0,markup_pct:a,lock_sell_price:!1,notes_public:"",notes_internal:"",package_components_text:"",display_name:"",use_manual_entry:!1,wp_object_type:null,wp_object_id:null,giav_entity_type:null,giav_entity_id:null,giav_supplier_id:ma,giav_supplier_name:_a,giav_mapping_status:"needs_review",show_supplier_picker:!1,supplier_override:!1,dates_inherited:!0,room_pricing:o,discounts:{discount_pct:0,free_nights_every:"",free_nights_count:""},giav_pricing:{giav_total_pvp:0,giav_total_net:0,giav_source:"double",giav_locked:!1}}}function wa(e,a,t){var l,n;const r={...e};r.start_date||(r.start_date=a?.start_date||""),r.end_date||(r.end_date=a?.end_date||""),r.quantity=Math.max(1,Ea(r.quantity,1)),void 0!==r.hotel_rooms&&(r.hotel_rooms=Math.max(0,Ea(r.hotel_rooms,0))),r.unit_cost_net=Math.max(0,ba(r.unit_cost_net));const o=r.use_markup?Math.max(0,ba(null!==(l=null!==(n=r.markup_pct)&&void 0!==n?n:t)&&void 0!==l?l:0)):0;var s,i;if(r.markup_pct=o,r.lock_sell_price?r.unit_sell_price=Math.max(0,ba(r.unit_sell_price)):r.unit_sell_price=(s=r.unit_cost_net,i=o,fa(Math.max(0,ba(s))*(1+Math.max(0,ba(i))/100))),"hotel"===r.service_type){const e=ya(r,a);r.hotel_nights=e;const t=function(e,a,t){var l,n,r,o,s;const i=ya(e,a),c=Math.max(0,Ea(null!==(l=e.hotel_rooms)&&void 0!==l?l:0,0)),u=function(e={}){var a,t,l,n;return{discount_pct:(n=ba(null!==(a=e.discount_pct)&&void 0!==a?a:0),Number.isFinite(n)?Math.min(50,Math.max(0,n)):0),free_nights_every:Math.max(0,Ea(null!==(t=e.free_nights_every)&&void 0!==t?t:0,0))||"",free_nights_count:Math.max(0,Ea(null!==(l=e.free_nights_count)&&void 0!==l?l:0,0))||""}}(e.discounts),{freeNights:p,nightsPayable:d}=Sa(i,u.free_nights_every,u.free_nights_count),m=e.use_markup?ba(null!==(n=null!==(r=e.markup_pct)&&void 0!==r?r:t)&&void 0!==n?n:0):0,_=e.room_pricing||Na(t),v=(e,a)=>{var t,l,n;const r=_?.[e]||{},o=null!==(t=a.net_price_per_night)&&void 0!==t?t:0,s=null!==(l=a.pvp_price_per_night)&&void 0!==l?l:0,i=void 0!==r.net_price_per_night&&""!==r.net_price_per_night,c=void 0!==r.pvp_price_per_night&&""!==r.pvp_price_per_night,p=void 0!==r.margin_pct&&""!==r.margin_pct,d=void 0!==r.rooms&&""!==r.rooms;return{enabled:"boolean"==typeof r.enabled?r.enabled:a.enabled,rooms:d?Math.max(0,Ea(null!==(n=r.rooms)&&void 0!==n?n:0,0)):a.rooms,pricing_basis:r.pricing_basis||a.pricing_basis,net_price_per_night:i?ba(r.net_price_per_night):o,margin_pct:p?ba(r.margin_pct):a.margin_pct,pvp_manual_enabled:"boolean"==typeof r.pvp_manual_enabled?r.pvp_manual_enabled:a.pvp_manual_enabled,pvp_price_per_night:c?ba(r.pvp_price_per_night):s,nights_payable:0,free_nights_applied:0,discount_pct_applied:u.discount_pct,total_net:0,total_pvp:0}},g={enabled:!1,rooms:0,pricing_basis:"per_room",net_price_per_night:0,margin_pct:m,pvp_manual_enabled:!1,pvp_price_per_night:0},h={double:v("double",{enabled:!0,rooms:c>0?c:1,pricing_basis:"per_room",net_price_per_night:null!==(o=e.unit_cost_net)&&void 0!==o?o:0,margin_pct:m,pvp_manual_enabled:!!e.lock_sell_price,pvp_price_per_night:null!==(s=e.unit_sell_price)&&void 0!==s?s:0}),single:v("single",g)},b=["double","single"].map(e=>{var a;const t=h[e];if(!t.enabled)return{totalNet:0,totalPvp:0};const l=Math.max(0,Ea(null!==(a=t.rooms)&&void 0!==a?a:0,0)),n="double"===e&&t.pricing_basis||"per_room",r="per_person"===n?2*l:l,o=Math.max(0,t.net_price_per_night)*d*r*(1-u.discount_pct/100),s=t.pvp_manual_enabled?Math.max(0,t.pvp_price_per_night)*d*r:o*(1+Math.max(0,t.margin_pct)/100);return h[e]={...t,pricing_basis:n,nights_payable:d,free_nights_applied:p,discount_pct_applied:u.discount_pct,total_net:fa(o),total_pvp:fa(s)},{totalNet:fa(o),totalPvp:fa(s)}}),E=b.reduce((e,a)=>e+a.totalNet,0),f=b.reduce((e,a)=>e+a.totalPvp,0),y=["double","single"].filter(e=>h[e].enabled),N=1===y.length?y[0]:"custom",S={...e.giav_pricing,giav_total_net:fa(E),giav_total_pvp:e.giav_pricing?.giav_locked?fa(ba(e.giav_pricing?.giav_total_pvp)):fa(f),giav_source:e.giav_pricing?.giav_locked?"custom":N,giav_locked:!!e.giav_pricing?.giav_locked};return{discounts:u,roomPricing:h,giavPricing:S,totals:{nights:i,nightsPayable:d,freeNights:p,totalNet:fa(E),totalPvp:fa(f)}}}(r,a,o);r.room_pricing=t.roomPricing,r.discounts=t.discounts,r.giav_pricing=t.giavPricing,r.line_cost_net=t.totals.totalNet,r.line_sell_price=t.giavPricing.giav_total_pvp,r.quantity=1,r.unit_cost_net=t.totals.totalNet,r.unit_sell_price=t.giavPricing.giav_total_pvp}else if("golf"===r.service_type){var c;const e=Math.max(0,Ea(null!==(c=a?.players_count)&&void 0!==c?c:0,0)),t=e>0?e:1,{greenFeesPerPerson:l,totalGreenFees:n}=function(e={},a=1){var t,l,n;const r=Math.max(1,Ea(a,1));let o=Math.max(0,Ea(null!==(t=e.green_fees_per_person)&&void 0!==t?t:0,0)),s=Math.max(0,Ea(null!==(l=e.total_green_fees)&&void 0!==l?l:0,0));const i=Math.max(0,Ea(null!==(n=e.quantity)&&void 0!==n?n:0,0));return o>0?s=o*r:s>0?(o=Math.max(1,Math.round(s/r)),s=o*r):i>0?(s=i,o=Math.max(1,Math.round(s/r)),s=o*r):(o=1,s=o*r),{greenFeesPerPerson:o,totalGreenFees:s}}(r,t);r.number_of_players=e,r.green_fees_per_person=l,r.total_green_fees=n,r.quantity=n,r.line_cost_net=fa(n*r.unit_cost_net),r.line_sell_price=fa(n*r.unit_sell_price)}else r.line_cost_net=fa(r.quantity*r.unit_cost_net),r.line_sell_price=fa(r.quantity*r.unit_sell_price);return r}function xa({item:e,idx:t,updateItem:l,currency:n,pax:r,basics:o,globalMarkupPct:s}){var i,c,u,p,d,m,_;const v=e.room_pricing||Na(s),g=Na(s),h=e=>v[e]||g[e],b=Math.max(0,Ea(null!==(i=h("double").rooms)&&void 0!==i?i:0,0)),E=Math.max(0,Ea(null!==(c=h("single").rooms)&&void 0!==c?c:0,0)),f=(h("double").enabled?2*b:0)+(h("single").enabled?E:0),y=f-r,N=y<0?`Faltan ${Math.abs(y)} pax por asignar a habitaciones`:y>0?`Sobran ${y} pax asignados`:"",S=Math.max(0,Ea(null!==(u=e.hotel_nights)&&void 0!==u?u:ya(e,o),0)),{nightsPayable:C}=Sa(S,e.discounts?.free_nights_every,e.discounts?.free_nights_count),w=function(e={}){var a,t,l;const n=Math.max(0,ba(null!==(a=e.discount_pct)&&void 0!==a?a:0)),r=Math.max(0,Ea(null!==(t=e.free_nights_every)&&void 0!==t?t:0,0)),o=Math.max(0,Ea(null!==(l=e.free_nights_count)&&void 0!==l?l:0,0)),s=[];return n>0&&s.push(`-${fa(n)}%`),r>0&&o>0&&s.push(`+${o} gratis cada ${r}`),s.length>0?s.join(" "):"Sin descuentos"}(e.discounts),x=e.notes_public||e.notes_internal?"Ver notas":"Sin notas",P=(a,n)=>{const r=e.room_pricing||{},o={...r[a]||{},...n},s={...r,[a]:o};l(t,{room_pricing:s})},k=(a,n)=>{const r=e.discounts||{};l(t,{discounts:{...r,[a]:n}})};return(0,a.createElement)("div",{className:"service-card__hotel-panel"},(0,a.createElement)("div",{className:"service-card__hotel-occupancy"},["double","single"].map(e=>{var t,l,r,o;const i="double"===e?"Doble":"Individual",c=h(e);return(0,a.createElement)("div",{key:e,className:"service-card__hotel-occupancy-card"},(0,a.createElement)("div",{className:"service-card__hotel-occupancy-header"},(0,a.createElement)(ta.ToggleControl,{label:`Cotizar ${i.toLowerCase()}`,checked:!!c.enabled,onChange:()=>P(e,{enabled:!c.enabled})}),(0,a.createElement)("span",{className:"service-card__hotel-occupancy-label"},i)),c.enabled&&(0,a.createElement)("div",{className:"service-card__hotel-occupancy-body"},(0,a.createElement)(ta.TextControl,{label:`Habitaciones ${i.toLowerCase()}`,type:"number",min:1,value:String(null!==(t=c.rooms)&&void 0!==t?t:""),onChange:a=>P(e,{rooms:a})}),"double"===e&&(0,a.createElement)(ta.SelectControl,{label:"Precio",value:c.pricing_basis||"per_room",options:[{label:"Por habitación",value:"per_room"},{label:"Por persona",value:"per_person"}],onChange:e=>P("double",{pricing_basis:e})}),(0,a.createElement)(ta.TextControl,{label:`Neto por noche (${i.toLowerCase()})`,value:String(null!==(l=c.net_price_per_night)&&void 0!==l?l:""),onChange:a=>P(e,{net_price_per_night:a}),placeholder:"120"}),(0,a.createElement)("details",{className:"service-card__hotel-mode-details"},(0,a.createElement)("summary",null,"Margen y PVP"),(0,a.createElement)("div",{className:"service-card__hotel-mode-details-grid"},(0,a.createElement)(ta.ToggleControl,{label:"PVP manual",checked:!!c.pvp_manual_enabled,onChange:()=>P(e,{pvp_manual_enabled:!c.pvp_manual_enabled})}),c.pvp_manual_enabled?(0,a.createElement)(ta.TextControl,{label:`PVP por noche (${i.toLowerCase()})`,value:String(null!==(r=c.pvp_price_per_night)&&void 0!==r?r:""),onChange:a=>P(e,{pvp_price_per_night:a}),placeholder:"165"}):(0,a.createElement)(ta.TextControl,{label:"Margen (%)",type:"number",min:0,value:String(null!==(o=c.margin_pct)&&void 0!==o?o:s),onChange:a=>P(e,{margin_pct:a})}))),(0,a.createElement)("div",{className:"service-card__hotel-total"},"Total hab. ",i.toLowerCase(),": ",n," ",fa(c.total_pvp||0).toFixed(2))))})),(0,a.createElement)("div",{className:"service-card__hotel-allocation"},(0,a.createElement)("div",{className:"service-card__hotel-allocation-text"},"Personas asignadas: ",f," de ",r),N&&(0,a.createElement)(ta.Notice,{status:"warning",isDismissible:!1},N)),(0,a.createElement)("div",{className:"service-card__subcard"},(0,a.createElement)("details",{className:"service-card__hotel-discounts-collapse"},(0,a.createElement)("summary",{className:"service-card__section-summary"},(0,a.createElement)("span",{className:"service-card__section-summary-title"},"Descuentos"),(0,a.createElement)("span",{className:"service-card__section-summary-meta"},w)),(0,a.createElement)("div",{className:"service-card__hotel-discounts"},(0,a.createElement)("div",{className:"service-card__hotel-discounts-grid"},(0,a.createElement)(ta.TextControl,{label:"Descuento (%)",type:"number",min:0,max:50,value:String(null!==(p=e.discounts?.discount_pct)&&void 0!==p?p:0),onChange:e=>k("discount_pct",e)}),(0,a.createElement)(ta.TextControl,{label:"Noches gratis (cada)",type:"number",min:0,value:String(null!==(d=e.discounts?.free_nights_every)&&void 0!==d?d:""),onChange:e=>k("free_nights_every",e)}),(0,a.createElement)(ta.TextControl,{label:"Noches gratis (cantidad)",type:"number",min:0,value:String(null!==(m=e.discounts?.free_nights_count)&&void 0!==m?m:""),onChange:e=>k("free_nights_count",e)})),S>0&&(0,a.createElement)("div",{className:"service-card__hotel-discount-summary"},"Se cobran ",C," noches de ",S)))),(0,a.createElement)("div",{className:"service-card__subcard service-card__subcard--giav"},(0,a.createElement)("div",{className:"service-card__hotel-giav"},(0,a.createElement)("div",{className:"service-card__hotel-subtitle"},"Total para GIAV"),(0,a.createElement)("div",{className:"service-card__hotel-giav-grid"},(0,a.createElement)("div",{className:"service-card__hotel-giav-total"},(0,a.createElement)("div",{className:"service-card__hotel-giav-label"},"Total alojamiento (para GIAV)"),(0,a.createElement)("div",{className:"service-card__hotel-giav-value"},n," ",fa(e.giav_pricing?.giav_total_pvp||0).toFixed(2))),(0,a.createElement)(ta.ToggleControl,{label:"Editar total para GIAV",checked:!!e.giav_pricing?.giav_locked,onChange:()=>{const a=e.giav_pricing||{};l(t,{giav_pricing:{...a,giav_locked:!a.giav_locked}})}}),(0,a.createElement)(ta.TextControl,{label:"Total editable",value:String(null!==(_=e.giav_pricing?.giav_total_pvp)&&void 0!==_?_:""),onChange:a=>(a=>{const n=e.giav_pricing||{};l(t,{giav_pricing:{...n,giav_total_pvp:a}})})(a),disabled:!e.giav_pricing?.giav_locked}),e.giav_pricing?.giav_locked&&(0,a.createElement)(ta.Notice,{status:"warning",isDismissible:!1},"Este total se enviará a GIAV. No se recalculará automáticamente.")))),(0,a.createElement)("div",{className:"service-card__subcard"},(0,a.createElement)("details",{className:"service-card__hotel-notes"},(0,a.createElement)("summary",{className:"service-card__section-summary"},(0,a.createElement)("span",{className:"service-card__section-summary-title"},"Notas"),(0,a.createElement)("span",{className:"service-card__section-summary-meta"},x)),(0,a.createElement)("div",{className:"service-card__hotel-notes-grid"},(0,a.createElement)(ta.TextControl,{label:"Notas para el cliente (itinerario)",value:e.notes_public||"",onChange:e=>l(t,{notes_public:e}),placeholder:"Incluye desayuno. Check-in 15:00."}),(0,a.createElement)(ta.TextControl,{label:"Notas internas (solo uso interno)",value:e.notes_internal||"",onChange:e=>l(t,{notes_internal:e}),placeholder:"Neto negociado, release 14D."})))))}function Pa(e=[],a={}){if(!Array.isArray(e)||!e.length)return e;const t=a?.start_date||"",l=a?.end_date||"";let n=!1;const r=e.map(e=>e&&e.dates_inherited?e.start_date===t&&e.end_date===l?e:(n=!0,{...e,start_date:t,end_date:l,dates_inherited:!0}):e);return n?r:e}function ka({basics:e,initialItems:l=[],onBack:n,onNext:r,onDraftChange:o,requestIntentions:s=null}){var i,c;const u=e?.currency||"EUR",p=Math.max(1,Ea(null!==(i=e?.pax_total)&&void 0!==i?i:1,1)),d=Math.max(0,Ea(null!==(c=e?.players_count)&&void 0!==c?c:0,0)),[m,_]=(0,t.useState)(20),[v,g]=(0,t.useState)(!0),[h,b]=(0,t.useState)(""),[E,f]=(0,t.useState)(null),[y,N]=(0,t.useState)(null),[S,C]=(0,t.useState)(0),[w,x]=(0,t.useState)(null),[P,k]=(0,t.useState)(!1),[T,M]=(0,t.useState)([]),A=(0,t.useRef)(null),[I,R]=(0,t.useState)(()=>(l.length?l:[Ca(e,20)]).map(a=>{const t={...a},l="boolean"==typeof t.dates_inherited,n=t.start_date||e?.start_date||"",r=t.end_date||e?.end_date||"";return t.start_date||(t.start_date=n),t.end_date||(t.end_date=r),t.dates_inherited=l?t.dates_inherited:n===(e?.start_date||"")&&r===(e?.end_date||""),wa(t,e,20)})),$=(0,t.useMemo)(()=>function(e){const a=e.reduce((e,a)=>(e.cost+=a.line_cost_net||0,e.sell+=a.line_sell_price||0,e),{cost:0,sell:0}),t=fa(a.sell-a.cost),l=a.sell>0?fa(t/a.sell*100):0;return{totals_cost_net:fa(a.cost),totals_sell_price:fa(a.sell),totals_margin_abs:t,totals_margin_pct:l}}(I),[I]);(0,t.useEffect)(()=>{if(!o)return;const e=window.setTimeout(()=>{o({items:I,totals:$})},200);return()=>window.clearTimeout(e)},[I,$,o]);const B=(0,t.useMemo)(()=>{var a,t,l;const n=Math.max(0,Ea(null!==(a=e?.pax_total)&&void 0!==a?a:0,0)),r=Ea(null!==(t=null!==(l=e?.players_count)&&void 0!==l?l:n)&&void 0!==t?t:0,0),o=Math.min(Math.max(r,0),n),s={paxTotal:n,playersCount:o,nonPlayersCount:Math.max(0,n-o),golfTotal:0,totalDouble:0,totalSingle:0,doubleRooms:0,singleRooms:0};I.forEach(e=>{if("golf"===e.service_type&&(s.golfTotal+=ba(e.line_sell_price||0)),"hotel"===e.service_type){const l=e.room_pricing||{};var a,t;l.double?.enabled&&(s.totalDouble+=ba(l.double?.total_pvp||0),s.doubleRooms+=Math.max(0,Ea(null!==(a=l.double?.rooms)&&void 0!==a?a:0,0))),l.single?.enabled&&(s.totalSingle+=ba(l.single?.total_pvp||0),s.singleRooms+=Math.max(0,Ea(null!==(t=l.single?.rooms)&&void 0!==t?t:0,0)))}});const i=ba($.totals_sell_price||0),c=i,u=s.doubleRooms>0?s.totalDouble/(2*s.doubleRooms):0,p=s.singleRooms>0?s.totalSingle/s.singleRooms:0,d=s.totalDouble||0,m=s.totalSingle||0,_=s.golfTotal||0,v=i-(d+m)-_,g=u+(s.paxTotal>0?v/s.paxTotal:0),h=s.playersCount>0?g+_/s.playersCount:null,b=s.doubleRooms>0&&s.singleRooms>0;let E=null;return b&&(E=Math.max(0,p-u)),{...s,totalTrip:i,baseTotal:c,priceNonPlayerDouble:g,pricePlayerDouble:h,supplementSingle:E,hasSingleSupplement:b}},[e?.pax_total,e?.players_count,I,$.totals_sell_price]);(0,t.useEffect)(()=>{R(a=>{const t=Pa(a,e);return t===a?a:t.map((t,l)=>t===a[l]?t:wa(t,e,m))})},[e?.start_date,e?.end_date,m,e]),(0,t.useEffect)(()=>{R(a=>a.map(a=>wa(a,e,m)))},[p]),(0,t.useEffect)(()=>{null!=S&&S>=I.length&&C(I.length?I.length-1:null)},[I.length,S]),(0,t.useEffect)(()=>{if(null==w)return;const e=document.querySelector(`[data-service-index="${w}"]`);if(!e)return;e.scrollIntoView({behavior:"smooth",block:"start"}),((e,a)=>{if(!e)return;if(!a?.service_type){const a=e.querySelector("select");if(a&&"function"==typeof a.focus)return void a.focus()}const t=e.querySelector(".service-card__grid--context input");t&&"function"==typeof t.focus?t.focus():O(e)})(e,I[w]),N(w);const a=window.setTimeout(()=>N(null),1200);return x(null),()=>window.clearTimeout(a)},[w,I]);const G=(a,t)=>{R(l=>{const n=[...l],r={...n[a],...t};return n[a]=wa(r,e,m),n})},D=(0,t.useMemo)(()=>I.map((e,a)=>(e=>{const a=[],t={};if((e.title||e.display_name||"").trim()||(a.push("Falta título"),t.title="Completa el título."),"hotel"!==e.service_type&&"golf"!==e.service_type||e.giav_supplier_id||(a.push("Falta proveedor"),t.supplier="Selecciona un proveedor."),"hotel"===e.service_type){var l,n,r;const o=e.room_pricing||{},s=!!o.double?.enabled,i=!!o.single?.enabled;s||i||(a.push("Activa doble/individual"),t.pricing="Activa doble y/o individual.");const c=(e,a)=>{var t;const l=o[e]||{};return l.enabled?Ea(null!==(t=l.rooms)&&void 0!==t?t:0,0)<1?`Habitaciones ${a} < 1`:ba(l.net_price_per_night)<=0?`Neto ${a} faltante`:l.pvp_manual_enabled&&ba(l.pvp_price_per_night)<=0?`PVP manual ${a} faltante`:"":""},u=c("double","doble"),d=c("single","individual");(u||d)&&(a.push(u||d),t.pricing="Revisa pricing de habitaciones.");const m=s?Math.max(0,Ea(null!==(l=o.double?.rooms)&&void 0!==l?l:0,0)):0,_=i?Math.max(0,Ea(null!==(n=o.single?.rooms)&&void 0!==n?n:0,0)):0;(s?2*m:0)+(i?_:0)!==p&&(a.push("Pax no cuadra"),t.pricing="Ajusta pax doble/individual."),ba(null!==(r=e.giav_pricing?.giav_total_pvp)&&void 0!==r?r:0)<=0&&(a.push("Total GIAV faltante"),t.pricing="Completa total GIAV.")}"golf"===e.service_type&&Ea(e.green_fees_per_person,1)<1&&(a.push("Green-fees faltante"),t.greenFees="Define green-fees por jugador."),["transfer","extra","package"].includes(e.service_type)&&Ea(e.quantity,1)<1&&(a.push("Cantidad inválida"),t.quantity="Cantidad debe ser >= 1."),ba(e.unit_sell_price)<=0&&(a.push("PVP unitario faltante"),t.unitSell="Define PVP unitario.");const o=("hotel"===e.service_type||"golf"===e.service_type)&&["needs_review","missing"].includes(e.giav_mapping_status);return{issues:a,fieldErrors:t,status:a.length>0?"error":o?"pending":"completed",hasMappingWarning:o}})(e)),[I,p]),L=e=>{C(e),f(e),window.setTimeout(()=>{const a=document.querySelector(`[data-service-index="${e}"]`);a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),O(a))},50)},F=e=>{G(e,{show_supplier_picker:!I[e].show_supplier_picker})},U=e=>!!e.show_supplier_picker,V=()=>{const e=[],a=[];return D.forEach((e,t)=>{e.issues.length>0&&a.push({index:t,title:`Servicio ${t+1}`,details:e.issues.slice(0,2).join(" · ")})}),I.some(e=>"golf"===e.service_type)&&d<=0&&e.push('Define "Jugadores" en Datos básicos.'),$.totals_sell_price<=0&&e.push("El PVP total debe ser > 0."),{errors:e,serviceErrors:a}},O=e=>{if(!e)return;const a=e.querySelector("input, select, textarea, button");a&&"function"==typeof a.focus&&a.focus()},j=(0,t.useMemo)(()=>V(),[D,I,d,$.totals_sell_price]),q=j.serviceErrors.length>0||j.errors.length>0,z=(e,{missing:t,tooltip:l}={})=>t?(0,a.createElement)("span",{className:"services-summary__value services-summary__value--missing",title:l},"—"):(0,a.createElement)("span",{className:"services-summary__value"},e);return(0,t.useEffect)(()=>{P&&(q||(b(""),M([])))},[P,q]),(0,a.createElement)(ta.Card,{className:"services-step"},(0,a.createElement)(ta.CardHeader,null,(0,a.createElement)("div",{className:"services-step__title"},(0,a.createElement)("strong",null,"Servicios & precios"),(0,a.createElement)("span",{className:"services-step__subtitle"},"Añade servicios con detalle, márgenes y proveedor."))),(0,a.createElement)(ta.CardBody,{ref:A},s&&(0,a.createElement)("div",{className:"services-intention-banner"},(0,a.createElement)("strong",null,"Intenciones detectadas"),s.golf?.requested&&(0,a.createElement)("span",null,"Solicitud indica ",s.golf.green_fees_per_player||"—"," green-fees por jugador."),s.flights?.requested&&(0,a.createElement)("span",null,"Requiere vuelos desde ",s.flights.departure_airport||"—","."),s.package&&(0,a.createElement)("span",null,"Paquete sugerido: ",s.package),s.more_info&&(0,a.createElement)("span",null,"Más info: ",s.more_info)),(0,a.createElement)("div",{className:"services-toolbar"},(0,a.createElement)("div",{className:"services-toolbar__controls"},(0,a.createElement)(ta.TextControl,{label:"Margen por defecto (%)",type:"number",min:0,value:String(m),onChange:e=>_(ba(e))}),(0,a.createElement)(ta.ToggleControl,{label:"Aplicar a nuevas líneas",checked:v,onChange:()=>g(e=>!e)}),(0,a.createElement)(ta.Button,{variant:"secondary",onClick:()=>{R(a=>a.map(a=>wa({...a,markup_pct:m},e,m)))}},"Aplicar a todas")),(0,a.createElement)("div",{className:"services-toolbar__summary"},(0,a.createElement)("div",{className:"services-toolbar__label"},"PVP total"),(0,a.createElement)("div",{className:"services-toolbar__value"},u," ",$.totals_sell_price.toFixed(2)))),(0,a.createElement)("div",{className:"services-items"},I.map((t,l)=>{var n,r,o;const s=S===l,i=D[l]||{issues:[],status:"pending",hasMappingWarning:!1,fieldErrors:{}},c=i.status,_=(a=>{const t=a.start_date||e?.start_date||"",l=a.end_date||e?.end_date||"",n=t&&l?`${t} → ${l}`:"Fechas por definir",r=`${u} ${fa(a.line_sell_price||0).toFixed(2)}`;return"golf"===a.service_type?`${n} · Jugadores: ${d||p} · ${r}`:"hotel"===a.service_type?`${n} · Pax: ${p} · ${r}`:["transfer","extra","package"].includes(a.service_type)?`Cantidad: ${Ea(null!==(o=a.quantity)&&void 0!==o?o:1,1)} · ${r}`:`${n} · ${r}`;var o})(t),v=i.hasMappingWarning?"Proveedor GIAV pendiente":"",g=i.issues.slice(0,2).join(" · "),h=i.fieldErrors||{};return(0,a.createElement)("div",{key:l,className:`service-card service-card--status-${c} ${s?"is-open":""} ${E===l?"is-error":""} ${y===l?"is-highlighted":""}`.trim(),"data-service-index":l},(0,a.createElement)("div",{className:"service-card__header"},(0,a.createElement)("div",{className:"service-card__title"},(0,a.createElement)("div",{className:"service-card__eyebrow"},"Servicio ",l+1),(0,a.createElement)("div",{className:"service-card__name"},ga.find(e=>e.value===t.service_type)?.label||"Servicio"," ·"," ",t.title?.trim()||t.display_name?.trim()||"Sin título"),(0,a.createElement)("div",{className:"service-card__summary"},_),"pending"===c&&v&&(0,a.createElement)("div",{className:"service-card__missing"},v),"error"===c&&g&&(0,a.createElement)("div",{className:"service-card__missing"},g)),(0,a.createElement)("div",{className:"service-card__meta"},(0,a.createElement)("div",{className:`service-card__badge service-card__badge--${c}`},"completed"===c&&"✓ OK","pending"===c&&"Pendiente","error"===c&&`${i.issues.length} errores`),(0,a.createElement)(ta.Button,{variant:"tertiary",className:"service-card__toggle",onClick:()=>C(s?null:l)},s?"Ocultar":"Ver detalle"),(0,a.createElement)("div",{className:"service-card__total"},(0,a.createElement)("span",null,"Total línea"),(0,a.createElement)("strong",null,u," ",fa(t.line_sell_price||0).toFixed(2))),(0,a.createElement)(ta.Button,{variant:"tertiary",onClick:()=>(e=>{R(a=>a.filter((a,t)=>t!==e)),C(a=>null==a?a:a===e?Math.max(0,e-1):a>e?a-1:a)})(l),disabled:1===I.length},"Eliminar"))),s&&(0,a.createElement)("div",{className:"service-card__content"},(0,a.createElement)("div",{className:"service-card__section"},(0,a.createElement)("div",{className:"service-card__section-title"},"Selección y contexto"),(0,a.createElement)("div",{className:"service-card__grid service-card__grid--context"},(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.SelectControl,{label:"Tipo de servicio",value:t.service_type,options:ga,onChange:e=>G(l,{service_type:e})})),"hotel"===t.service_type||"golf"===t.service_type?(0,a.createElement)(a.Fragment,null,t.use_manual_entry?(0,a.createElement)("div",{className:"service-card__field "+(h.title?"is-error":"")},(0,a.createElement)(ta.TextControl,{label:"hotel"===t.service_type?"Hotel (manual) *":"Campo de golf (manual) *",value:t.display_name||"",onChange:e=>G(l,{display_name:e,title:e}),placeholder:"hotel"===t.service_type?"Ej: Hotel X (fuera de cat├ílogo)":"Ej: Campo Y (fuera de cat├ílogo)"}),h.title&&(0,a.createElement)("div",{className:"service-card__field-error"},h.title)):(0,a.createElement)("div",{className:"service-card__field "+(h.title?"is-error":"")},(0,a.createElement)(pa,{label:"hotel"===t.service_type?"Hotel":"Campo de golf",type:"hotel"===t.service_type?"hotel":"golf",valueTitle:t.title,onPick:async e=>{const a="hotel"===t.service_type?"hotel":"course";G(l,{title:e.title,display_name:e.title,wp_object_type:a,wp_object_id:e.id,supplier_override:!1});try{const t=await na.getGiavMapping({wp_object_type:a,wp_object_id:e.id});var n,r;t?.status&&"missing"!==t.status?G(l,{giav_mapping_status:t.status,giav_entity_type:t.giav_entity_type,giav_entity_id:t.giav_entity_id,giav_supplier_id:null!==(n=t.giav_supplier_id)&&void 0!==n?n:ma,giav_supplier_name:null!==(r=t.giav_supplier_name)&&void 0!==r?r:_a}):G(l,{giav_mapping_status:"needs_review",giav_entity_type:"supplier",giav_entity_id:ma,giav_supplier_id:ma,giav_supplier_name:_a})}catch{G(l,{giav_mapping_status:"needs_review",giav_entity_type:"supplier",giav_entity_id:ma,giav_supplier_id:ma,giav_supplier_name:_a})}}}),h.title&&(0,a.createElement)("div",{className:"service-card__field-error"},h.title)),(0,a.createElement)("div",{className:"service-card__field service-card__field--toggle"},(0,a.createElement)(ta.ToggleControl,{label:"Entrada manual (fuera de catálogo)",checked:!!t.use_manual_entry,onChange:()=>{if(t.use_manual_entry)G(l,{use_manual_entry:!1,wp_object_type:null,wp_object_id:null,show_supplier_picker:!1,giav_mapping_status:"missing",supplier_override:!1,display_name:""});else{const e=t.display_name||t.title||"";G(l,{use_manual_entry:!0,wp_object_type:"manual",wp_object_id:0,show_supplier_picker:!0,giav_entity_type:"supplier",giav_entity_id:t.giav_supplier_id||ma,giav_mapping_status:t.giav_supplier_id===ma?"needs_review":"active",giav_supplier_id:t.giav_supplier_id||ma,giav_supplier_name:t.giav_supplier_name||_a,supplier_override:!1,display_name:e,title:e})}}})),(0,a.createElement)("div",{className:"service-card__supplier"},!U(t)&&(0,a.createElement)("div",{className:"service-card__supplier-actions"},(0,a.createElement)(ta.Button,{variant:"tertiary",onClick:()=>F(l)},"Cambiar proveedor")),U(t)&&(0,a.createElement)(a.Fragment,null,!t.use_manual_entry&&(0,a.createElement)("div",{className:"service-card__field service-card__field--toggle"},(0,a.createElement)(ta.ToggleControl,{label:"Proveedor (opcional)",checked:!!t.show_supplier_picker,onChange:()=>F(l)})),(0,a.createElement)(da,{selectedId:t.giav_supplier_id||ma,selectedLabel:t.giav_supplier_name||_a,disabled:!1,onPick:e=>{const a=String(e?.id||""),n=String(e?.label||"");a&&G(l,{giav_entity_type:"supplier",giav_entity_id:a,giav_supplier_id:a,giav_supplier_name:n,giav_mapping_status:a===ma?"needs_review":"active",supplier_override:!t.use_manual_entry})}}),h.supplier&&(0,a.createElement)("div",{className:"service-card__field-error"},h.supplier)))):(0,a.createElement)("div",{className:"service-card__field "+(h.title?"is-error":"")},(0,a.createElement)(ta.TextControl,{label:"T├¡tulo / descripci├│n *",value:t.title,onChange:e=>G(l,{title:e})}),h.title&&(0,a.createElement)("div",{className:"service-card__field-error"},h.title)),"hotel"===t.service_type&&(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.TextControl,{label:"Tipo de habitación",value:t.hotel_room_type||"",onChange:e=>G(l,{hotel_room_type:e}),placeholder:"Deluxe / Sea View..."})),"hotel"===t.service_type&&(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.SelectControl,{label:"Régimen",value:t.hotel_regimen||"",options:[{label:"Seleccionar",value:""},...ha],onChange:e=>G(l,{hotel_regimen:e})})))),(0,a.createElement)("div",{className:"service-card__section"},(0,a.createElement)("div",{className:"service-card__section-title"},"Fechas y ocupación"),(0,a.createElement)("div",{className:"service-card__date-status"},(0,a.createElement)("span",{className:"service-card__date-label "+(t.dates_inherited?"is-inherited":"is-custom")},t.dates_inherited?"Fechas del viaje":"Fechas personalizadas"),!t.dates_inherited&&(0,a.createElement)(ta.Button,{variant:"tertiary",className:"service-card__date-reset",onClick:()=>(a=>{G(a,{start_date:e?.start_date||"",end_date:e?.end_date||"",dates_inherited:!0})})(l)},"Restablecer fechas del viaje")),(0,a.createElement)("div",{className:"service-card__grid service-card__grid--dates"},(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.TextControl,{label:"Fecha inicio",type:"date",value:t.start_date,onChange:a=>((a,t)=>{R(l=>{const n=[...l],r=n[a],o=t||"",s=r.end_date&&o&&r.end_date<o?o:r.end_date;return n[a]=wa({...r,start_date:o,end_date:s,dates_inherited:!1},e,m),n}),window.setTimeout(()=>{const e=document.getElementById(`wp-travel-end-date-${a}`);if(e&&(e.focus(),"function"==typeof e.showPicker))try{e.showPicker()}catch(e){}},0)})(l,a),min:va,className:"service-card__date-start"})),(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.TextControl,{id:`wp-travel-end-date-${l}`,label:"Fecha fin",type:"date",value:t.end_date,onChange:e=>((e,a)=>G(e,{end_date:a}))(l,e),min:t.start_date||void 0})),"hotel"===t.service_type?(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.TextControl,{label:"Noches",type:"number",min:0,value:String(null!==(n=t.hotel_nights)&&void 0!==n?n:ya(t,e)),onChange:a=>((a,t)=>{const l=I[a].start_date||e?.start_date;if(l){const e=function(e,a){if(!e)return"";const t=new Date(`${e}T00:00:00`);return Number.isFinite(t.getTime())?(t.setDate(t.getDate()+Math.max(0,a)),t.toISOString().slice(0,10)):""}(l,Ea(t,1));G(a,{end_date:e})}})(l,a)}))):"golf"===t.service_type?(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.TextControl,{label:"Jugadores",type:"number",min:1,value:String(d||p),disabled:!0,help:"Definido en Datos basicos"})),(0,a.createElement)("div",{className:"service-card__field "+(h.greenFees?"is-error":"")},(0,a.createElement)(ta.TextControl,{label:"Green-fees por jugador *",type:"number",min:1,value:String(null!==(r=t.green_fees_per_person)&&void 0!==r?r:""),onChange:e=>G(l,{green_fees_per_person:e})}),h.greenFees&&(0,a.createElement)("div",{className:"service-card__field-error"},h.greenFees)),(0,a.createElement)("div",{className:"service-card__golf-summary"},"Total green-fees (interno): ",Ea(d||p,1)," x ",Ea(t.green_fees_per_person,0)," ="," ",Ea(t.total_green_fees,0))):(0,a.createElement)("div",{className:"service-card__field "+(h.quantity?"is-error":"")},(0,a.createElement)(ta.TextControl,{label:"transfer"===t.service_type?"Cantidad (servicios)":"package"===t.service_type?"Cantidad (paquetes)":"Cantidad",type:"number",min:1,value:String(t.quantity),onChange:e=>G(l,{quantity:e})}),h.quantity&&(0,a.createElement)("div",{className:"service-card__field-error"},h.quantity)))),(0,a.createElement)("div",{className:"service-card__section service-card__section--pricing"},(0,a.createElement)("div",{className:"service-card__section-title"},"Pricing"),h.pricing&&(0,a.createElement)("div",{className:"service-card__field-error service-card__field-error--inline"},h.pricing),"hotel"===t.service_type?(0,a.createElement)(xa,{item:t,idx:l,updateItem:G,currency:u,pax:p,basics:e,globalMarkupPct:m}):(0,a.createElement)("div",{className:"service-card__pricing"},(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.TextControl,{label:"Coste neto (unit.)",value:String(t.unit_cost_net),onChange:e=>G(l,{unit_cost_net:e}),placeholder:"120"})),(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.ToggleControl,{label:"Usar margen",checked:!!t.use_markup,onChange:()=>G(l,{use_markup:!t.use_markup})})),t.use_markup&&(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.TextControl,{label:"Margen (%)",type:"number",min:0,value:String(null!==(o=t.markup_pct)&&void 0!==o?o:m),onChange:e=>G(l,{markup_pct:e})})),(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(ta.ToggleControl,{label:"PVP manual",checked:!!t.lock_sell_price,onChange:()=>G(l,{lock_sell_price:!t.lock_sell_price})})),(0,a.createElement)("div",{className:"service-card__field "+(h.unitSell?"is-error":"")},(0,a.createElement)(ta.TextControl,{label:"PVP (unit.)",value:String(t.unit_sell_price),onChange:e=>G(l,{unit_sell_price:e}),placeholder:"165",disabled:!t.lock_sell_price}),h.unitSell&&(0,a.createElement)("div",{className:"service-card__field-error"},h.unitSell)))),"package"===t.service_type&&(0,a.createElement)("div",{className:"service-card__section service-card__section--package"},(0,a.createElement)("div",{className:"service-card__section-title"},"Detalle del paquete"),(0,a.createElement)("div",{className:"service-card__package"},(0,a.createElement)(ta.TextControl,{label:"Incluye (una l├¡nea por item)",value:t.package_components_text||"",onChange:e=>G(l,{package_components_text:e}),placeholder:"3 noches\n2 green-fees\nDesayuno incluido"}))),"hotel"!==t.service_type&&(0,a.createElement)("div",{className:"service-card__section service-card__section--notes"},(0,a.createElement)("div",{className:"service-card__section-title"},"Notas"),(0,a.createElement)("details",{className:"service-card__notes-details"},(0,a.createElement)("summary",null,"Mostrar notas"),(0,a.createElement)("div",{className:"service-card__notes"},(0,a.createElement)(ta.TextControl,{label:"Notas para el cliente (itinerario)",value:t.notes_public||"",onChange:e=>G(l,{notes_public:e}),placeholder:"Incluye desayuno. Check-in 15:00."}),(0,a.createElement)(ta.TextControl,{label:"Notas internas (solo uso interno)",value:t.notes_internal||"",onChange:e=>G(l,{notes_internal:e}),placeholder:"Neto negociado, release 14D."}))))))})),(0,a.createElement)("div",{className:"services-add"},(0,a.createElement)(ta.Button,{variant:"secondary",onClick:()=>{const a=I.length-1,t=a>=0?D[a]:null;("error"!==t?.status||window.confirm("Tienes un servicio incompleto. ¿Crear otro igualmente?"))&&R(a=>{const t=[...a,Ca(e,m)],l=t.length-1;return C(l),x(l),t})}},"+ Añadir servicio")),(0,a.createElement)("div",{className:"services-summary"},(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"services-summary__label"},"Total viaje"),z(`${u} ${fa(B.totalTrip).toFixed(2)}`,{missing:$.totals_sell_price<=0,tooltip:"Completa servicios para calcular."}),(0,a.createElement)("div",{className:"services-summary__meta"},"Jugadores: ",B.playersCount," | No jugadores: ",B.nonPlayersCount)),B.playersCount>0&&(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"services-summary__label"},"Precio jugador en doble"),z(`${u} ${fa(B.pricePlayerDouble||0).toFixed(2)}`,{missing:B.playersCount<=0,tooltip:"Completa jugadores y servicios para calcular."})),B.nonPlayersCount>0&&(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"services-summary__label"},"Precio no jugador en doble"),z(`${u} ${fa(B.priceNonPlayerDouble||0).toFixed(2)}`,{missing:B.nonPlayersCount<=0,tooltip:"Completa no jugadores para calcular."})),B.hasSingleSupplement&&(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"services-summary__label"},"Suplemento individual"),z(`${u} ${fa(B.supplementSingle||0).toFixed(2)}`,{missing:!B.hasSingleSupplement,tooltip:"Completa habitaciones para calcular."}))),(0,a.createElement)("div",{className:"services-footer"},(h||P&&T.length>0)&&(0,a.createElement)("div",{className:"services-footer__errors"},(0,a.createElement)("div",{className:"services-footer__errors-header"},(0,a.createElement)("span",null,"Error summary"),(0,a.createElement)(ta.Button,{variant:"link",onClick:()=>{A.current&&A.current.scrollIntoView({behavior:"smooth",block:"start"})}},"Ver arriba")),h&&(0,a.createElement)("div",{className:"services-footer__errors-message"},h),(0,a.createElement)("ul",null,(T.length>0?T:j.serviceErrors).slice(0,3).map(e=>(0,a.createElement)("li",{key:e.index},(0,a.createElement)("button",{type:"button",onClick:()=>L(e.index)},e.title,": ",e.details)))),j.serviceErrors.length>3&&(0,a.createElement)("div",{className:"services-footer__errors-more"},"+",j.serviceErrors.length-3," más")),(0,a.createElement)("div",{className:"services-footer__bar"},(0,a.createElement)("div",{className:"services-footer__left"},(0,a.createElement)(ta.Button,{variant:"secondary",onClick:n},"Volver")),(0,a.createElement)("div",{className:"services-footer__summary"},(0,a.createElement)("span",null,"Total viaje"),(0,a.createElement)("strong",null,u," ",fa(B.totalTrip).toFixed(2))),(0,a.createElement)("div",{className:"services-footer__right"},(0,a.createElement)(ta.Button,{variant:"primary",onClick:()=>{const{errors:e,serviceErrors:a}=V();if(k(!0),a.length>0||e.length>0){const t=a.length>0?`Faltan datos en ${a.length} servicios. Te llevo al primero.`:e[0];return b(t),M(a),void((e,a)=>{if(e.length>0)L(e[0].index);else if(a.length>0){f(null);const e=document.querySelector(".services-step");e&&(e.scrollIntoView({behavior:"smooth",block:"start"}),O(e))}})(a,e)}b(""),M([]),f(null),r({items:I,totals:$})},disabled:q&&P,title:q?"Completa los campos obligatorios para continuar.":""},h?"Revisa los campos marcados":"Continuar"))))))}function Ta(e){const a=parseFloat(e);return Number.isFinite(a)?Math.round(100*(a+Number.EPSILON))/100:0}function Ma(e){const a=parseFloat(String(e).replace(",","."));return Number.isFinite(a)?a:0}function Aa(e,a=0){const t=parseInt(e,10);return Number.isFinite(t)?t:a}function Ia({proposalId:e,basics:l,items:n,totals:r,onBack:o,onSent:s,mode:i="create",versionNumber:c=1}){const[u,p]=(0,t.useState)(!1),[d,m]=(0,t.useState)(""),_="undefined"!=typeof window&&window.CASANOVA_GESTION_RESERVAS?"wp-travel-giav-portal":"wp-travel-giav-admin",v=(0,t.useMemo)(()=>{const e={crm_customer_id:null,first_name:l.first_name,last_name:l.last_name,customer_name:ze(l.first_name,l.last_name,l.customer_name),customer_email:l.customer_email,customer_country:l.customer_country,customer_language:l.customer_language,proposal_title:l.proposal_title,start_date:l.start_date,end_date:l.end_date,pax_total:l.pax_total,players_count:l.players_count,currency:l.currency,status:"sent"},a=(n||[]).map((e,a)=>{var t,l,n,r,o,s,i,c,u,p,d,m,_,v,g,h,b,E,f,y,N,S,C,w,x,P,k,T;return{day_index:null!==(t=e.day_index)&&void 0!==t?t:null,service_type:e.service_type,wp_object_type:null!==(l=e.wp_object_type)&&void 0!==l?l:null,wp_object_id:null!==(n=e.wp_object_id)&&void 0!==n?n:null,giav_entity_type:null!==(r=e.giav_entity_type)&&void 0!==r?r:null,giav_entity_id:null!==(o=e.giav_entity_id)&&void 0!==o?o:null,giav_supplier_id:null!==(s=e.giav_supplier_id)&&void 0!==s?s:null,giav_supplier_name:null!==(i=e.giav_supplier_name)&&void 0!==i?i:null,supplier_source:null!==(c=e.supplier_source)&&void 0!==c?c:null,supplier_resolution_chain:Array.isArray(e.supplier_resolution_chain)?e.supplier_resolution_chain:[],preflight_ok:null!==(u=e.preflight_ok)&&void 0!==u?u:null,warnings:Array.isArray(e.warnings)?e.warnings:[],blocking:Array.isArray(e.blocking)?e.blocking:[],supplier_override:!!e.supplier_override,title:null!==(p=e.title)&&void 0!==p?p:`Item ${a+1}`,display_name:null!==(d=e.display_name)&&void 0!==d?d:null,start_date:e.start_date||null,end_date:e.end_date||null,quantity:null!==(m=e.quantity)&&void 0!==m?m:1,pax_quantity:null!==(_=e.pax_quantity)&&void 0!==_?_:null,hotel_rate_basis:null!==(v=e.hotel_rate_basis)&&void 0!==v?v:null,hotel_nights:null!==(g=e.hotel_nights)&&void 0!==g?g:null,hotel_rooms:null!==(h=e.hotel_rooms)&&void 0!==h?h:null,hotel_room_type:null!==(b=e.hotel_room_type)&&void 0!==b?b:"",hotel_regimen:null!==(E=e.hotel_regimen)&&void 0!==E?E:"",room_pricing:null!==(f=e.room_pricing)&&void 0!==f?f:null,discounts:null!==(y=e.discounts)&&void 0!==y?y:null,giav_pricing:null!==(N=e.giav_pricing)&&void 0!==N?N:null,package_components:Array.isArray(e.package_components)?e.package_components:[],package_components_text:null!==(S=e.package_components_text)&&void 0!==S?S:"",green_fees_per_person:null!==(C=e.green_fees_per_person)&&void 0!==C?C:null,number_of_players:null!==(w=e.number_of_players)&&void 0!==w?w:null,total_green_fees:null!==(x=e.total_green_fees)&&void 0!==x?x:null,unit_cost_net:Ta(e.unit_cost_net),unit_sell_price:Ta(e.unit_sell_price),line_cost_net:Ta(e.line_cost_net),line_sell_price:Ta(e.line_sell_price),use_markup:!!e.use_markup,markup_pct:Ta(null!==(P=e.markup_pct)&&void 0!==P?P:0),lock_sell_price:!!e.lock_sell_price,notes_public:null!==(k=e.notes_public)&&void 0!==k?k:"",notes_internal:null!==(T=e.notes_internal)&&void 0!==T?T:""}}),t=r||{totals_cost_net:0,totals_sell_price:0,totals_margin_abs:0,totals_margin_pct:0};return{header:e,items:a,totals:{totals_cost_net:Ta(t.totals_cost_net),totals_sell_price:Ta(t.totals_sell_price),totals_margin_abs:Ta(t.totals_margin_abs),totals_margin_pct:Ta(t.totals_margin_pct)},template_id:null,terms_version:null,metadata:{created_at:(new Date).toISOString(),created_by:null,source:_,schema_version:"v2"}}},[l,n,r]),g=v?.header||{},h=ze(g.first_name,g.last_name,g.customer_name),b=v?.totals||{},E=Array.isArray(v?.items)?v.items:[],f=(0,t.useMemo)(()=>{let e=0,a=0;return E.forEach(t=>{const l=Array.isArray(t?.warnings)?t.warnings:[],n=Array.isArray(t?.blocking)?t.blocking:[];e+=l.length,a+=n.length}),{warningCount:e,blockingCount:a}},[E]),y=f.blockingCount>0?"error":f.warningCount>0?"warning":"success",N=f.blockingCount>0?`Hay ${f.blockingCount} servicios con errores`:f.warningCount>0?`Hay ${f.warningCount} avisos en servicios`:"Servicios listos para enviar",S=(0,t.useMemo)(()=>{var e,a,t;const l=Math.max(0,Aa(null!==(e=g?.pax_total)&&void 0!==e?e:0,0)),n=Aa(null!==(a=null!==(t=g?.players_count)&&void 0!==t?t:l)&&void 0!==a?a:0,0),r=Math.min(Math.max(n,0),l),o={paxTotal:l,playersCount:r,nonPlayersCount:Math.max(0,l-r),golfTotal:0,totalDouble:0,totalSingle:0,doubleRooms:0,singleRooms:0};E.forEach(e=>{if("golf"===e.service_type&&(o.golfTotal+=Ma(e.line_sell_price||0)),"hotel"===e.service_type){const l=e.room_pricing||{};var a,t;l.double?.enabled&&(o.totalDouble+=Ma(l.double?.total_pvp||0),o.doubleRooms+=Math.max(0,Aa(null!==(a=l.double?.rooms)&&void 0!==a?a:0,0))),l.single?.enabled&&(o.totalSingle+=Ma(l.single?.total_pvp||0),o.singleRooms+=Math.max(0,Aa(null!==(t=l.single?.rooms)&&void 0!==t?t:0,0)))}});const s=Ma(b?.totals_sell_price||0),i=s,c=o.doubleRooms>0?o.totalDouble/(2*o.doubleRooms):0,u=o.singleRooms>0?o.totalSingle/o.singleRooms:0,p=s-(o.totalDouble+o.totalSingle)-o.golfTotal,d=c+(o.paxTotal>0?p/o.paxTotal:0),m=o.playersCount>0?d+o.golfTotal/o.playersCount:null,_=o.doubleRooms>0&&o.singleRooms>0;let v=null;return _&&(v=Math.max(0,u-c)),{...o,totalTrip:s,baseTotal:i,priceNonPlayerDouble:d,pricePlayerDouble:m,supplementSingle:v,hasSingleSupplement:_}},[g?.pax_total,g?.players_count,E,b?.totals_sell_price]),C="edit"===i?"Guardar nueva versión":g.customer_email?"Enviar propuesta":"Crear enlace";return(0,a.createElement)(ta.Card,null,(0,a.createElement)(ta.CardHeader,null,(0,a.createElement)("strong",null,"Preview y envío")),(0,a.createElement)(ta.CardBody,null,d&&(0,a.createElement)(ta.Notice,{status:"error",isDismissible:!0,onRemove:()=>m("")},d),(0,a.createElement)(ta.Notice,{status:y,isDismissible:!1},N),(0,a.createElement)(ta.Notice,{status:"info",isDismissible:!1},"El cliente vera solo el total del paquete. El desglose por lineas queda guardado internamente en la version."),(0,a.createElement)("div",{className:"proposal-preview"},(0,a.createElement)("div",{className:"proposal-preview__header"},(0,a.createElement)("div",{className:"proposal-preview__name"},h||"—"),(0,a.createElement)("div",{className:"proposal-preview__meta"},g.start_date," - ",g.end_date," | Pax: ",g.pax_total," | Moneda: ",g.currency)),(0,a.createElement)("div",{className:"proposal-preview__includes"},(0,a.createElement)("div",{className:"proposal-preview__includes-title"},"Incluye"),(0,a.createElement)("div",{className:"preview-items"},E.map((e,t)=>{const l=Array.isArray(e?.warnings)?e.warnings:[],n=Array.isArray(e?.blocking)?e.blocking:[],r=e.display_name||e.title||`Item ${t+1}`,o=e.giav_supplier_name||"Proveedor no especificado",s=n.length>0,i=l.length>0;return(0,a.createElement)("div",{key:t,className:"preview-item"},(0,a.createElement)("div",{className:"preview-item__main"},(0,a.createElement)("div",{className:"preview-item__title"},(0,a.createElement)("strong",null,e.service_type?.toUpperCase())," - ",r),(0,a.createElement)("div",{className:"preview-item__supplier"},"Proveedor: ",o),"hotel"===e.service_type&&e.hotel_room_type?(0,a.createElement)("div",{className:"preview-item__meta"},"Habitacion: ",e.hotel_room_type):null,"package"===e.service_type&&e.package_components_text?(0,a.createElement)("div",{className:"preview-item__meta"},"Incluye: ",e.package_components_text.split("\n").filter(Boolean).join(", ")):null,s&&(0,a.createElement)("div",{className:"preview-item__blocking"},(0,a.createElement)("span",{className:"preview-item__badge preview-item__badge--error"},"Error"),"Este servicio impide la confirmacion."),s&&(0,a.createElement)("details",{className:"preview-item__details"},(0,a.createElement)("summary",null,"Ver motivos"),(0,a.createElement)("ul",null,n.map((e,t)=>(0,a.createElement)("li",{key:t},e?.message||"Revision requerida")))),i&&(0,a.createElement)("details",{className:"preview-item__details"},(0,a.createElement)("summary",null,(0,a.createElement)("span",{className:"preview-item__badge preview-item__badge--warning"},"Aviso"),"Ver avisos (",l.length,")"),(0,a.createElement)("ul",null,l.map((e,t)=>(0,a.createElement)("li",{key:t},e?.message||"Aviso"))))))}))),(0,a.createElement)("div",{className:"proposal-preview__totals"},(0,a.createElement)("div",{className:"proposal-preview__totals-label"},"Total viaje"),(0,a.createElement)("div",{className:"proposal-preview__totals-value"},g.currency," ",Ta(S.totalTrip).toFixed(2)),S.playersCount>0&&(0,a.createElement)("div",{className:"proposal-preview__totals-line"},"Precio jugador en doble: ",g.currency," ",Ta(S.pricePlayerDouble||0).toFixed(2)),(0,a.createElement)("div",{className:"proposal-preview__totals-line"},"Precio no jugador en doble: ",g.currency," ",Ta(S.priceNonPlayerDouble||0).toFixed(2)),S.hasSingleSupplement&&(0,a.createElement)("div",{className:"proposal-preview__totals-line"},"Suplemento individual: ",g.currency," ",Ta(S.supplementSingle||0).toFixed(2)),(0,a.createElement)("div",{className:"proposal-preview__totals-note"},"Precios por persona. El suplemento individual aplica por persona alojada en habitacion individual."))),(0,a.createElement)("div",{className:"proposal-preview__actions"},(0,a.createElement)(ta.Button,{variant:"secondary",onClick:o,disabled:u},"Volver"),(0,a.createElement)(ta.Button,{variant:"primary",onClick:async()=>{p(!0),m("");const a=function(){const a=e&&Number(e)>0?Number(e):null;if(a)return a;return(()=>{try{const e=window.location.search||"";if(!e)return null;const a=new URLSearchParams(e),t=["proposal_id","id","proposalId","proposalId"];for(let e of t){const t=a.get(e);if(t){const e=parseInt(t,10);if(Number.isFinite(e)&&e>0)return e}}}catch(e){}return null})()||null}();try{"undefined"!=typeof process&&process&&process.env}catch(e){}if(!a||Number(a)<=0)return p(!1),void m("No se pudo enviar: falta el identificador de propuesta válido (proposalId).");if("Enviar propuesta"!==C||window.confirm("Confirmar envio de la propuesta?"))try{const e="edit"===i?await na.createProposalVersion(a,v,c):await na.sendProposal(a,v,c);s({versionId:e.version_id,publicToken:e.public_token,publicUrl:e.public_url,status:e.status,snapshot:v})}catch(e){m(e?.message||"Error enviando la propuesta.")}finally{p(!1)}else p(!1)},disabled:u},C),u&&(0,a.createElement)(ta.Spinner,null))))}const Ra={draft:"Borrador",sent:"Enviada",accepted:"Aceptada",queued:"En cola",synced:"Sincronizada",error:"Error",revoked:"Revocada",lost:"Perdida"},$a=e=>{if(!e)return"-";const a=String(e),t=a.includes("T")?a:a.replace(" ","T"),l=new Date(t);return Number.isNaN(l.getTime())?e:new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(l)};function Ba({onExit:e,mode:l="create",initialProposal:n=null,initialSnapshot:r=null,nextVersionNumber:o=1,showStepper:s=!1}){const[i,c]=(0,t.useState)(1),[u,p]=(0,t.useState)(n?.id||null),[d,m]=(0,t.useState)(n?.status||"draft"),[_]=(0,t.useState)(n?.accepted_at||""),[v]=(0,t.useState)(n?.proposal_token||""),[g,h]=(0,t.useState)(n?.public_url||""),[b,E]=(0,t.useState)(null),[f,y]=(0,t.useState)(!1),N="undefined"!=typeof window&&!!window.CASANOVA_GESTION_RESERVAS,S=(0,t.useMemo)(()=>{if(!n&&!r)return null;const e=r?.header||{},a=e.customer_name||"",t=n?.customer_name||"",l=He(a),o=He(t),s=(e.first_name||l.firstName,e.last_name||l.lastName,e.first_name||n?.first_name||l.firstName||o.firstName||""),i=e.last_name||n?.last_name||l.lastName||o.lastName||"";return{proposal_title:e.proposal_title||n?.proposal_title||"",first_name:s,last_name:i,customer_name:ze(s,i,e.customer_name||n?.customer_name||""),customer_email:e.customer_email||n?.customer_email||"",customer_country:e.customer_country||n?.customer_country||"",customer_language:e.customer_language||n?.customer_language||"en",start_date:e.start_date||n?.start_date||"",end_date:e.end_date||n?.end_date||"",pax_total:e.pax_total||n?.pax_total||1,currency:e.currency||n?.currency||"EUR"}},[n,r]),[C,w]=(0,t.useState)(S),x=(0,t.useMemo)(()=>{const e=n?.source_meta_json;if(e)try{const a=JSON.parse(e);if(a?.intentions)return a.intentions}catch(e){}return r?.intentions||null},[n?.source_meta_json,r?.intentions]),[P,k]=(0,t.useState)(r?.items||[]),[T,M]=(0,t.useState)(r?.totals||null),[A,I]=(0,t.useState)(null),[R,$]=(0,t.useState)(null);let B=null;if(1===i)B=(0,a.createElement)(ua,{initialValues:C||{customer_language:"en",currency:"EUR",pax_total:1},onNext:({basics:e})=>{w(e),k(a=>Pa(a,e)),c(2)},onCreated:({proposalId:e,basics:a})=>{p(e),w(a),k(e=>Pa(e,a)),c(2)},proposalId:u});else if(2===i)B=(0,a.createElement)(ka,{basics:C,initialItems:P,onDraftChange:({items:e,totals:a})=>{k(e),M(a)},onBack:()=>c(1),onNext:({items:e,totals:a})=>{k(e),M(a),c(3)},requestIntentions:x});else if(3===i)B=(0,a.createElement)(Ia,{proposalId:u,basics:C,items:P,totals:T,mode:l,versionNumber:o,onBack:()=>c(2),onSent:({versionId:e,snapshot:a,publicUrl:t,publicToken:l,status:n})=>{$(e),I(a||null),t&&h(t),l&&E(l),n&&m(n),c(4)}});else if(4===i){const t=g||((e,a)=>{if(!e)return"";const t=`${window.location.origin}/travel-proposal/${e}/`;return a?`${window.location.origin}/travel-proposal/${e}/v/${a}/`:t})(v,b),n=Ra[d]||d||"-",r=_?`Aceptada el ${$a(_)}`:"Pendiente",o=(({email:e,name:a,publicUrl:t})=>{if(!e||!t)return"";const l=`${a?`Hola ${a},`:"Hola,"}\n\nAquí tienes el enlace a tu propuesta:\n${t}\n\nQuedamos a tu disposición para cualquier duda.`;return`mailto:${e}?subject=${encodeURIComponent("Tu propuesta de viaje")}&body=${encodeURIComponent(l)}`})({email:C?.customer_email,name:C?.customer_name,publicUrl:t}),s=(e=>{if("undefined"==typeof window)return"";const a=window.CASANOVA_GESTION_RESERVAS;return a?.pageBase&&e?`${a.pageBase.replace(/\/$/,"")}#/propuesta/${e}`:""})(u)||((e={})=>{const a=new URL(window.location.href);return a.searchParams.set("page","travel_proposals"),a.searchParams.delete("proposal_id"),a.searchParams.delete("action"),Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t?a.searchParams.set(e,t):a.searchParams.delete(e)}),a.toString()})({proposal_id:u}),i=N?"Ver detalle en portal":"Ir al repositorio / ver detalle",c=async()=>{await async function(e){if(!e)return!1;try{if(navigator.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0}catch(e){}const a=document.createElement("textarea");a.value=e,a.style.position="fixed",a.style.top="-1000px",document.body.appendChild(a),a.focus(),a.select();const t=document.execCommand("copy");return document.body.removeChild(a),t}(t)&&(y(!0),window.setTimeout(()=>y(!1),1500))};B=(0,a.createElement)(ta.Card,null,(0,a.createElement)(ta.CardHeader,null,(0,a.createElement)("strong",null,"Preview y envio")),(0,a.createElement)(ta.CardBody,null,(0,a.createElement)(ta.Notice,{status:"success",isDismissible:!1},"edit"===l?"Nueva version creada:":"Propuesta enviada. Version creada:"," ",(0,a.createElement)("strong",null,R)),"accepted"===d&&_?(0,a.createElement)(ta.Notice,{status:"info",isDismissible:!1},"Aceptada el ",$a(_),"."):null,(0,a.createElement)("div",{className:"proposal-wizard__final-meta"},(0,a.createElement)("div",null,(0,a.createElement)("strong",null,"Estado:")," ",n),(0,a.createElement)("div",null,(0,a.createElement)("strong",null,"Aceptacion:")," ",r),(0,a.createElement)("div",null,(0,a.createElement)("strong",null,"GIAV:")," El expediente se creara tras la aceptacion del cliente.")),(0,a.createElement)("div",{className:"proposal-wizard__final-actions"},"accepted"!==d?(0,a.createElement)(ta.Button,{variant:"primary",onClick:c,disabled:!t},f?"Enlace copiado":"Copiar enlace publico"):null,o?(0,a.createElement)(ta.Button,{variant:"secondary",onClick:()=>window.location.assign(o)},"Enviar email al cliente"):null,t?(0,a.createElement)(ta.Button,{variant:"link",href:t,target:"_blank",rel:"noopener noreferrer"},"Abrir vista publica"):null,s?(0,a.createElement)(ta.Button,{variant:"link",href:s},i):null,(0,a.createElement)(ta.Button,{variant:"tertiary",onClick:e},"Salir"))))}if(!B)return null;if(!s)return B;const G=i>3?3:i;return(0,a.createElement)("div",{className:"proposal-wizard"},(0,a.createElement)("div",{className:"proposal-wizard__stepper"},[{title:"Datos basicos",subtitle:"Identidad y fechas"},{title:"Servicios y precios",subtitle:"Hotel, golf y extras"},{title:"Vista previa y envio",subtitle:"Resumen final"}].map((e,t)=>{const l=t+1,n=G===l?"is-active":G>l?"is-complete":"is-upcoming";return(0,a.createElement)("div",{key:e.title,className:`proposal-wizard__step ${n}`.trim()},(0,a.createElement)("div",{className:"proposal-wizard__step-index"},l),(0,a.createElement)("div",{className:"proposal-wizard__step-text"},(0,a.createElement)("div",{className:"proposal-wizard__step-title"},e.title),(0,a.createElement)("div",{className:"proposal-wizard__step-subtitle"},e.subtitle)))})),(0,a.createElement)("div",{className:"proposal-wizard__content"},B))}const Ga=({mode:e="create"})=>{const l=Z(),{proposalId:n}=Y(),r=n?parseInt(n,10):null,o="edit"===e&&Number.isFinite(r),s=o?`Editar propuesta #${r}`:"Nueva propuesta",i=o?`#${r}`:"Nueva propuesta",[c,u]=(0,t.useState)(null),[p,d]=(0,t.useState)(!1),[m,_]=(0,t.useState)("");(0,t.useEffect)(()=>{if(!o||!r)return u(null),void _("");let e=!0;return(async()=>{d(!0),_("");try{const a=await na.getProposalDetail(r);e&&u(a)}catch(a){e&&_(a?.message||"No se pudo cargar la propuesta.")}finally{e&&d(!1)}})(),()=>{e=!1}},[o,r]);const v=(0,t.useMemo)(()=>o&&c?.proposal?{initialProposal:c.proposal,initialSnapshot:c.current_snapshot,nextVersionNumber:c.next_version_number||1,mode:"edit"}:null,[c,o]);return(0,a.createElement)("div",{className:"casanova-portal-section casanova-portal-section--wizard"},(0,a.createElement)("header",{className:"casanova-portal-section__header"},(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"casanova-portal-breadcrumbs"},(0,a.createElement)(Se,{to:"/proposals"},"Propuestas"),(0,a.createElement)("span",null,"/"),(0,a.createElement)("span",null,i)),(0,a.createElement)("h2",null,s),(0,a.createElement)("p",null,"Completa los pasos para crear o actualizar la propuesta.")),(0,a.createElement)("div",{className:"casanova-portal-section__actions"},(0,a.createElement)(Se,{className:"button-secondary",to:"/proposals"},"Volver al listado"))),p?(0,a.createElement)("div",{className:"casanova-portal__loading"},"Cargando..."):null,m?(0,a.createElement)("div",{className:"casanova-portal-section__notice"},m):null,p||o&&!v?null:(0,a.createElement)("div",{className:"casanova-portal-wizard"},(0,a.createElement)(Ba,{showStepper:!0,onExit:()=>l("/proposals"),...v||{}})))},Da={new:"Nueva",contacted:"Contactado",quoting:"Cotizando",proposal_sent:"Propuesta enviada",won:"Ganada",lost:"Perdida",archived:"Archivada"},La=[{value:"",label:"Todos los estados"},...Object.entries(Da).map(([e,a])=>({value:e,label:a}))],Fa=[{value:"",label:"Todos los idiomas"},{value:"es",label:"Español"},{value:"en",label:"English"}],Ua={draft:"Borrador",sent:"Enviada",accepted:"Aceptada",queued:"En cola",synced:"Sincronizada",error:"Error",revoked:"Revocada",lost:"Perdida"},Va="undefined"==typeof window?"":(window.CASANOVA_GESTION_RESERVAS?.pageBase||"").replace(/\/$/,""),Oa=(e,a=!1)=>Va&&e?`${Va}#/propuesta/${e}${a?"/editar":""}`:"";function ja(){const[e,l]=(0,t.useState)([]),[n,r]=(0,t.useState)(!1),[o,s]=(0,t.useState)(null),[i,c]=(0,t.useState)({search:"",status:"",lang:"",page:1}),[u,p]=(0,t.useState)({total_pages:1}),[d,m]=(0,t.useState)(null),_=(0,t.useCallback)(async()=>{r(!0),s(null);try{const e=await De({search:i.search,status:i.status,lang:i.lang,page:i.page,perPage:20});l(e.items||[]),p({total_pages:e.total_pages||1,page:e.page||1})}catch(e){s({type:"error",message:e.message||"No se pudo cargar las solicitudes."}),l([])}finally{r(!1)}},[i]);(0,t.useEffect)(()=>{_()},[_]);const v=(e,a)=>{c(t=>({...t,[e]:a,page:"page"===e?a:1}))},g=(0,t.useMemo)(()=>e.map(e=>{const t=e.mapped||{},l=e.intentions||{},n=((e={})=>[e.first_name||e.nombre||"",e.last_name||e.apellido||""].filter(Boolean).join(" ")||(e.customer_name?e.customer_name:"Sin nombre"))(t),r=l.golf?.green_fees_per_player,o=l.flights,i=t.pax_total||(t.jugadores||0)+(t.no_jugadores||0),c=e.proposal,u=Boolean(c?.id),p=u&&Boolean(Va),v=u?Ua[c.status]||c.status||"—":"Sin propuesta",g=u?Oa(c.id):"",h=u?Oa(c.id,!0):"",b=u?"Actualizar propuesta":"Convertir";return(0,a.createElement)("div",{key:e.id,className:"casanova-portal-table__row casanova-portal-table__row--item","data-idx":e.id},(0,a.createElement)("span",null,(e=>{if(!e)return"â";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})})(e.created_at)),(0,a.createElement)("span",null,n),(0,a.createElement)("span",null,t.email||"—"),(0,a.createElement)("span",null,t.fecha_llegada||"—"," – ",t.fecha_regreso||"—"),(0,a.createElement)("span",null,i),(0,a.createElement)("span",null,(0,a.createElement)("span",{className:`status-chip status-chip--${(e.status||"new").replace(/[^a-z0-9_-]/gi,"-")}`},Da[e.status]||e.status||"Nueva"),u?(0,a.createElement)("div",{style:{fontSize:11,color:"#6b7280"}},"Propuesta: ",v):null),(0,a.createElement)("span",null,r?`${r} GF/jug`:"—",o?.requested?(0,a.createElement)("div",{style:{fontSize:11,color:"#6b7280"}},"Vuelos desde ",o.departure_airport||"—"):null),(0,a.createElement)("span",{className:"casanova-portal-table__actions"},(0,a.createElement)(Se,{className:"button-secondary casanova-portal-table__action",to:`/requests/${e.id}`},"Ver"),p&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("button",{type:"button",className:"button-secondary casanova-portal-table__action",onClick:()=>window.open(g,"_blank","noopener")},"Ver propuesta"),(0,a.createElement)("button",{type:"button",className:"button-secondary casanova-portal-table__action",onClick:()=>window.open(h,"_blank","noopener")},"Editar propuesta")),(0,a.createElement)("button",{type:"button",className:"button-primary casanova-portal-table__action",onClick:()=>(async e=>{m(e),s(null);try{const a=await Ue(e);s({type:"success",message:"Propuesta creada. Abriendo wizard..."}),a?.redirect_url&&window.open(a.redirect_url,"_blank","noopener"),await _()}catch(e){s({type:"error",message:e.message||"No se pudo convertir la solicitud."})}finally{m(null)}})(e.id),disabled:d===e.id},d===e.id?"Convertiendo...":b)))}),[e,d]);return(0,a.createElement)("div",{className:"casanova-portal-section"},(0,a.createElement)("header",{className:"casanova-portal-section__header"},(0,a.createElement)("div",null,(0,a.createElement)("h2",null,"Solicitudes recibidas"),(0,a.createElement)("p",null,"Monitorea Gravity Forms, califica el estado y convierte en propuestas."))),(0,a.createElement)("div",{className:"casanova-portal-filters"},(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Buscar"),(0,a.createElement)("input",{type:"search",value:i.search,onChange:e=>v("search",e.target.value),placeholder:"Nombre, email o ID"})),(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Estado"),(0,a.createElement)("select",{value:i.status,onChange:e=>v("status",e.target.value)},La.map(e=>(0,a.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Idioma"),(0,a.createElement)("select",{value:i.lang,onChange:e=>v("lang",e.target.value)},Fa.map(e=>(0,a.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,a.createElement)("div",{className:"casanova-portal-filters__actions"},(0,a.createElement)("button",{className:"button-secondary",onClick:()=>_(),disabled:n},"Refrescar"))),o&&(0,a.createElement)("div",{className:"casanova-portal-section__notice "+("success"===o.type?"casanova-portal-section__notice--success":"")},o.message),(0,a.createElement)("div",{className:"casanova-portal-table"},(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--header"},(0,a.createElement)("span",null,"Fecha"),(0,a.createElement)("span",null,"Nombre"),(0,a.createElement)("span",null,"Email"),(0,a.createElement)("span",null,"Fechas"),(0,a.createElement)("span",null,"PAX"),(0,a.createElement)("span",null,"Estado"),(0,a.createElement)("span",null,"Intenciones"),(0,a.createElement)("span",null,"Acciones")),n?(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--loading"},"Cargando solicitudesâ¦"):null,!n&&!g.length&&(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--empty"},"No hay solicitudes que coincidan."),!n&&g),(0,a.createElement)("div",{className:"casanova-portal-filters",style:{justifyContent:"space-between"}},(0,a.createElement)("button",{className:"button-secondary",onClick:()=>v("page",Math.max(1,i.page-1)),disabled:i.page<=1},"Anterior"),(0,a.createElement)("span",{style:{alignSelf:"center"}},"PÃ¡gina ",i.page," de ",u.total_pages||1),(0,a.createElement)("button",{className:"button-secondary",onClick:()=>v("page",i.page+1),disabled:i.page>=(u.total_pages||1)},"Siguiente")))}const qa=[{value:"",label:"Selecciona un estado"},...Object.entries({new:"Nueva",contacted:"Contactado",quoting:"Cotizando",proposal_sent:"Propuesta enviada",won:"Ganada",lost:"Perdida",archived:"Archivada"}).map(([e,a])=>({value:e,label:a}))];function za(){const{requestId:e}=Y(),l=Z(),[n,r]=(0,t.useState)(null),[o,s]=(0,t.useState)(!1),[i,c]=(0,t.useState)(""),[u,p]=(0,t.useState)(""),[d,m]=(0,t.useState)(""),[_,v]=(0,t.useState)(null),[g,h]=(0,t.useState)(!1),[b,E]=(0,t.useState)(!1),f=async()=>{if(e){s(!0),c("");try{const a=await Le(e);r(a.request),p(a.request?.status||""),m(a.request?.notes||"")}catch(e){c(e.message||"No se pudo cargar la solicitud.")}finally{s(!1)}}else c("Solicitud inválida.")};(0,t.useEffect)(()=>{f()},[e]);const y=(0,t.useMemo)(()=>{const e=n?.intentions;if(!e)return null;const a=[];return e.golf?.requested&&a.push(`Green-fees por jugador: ${e.golf.green_fees_per_player||"—"}.`),e.flights?.requested&&a.push(`Requiere vuelos desde ${e.flights.departure_airport||"–"}.`),0===a.length&&e.package&&a.push(`Paquete: ${e.package}.`),a},[n?.intentions]);return o?(0,a.createElement)("div",{className:"casanova-portal-section"},"Cargando solicitud…"):i?(0,a.createElement)("div",{className:"casanova-portal-section"},(0,a.createElement)("div",{className:"casanova-portal-section__notice casanova-portal-section__notice--error"},i)):n?(0,a.createElement)("div",{className:"casanova-portal-section"},(0,a.createElement)("header",{className:"casanova-portal-detail__header"},(0,a.createElement)("div",null,(0,a.createElement)("p",{className:"casanova-portal__eyebrow"},"Solicitud #",n.entry_id),(0,a.createElement)("h2",null,((e={})=>[e.first_name||e.nombre||"",e.last_name||e.apellido||""].filter(Boolean).join(" ")||(e.customer_name?e.customer_name:"Sin nombre"))(n.mapped)),(0,a.createElement)("p",null,n.mapped?.email||"—"," • ",n.mapped?.telefono||"—")),(0,a.createElement)("div",{className:"casanova-portal-detail__actions"},(0,a.createElement)("button",{type:"button",className:"button-secondary",onClick:()=>l("/requests")},"Volver al listado"),n.proposal?.public_url?(0,a.createElement)("a",{className:"button-secondary",href:n.proposal.public_url,target:"_blank",rel:"noreferrer"},"Abrir propuesta"):null)),_&&(0,a.createElement)("div",{className:"casanova-portal-section__notice "+("success"===_.type?"casanova-portal-section__notice--success":"")},_.text),y&&y.length>0&&(0,a.createElement)("div",{className:"casanova-portal-section__notice casanova-portal-section__notice--success"},"Solicitud indica: ",y.join(" ")),(0,a.createElement)("div",{className:"casanova-portal-requests-detail"},(0,a.createElement)("div",{className:"casanova-portal-card"},(0,a.createElement)("h3",null,"Resumen"),(0,a.createElement)("p",null,"Fechas: ",n.mapped?.fecha_llegada||"—"," – ",n.mapped?.fecha_regreso||"—"),(0,a.createElement)("p",null,"Jugadores: ",n.mapped?.jugadores||0),(0,a.createElement)("p",null,"No jugadores: ",n.mapped?.no_jugadores||0),(0,a.createElement)("p",null,"Green-fees por jugador: ",n.mapped?.green_fees_per_player||"—"),(0,a.createElement)("p",null,"Solicita vuelos: ",n.intentions?.flights?.requested?"S�":"No"),(0,a.createElement)("p",null,"Más info: ",n.mapped?.more_info||"—")),(0,a.createElement)("div",{className:"casanova-portal-card"},(0,a.createElement)("h3",null,"Estado CRM"),(0,a.createElement)("label",{htmlFor:"request-status",className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Estado"),(0,a.createElement)("select",{id:"request-status",value:u,onChange:e=>p(e.target.value)},qa.map(e=>(0,a.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Notas"),(0,a.createElement)("textarea",{value:d,onChange:e=>m(e.target.value),rows:"4",style:{width:"100%",borderRadius:10,border:"1px solid #cbd5f5",padding:10,fontSize:14}})),(0,a.createElement)("div",{className:"casanova-portal-detail__actions-row"},(0,a.createElement)("button",{type:"button",className:"button-primary",onClick:async()=>{if(u){h(!0),v(null);try{await Fe(e,{status:u,notes:d}),v({type:"success",text:"Estado actualizado."}),await f()}catch(e){v({type:"error",text:e.message||"No se pudo actualizar."})}finally{h(!1)}}else v({type:"error",text:"Selecciona un estado."})},disabled:g||n.status===u},g?"Guardando…":"Actualizar estado"),(0,a.createElement)("button",{type:"button",className:"button-primary",onClick:async()=>{E(!0),v(null);try{const a=await Ue(e);v({type:"success",text:"Propuesta creada. Abriendo wizard..."}),a?.redirect_url&&window.open(a.redirect_url,"_blank","noopener"),await f()}catch(e){v({type:"error",text:e.message||"No se pudo convertir."})}finally{E(!1)}},disabled:b},b?"Convirtiendo…":"Crear propuesta"))))):null}const Ha=({children:e,config:t})=>(0,a.createElement)("div",{className:"casanova-portal"},(0,a.createElement)("header",{className:"casanova-portal__header"},(0,a.createElement)("div",{className:"casanova-portal__header-main"},(0,a.createElement)("div",null,(0,a.createElement)("p",{className:"casanova-portal__eyebrow"},"Portal de propuestas"),(0,a.createElement)("h1",null,"Gestión de reservas")),(0,a.createElement)("div",{className:"casanova-portal__user"},(0,a.createElement)("div",{className:"casanova-portal__user-meta"},(0,a.createElement)("span",null,t.currentUser?.displayName||"Administrador"),(0,a.createElement)("small",null,t.currentUser?.email||"")),t.logoutUrl?(0,a.createElement)("div",{className:"casanova-portal__user-actions"},(0,a.createElement)("a",{className:"casanova-portal__logout",href:t.logoutUrl},"Cerrar sesión")):null)),(0,a.createElement)("p",{className:"casanova-portal__subtitle"},"Monitorea versiones, revisa estados y sincroniza con GIAV.")),(0,a.createElement)("div",{className:"casanova-portal__body"},(0,a.createElement)("aside",{className:"casanova-portal__sidebar"},(0,a.createElement)("div",{className:"casanova-portal__branding"},(0,a.createElement)("span",{className:"casanova-portal__branding-icon"},"CG"),(0,a.createElement)("div",null,(0,a.createElement)("strong",null,"Casanova"),(0,a.createElement)("small",null,"Gestión premium"))),(0,a.createElement)("nav",{className:"casanova-portal__nav"},(0,a.createElement)(Ce,{to:"/proposals",className:({isActive:e})=>"casanova-portal__nav-link "+(e?"casanova-portal__nav-link--active":"")},"Listado de propuestas"),(0,a.createElement)(Ce,{to:"/requests",className:({isActive:e})=>"casanova-portal__nav-link "+(e?"casanova-portal__nav-link--active":"")},"Solicitudes recibidas")),(0,a.createElement)("div",{className:"casanova-portal__status"},(0,a.createElement)("span",null,"Base de datos"),(0,a.createElement)("strong",{className:t.flags?.dbHealthy?"status-chip--ok":"status-chip--warning"},t.flags?.dbHealthy?"OK":"Revisar"))),(0,a.createElement)("section",{className:"casanova-portal__content"},e))),Wa=()=>{const e=window.CASANOVA_GESTION_RESERVAS;return e?(0,a.createElement)(fe,null,(0,a.createElement)(Ha,{config:e},(0,a.createElement)(pe,null,(0,a.createElement)(ce,{path:"/",element:(0,a.createElement)(ie,{to:"/proposals",replace:!0})}),(0,a.createElement)(ce,{path:"/proposals",element:(0,a.createElement)(Ye,null)}),(0,a.createElement)(ce,{path:"/requests",element:(0,a.createElement)(ja,null)}),(0,a.createElement)(ce,{path:"/requests/:requestId",element:(0,a.createElement)(za,null)}),(0,a.createElement)(ce,{path:"/nueva",element:(0,a.createElement)(Ga,{mode:"create"})}),(0,a.createElement)(ce,{path:"/propuesta/:proposalId",element:(0,a.createElement)(aa,null)}),(0,a.createElement)(ce,{path:"/propuesta/:proposalId/editar",element:(0,a.createElement)(Ga,{mode:"edit"})}),(0,a.createElement)(ce,{path:"/proposals/:proposalId",element:(0,a.createElement)(aa,null)}),(0,a.createElement)(ce,{path:"/proposals/:proposalId/edit",element:(0,a.createElement)(Ga,{mode:"edit"})}),(0,a.createElement)(ce,{path:"*",element:(0,a.createElement)(ie,{to:"/proposals",replace:!0})})))):(0,a.createElement)("div",{className:"casanova-portal__loading"},"Cargando configuración...")},Ka=document.getElementById("casanova-gestion-reservas-app");Ka&&(0,t.createRoot)(Ka).render((0,a.createElement)(Wa,null))})();