(()=>{"use strict";var e,a,t={455(e){e.exports=window.wp.apiFetch},609(e){e.exports=window.React},863(e,a,t){t.d(a,{Ay:()=>d,ZW:()=>c,q2:()=>p,t9:()=>u});var l=t(455),n=t.n(l);const r=window.CASANOVA_GESTION_RESERVAS||{},i=(r.restUrl||`${window.location.origin}/wp-json/travel/v1`).replace(/\/$/,""),o=(()=>{let e=!1;return()=>{if(e)return;const a=r.restUrl?r.restUrl.replace(/\/travel\/v1\/?$/,"/"):r.apiUrl?r.apiUrl.replace(/\/travel\/v1\/?$/,"/"):`${window.location.origin}/wp-json/`;a&&n().use(n().createRootURLMiddleware(a)),r.nonce&&n().use(n().createNonceMiddleware(r.nonce)),e=!0}})(),s=async(e,a={})=>{const t={"X-WP-Nonce":r.nonce||"",...a.headers},l={method:a.method||"GET",credentials:"include",headers:t};void 0!==a.body&&(t["Content-Type"]="application/json",l.body=JSON.stringify(a.body));const n=await fetch((e=>{const a=e.replace(/^\/+/,"");return new URL(a,`${i}/`).toString()})(e),l);return(async e=>{const a=-1!==(e.headers.get("content-type")||"").indexOf("application/json")?await e.json():null;if(e.ok)return a;const t=new Error(a?.message||"No se pudo completar la solicitud");throw t.status=e.status,t})(n)},c=async({year:e,force:a,page:t,perPage:l,sortBy:n,order:r,agent:i,client:o,paymentStatus:c,paymentDueDays:u,tripDueDays:p,expediente:d}={})=>{const m=e||(new Date).getFullYear(),_=new URLSearchParams;return _.set("year",String(m)),a&&_.set("force","1"),null!=t&&_.set("page",String(t)),null!=l&&_.set("per_page",String(l)),n&&_.set("sort_by",n),r&&_.set("order",r),i&&_.set("agent",i),o&&_.set("client",o),c&&_.set("payment_status",c),null!=u&&_.set("payment_due_days",String(u)),null!=p&&_.set("trip_due_days",String(p)),d&&_.set("expediente",d),s(`dashboard?${_.toString()}`)},u=async(e,a)=>e?a?(o(),n()({path:`/travel/v1/proposals/${e}/accept`,method:"POST",data:{version_id:a}})):Promise.reject(new Error("Selecciona una versión a aceptar")):Promise.reject(new Error("ID de propuesta inválido")),p=async e=>e?(o(),n()({path:`/travel/v1/proposals/${e}/mark-sent`,method:"POST"})):Promise.reject(new Error("ID de propuesta inválido")),d={listProposals:async(e={})=>{var a,t;const l=await s(((e={})=>{var a,t;const l=new URLSearchParams,n=(e,a)=>{null!=a&&""!==a&&l.set(e,String(a))};return n("q",e.search),n("status",e.status),n("sort",e.sortBy||"updated_at"),n("order",e.order||"desc"),n("page",null!==(a=e.page)&&void 0!==a?a:1),n("per_page",null!==(t=e.perPage)&&void 0!==t?t:50),`proposals?${l.toString()}`})(e)),n=Array.isArray(l?.items)?l.items:[];return{items:n,total:"number"==typeof l?.total?l.total:n.length,page:null!==(a=l?.page)&&void 0!==a?a:1,per_page:null!==(t=l?.per_page)&&void 0!==t?t:50}},deleteProposal:e=>s(`proposals/${e}`,{method:"DELETE"}),bulkDeleteProposals:(e=[])=>s("proposals/bulk-delete",{method:"POST",body:{ids:e}}),getProposalDetail:e=>s(`proposals/${e}/detail`),giavPreflight:async e=>e?(o(),n()({path:`/travel/v1/versions/${e}/giav-preflight`,method:"GET"})):Promise.reject(new Error("Versión inválida")),retryGiavSync:async e=>e?(o(),n()({path:`/travel/v1/proposals/${e}/giav-retry`,method:"POST"})):Promise.reject(new Error("ID de propuesta inválido")),listRequests:async(e={})=>{var a,t,l;const n=await s(((e={})=>{var a,t;const l=new URLSearchParams,n=(e,a)=>{null!=a&&""!==a&&l.set(e,String(a))};return n("q",e.search),n("status",e.status),n("lang",e.lang),n("form",e.form),n("page",null!==(a=e.page)&&void 0!==a?a:1),n("per_page",null!==(t=e.perPage)&&void 0!==t?t:20),`requests?${l.toString()}`})(e));return{items:Array.isArray(n?.items)?n.items:[],total:"number"==typeof n?.total?n.total:0,page:null!==(a=n?.page)&&void 0!==a?a:1,per_page:null!==(t=n?.per_page)&&void 0!==t?t:20,total_pages:null!==(l=n?.total_pages)&&void 0!==l?l:0}},getRequest:e=>s(`requests/${e}`),updateRequestStatus:(e,a)=>s(`requests/${e}/status`,{method:"POST",body:a}),convertRequest:e=>s(`requests/${e}/convert`,{method:"POST"})}}},l={};function n(e){var a=l[e];if(void 0!==a)return a.exports;var r=l[e]={exports:{}};return t[e](r,r.exports,n),r.exports}n.m=t,n.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return n.d(a,{a}),a},n.d=(e,a)=>{for(var t in a)n.o(a,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((a,t)=>(n.f[t](e,a),a),[])),n.u=e=>e+".js",n.miniCssF=e=>e+".css",n.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),e={},a="wp-travel-giav-admin:",n.l=(t,l,r,i)=>{if(e[t])e[t].push(l);else{var o,s;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var p=c[u];if(p.getAttribute("src")==t||p.getAttribute("data-webpack")==a+r){o=p;break}}o||(s=!0,(o=document.createElement("script")).charset="utf-8",n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",a+r),o.src=t),e[t]=[l];var d=(a,l)=>{o.onerror=o.onload=null,clearTimeout(m);var n=e[t];if(delete e[t],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach(e=>e(l)),a)return a(l)},m=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),s&&document.head.appendChild(o)}},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;globalThis.importScripts&&(e=globalThis.location+"");var a=globalThis.document;if(!e&&a&&(a.currentScript&&"SCRIPT"===a.currentScript.tagName.toUpperCase()&&(e=a.currentScript.src),!e)){var t=a.getElementsByTagName("script");if(t.length)for(var l=t.length-1;l>-1&&(!e||!/^http(s?):/.test(e));)e=t[l--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{if("undefined"!=typeof document){var e={65:0};n.f.miniCss=(a,t)=>{e[a]?t.push(e[a]):0!==e[a]&&{432:1}[a]&&t.push(e[a]=(e=>new Promise((a,t)=>{var l=n.miniCssF(e),r=n.p+l;if(((e,a)=>{for(var t=document.getElementsByTagName("link"),l=0;l<t.length;l++){var n=(i=t[l]).getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(n===e||n===a))return i}var r=document.getElementsByTagName("style");for(l=0;l<r.length;l++){var i;if((n=(i=r[l]).getAttribute("data-href"))===e||n===a)return i}})(l,r))return a();((e,a,t,l,r)=>{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",n.nc&&(i.nonce=n.nc),i.onerror=i.onload=t=>{if(i.onerror=i.onload=null,"load"===t.type)l();else{var n=t&&t.type,o=t&&t.target&&t.target.href||a,s=new Error("Loading CSS chunk "+e+" failed.\n("+n+": "+o+")");s.name="ChunkLoadError",s.code="CSS_CHUNK_LOAD_FAILED",s.type=n,s.request=o,i.parentNode&&i.parentNode.removeChild(i),r(s)}},i.href=a,document.head.appendChild(i)})(e,r,0,a,t)}))(a).then(()=>{e[a]=0},t=>{throw delete e[a],t}))}}})(),(()=>{var e={65:0};n.f.j=(a,t)=>{var l=n.o(e,a)?e[a]:void 0;if(0!==l)if(l)t.push(l[2]);else{var r=new Promise((t,n)=>l=e[a]=[t,n]);t.push(l[2]=r);var i=n.p+n.u(a),o=new Error;n.l(i,t=>{if(n.o(e,a)&&(0!==(l=e[a])&&(e[a]=void 0),l)){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;o.message="Loading chunk "+a+" failed.\n("+r+": "+i+")",o.name="ChunkLoadError",o.type=r,o.request=i,l[1](o)}},"chunk-"+a,a)}};var a=(a,t)=>{var l,r,[i,o,s]=t,c=0;if(i.some(a=>0!==e[a])){for(l in o)n.o(o,l)&&(n.m[l]=o[l]);s&&s(n)}for(a&&a(t);c<i.length;c++)r=i[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0},t=globalThis.webpackChunkwp_travel_giav_admin=globalThis.webpackChunkwp_travel_giav_admin||[];t.forEach(a.bind(null,0)),t.push=a.bind(null,t.push.bind(t))})();var r=n(609);const i=window.wp.element,o=window.ReactDOM;function s(){return s=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},s.apply(this,arguments)}var c;!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(c||(c={}));const u="popstate";function p(e,a){if(!1===e||null==e)throw new Error(a)}function d(e,a){if(!e){"undefined"!=typeof console&&console.warn(a);try{throw new Error(a)}catch(e){}}}function m(e,a){return{usr:e.state,key:e.key,idx:a}}function _(e,a,t,l){return void 0===t&&(t=null),s({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof a?g(a):a,{state:t,key:a&&a.key||l||Math.random().toString(36).substr(2,8)})}function v(e){let{pathname:a="/",search:t="",hash:l=""}=e;return t&&"?"!==t&&(a+="?"===t.charAt(0)?t:"?"+t),l&&"#"!==l&&(a+="#"===l.charAt(0)?l:"#"+l),a}function g(e){let a={};if(e){let t=e.indexOf("#");t>=0&&(a.hash=e.substr(t),e=e.substr(0,t));let l=e.indexOf("?");l>=0&&(a.search=e.substr(l),e=e.substr(0,l)),e&&(a.pathname=e)}return a}var h;function b(e,a,t){return void 0===t&&(t="/"),function(e,a,t,l){let n=I(("string"==typeof a?g(a):a).pathname||"/",t);if(null==n)return null;let r=f(e);!function(e){e.sort((e,a)=>e.score!==a.score?a.score-e.score:function(e,a){return e.length===a.length&&e.slice(0,-1).every((e,t)=>e===a[t])?e[e.length-1]-a[a.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),a.routesMeta.map(e=>e.childrenIndex)))}(r);let i=null;for(let e=0;null==i&&e<r.length;++e){let a=A(n);i=M(r[e],a,l)}return i}(e,a,t,!1)}function f(e,a,t,l){void 0===a&&(a=[]),void 0===t&&(t=[]),void 0===l&&(l="");let n=(e,n,r)=>{let i={relativePath:void 0===r?e.path||"":r,caseSensitive:!0===e.caseSensitive,childrenIndex:n,route:e};i.relativePath.startsWith("/")&&(p(i.relativePath.startsWith(l),'Absolute route path "'+i.relativePath+'" nested under path "'+l+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),i.relativePath=i.relativePath.slice(l.length));let o=G([l,i.relativePath]),s=t.concat(i);e.children&&e.children.length>0&&(p(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),f(e.children,a,s,o)),(null!=e.path||e.index)&&a.push({path:o,score:P(o,e.index),routesMeta:s})};return e.forEach((e,a)=>{var t;if(""!==e.path&&null!=(t=e.path)&&t.includes("?"))for(let t of E(e.path))n(e,a,t);else n(e,a)}),a}function E(e){let a=e.split("/");if(0===a.length)return[];let[t,...l]=a,n=t.endsWith("?"),r=t.replace(/\?$/,"");if(0===l.length)return n?[r,""]:[r];let i=E(l.join("/")),o=[];return o.push(...i.map(e=>""===e?r:[r,e].join("/"))),n&&o.push(...i),o.map(a=>e.startsWith("/")&&""===a?"/":a)}!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(h||(h={})),new Set(["lazy","caseSensitive","path","id","index","children"]);const y=/^:[\w-]+$/,N=3,S=2,C=1,w=10,k=-2,x=e=>"*"===e;function P(e,a){let t=e.split("/"),l=t.length;return t.some(x)&&(l+=k),a&&(l+=S),t.filter(e=>!x(e)).reduce((e,a)=>e+(y.test(a)?N:""===a?C:w),l)}function M(e,a,t){void 0===t&&(t=!1);let{routesMeta:l}=e,n={},r="/",i=[];for(let e=0;e<l.length;++e){let o=l[e],s=e===l.length-1,c="/"===r?a:a.slice(r.length)||"/",u=T({path:o.relativePath,caseSensitive:o.caseSensitive,end:s},c),p=o.route;if(!u&&s&&t&&!l[l.length-1].route.index&&(u=T({path:o.relativePath,caseSensitive:o.caseSensitive,end:!1},c)),!u)return null;Object.assign(n,u.params),i.push({params:n,pathname:G([r,u.pathname]),pathnameBase:F(G([r,u.pathnameBase])),route:p}),"/"!==u.pathnameBase&&(r=G([r,u.pathnameBase]))}return i}function T(e,a){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[t,l]=function(e,a,t){void 0===a&&(a=!1),void 0===t&&(t=!0),d("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let l=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,a,t)=>(l.push({paramName:a,isOptional:null!=t}),t?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(l.push({paramName:"*"}),n+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":""!==e&&"/"!==e&&(n+="(?:(?=\\/|$))"),[new RegExp(n,a?void 0:"i"),l]}(e.path,e.caseSensitive,e.end),n=a.match(t);if(!n)return null;let r=n[0],i=r.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:l.reduce((e,a,t)=>{let{paramName:l,isOptional:n}=a;if("*"===l){let e=o[t]||"";i=r.slice(0,r.length-e.length).replace(/(.)\/+$/,"$1")}const s=o[t];return e[l]=n&&!s?void 0:(s||"").replace(/%2F/g,"/"),e},{}),pathname:r,pathnameBase:i,pattern:e}}function A(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(a){return d(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+a+")."),e}}function I(e,a){if("/"===a)return e;if(!e.toLowerCase().startsWith(a.toLowerCase()))return null;let t=a.endsWith("/")?a.length-1:a.length,l=e.charAt(t);return l&&"/"!==l?null:e.slice(t)||"/"}const R=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function $(e,a){let t=a.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?t.length>1&&t.pop():"."!==e&&t.push(e)}),t.length>1?t.join("/"):"/"}function B(e,a,t,l){return"Cannot include a '"+e+"' character in a manually specified `to."+a+"` field ["+JSON.stringify(l)+"].  Please separate it out to the `to."+t+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function L(e,a){let t=function(e){return e.filter((e,a)=>0===a||e.route.path&&e.route.path.length>0)}(e);return a?t.map((e,a)=>a===t.length-1?e.pathname:e.pathnameBase):t.map(e=>e.pathnameBase)}function D(e,a,t,l){let n;void 0===l&&(l=!1),"string"==typeof e?n=g(e):(n=s({},e),p(!n.pathname||!n.pathname.includes("?"),B("?","pathname","search",n)),p(!n.pathname||!n.pathname.includes("#"),B("#","pathname","hash",n)),p(!n.search||!n.search.includes("#"),B("#","search","hash",n)));let r,i=""===e||""===n.pathname,o=i?"/":n.pathname;if(null==o)r=t;else{let e=a.length-1;if(!l&&o.startsWith("..")){let a=o.split("/");for(;".."===a[0];)a.shift(),e-=1;n.pathname=a.join("/")}r=e>=0?a[e]:"/"}let c=function(e,a){void 0===a&&(a="/");let t,{pathname:l,search:n="",hash:r=""}="string"==typeof e?g(e):e;if(l)if(i=l,R.test(i))t=l;else{if(l.includes("//")){let e=l;l=l.replace(/\/\/+/g,"/"),d(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+l)}t=l.startsWith("/")?$(l.substring(1),"/"):$(l,a)}else t=a;var i;return{pathname:t,search:q(n),hash:U(r)}}(n,r),u=o&&"/"!==o&&o.endsWith("/"),m=(i||"."===o)&&t.endsWith("/");return c.pathname.endsWith("/")||!u&&!m||(c.pathname+="/"),c}const G=e=>e.join("/").replace(/\/\/+/g,"/"),F=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),q=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",U=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;const V=["post","put","patch","delete"],j=(new Set(V),["get",...V]);function O(){return O=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},O.apply(this,arguments)}new Set(j),new Set([301,302,303,307,308]),new Set([307,308]),Symbol("deferred");const z=r.createContext(null),H=r.createContext(null),W=r.createContext(null),K=r.createContext(null),J=r.createContext({outlet:null,matches:[],isDataRoute:!1}),Z=r.createContext(null);function Y(){return null!=r.useContext(K)}function Q(){return Y()||p(!1),r.useContext(K).location}function X(e){r.useContext(W).static||r.useLayoutEffect(e)}function ee(){let{isDataRoute:e}=r.useContext(J);return e?function(){let{router:e}=function(){let e=r.useContext(z);return e||p(!1),e}(se.UseNavigateStable),a=ue(ce.UseNavigateStable),t=r.useRef(!1);return X(()=>{t.current=!0}),r.useCallback(function(l,n){void 0===n&&(n={}),t.current&&("number"==typeof l?e.navigate(l):e.navigate(l,O({fromRouteId:a},n)))},[e,a])}():function(){Y()||p(!1);let e=r.useContext(z),{basename:a,future:t,navigator:l}=r.useContext(W),{matches:n}=r.useContext(J),{pathname:i}=Q(),o=JSON.stringify(L(n,t.v7_relativeSplatPath)),s=r.useRef(!1);return X(()=>{s.current=!0}),r.useCallback(function(t,n){if(void 0===n&&(n={}),!s.current)return;if("number"==typeof t)return void l.go(t);let r=D(t,JSON.parse(o),i,"path"===n.relative);null==e&&"/"!==a&&(r.pathname="/"===r.pathname?a:G([a,r.pathname])),(n.replace?l.replace:l.push)(r,n.state,n)},[a,l,o,i,e])}()}function ae(){let{matches:e}=r.useContext(J),a=e[e.length-1];return a?a.params:{}}function te(e,a){let{relative:t}=void 0===a?{}:a,{future:l}=r.useContext(W),{matches:n}=r.useContext(J),{pathname:i}=Q(),o=JSON.stringify(L(n,l.v7_relativeSplatPath));return r.useMemo(()=>D(e,JSON.parse(o),i,"path"===t),[e,o,i,t])}function le(e,a,t,l){Y()||p(!1);let{navigator:n}=r.useContext(W),{matches:i}=r.useContext(J),o=i[i.length-1],s=o?o.params:{},u=(o&&o.pathname,o?o.pathnameBase:"/");o&&o.route;let d,m=Q();if(a){var _;let e="string"==typeof a?g(a):a;"/"===u||(null==(_=e.pathname)?void 0:_.startsWith(u))||p(!1),d=e}else d=m;let v=d.pathname||"/",h=v;if("/"!==u){let e=u.replace(/^\//,"").split("/");h="/"+v.replace(/^\//,"").split("/").slice(e.length).join("/")}let f=b(e,{pathname:h}),E=function(e,a,t,l){var n;if(void 0===a&&(a=[]),void 0===t&&(t=null),void 0===l&&(l=null),null==e){var i;if(!t)return null;if(t.errors)e=t.matches;else{if(!(null!=(i=l)&&i.v7_partialHydration&&0===a.length&&!t.initialized&&t.matches.length>0))return null;e=t.matches}}let o=e,s=null==(n=t)?void 0:n.errors;if(null!=s){let e=o.findIndex(e=>e.route.id&&void 0!==(null==s?void 0:s[e.route.id]));e>=0||p(!1),o=o.slice(0,Math.min(o.length,e+1))}let c=!1,u=-1;if(t&&l&&l.v7_partialHydration)for(let e=0;e<o.length;e++){let a=o[e];if((a.route.HydrateFallback||a.route.hydrateFallbackElement)&&(u=e),a.route.id){let{loaderData:e,errors:l}=t,n=a.route.loader&&void 0===e[a.route.id]&&(!l||void 0===l[a.route.id]);if(a.route.lazy||n){c=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,l,n)=>{let i,p=!1,d=null,m=null;var _;t&&(i=s&&l.route.id?s[l.route.id]:void 0,d=l.route.errorElement||re,c&&(u<0&&0===n?(pe[_="route-fallback"]||(pe[_]=!0),p=!0,m=null):u===n&&(p=!0,m=l.route.hydrateFallbackElement||null)));let v=a.concat(o.slice(0,n+1)),g=()=>{let a;return a=i?d:p?m:l.route.Component?r.createElement(l.route.Component,null):l.route.element?l.route.element:e,r.createElement(oe,{match:l,routeContext:{outlet:e,matches:v,isDataRoute:null!=t},children:a})};return t&&(l.route.ErrorBoundary||l.route.errorElement||0===n)?r.createElement(ie,{location:t.location,revalidation:t.revalidation,component:d,error:i,children:g(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):g()},null)}(f&&f.map(e=>Object.assign({},e,{params:Object.assign({},s,e.params),pathname:G([u,n.encodeLocation?n.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:G([u,n.encodeLocation?n.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),i,t,l);return a&&E?r.createElement(K.Provider,{value:{location:O({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:c.Pop}},E):E}function ne(){let e=function(){var e;let a=r.useContext(Z),t=function(){let e=r.useContext(H);return e||p(!1),e}(ce.UseRouteError),l=ue(ce.UseRouteError);return void 0!==a?a:null==(e=t.errors)?void 0:e[l]}(),a=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),t=e instanceof Error?e.stack:null,l={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return r.createElement(r.Fragment,null,r.createElement("h2",null,"Unexpected Application Error!"),r.createElement("h3",{style:{fontStyle:"italic"}},a),t?r.createElement("pre",{style:l},t):null,null)}const re=r.createElement(ne,null);class ie extends r.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,a){return a.location!==e.location||"idle"!==a.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:a.error,location:a.location,revalidation:e.revalidation||a.revalidation}}componentDidCatch(e,a){console.error("React Router caught the following error during render",e,a)}render(){return void 0!==this.state.error?r.createElement(J.Provider,{value:this.props.routeContext},r.createElement(Z.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function oe(e){let{routeContext:a,match:t,children:l}=e,n=r.useContext(z);return n&&n.static&&n.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=t.route.id),r.createElement(J.Provider,{value:a},l)}var se=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(se||{}),ce=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ce||{});function ue(e){let a=function(){let e=r.useContext(J);return e||p(!1),e}(),t=a.matches[a.matches.length-1];return t.route.id||p(!1),t.route.id}const pe={};function de(e){let{to:a,replace:t,state:l,relative:n}=e;Y()||p(!1);let{future:i,static:o}=r.useContext(W),{matches:s}=r.useContext(J),{pathname:c}=Q(),u=ee(),d=D(a,L(s,i.v7_relativeSplatPath),c,"path"===n),m=JSON.stringify(d);return r.useEffect(()=>u(JSON.parse(m),{replace:t,state:l,relative:n}),[u,m,n,t,l]),null}function me(e){p(!1)}function _e(e){let{basename:a="/",children:t=null,location:l,navigationType:n=c.Pop,navigator:i,static:o=!1,future:s}=e;Y()&&p(!1);let u=a.replace(/^\/*/,"/"),d=r.useMemo(()=>({basename:u,navigator:i,static:o,future:O({v7_relativeSplatPath:!1},s)}),[u,s,i,o]);"string"==typeof l&&(l=g(l));let{pathname:m="/",search:_="",hash:v="",state:h=null,key:b="default"}=l,f=r.useMemo(()=>{let e=I(m,u);return null==e?null:{location:{pathname:e,search:_,hash:v,state:h,key:b},navigationType:n}},[u,m,_,v,h,b,n]);return null==f?null:r.createElement(W.Provider,{value:d},r.createElement(K.Provider,{children:t,value:f}))}function ve(e){let{children:a,location:t}=e;return le(ge(a),t)}function ge(e,a){void 0===a&&(a=[]);let t=[];return r.Children.forEach(e,(e,l)=>{if(!r.isValidElement(e))return;let n=[...a,l];if(e.type===r.Fragment)return void t.push.apply(t,ge(e.props.children,n));e.type!==me&&p(!1),e.props.index&&e.props.children&&p(!1);let i={id:e.props.id||n.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(i.children=ge(e.props.children,n)),t.push(i)}),t}function he(){return he=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},he.apply(this,arguments)}function be(e,a){if(null==e)return{};var t,l,n={},r=Object.keys(e);for(l=0;l<r.length;l++)t=r[l],a.indexOf(t)>=0||(n[t]=e[t]);return n}function fe(e){return void 0===e&&(e=""),new URLSearchParams("string"==typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((a,t)=>{let l=e[t];return a.concat(Array.isArray(l)?l.map(e=>[t,e]):[[t,l]])},[]))}r.startTransition,new Promise(()=>{}),r.Component,new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Ee=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ye=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"];try{window.__reactRouterVersion="6"}catch(e){}const Ne=r.createContext({isTransitioning:!1});new Map;const Se=r.startTransition;function Ce(e){let{basename:a,children:t,future:l,window:n}=e,i=r.useRef();var o;null==i.current&&(i.current=(void 0===(o={window:n,v5Compat:!0})&&(o={}),function(e,a,t,l){void 0===l&&(l={});let{window:n=document.defaultView,v5Compat:r=!1}=l,i=n.history,o=c.Pop,d=null,g=h();function h(){return(i.state||{idx:null}).idx}function b(){o=c.Pop;let e=h(),a=null==e?null:e-g;g=e,d&&d({action:o,location:E.location,delta:a})}function f(e){let a="null"!==n.location.origin?n.location.origin:n.location.href,t="string"==typeof e?e:v(e);return t=t.replace(/ $/,"%20"),p(a,"No window.location.(origin|href) available to create URL for href: "+t),new URL(t,a)}null==g&&(g=0,i.replaceState(s({},i.state,{idx:g}),""));let E={get action(){return o},get location(){return e(n,i)},listen(e){if(d)throw new Error("A history only accepts one active listener");return n.addEventListener(u,b),d=e,()=>{n.removeEventListener(u,b),d=null}},createHref:e=>a(n,e),createURL:f,encodeLocation(e){let a=f(e);return{pathname:a.pathname,search:a.search,hash:a.hash}},push:function(e,a){o=c.Push;let l=_(E.location,e,a);t&&t(l,e),g=h()+1;let s=m(l,g),u=E.createHref(l);try{i.pushState(s,"",u)}catch(e){if(e instanceof DOMException&&"DataCloneError"===e.name)throw e;n.location.assign(u)}r&&d&&d({action:o,location:E.location,delta:1})},replace:function(e,a){o=c.Replace;let l=_(E.location,e,a);t&&t(l,e),g=h();let n=m(l,g),s=E.createHref(l);i.replaceState(n,"",s),r&&d&&d({action:o,location:E.location,delta:0})},go:e=>i.go(e)};return E}(function(e,a){let{pathname:t="/",search:l="",hash:n=""}=g(e.location.hash.substr(1));return t.startsWith("/")||t.startsWith(".")||(t="/"+t),_("",{pathname:t,search:l,hash:n},a.state&&a.state.usr||null,a.state&&a.state.key||"default")},function(e,a){let t=e.document.querySelector("base"),l="";if(t&&t.getAttribute("href")){let a=e.location.href,t=a.indexOf("#");l=-1===t?a:a.slice(0,t)}return l+"#"+("string"==typeof a?a:v(a))},function(e,a){d("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")},o)));let h=i.current,[b,f]=r.useState({action:h.action,location:h.location}),{v7_startTransition:E}=l||{},y=r.useCallback(e=>{E&&Se?Se(()=>f(e)):f(e)},[f,E]);return r.useLayoutEffect(()=>h.listen(y),[h,y]),r.useEffect(()=>{return null==(e=l)||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!a||a.v7_relativeSplatPath),void(a&&(a.v7_fetcherPersist,a.v7_normalizeFormMethod,a.v7_partialHydration,a.v7_skipActionErrorRevalidation));var e,a},[l]),r.createElement(_e,{basename:a,children:t,location:b.location,navigationType:b.action,navigator:h,future:l})}o.flushSync,r.useId;const we="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,ke=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xe=r.forwardRef(function(e,a){let t,{onClick:l,relative:n,reloadDocument:i,replace:o,state:s,target:c,to:u,preventScrollReset:d,viewTransition:m}=e,_=be(e,Ee),{basename:g}=r.useContext(W),h=!1;if("string"==typeof u&&ke.test(u)&&(t=u,we))try{let e=new URL(window.location.href),a=u.startsWith("//")?new URL(e.protocol+u):new URL(u),t=I(a.pathname,g);a.origin===e.origin&&null!=t?u=t+a.search+a.hash:h=!0}catch(e){}let b=function(e,a){let{relative:t}=void 0===a?{}:a;Y()||p(!1);let{basename:l,navigator:n}=r.useContext(W),{hash:i,pathname:o,search:s}=te(e,{relative:t}),c=o;return"/"!==l&&(c="/"===o?l:G([l,o])),n.createHref({pathname:c,search:s,hash:i})}(u,{relative:n}),f=function(e,a){let{target:t,replace:l,state:n,preventScrollReset:i,relative:o,viewTransition:s}=void 0===a?{}:a,c=ee(),u=Q(),p=te(e,{relative:o});return r.useCallback(a=>{if(function(e,a){return!(0!==e.button||a&&"_self"!==a||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(a,t)){a.preventDefault();let t=void 0!==l?l:v(u)===v(p);c(e,{replace:t,state:n,preventScrollReset:i,relative:o,viewTransition:s})}},[u,c,p,l,n,t,e,i,o,s])}(u,{replace:o,state:s,target:c,preventScrollReset:d,relative:n,viewTransition:m});return r.createElement("a",he({},_,{href:t||b,onClick:h||i?l:function(e){l&&l(e),e.defaultPrevented||f(e)},ref:a,target:c}))}),Pe=r.forwardRef(function(e,a){let{"aria-current":t="page",caseSensitive:l=!1,className:n="",end:i=!1,style:o,to:s,viewTransition:c,children:u}=e,d=be(e,ye),m=te(s,{relative:d.relative}),_=Q(),v=r.useContext(H),{navigator:g,basename:h}=r.useContext(W),b=null!=v&&function(e,a){void 0===a&&(a={});let t=r.useContext(Ne);null==t&&p(!1);let{basename:l}=function(){let e=r.useContext(z);return e||p(!1),e}(Me.useViewTransitionState),n=te(e,{relative:a.relative});if(!t.isTransitioning)return!1;let i=I(t.currentLocation.pathname,l)||t.currentLocation.pathname,o=I(t.nextLocation.pathname,l)||t.nextLocation.pathname;return null!=T(n.pathname,o)||null!=T(n.pathname,i)}(m)&&!0===c,f=g.encodeLocation?g.encodeLocation(m).pathname:m.pathname,E=_.pathname,y=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;l||(E=E.toLowerCase(),y=y?y.toLowerCase():null,f=f.toLowerCase()),y&&h&&(y=I(y,h)||y);const N="/"!==f&&f.endsWith("/")?f.length-1:f.length;let S,C=E===f||!i&&E.startsWith(f)&&"/"===E.charAt(N),w=null!=y&&(y===f||!i&&y.startsWith(f)&&"/"===y.charAt(f.length)),k={isActive:C,isPending:w,isTransitioning:b},x=C?t:void 0;S="function"==typeof n?n(k):[n,C?"active":null,w?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let P="function"==typeof o?o(k):o;return r.createElement(xe,he({},d,{"aria-current":x,className:S,ref:a,style:P,to:s,viewTransition:c}),"function"==typeof u?u(k):u)});var Me,Te;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Me||(Me={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Te||(Te={}));var Ae=n(863);function Ie(e){return(0,r.createElement)("svg",{viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",...e},(0,r.createElement)("path",{d:"M12 20h9",stroke:"currentColor",strokeLinecap:"round"}),(0,r.createElement)("path",{d:"M16.5 3.5a2.1 2.1 0 0 1 3 3L8 18l-4 1 1-4L16.5 3.5Z",stroke:"currentColor",strokeLinejoin:"round"}))}function Re(e){return(0,r.createElement)("svg",{viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",...e},(0,r.createElement)("path",{d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z",stroke:"currentColor"}),(0,r.createElement)("path",{d:"M3 12h18",stroke:"currentColor",strokeLinecap:"round"}),(0,r.createElement)("path",{d:"M12 3c2.8 3 4.2 6 4.2 9s-1.4 6-4.2 9c-2.8-3-4.2-6-4.2-9S9.2 6 12 3Z",stroke:"currentColor",strokeLinejoin:"round"}))}function $e(e){return(0,r.createElement)("svg",{viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",...e},(0,r.createElement)("path",{d:"M10 13a5 5 0 0 0 7.1 0l1.4-1.4a5 5 0 0 0-7.1-7.1L10.6 4",stroke:"currentColor",strokeLinecap:"round"}),(0,r.createElement)("path",{d:"M14 11a5 5 0 0 0-7.1 0L5.5 12.4a5 5 0 0 0 7.1 7.1L13.4 20",stroke:"currentColor",strokeLinecap:"round"}))}function Be(e){return(0,r.createElement)("svg",{viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",...e},(0,r.createElement)("path",{d:"M9 4h6l1 2H8l1-2z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.createElement)("path",{d:"M6 7h12l-1 12a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 7z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.createElement)("path",{d:"M10 11v6",stroke:"currentColor",strokeLinecap:"round"}),(0,r.createElement)("path",{d:"M14 11v6",stroke:"currentColor",strokeLinecap:"round"}))}function Le({proposal:e,onDelete:a}){const t=e?.public_url||"",l=(0,r.useMemo)(()=>`/propuesta/${e?.id}/editar`,[e?.id]),n="undefined"!=typeof navigator&&!!navigator.clipboard,i=!t||!n,o=t?n?"Copiar enlace":"Tu navegador no permite copiar al portapapeles":"No hay enlace pública disponible";return(0,r.createElement)("div",{className:"cg-row-actions-inline"},(0,r.createElement)(xe,{to:l,className:"cg-row-actions-inline__icon",title:"Editar propuesta","aria-label":"Editar propuesta"},(0,r.createElement)(Ie,{className:"cg-row-actions-inline__svg"})),t?(0,r.createElement)("a",{href:t,target:"_blank",rel:"noreferrer",className:"cg-row-actions-inline__icon",title:"Vista pública","aria-label":"Vista pública"},(0,r.createElement)(Re,{className:"cg-row-actions-inline__svg"})):(0,r.createElement)("button",{type:"button",className:"cg-row-actions-inline__icon cg-row-actions-inline__icon--disabled",disabled:!0,title:"No hay vista pública disponible","aria-label":"Vista pública no disponible"},(0,r.createElement)(Re,{className:"cg-row-actions-inline__svg"})),(0,r.createElement)("button",{type:"button",className:"cg-row-actions-inline__icon",onClick:async()=>{if(t&&n)try{await navigator.clipboard.writeText(t)}catch(e){}},disabled:i,title:o,"aria-label":o},(0,r.createElement)($e,{className:"cg-row-actions-inline__svg"})),"function"==typeof a?(0,r.createElement)("button",{type:"button",className:"cg-row-actions-inline__icon cg-row-actions-inline__icon--destructive",title:"Eliminar propuesta","aria-label":"Eliminar propuesta",onClick:()=>{"function"==typeof a&&a(e)}},(0,r.createElement)(Be,{className:"cg-row-actions-inline__svg"})):null)}function De(e="",a="",t=""){const l=[(e||"").trim(),(a||"").trim()].filter(Boolean).join(" ").trim();return l||(t||"").trim()}function Ge(e=""){const a=(e||"").trim();if(!a)return{firstName:"",lastName:""};const t=a.split(/\s+/);return{firstName:t.shift()||"",lastName:t.join(" ")}}const Fe={draft:"Borrador",sent:"Enviada",accepted:"Aceptada",queued:"En cola",synced:"Sincronizada",error:"Error",revoked:"Revocada",lost:"Perdida"},qe=[{value:"all",label:"Todos los estados"},...Object.entries(Fe).map(([e,a])=>({value:e,label:a}))],Ue=[{key:"id",label:"ID"},{key:"proposal_title",label:"Título"},{key:"customer_name",label:"Cliente"},{key:"author_name",label:"Autor"},{key:"status",label:"Estado"},{key:"updated_at",label:"Última actualización"},{key:"totals_sell_price",label:"Total"}],Ve=({column:e,sortBy:a,order:t})=>{const l=a===e?t:"none";return(0,r.createElement)("span",{className:`casanova-portal-table__sort-icon is-${l}`,"aria-hidden":"true"})},je=()=>{const[e,a]=function(e){let a=r.useRef(fe(e)),t=r.useRef(!1),l=Q(),n=r.useMemo(()=>function(e,a){let t=fe(e);return a&&a.forEach((e,l)=>{t.has(l)||a.getAll(l).forEach(e=>{t.append(l,e)})}),t}(l.search,t.current?null:a.current),[l.search]),i=ee(),o=r.useCallback((e,a)=>{const l=fe("function"==typeof e?e(n):e);t.current=!0,i("?"+l,a)},[i,n]);return[n,o]}(),t=Ue.map(e=>e.key),l=e.get("q")||"",n=e.get("status")||"all",o=e.get("sort")||"updated_at",s=(e.get("order")||"desc").toLowerCase(),c=e=>t.includes(e)?e:"updated_at",[u,p]=(0,i.useState)(l),[d,m]=(0,i.useState)(l),[_,v]=(0,i.useState)(n),[g,h]=(0,i.useState)(c(o)),[b,f]=(0,i.useState)("asc"===s?"asc":"desc"),[E,y]=(0,i.useState)([]),[N,S]=(0,i.useState)(!1),[C,w]=(0,i.useState)(""),[k,x]=(0,i.useState)([]),P=(0,i.useCallback)(async()=>{S(!0),w("");try{const e=await Ae.Ay.listProposals({search:d,status:"all"!==_?_:void 0,sortBy:g,order:b});y(e.items),x(a=>a.filter(a=>e.items.some(e=>e.id===a)))}catch(e){w(e.message||"No se pudo cargar el listado.")}finally{S(!1)}},[d,_,g,b]);(0,i.useEffect)(()=>{const e=setTimeout(()=>{m(u.trim())},350);return()=>clearTimeout(e)},[u]),(0,i.useEffect)(()=>{const e={};d&&(e.q=d),_&&"all"!==_&&(e.status=_),g&&(e.sort=g),b&&(e.order=b),a(e,{replace:!0}),P()},[d,_,g,b,P,a]);const M=async e=>{if(e?.id&&window.confirm(`¿Seguro que quieres eliminar la propuesta #${e.id}?`)){S(!0),w("");try{await Ae.Ay.deleteProposal(e.id),x(a=>a.filter(a=>a!==e.id)),await P()}catch(e){w(e.message||"No se pudo eliminar la propuesta.")}finally{S(!1)}}};return(0,r.createElement)("div",{className:"casanova-portal-section"},(0,r.createElement)("header",{className:"casanova-portal-section__header"},(0,r.createElement)("div",null,(0,r.createElement)("h2",null,"Repositorio de propuestas"),(0,r.createElement)("p",null,"Revisa estados, clientes y detalles sin salir del portal.")),(0,r.createElement)("div",{className:"casanova-portal-section__actions"},(0,r.createElement)(xe,{className:"button-secondary",to:"/nueva"},"Nueva propuesta"),(0,r.createElement)("button",{className:"button-primary",onClick:P,disabled:N},"Refrescar"))),(0,r.createElement)("div",{className:"casanova-portal-filters"},(0,r.createElement)("label",{className:"casanova-portal-filter"},(0,r.createElement)("span",null,"Buscar"),(0,r.createElement)("input",{type:"search",value:u,onChange:e=>p(e.target.value),placeholder:"Cliente, email, token o ID"})),(0,r.createElement)("label",{className:"casanova-portal-filter"},(0,r.createElement)("span",null,"Estado"),(0,r.createElement)("select",{value:_,onChange:e=>v(e.target.value)},qe.map(e=>(0,r.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,r.createElement)("label",{className:"casanova-portal-filter"},(0,r.createElement)("span",null,"Ordenar por"),(0,r.createElement)("select",{value:g,onChange:e=>h(c(e.target.value))},Ue.map(e=>(0,r.createElement)("option",{key:e.key,value:e.key},e.label)))),(0,r.createElement)("label",{className:"casanova-portal-filter"},(0,r.createElement)("span",null,"Orden"),(0,r.createElement)("select",{value:b,onChange:e=>f("asc"===e.target.value?"asc":"desc")},(0,r.createElement)("option",{value:"desc"},"Descendente"),(0,r.createElement)("option",{value:"asc"},"Ascendente"))),(0,r.createElement)("div",{className:"casanova-portal-filters__actions"},(0,r.createElement)("button",{className:"button-secondary",onClick:()=>{p(""),v("all"),h("updated_at"),f("desc")}},"Limpiar filtros"),(0,r.createElement)("button",{className:"button-danger",onClick:async()=>{if(0!==k.length&&window.confirm(`¿Seguro que quieres eliminar ${k.length} propuestas?`)){S(!0),w("");try{await Ae.Ay.bulkDeleteProposals(k),x([]),await P()}catch(e){w(e.message||"No se pudieron eliminar las propuestas.")}finally{S(!1)}}},disabled:N||0===k.length},"Eliminar seleccionadas (",k.length,")"))),C?(0,r.createElement)("div",{className:"casanova-portal-section__notice"},(0,r.createElement)("span",null,C)):null,(0,r.createElement)("div",{className:"casanova-portal-table"},(0,r.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--header"},(0,r.createElement)("span",{className:"casanova-portal-table__select"},(0,r.createElement)("input",{type:"checkbox",checked:E.length>0&&k.length===E.length,onChange:()=>{k.length!==E.length?x(E.map(e=>e.id)):x([])},disabled:N||0===E.length,"aria-label":"Seleccionar todas las propuestas"})),Ue.map(e=>(0,r.createElement)("span",{key:e.key},(0,r.createElement)("button",{type:"button",className:"casanova-portal-table__sort-button",onClick:()=>(e=>{g!==e?(h(e),f("desc")):f(e=>"asc"===e?"desc":"asc")})(e.key)},e.label,(0,r.createElement)(Ve,{column:e.key,sortBy:g,order:b})))),(0,r.createElement)("span",null,"Acciones")),N?(0,r.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--loading"},"Cargando propuestas…"):null,N||0!==E.length?null:(0,r.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--empty"},"No hay propuestas que coincidan con los filtros seleccionados."),!N&&E.map(e=>{var a;return(0,r.createElement)("div",{key:e.id,className:"casanova-portal-table__row casanova-portal-table__row--item"},(0,r.createElement)("span",{className:"casanova-portal-table__select"},(0,r.createElement)("input",{type:"checkbox",checked:k.includes(e.id),onChange:()=>{return a=e.id,void x(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a]);var a},disabled:N,"aria-label":`Seleccionar propuesta #${e.id}`})),(0,r.createElement)("span",null,"#",e.id),(0,r.createElement)("span",null,e.display_title||e.proposal_title||"Propuesta sin título"),(0,r.createElement)("span",null,De(e.first_name,e.last_name,e.customer_name)||e.customer_email||"—"),(0,r.createElement)("span",null,e.author_name||"—"),(0,r.createElement)("span",null,(0,r.createElement)("span",{className:`status-chip status-chip--${(e.status||"draft").replace(/[^a-z0-9_-]/gi,"-")}`},Fe[e.status]||e.status||"—")),(0,r.createElement)("span",null,(e=>{if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString("es-ES",{dateStyle:"medium",timeStyle:"short"})})(e.updated_at)),(0,r.createElement)("span",null,((e,a)=>{if(null==e)return"—";const t=Number(e);return Number.isNaN(t)?String(e):new Intl.NumberFormat("es-ES",{style:"currency",currency:a||"EUR",maximumFractionDigits:2}).format(t)})(null!==(a=e.current_version_total)&&void 0!==a?a:e.totals_sell_price,e.currency)),(0,r.createElement)("span",{className:"casanova-portal-table__actions"},(0,r.createElement)(xe,{className:"button-secondary casanova-portal-table__action",to:`/propuesta/${e.id}`},"Ver detalle"),(0,r.createElement)(Le,{proposal:e,onDelete:M})))})))},Oe={admin:"Admin",client:"Cliente"},ze={none:"No iniciado",pending:"En proceso",ok:"Creado",error:"Error"},He=e=>{if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString("es-ES",{dateStyle:"medium",timeStyle:"short"})};function We(){var e;const{proposalId:a}=ae(),t=ee(),[l,n]=(0,i.useState)(null),[o,s]=(0,i.useState)(!1),[c,u]=(0,i.useState)(""),[p,d]=(0,i.useState)(""),[m,_]=(0,i.useState)(""),[v,g]=(0,i.useState)(!1),[h,b]=(0,i.useState)(""),[f,E]=(0,i.useState)(!1),[y,N]=(0,i.useState)(!1),[S,C]=(0,i.useState)(""),[w,k]=(0,i.useState)(!1),x=async()=>{s(!0),u("");try{const e=await Ae.Ay.getProposalDetail(a);n(e)}catch(e){u(e?.message||"No se pudo cargar la propuesta.")}finally{s(!1)}};(0,i.useEffect)(()=>{if(!a)return n(null),void u("Propuesta no encontrada.");x()},[a]),(0,i.useEffect)(()=>{const e=l?.proposal?.current_version_id;b(e?String(e):"")},[l?.proposal?.current_version_id]),(0,i.useEffect)(()=>{let e=!1;const a=l?.proposal?.accepted_version_id;if(a)return Ae.Ay.giavPreflight(a).then(()=>{e||C("")}).catch(a=>{e||(503===(a?.data?.status||a?.status)||(a?.message||a?.data?.message||"").includes("DB"))&&C("La base de datos no está actualizada. Ejecuta migraciones.")}),()=>{e=!0};C("")},[l?.proposal?.accepted_version_id]);const P=l?.proposal,M=l?.versions||[],T=P&&De(P.first_name,P.last_name,P.customer_name)||"Sin nombre";(0,i.useEffect)(()=>{P&&(P.public_url||l?.current_snapshot?.public_url)&&g(!1)},[P?.public_url]);const A=M.find(e=>Number(e.id)===Number(P?.accepted_version_id)),I=M.find(e=>String(e.id)===h),R=[{value:"",label:"Selecciona una versión"}].concat(M.map(e=>{var a;return{value:String(e.id),label:`#${null!==(a=e.version_number)&&void 0!==a?a:e.id} · ${He(e.created_at)}`}})),$="confirmed"===P?.confirmation_status?"Confirmada":"pending"===P?.confirmation_status?"Pendiente":"-",B="accepted"===P?.status,L=P?.giav_sync_status||"none",D=ze[L]||L||"-",G=Boolean(P?.giav_expediente_id),F="pending"===L,q="error"===L,U=[{label:"ID cliente",value:P?.giav_client_id},{label:"ID expediente",value:P?.giav_expediente_id},{label:"ID reserva PQ",value:P?.giav_pq_reserva_id}].filter(e=>e.value),V=async()=>{if(P){N(!0),d(""),_("");try{await Ae.Ay.retryGiavSync(P.id),_("error"===P.giav_sync_status?"Solicitud de reintento en GIAV enviada correctamente.":"Expediente solicitado en GIAV."),await x()}catch(e){d(e?.message||"No se pudo crear el expediente en GIAV.")}finally{N(!1)}}};return o&&!P?(0,r.createElement)("div",{className:"casanova-portal-section"},"Cargando detalle…"):c&&!P?(0,r.createElement)("div",{className:"casanova-portal-section"},(0,r.createElement)("div",{className:"casanova-portal-section__notice"},c)):P?(0,r.createElement)("div",{className:"casanova-portal-section"},(0,r.createElement)("header",{className:"casanova-portal-detail__header"},(0,r.createElement)("div",null,(0,r.createElement)("p",{className:"casanova-portal__eyebrow"},"Propuesta #",P.id),(0,r.createElement)("h2",null,P.proposal_title||"Nueva propuesta"),(0,r.createElement)("p",null,T," · ",P.customer_email)),(0,r.createElement)("div",{className:"casanova-portal-detail__actions"},"accepted"!==P.status?(0,r.createElement)("button",{type:"button",className:"button-secondary",onClick:async()=>{if(P?.id){if(window.confirm("¿Marcar como enviada y habilitar el enlace público? (No envía emails automáticamente)")){k(!0),d(""),_("");try{await(0,Ae.q2)(P.id),_("Propuesta marcada como enviada."),await x()}catch(e){d(e?.message||"No se pudo marcar como enviada.")}finally{k(!1)}}}else d("No se encontró la propuesta.")},disabled:w},w?"Compartiendo...":"Compartir propuesta"):null,(0,r.createElement)("button",{type:"button",className:"button-secondary",onClick:()=>{const e=P.public_url||l?.current_snapshot?.public_url;e&&window.open(e,"_blank","noopener,noreferrer")},disabled:!P.public_url&&!l?.current_snapshot?.public_url},"Abrir vista pública"),(0,r.createElement)("button",{type:"button",className:"button-secondary",onClick:async()=>{const e=P?.public_url||l?.current_snapshot?.public_url;if(e)try{await navigator.clipboard.writeText(e),g(!0),window.setTimeout(()=>g(!1),1500)}catch(e){console.error(e)}},disabled:!P.public_url&&!l?.current_snapshot?.public_url},v?"Copiado":"Copiar enlace"),(0,r.createElement)("button",{type:"button",className:"button-primary",onClick:()=>t("/proposals")},"Volver al listado"))),p&&(0,r.createElement)("div",{className:"casanova-portal-section__notice casanova-portal-section__notice--error"},p),m&&(0,r.createElement)("div",{className:"casanova-portal-section__notice casanova-portal-section__notice--success"},m),(0,r.createElement)("div",{className:"casanova-portal-detail__grid"},(0,r.createElement)("div",{className:"casanova-portal-card"},(0,r.createElement)("h3",null,"Resumen"),(0,r.createElement)("p",null,"Fechas: ",P.start_date||"—"," — ",P.end_date||"—"),(0,r.createElement)("p",null,"Estado: ",P.status||"—"),(0,r.createElement)("p",null,"PAX: ",P.pax_total||0),(0,r.createElement)("p",null,"Jugadores: ",P.players_count||0),(0,r.createElement)("p",null,"Total estimado:"," ",l?.current_version?.totals_sell_price?`${l.current_version.totals_sell_price} ${P.currency||""}`:"—")),(0,r.createElement)("div",{className:"casanova-portal-card"},(0,r.createElement)("h3",null,"Aceptación"),(0,r.createElement)("p",{className:"proposal-detail__helper"},"Estado: ",P.confirmation_status?P.confirmation_status:"Pendiente"),B?(0,r.createElement)("div",{className:"proposal-detail__grid"},(0,r.createElement)("div",null,(0,r.createElement)("div",{className:"proposal-detail__label"},"Versión aceptada"),(0,r.createElement)("div",{className:"proposal-detail__value"},A?`#${null!==(e=A.version_number)&&void 0!==e?e:A.id}`:P.accepted_version_id||"—")),(0,r.createElement)("div",null,(0,r.createElement)("div",{className:"proposal-detail__label"},"Aceptada por"),(0,r.createElement)("div",{className:"proposal-detail__value"},Oe[P.accepted_by]||P.accepted_by||"—")),(0,r.createElement)("div",null,(0,r.createElement)("div",{className:"proposal-detail__label"},"Fecha de aceptación"),(0,r.createElement)("div",{className:"proposal-detail__value"},He(P.accepted_at))),(0,r.createElement)("div",null,(0,r.createElement)("div",{className:"proposal-detail__label"},"Confirmación"),(0,r.createElement)("div",{className:"proposal-detail__value"},$))):(0,r.createElement)("div",{className:"proposal-detail__block"},(0,r.createElement)("label",{htmlFor:"proposal-accept-version",className:"proposal-detail__label"},"Versión a aceptar"),(0,r.createElement)("select",{id:"proposal-accept-version",className:"proposal-detail__select",value:h,onChange:e=>b(e.target.value),disabled:f||0===R.length},R.map(e=>(0,r.createElement)("option",{key:e.value,value:e.value},e.label))),(0,r.createElement)("div",{className:"proposal-detail__button-row"},(0,r.createElement)("button",{type:"button",className:"button-primary",onClick:async()=>{if(!P?.id)return void d("No se encontró la propuesta.");if(!I?.id)return void d("Selecciona una versión para aceptar.");const e=I.version_number?`#${I.version_number}`:`#${I.id}`;if(window.confirm(`¿Confirmas que la versión ${e} se marcará como aceptada? Esta acción no se puede deshacer fácilmente.`)){E(!0),d(""),_("");try{await(0,Ae.t9)(P.id,I.id),_(`Versión ${e} marcada como aceptada.`),await x()}catch(e){d(e?.message||"No se pudo marcar como aceptada.")}finally{E(!1)}}},disabled:f||!I},f?"Procesando…":"Marcar como aceptada")))),(0,r.createElement)("div",{className:"casanova-portal-card"},(0,r.createElement)("h3",null,"Integración GIAV"),(0,r.createElement)("div",{className:"proposal-detail__section-title"},(0,r.createElement)("span",{className:"proposal-detail__pill proposal-detail__pill--"+("ok"===L?"success":"error"===L?"danger":"pending"===L?"warning":"neutral")},D)),(0,r.createElement)("div",{className:"proposal-detail__block"},U.length>0?(0,r.createElement)("div",{className:"proposal-detail__grid"},U.map(e=>(0,r.createElement)("div",{key:e.label},(0,r.createElement)("div",{className:"proposal-detail__label"},e.label),(0,r.createElement)("div",{className:"proposal-detail__value"},e.value))),P.giav_sync_updated_at&&(0,r.createElement)("div",null,(0,r.createElement)("div",{className:"proposal-detail__label"},"Última actualización"),(0,r.createElement)("div",{className:"proposal-detail__value"},He(P.giav_sync_updated_at)))):(0,r.createElement)("p",{className:"proposal-detail__helper"},"Aún no hay identificadores de GIAV vinculados."),P.giav_sync_error&&(0,r.createElement)("div",{className:"proposal-detail__error"},(0,r.createElement)("strong",null,"Error:")," ",P.giav_sync_error),(0,r.createElement)("div",{className:"proposal-detail__cta"},B?q&&!G?(0,r.createElement)("button",{type:"button",className:"button-primary",disabled:y||Boolean(S),onClick:V,title:S||"Se reintentará la creación del expediente en GIAV y se actualizará el estado."},y?"Creando…":"Reintentar GIAV"):G||F?F?(0,r.createElement)("span",{className:"proposal-detail__helper"},"En proceso de creación en GIAV."):(0,r.createElement)("span",{className:"proposal-detail__helper"},"Expediente creado y sincronizado."):(0,r.createElement)("button",{type:"button",className:"button-primary",disabled:y||Boolean(S),onClick:V,title:S||"Crear expediente en GIAV. Esta acción puede tardar varios segundos."},y?"Creando…":"Crear expediente en GIAV"):(0,r.createElement)("span",{className:"proposal-detail__helper"},"Necesitas aceptar una versión antes de crear expediente en GIAV."),S&&(0,r.createElement)("p",{className:"proposal-detail__helper"},S))))),(0,r.createElement)("div",{className:"casanova-portal-detail__actions-row"},(0,r.createElement)("button",{type:"button",className:"button-primary",onClick:()=>t(`/proposals/${a}/edit`)},"Editar propuesta"),(0,r.createElement)("button",{type:"button",className:"button-secondary",onClick:()=>{window.open(((e={})=>{const a=new URL(window.location.href);return a.searchParams.set("page","travel_proposals"),a.searchParams.delete("proposal_id"),a.searchParams.delete("action"),Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t?a.searchParams.set(e,t):a.searchParams.delete(e)}),a.toString()})({proposal_id:a,action:"edit"}),"_blank")}},"Abrir wizard en wp-admin")),(0,r.createElement)("div",{className:"casanova-portal-card"},(0,r.createElement)("h3",null,"Versiones"),(0,r.createElement)("div",{className:"casanova-portal-table"},(0,r.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--header"},(0,r.createElement)("span",null,"Versión"),(0,r.createElement)("span",null,"Fecha"),(0,r.createElement)("span",null,"Total"),(0,r.createElement)("span",null,"Publicación")),M.length?M.map(e=>{var a,t;return(0,r.createElement)("div",{key:e.id,className:"casanova-portal-table__row"},(0,r.createElement)("span",null,null!==(a=e.version_number)&&void 0!==a?a:e.id),(0,r.createElement)("span",null,He(e.created_at)),(0,r.createElement)("span",null,null!==(t=e.totals_sell_price)&&void 0!==t?t:"—"),(0,r.createElement)("span",null,e.public_url?(0,r.createElement)("a",{href:e.public_url,target:"_blank",rel:"noreferrer"},"Vista pública"):"—"))}):(0,r.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--empty"},"No hay versiones registradas.")))):null}const Ke=window.wp.components;var Je=n(455),Ze=n.n(Je);const Ye=window.WP_TRAVEL_GIAV||window.CASANOVA_GESTION_RESERVAS||{};if(!Ze().__WP_TRAVEL_GIAV_CONFIGURED){const e=Ye.nonce||"",a=(e=>{if(e.wpRestRoot)return e.wpRestRoot;const a=e.apiUrl||e.restUrl;return a?a.replace(/\/travel\/v1\/?$/,"/"):"/wp-json/"})(Ye);a&&Ze().use(Ze().createRootURLMiddleware(a)),e&&Ze().use(Ze().createNonceMiddleware(e)),Ze().__WP_TRAVEL_GIAV_CONFIGURED=!0}const Qe={createProposal:e=>Ze()({path:"/travel/v1/proposals",method:"POST",data:e}),listProposals:({orderBy:e="updated_at",order:a="desc",limit:t=50,offset:l=0,search:n,author:r,page:i,per_page:o}={})=>{const s=new URLSearchParams;return s.set("order_by",e),s.set("order",a),s.set("limit",t),s.set("offset",l),void 0!==n&&s.set("search",n),void 0!==r&&s.set("author",r),void 0!==i&&s.set("page",i),void 0!==o&&s.set("per_page",o),Ze()({path:`/travel/v1/proposals?${s.toString()}`,method:"GET"})},getProposal:e=>Ze()({path:`/travel/v1/proposals/${e}`,method:"GET"}),getProposalDetail:e=>Ze()({path:`/travel/v1/proposals/${e}/detail`,method:"GET"}),updateProposal:(e,a)=>Ze()({path:`/travel/v1/proposals/${e}`,method:"PUT",data:a}),deleteProposal:e=>Ze()({path:`/travel/v1/proposals/${e}`,method:"DELETE"}),bulkDeleteProposals:e=>Ze()({path:"/travel/v1/proposals/bulk-delete",method:"POST",data:{ids:e}}),sendProposal:(e,a,t)=>Ze()({path:`/travel/v1/proposals/${e}/send`,method:"POST",data:{snapshot:a,version_number:t}}),createProposalVersion:(e,a,t)=>Ze()({path:`/travel/v1/proposals/${e}/versions`,method:"POST",data:{snapshot:a,version_number:t}}),setCurrentVersion:(e,a)=>Ze()({path:`/travel/v1/proposals/${e}/current-version`,method:"POST",data:{version_id:a}}),acceptProposal:(e,a)=>Ze()({path:`/travel/v1/proposals/${e}/accept`,method:"POST",data:{version_id:a}}),retryGiavSync:e=>Ze()({path:`/travel/v1/proposals/${e}/giav-retry`,method:"POST"}),searchCatalog:({type:e,q:a})=>Ze()({path:`/travel/v1/catalog/search?type=${encodeURIComponent(e)}&q=${encodeURIComponent(a||"")}`,method:"GET"}),getGiavMapping:({wp_object_type:e,wp_object_id:a})=>Ze()({path:`/travel/v1/giav-mapping?wp_object_type=${encodeURIComponent(e)}&wp_object_id=${encodeURIComponent(a)}`,method:"GET"}),listGiavMappings:({type:e,q:a,limit:t=50,offset:l=0})=>Ze()({path:`/travel/v1/giav-mapping/list?type=${encodeURIComponent(e)}&q=${encodeURIComponent(a||"")}&limit=${encodeURIComponent(t)}&offset=${encodeURIComponent(l)}`,method:"GET"}),upsertGiavMapping:e=>Ze()({path:"/travel/v1/giav-mapping/upsert",method:"POST",data:e}),batchUpsertGiavMappings:({wp_object_type:e,giav_supplier_id:a,items:t,status:l="active",match_type:n="batch"})=>Ze()({path:"/travel/v1/giav-mapping/batch-upsert",method:"POST",data:{wp_object_type:e,giav_supplier_id:a,items:t,status:l,match_type:n}}),listRequests:({status:e,lang:a,form:t,q:l,page:n=1,per_page:r=20}={})=>{const i=new URLSearchParams;return e&&i.set("status",e),a&&i.set("lang",a),t&&i.set("form",t),l&&i.set("q",l),i.set("page",n),i.set("per_page",r),Ze()({path:`/travel/v1/requests?${i.toString()}`,method:"GET"})},convertRequest:e=>Ze()({path:`/travel/v1/requests/${e}/convert`,method:"POST"}),searchGiavProviders:async({q:e,pageSize:a=20,pageIndex:t=0,includeDisabled:l=!1})=>{const n=await Ze()({path:`/travel/v1/giav/providers/search?q=${encodeURIComponent(e)}&pageSize=${encodeURIComponent(a)}&pageIndex=${encodeURIComponent(t)}&includeDisabled=${encodeURIComponent(l)}`,method:"GET"});return{items:(Array.isArray(n)?n:Array.isArray(n?.items)?n.items:[]).map(e=>{var a,t,l,n,r,i,o,s;return{id:String(null!==(a=null!==(t=null!==(l=null!==(n=e.id)&&void 0!==n?n:e.ID)&&void 0!==l?l:e.Id)&&void 0!==t?t:e.proveedorId)&&void 0!==a?a:""),label:String(null!==(r=null!==(i=null!==(o=null!==(s=e.label)&&void 0!==s?s:e.NombreAlias)&&void 0!==o?o:e.Nombre)&&void 0!==i?i:e.title)&&void 0!==r?r:""),raw:e}}).filter(e=>e.id&&e.label)}},giavPreflight:e=>Ze()({path:`/travel/v1/versions/${e}/giav-preflight`,method:"GET"}),confirmGiav:e=>Ze()({path:`/travel/v1/versions/${e}/confirm`,method:"POST"}),getRequestMappingConfig:()=>Ze()({path:"/travel/v1/requests/mapping",method:"GET"}),saveRequestFormsMapping:e=>Ze()({path:"/travel/v1/requests/mapping",method:"POST",data:e}),getRequestFormMapping:e=>Ze()({path:`/travel/v1/requests/mapping/${e}`,method:"GET"}),saveRequestFormMapping:(e,a)=>Ze()({path:`/travel/v1/requests/mapping/${e}`,method:"POST",data:a})},Xe=[{label:"Español",value:"es_ES"},{label:"English (US)",value:"en_US"}],ea=[{label:"EUR",value:"EUR"},{label:"USD",value:"USD"},{label:"GBP",value:"GBP"}],aa=[{value:"AF",label:"Afghanistan (AF)"},{value:"AL",label:"Albania (AL)"},{value:"DZ",label:"Algeria (DZ)"},{value:"AS",label:"American Samoa (AS)"},{value:"AD",label:"Andorra (AD)"},{value:"AO",label:"Angola (AO)"},{value:"AI",label:"Anguilla (AI)"},{value:"AQ",label:"Antarctica (AQ)"},{value:"AG",label:"Antigua and Barbuda (AG)"},{value:"AR",label:"Argentina (AR)"},{value:"AM",label:"Armenia (AM)"},{value:"AW",label:"Aruba (AW)"},{value:"AU",label:"Australia (AU)"},{value:"AT",label:"Austria (AT)"},{value:"AZ",label:"Azerbaijan (AZ)"},{value:"BS",label:"Bahamas (BS)"},{value:"BH",label:"Bahrain (BH)"},{value:"BD",label:"Bangladesh (BD)"},{value:"BB",label:"Barbados (BB)"},{value:"BY",label:"Belarus (BY)"},{value:"BE",label:"Belgium (BE)"},{value:"BZ",label:"Belize (BZ)"},{value:"BJ",label:"Benin (BJ)"},{value:"BM",label:"Bermuda (BM)"},{value:"BT",label:"Bhutan (BT)"},{value:"BO",label:"Bolivia (BO)"},{value:"BQ",label:"Bonaire, Sint Eustatius and Saba (BQ)"},{value:"BA",label:"Bosnia and Herzegovina (BA)"},{value:"BW",label:"Botswana (BW)"},{value:"BV",label:"Bouvet Island (BV)"},{value:"BR",label:"Brazil (BR)"},{value:"IO",label:"British Indian Ocean Territory (IO)"},{value:"BN",label:"Brunei (BN)"},{value:"BG",label:"Bulgaria (BG)"},{value:"BF",label:"Burkina Faso (BF)"},{value:"BI",label:"Burundi (BI)"},{value:"KH",label:"Cambodia (KH)"},{value:"CM",label:"Cameroon (CM)"},{value:"CA",label:"Canada (CA)"},{value:"CV",label:"Cape Verde (CV)"},{value:"KY",label:"Cayman Islands (KY)"},{value:"CF",label:"Central African Republic (CF)"},{value:"TD",label:"Chad (TD)"},{value:"CL",label:"Chile (CL)"},{value:"CN",label:"China (CN)"},{value:"CX",label:"Christmas Island (CX)"},{value:"CC",label:"Cocos (Keeling) Islands (CC)"},{value:"CO",label:"Colombia (CO)"},{value:"KM",label:"Comoros (KM)"},{value:"CG",label:"Congo (CG)"},{value:"CD",label:"Congo (Democratic Republic) (CD)"},{value:"CK",label:"Cook Islands (CK)"},{value:"CR",label:"Costa Rica (CR)"},{value:"CI",label:"Côte d’Ivoire (CI)"},{value:"HR",label:"Croatia (HR)"},{value:"CU",label:"Cuba (CU)"},{value:"CW",label:"Curaçao (CW)"},{value:"CY",label:"Cyprus (CY)"},{value:"CZ",label:"Czechia (CZ)"},{value:"DK",label:"Denmark (DK)"},{value:"DJ",label:"Djibouti (DJ)"},{value:"DM",label:"Dominica (DM)"},{value:"DO",label:"Dominican Republic (DO)"},{value:"EC",label:"Ecuador (EC)"},{value:"EG",label:"Egypt (EG)"},{value:"SV",label:"El Salvador (SV)"},{value:"GQ",label:"Equatorial Guinea (GQ)"},{value:"ER",label:"Eritrea (ER)"},{value:"EE",label:"Estonia (EE)"},{value:"ET",label:"Ethiopia (ET)"},{value:"FK",label:"Falkland Islands (FK)"},{value:"FO",label:"Faroe Islands (FO)"},{value:"FJ",label:"Fiji (FJ)"},{value:"FI",label:"Finland (FI)"},{value:"FR",label:"France (FR)"},{value:"GF",label:"French Guiana (GF)"},{value:"PF",label:"French Polynesia (PF)"},{value:"TF",label:"French Southern Territories (TF)"},{value:"GA",label:"Gabon (GA)"},{value:"GM",label:"Gambia (GM)"},{value:"GE",label:"Georgia (GE)"},{value:"DE",label:"Germany (DE)"},{value:"GH",label:"Ghana (GH)"},{value:"GI",label:"Gibraltar (GI)"},{value:"GR",label:"Greece (GR)"},{value:"GL",label:"Greenland (GL)"},{value:"GD",label:"Grenada (GD)"},{value:"GP",label:"Guadeloupe (GP)"},{value:"GU",label:"Guam (GU)"},{value:"GT",label:"Guatemala (GT)"},{value:"GG",label:"Guernsey (GG)"},{value:"GN",label:"Guinea (GN)"},{value:"GW",label:"Guinea-Bissau (GW)"},{value:"GY",label:"Guyana (GY)"},{value:"HT",label:"Haiti (HT)"},{value:"HM",label:"Heard Island and McDonald Islands (HM)"},{value:"HN",label:"Honduras (HN)"},{value:"HK",label:"Hong Kong (HK)"},{value:"HU",label:"Hungary (HU)"},{value:"IS",label:"Iceland (IS)"},{value:"IN",label:"India (IN)"},{value:"ID",label:"Indonesia (ID)"},{value:"IR",label:"Iran (IR)"},{value:"IQ",label:"Iraq (IQ)"},{value:"IE",label:"Ireland (IE)"},{value:"IM",label:"Isle of Man (IM)"},{value:"IL",label:"Israel (IL)"},{value:"IT",label:"Italy (IT)"},{value:"JM",label:"Jamaica (JM)"},{value:"JP",label:"Japan (JP)"},{value:"JE",label:"Jersey (JE)"},{value:"JO",label:"Jordan (JO)"},{value:"KZ",label:"Kazakhstan (KZ)"},{value:"KE",label:"Kenya (KE)"},{value:"KI",label:"Kiribati (KI)"},{value:"KP",label:"Korea (North) (KP)"},{value:"KR",label:"Korea (South) (KR)"},{value:"KW",label:"Kuwait (KW)"},{value:"KG",label:"Kyrgyzstan (KG)"},{value:"LA",label:"Laos (LA)"},{value:"LV",label:"Latvia (LV)"},{value:"LB",label:"Lebanon (LB)"},{value:"LS",label:"Lesotho (LS)"},{value:"LR",label:"Liberia (LR)"},{value:"LY",label:"Libya (LY)"},{value:"LI",label:"Liechtenstein (LI)"},{value:"LT",label:"Lithuania (LT)"},{value:"LU",label:"Luxembourg (LU)"},{value:"MO",label:"Macao (MO)"},{value:"MG",label:"Madagascar (MG)"},{value:"MW",label:"Malawi (MW)"},{value:"MY",label:"Malaysia (MY)"},{value:"MV",label:"Maldives (MV)"},{value:"ML",label:"Mali (ML)"},{value:"MT",label:"Malta (MT)"},{value:"MH",label:"Marshall Islands (MH)"},{value:"MQ",label:"Martinique (MQ)"},{value:"MR",label:"Mauritania (MR)"},{value:"MU",label:"Mauritius (MU)"},{value:"YT",label:"Mayotte (YT)"},{value:"MX",label:"Mexico (MX)"},{value:"FM",label:"Micronesia (FM)"},{value:"MD",label:"Moldova (MD)"},{value:"MC",label:"Monaco (MC)"},{value:"MN",label:"Mongolia (MN)"},{value:"ME",label:"Montenegro (ME)"},{value:"MS",label:"Montserrat (MS)"},{value:"MA",label:"Morocco (MA)"},{value:"MZ",label:"Mozambique (MZ)"},{value:"MM",label:"Myanmar (MM)"},{value:"NA",label:"Namibia (NA)"},{value:"NR",label:"Nauru (NR)"},{value:"NP",label:"Nepal (NP)"},{value:"NL",label:"Netherlands (NL)"},{value:"NC",label:"New Caledonia (NC)"},{value:"NZ",label:"New Zealand (NZ)"},{value:"NI",label:"Nicaragua (NI)"},{value:"NE",label:"Niger (NE)"},{value:"NG",label:"Nigeria (NG)"},{value:"NU",label:"Niue (NU)"},{value:"NF",label:"Norfolk Island (NF)"},{value:"MK",label:"North Macedonia (MK)"},{value:"MP",label:"Northern Mariana Islands (MP)"},{value:"NO",label:"Norway (NO)"},{value:"OM",label:"Oman (OM)"},{value:"PK",label:"Pakistan (PK)"},{value:"PW",label:"Palau (PW)"},{value:"PS",label:"Palestine (PS)"},{value:"PA",label:"Panama (PA)"},{value:"PG",label:"Papua New Guinea (PG)"},{value:"PY",label:"Paraguay (PY)"},{value:"PE",label:"Peru (PE)"},{value:"PH",label:"Philippines (PH)"},{value:"PN",label:"Pitcairn (PN)"},{value:"PL",label:"Poland (PL)"},{value:"PT",label:"Portugal (PT)"},{value:"PR",label:"Puerto Rico (PR)"},{value:"QA",label:"Qatar (QA)"},{value:"RE",label:"Réunion (RE)"},{value:"RO",label:"Romania (RO)"},{value:"RU",label:"Russia (RU)"},{value:"RW",label:"Rwanda (RW)"},{value:"BL",label:"Saint Barthélemy (BL)"},{value:"SH",label:"Saint Helena (SH)"},{value:"KN",label:"Saint Kitts and Nevis (KN)"},{value:"LC",label:"Saint Lucia (LC)"},{value:"MF",label:"Saint Martin (MF)"},{value:"PM",label:"Saint Pierre and Miquelon (PM)"},{value:"VC",label:"Saint Vincent and the Grenadines (VC)"},{value:"WS",label:"Samoa (WS)"},{value:"SM",label:"San Marino (SM)"},{value:"ST",label:"São Tomé and Príncipe (ST)"},{value:"SA",label:"Saudi Arabia (SA)"},{value:"SN",label:"Senegal (SN)"},{value:"RS",label:"Serbia (RS)"},{value:"SC",label:"Seychelles (SC)"},{value:"SL",label:"Sierra Leone (SL)"},{value:"SG",label:"Singapore (SG)"},{value:"SX",label:"Sint Maarten (SX)"},{value:"SK",label:"Slovakia (SK)"},{value:"SI",label:"Slovenia (SI)"},{value:"SB",label:"Solomon Islands (SB)"},{value:"SO",label:"Somalia (SO)"},{value:"ZA",label:"South Africa (ZA)"},{value:"GS",label:"South Georgia and the South Sandwich Islands (GS)"},{value:"SS",label:"South Sudan (SS)"},{value:"ES",label:"Spain (ES)"},{value:"LK",label:"Sri Lanka (LK)"},{value:"SD",label:"Sudan (SD)"},{value:"SR",label:"Suriname (SR)"},{value:"SJ",label:"Svalbard and Jan Mayen (SJ)"},{value:"SE",label:"Sweden (SE)"},{value:"CH",label:"Switzerland (CH)"},{value:"SY",label:"Syria (SY)"},{value:"TW",label:"Taiwan (TW)"},{value:"TJ",label:"Tajikistan (TJ)"},{value:"TZ",label:"Tanzania (TZ)"},{value:"TH",label:"Thailand (TH)"},{value:"TL",label:"Timor-Leste (TL)"},{value:"TG",label:"Togo (TG)"},{value:"TK",label:"Tokelau (TK)"},{value:"TO",label:"Tonga (TO)"},{value:"TT",label:"Trinidad and Tobago (TT)"},{value:"TN",label:"Tunisia (TN)"},{value:"TR",label:"Turkey (TR)"},{value:"TM",label:"Turkmenistan (TM)"},{value:"TC",label:"Turks and Caicos Islands (TC)"},{value:"TV",label:"Tuvalu (TV)"},{value:"UG",label:"Uganda (UG)"},{value:"UA",label:"Ukraine (UA)"},{value:"AE",label:"United Arab Emirates (AE)"},{value:"GB",label:"United Kingdom (GB)"},{value:"US",label:"United States (US)"},{value:"UM",label:"United States Minor Outlying Islands (UM)"},{value:"UY",label:"Uruguay (UY)"},{value:"UZ",label:"Uzbekistan (UZ)"},{value:"VU",label:"Vanuatu (VU)"},{value:"VA",label:"Vatican City (VA)"},{value:"VE",label:"Venezuela (VE)"},{value:"VN",label:"Vietnam (VN)"},{value:"VG",label:"Virgin Islands (British) (VG)"},{value:"VI",label:"Virgin Islands (US) (VI)"},{value:"WF",label:"Wallis and Futuna (WF)"},{value:"EH",label:"Western Sahara (EH)"},{value:"YE",label:"Yemen (YE)"},{value:"ZM",label:"Zambia (ZM)"},{value:"ZW",label:"Zimbabwe (ZW)"}];function ta(){return(new Date).toISOString().slice(0,10)}function la(e){if(!e)return"";if(e instanceof Date&&!Number.isNaN(e.getTime()))return e.toISOString().slice(0,10);if("string"==typeof e){if(e.includes("/")){const[a,t,l]=e.split("/");if(a&&t&&l)return`${l.padStart(4,"0")}-${t.padStart(2,"0")}-${a.padStart(2,"0")}`}return e.slice(0,10)}return""}function na(e){if(!e)return null;const a="string"==typeof e?e.slice(0,10):e,t=a instanceof Date?a:new Date(`${a}T00:00:00`);return Number.isNaN(t.getTime())?null:(t.setHours(0,0,0,0),t)}function ra(){const e=new Date;return e.setHours(0,0,0,0),e}function ia({id:e,label:a,value:t,onChange:l,className:n="",fieldRef:o,isInvalidDate:s}){const[c,u]=(0,i.useState)(!1),[p,d]=(0,i.useState)(null),m=function(e){if(!e)return"";const[a,t,l]=e.split("-");return a&&t&&l?`${l}/${t}/${a}`:e}(t);return(0,r.createElement)("div",{className:`proposal-basics__field ${n}`.trim(),ref:e=>{"function"==typeof o&&o(e)}},(0,r.createElement)(Ke.TextControl,{id:e,label:a,value:m,onClick:e=>{d(e.currentTarget),u(!0)},onFocus:e=>{d(e.currentTarget),u(!0)},readOnly:!0,placeholder:"DD/MM/AAAA"}),c&&p&&(0,r.createElement)(Ke.Popover,{anchor:p,placement:"bottom-start",className:"proposal-basics__date-popover",onClose:()=>{u(!1),d(null)}},(0,r.createElement)(Ke.DatePicker,{currentDate:t||ta(),onChange:e=>{const a=la(e);a&&l(a),u(!1)},isInvalidDate:s})))}function oa({initialValues:e={},onCreated:a,onNext:t,proposalId:l}){var n;const o=(0,i.useMemo)(()=>{var a,t,l,n;const r={proposal_title:"",customer_name:e.customer_name||"",customer_email:"",customer_country:"",customer_language:"es",start_date:ta(),end_date:ta(),pax_total:1,players_count:null!==(a=null!==(t=e.players_count)&&void 0!==t?t:e.pax_total)&&void 0!==a?a:1,currency:"EUR",first_name:null!==(l=e.first_name)&&void 0!==l?l:"",last_name:null!==(n=e.last_name)&&void 0!==n?n:"",...e},i=r.customer_name||e.customer_name||"",o=Ge(i),s=r.first_name||o.firstName,c=r.last_name||o.lastName;return r.first_name=s,r.last_name=c,r.customer_name=De(s,c,i),r},[e]),[s,c]=(0,i.useState)(o),[u,p]=(0,i.useState)(!1),[d,m]=(0,i.useState)(""),[_,v]=(0,i.useState)(""),[g,h]=(0,i.useState)(""),[b,f]=(0,i.useState)(""),E=(0,i.useRef)({}),y=!l;(0,i.useEffect)(()=>{c(e=>{const a={...e,...o};return a.customer_name=De(a.first_name,a.last_name,o.customer_name),a})},[o]),(0,i.useEffect)(()=>(window.fillProposalBasics=(e={})=>{c(a=>{const t="string"==typeof e.name?e.name:a.customer_name,l=Ge(t),n="string"==typeof e.first_name?e.first_name:l.firstName||a.first_name,r="string"==typeof e.last_name?e.last_name:l.lastName||a.last_name;return{...a,proposal_title:"string"==typeof e.title?e.title:a.proposal_title,first_name:n,last_name:r,customer_name:De(n,r,t),customer_email:"string"==typeof e.email?e.email:a.customer_email,customer_country:"string"==typeof e.country?e.country.toUpperCase():a.customer_country,customer_language:"string"==typeof e.language?e.language:a.customer_language}})},()=>{delete window.fillProposalBasics}),[]);const N=e=>a=>{c(t=>{const l={...t,[e]:a};if("first_name"===e||"last_name"===e){const n="first_name"===e?a:t.first_name,r="last_name"===e?a:t.last_name;l.customer_name=De(n,r,t.customer_name)}return l}),h(a=>a===e?"":a)},S=e=>a=>{a&&(E.current[e]=a)},C=e=>{const a=E.current[e];if(!a)return;a.scrollIntoView({behavior:"smooth",block:"center"});const t=a.querySelector("input, select, textarea, button");t&&"function"==typeof t.focus&&t.focus()},w=()=>{if(!s.first_name?.trim())return{message:"El nombre del cliente es obligatorio.",field:"first_name"};if(!s.start_date)return{message:"La fecha de inicio es obligatoria.",field:"start_date"};if(!s.end_date)return{message:"La fecha de fin es obligatoria.",field:"end_date"};if(s.end_date<s.start_date)return{message:"La fecha fin no puede ser anterior a la fecha inicio.",field:"end_date"};const e=parseInt(s.pax_total,10);if(Number.isNaN(e)||e<1)return{message:"Pax debe ser un numero >= 1.",field:"pax_total"};const a=parseInt(s.players_count,10);return Number.isNaN(a)||a<0?{message:"Jugadores debe ser un numero >= 0.",field:"players_count"}:a>e?{message:"Jugadores no puede ser mayor que Pax.",field:"players_count"}:s.customer_email&&!/^\S+@\S+\.\S+$/.test(s.customer_email)?{message:"El email no parece valido (si lo rellenas, que sea correcto).",field:"customer_email"}:s.customer_country&&2!==s.customer_country.length?{message:"Pais debe ser ISO2 (2 letras) o vacio.",field:"customer_country"}:null},k=(0,i.useMemo)(()=>{if(!b)return aa;const e=b.toLowerCase();return aa.filter(a=>a.label.toLowerCase().includes(e)||a.value.toLowerCase().includes(e))},[b]),x=parseInt(s.pax_total,10),P=parseInt(s.players_count,10),M=Number.isFinite(x)?Math.max(0,x-(Number.isFinite(P)?P:0)):0;return(0,r.createElement)(Ke.Card,null,(0,r.createElement)(Ke.CardHeader,null,(0,r.createElement)("strong",null,"Datos básicos")),(0,r.createElement)(Ke.CardBody,null,_&&(0,r.createElement)(Ke.Notice,{status:"success",isDismissible:!0,onRemove:()=>v("")},_),d&&(0,r.createElement)(Ke.Notice,{status:"error",isDismissible:!0,onRemove:()=>{m(""),v(""),h("")}},d),(0,r.createElement)("div",{className:"proposal-basics"},(0,r.createElement)("div",{className:"proposal-basics__section"},(0,r.createElement)("div",{className:"proposal-basics__section-title"},"Identidad de la propuesta"),(0,r.createElement)("div",{className:"proposal-basics__grid"},(0,r.createElement)("div",{className:("proposal-basics__field proposal-basics__field--full "+("proposal_title"===g?"is-error":"")).trim(),ref:S("proposal_title")},(0,r.createElement)(Ke.TextControl,{label:"Título de la propuesta",value:s.proposal_title,onChange:N("proposal_title"),placeholder:"Escapada a la Costa del Sol"})),(0,r.createElement)("div",{className:("proposal-basics__field "+("first_name"===g?"is-error":"")).trim(),ref:S("first_name")},(0,r.createElement)(Ke.TextControl,{label:"Nombre *",value:s.first_name,onChange:N("first_name"),placeholder:"John"})),(0,r.createElement)("div",{className:"proposal-basics__field",ref:S("last_name")},(0,r.createElement)(Ke.TextControl,{label:"Apellidos",value:s.last_name,onChange:N("last_name"),placeholder:"Doe"})),(0,r.createElement)("div",{className:("proposal-basics__field "+("customer_email"===g?"is-error":"")).trim(),ref:S("customer_email")},(0,r.createElement)(Ke.TextControl,{label:"Email",value:s.customer_email,onChange:N("customer_email"),placeholder:"john@email.com"})))),(0,r.createElement)("div",{className:"proposal-basics__section"},(0,r.createElement)("div",{className:"proposal-basics__section-title"},"Fechas y pasajeros"),(0,r.createElement)("div",{className:"proposal-basics__grid proposal-basics__grid--dates"},(0,r.createElement)(ia,{label:"Fecha inicio *",value:s.start_date,onChange:e=>{c(a=>{const t={...a,start_date:e};return t.end_date&&e&&t.end_date<e&&(t.end_date=e),t}),window.setTimeout(()=>{const e=document.getElementById("wp-travel-end-date");if(e&&(e.focus(),"function"==typeof e.showPicker))try{e.showPicker()}catch(e){}},0)},className:"start_date"===g?"is-error":"",fieldRef:S("start_date"),isInvalidDate:e=>{if(!y)return!1;const a=na(la(e));return!!a&&a<ra()}}),(0,r.createElement)("div",{className:"proposal-basics__date-arrow","aria-hidden":"true"},"→"),(0,r.createElement)(ia,{id:"wp-travel-end-date",label:"Fecha fin *",value:s.end_date,onChange:e=>{c(a=>a.start_date&&e&&e<a.start_date?{...a,end_date:a.start_date}:{...a,end_date:e})},className:"end_date"===g?"is-error":"",fieldRef:S("end_date"),isInvalidDate:e=>{const a=na(la(e));if(!a)return!1;const t=y?na(s.start_date)||ra():na(s.start_date);return!!t&&a<t}}),(0,r.createElement)("div",{className:("proposal-basics__field proposal-basics__field--pax "+("pax_total"===g?"is-error":"")).trim(),ref:S("pax_total")},(0,r.createElement)(Ke.TextControl,{label:"Pax *",type:"number",min:1,value:String(s.pax_total),onChange:N("pax_total")})),(0,r.createElement)("div",{className:("proposal-basics__field proposal-basics__field--pax "+("players_count"===g?"is-error":"")).trim(),ref:S("players_count")},(0,r.createElement)(Ke.TextControl,{label:"Jugadores",type:"number",min:0,value:String(null!==(n=s.players_count)&&void 0!==n?n:""),onChange:N("players_count"),help:`No jugadores: ${M}`})))),(0,r.createElement)("div",{className:"proposal-basics__section"},(0,r.createElement)("div",{className:"proposal-basics__section-title"},"Preferencias"),(0,r.createElement)("div",{className:"proposal-basics__grid"},(0,r.createElement)("div",{className:("proposal-basics__field "+("customer_language"===g?"is-error":"")).trim(),ref:S("customer_language")},(0,r.createElement)(Ke.SelectControl,{label:"Idioma",value:s.customer_language,options:Xe,onChange:N("customer_language")})),(0,r.createElement)("div",{className:("proposal-basics__field "+("customer_country"===g?"is-error":"")).trim(),ref:S("customer_country")},(0,r.createElement)(Ke.ComboboxControl,{label:"País",value:s.customer_country,options:k,onFilterValueChange:f,onChange:e=>N("customer_country")(e?e.toUpperCase():""),placeholder:"Busca país o código"})),(0,r.createElement)("div",{className:("proposal-basics__field "+("currency"===g?"is-error":"")).trim(),ref:S("currency")},(0,r.createElement)(Ke.SelectControl,{label:"Moneda",value:s.currency,options:ea,onChange:N("currency")}))))),(0,r.createElement)("div",{className:"proposal-basics__actions"},l&&(0,r.createElement)(Ke.Button,{variant:"secondary",onClick:async()=>{if(!l)return;const e=w();if(e)return v(""),m(e.message),h(e.field||""),void C(e.field);p(!0),m(""),v("");const a=De(s.first_name,s.last_name,s.customer_name),t={...s,customer_name:a,pax_total:parseInt(s.pax_total,10),players_count:Math.max(0,parseInt(s.players_count,10)),customer_country:s.customer_country?s.customer_country.toUpperCase():""};try{await Qe.updateProposal(l,t),v("Cambios guardados.")}catch(e){m(e?.message||"Error guardando la propuesta.")}finally{p(!1)}},disabled:u},"Guardar"),(0,r.createElement)(Ke.Button,{variant:"primary",onClick:async()=>{const e=w();if(e)return v(""),m(e.message),h(e.field||""),void C(e.field);p(!0),v(""),m("");const n=De(s.first_name,s.last_name,s.customer_name),r={...s,customer_name:n,pax_total:parseInt(s.pax_total,10),players_count:Math.max(0,parseInt(s.players_count,10)),customer_country:s.customer_country?s.customer_country.toUpperCase():""};try{if(l)return await Qe.updateProposal(l,r),void t?.({basics:r});const e=await Qe.createProposal(r);a?.({proposalId:e.proposal_id,basics:r})}catch(e){m(e?.message||"Error creando la propuesta.")}finally{p(!1)}},disabled:u},d?"Revisa los campos marcados":"Continuar"),u&&(0,r.createElement)(Ke.Spinner,null))))}function sa({label:e,type:a,valueTitle:t,onPick:l}){const[n,o]=(0,i.useState)(t||""),[s,c]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),[d,m]=(0,i.useState)([]);return(0,i.useEffect)(()=>{o(t||"")},[t]),(0,i.useEffect)(()=>{if(!s)return;let e=!0;return p(!0),Qe.searchCatalog({type:a,q:n}).then(a=>e&&m(Array.isArray(a)?a:[])).catch(()=>e&&m([])).finally(()=>e&&p(!1)),()=>{e=!1}},[n,s,a]),(0,r.createElement)("div",{style:{position:"relative",width:"100%",maxWidth:320,minWidth:0}},(0,r.createElement)(Ke.TextControl,{label:e,value:n,onChange:e=>{o(e),c(!0)},onFocus:()=>c(!0),placeholder:"hotel"===a?"Buscar hotel…":"Buscar campo…"}),s&&(0,r.createElement)("div",{style:{position:"absolute",zIndex:30,background:"#fff",border:"1px solid #ddd",borderRadius:8,width:"100%",maxHeight:220,overflow:"auto",boxShadow:"0 6px 18px rgba(0,0,0,.08)"}},u&&(0,r.createElement)("div",{style:{padding:8}},(0,r.createElement)(Ke.Spinner,null)),!u&&0===d.length&&(0,r.createElement)("div",{style:{padding:8,fontSize:12,opacity:.6}},"Sin resultados"),!u&&d.map(e=>(0,r.createElement)("button",{key:e.id,type:"button",onClick:()=>{l(e),c(!1)},style:{display:"block",width:"100%",padding:"8px 10px",border:0,background:"transparent",textAlign:"left",cursor:"pointer"}},e.title))))}function ca({valueId:e,valueLabel:a,onSelect:t,disabled:l=!1,placeholder:n="Buscar proveedor en GIAV..."}){const[i,o]=(0,r.useState)(a||""),[s,c]=(0,r.useState)([]),[u,p]=(0,r.useState)(!1),[d,m]=(0,r.useState)(!1),[_,v]=(0,r.useState)(""),g=(0,r.useRef)(null);(0,r.useEffect)(()=>{a&&a!==i&&o(a)},[a]);return(0,r.createElement)("div",{style:{position:"relative"}},(0,r.createElement)("input",{type:"text",value:i,onChange:e=>{return a=e.target.value,o(a),p(!0),clearTimeout(g.current),void(g.current=setTimeout(()=>(async e=>{const a=(e||"").trim();if(a.length<2)return c([]),v(""),void p(!1);m(!0),v("");try{const e=await Qe.searchGiavProviders({q:a,pageSize:20,pageIndex:0,includeDisabled:!1}),t=(Array.isArray(e)?e:Array.isArray(e?.items)?e.items:[]).map(e=>{var a,t,l,n,r,i,o,s;return{id:String(null!==(a=null!==(t=null!==(l=null!==(n=e.id)&&void 0!==n?n:e.Id)&&void 0!==l?l:e.ID)&&void 0!==t?t:e.proveedorId)&&void 0!==a?a:""),label:String(null!==(r=null!==(i=null!==(o=null!==(s=e.label)&&void 0!==s?s:e.NombreAlias)&&void 0!==o?o:e.Nombre)&&void 0!==i?i:e.title)&&void 0!==r?r:"")}}).filter(e=>e.id&&e.label);c(t),p(t.length>0)}catch(e){v(e?.message||"Error buscando proveedores en GIAV"),c([]),p(!1)}finally{m(!1)}})(a),250));var a},onFocus:()=>{s.length>0&&p(!0)},placeholder:n,disabled:l,style:{width:"100%"}}),(0,r.createElement)("div",{style:{fontSize:12,marginTop:6,opacity:.8}},e?(0,r.createElement)(r.Fragment,null,"ID seleccionado: ",(0,r.createElement)("strong",null,e)):null,d?(0,r.createElement)("span",{style:{marginLeft:10}},"Buscando…"):null,_?(0,r.createElement)("span",{style:{marginLeft:10,color:"crimson"}},_):null),u&&s.length>0&&(0,r.createElement)("div",{style:{position:"absolute",zIndex:20,top:"100%",left:0,right:0,background:"#fff",border:"1px solid #ddd",borderTop:"none",maxHeight:260,overflow:"auto"}},s.map(e=>(0,r.createElement)("div",{key:e.id,onMouseDown:a=>{a.preventDefault(),(e=>{o(e.label),p(!1),c([]),v(""),t?.(e)})(e)},style:{padding:"10px 12px",cursor:"pointer",borderBottom:"1px solid #f0f0f0"}},(0,r.createElement)("div",{style:{fontWeight:600}},e.label),(0,r.createElement)("div",{style:{fontSize:12,opacity:.75}},"ID: ",e.id)))))}const ua="1734698",pa="Proveedores varios",da=(new Date).toISOString().slice(0,10),ma=[{label:"Hotel",value:"hotel"},{label:"Golf",value:"golf"},{label:"Transfer",value:"transfer"},{label:"Extra",value:"extra"},{label:"Paquete",value:"package"}],_a=[{label:"Alojamiento y Desayuno",value:"AD"},{label:"Solo Alojamiento",value:"SA"},{label:"Media Pensión",value:"MP"},{label:"Pensión Completa",value:"PC"},{label:"Todo Incluido",value:"TI"},{label:"Según Programa",value:"SP"}];function va(e){const a=parseFloat(String(e).replace(",","."));return Number.isFinite(a)?a:0}function ga(e,a=1){const t=parseInt(e,10);return Number.isFinite(t)?t:a}function ha(e,a,t){return Number.isFinite(e)?Math.min(t,Math.max(a,e)):a}function ba(e){return Math.round(100*(e+Number.EPSILON))/100}function fa(e,a){if(!e||!a)return 0;const[t,l,n]=String(e).split("-").map(e=>parseInt(e,10)),[r,i,o]=String(a).split("-").map(e=>parseInt(e,10));if(![t,l,n,r,i,o].every(e=>Number.isFinite(e)))return 0;const s=Date.UTC(t,l-1,n),c=Date.UTC(r,i-1,o)-s;return!Number.isFinite(c)||c<=0?0:Math.round(c/864e5)}function Ea(e,a){if(!e)return"";const[t,l,n]=String(e).split("-").map(e=>parseInt(e,10));if(![t,l,n].every(e=>Number.isFinite(e)))return"";const r=new Date(Date.UTC(t,l-1,n));return r.setUTCDate(r.getUTCDate()+Math.max(0,a)),r.toISOString().slice(0,10)}function ya(e,a,t,l="",n=0){const r=function(e,a,t="",l=0){const n=fa(e,a);if(n<=0)return[];const r=[];for(let a=0;a<n;a++)r.push({date:Ea(e,a),net_price:t,margin_pct:l});return r}(a,t,l,n);if(!r.length)return[];const i=new Map;return(Array.isArray(e)?e:[]).forEach(e=>{const a=e?.date;var t,r,o,s,c;a&&(i.has(a)||i.set(a,{date:a,net_price:null!==(t=null!==(r=null!==(o=e.net_price)&&void 0!==o?o:e.net)&&void 0!==r?r:e.net_price_per_night)&&void 0!==t?t:l,margin_pct:null!==(s=null!==(c=e.margin_pct)&&void 0!==c?c:e.margin)&&void 0!==s?s:n}))}),r.map(e=>{const a=i.get(e.date);return a?{...e,...a}:e})}function Na(e,a){return fa(e.start_date||a?.start_date||"",e.end_date||a?.end_date||"")}function Sa(e=0){return{double:{enabled:!0,rooms:1,pricing_basis:"per_room",net_price_per_night:"",margin_pct:e,pvp_manual_enabled:!1,pvp_price_per_night:"",nights_payable:0,free_nights_applied:0,discount_pct_applied:0,total_net:0,total_pvp:0},single:{enabled:!1,rooms:0,pricing_basis:"per_room",net_price_per_night:"",margin_pct:e,pvp_manual_enabled:!1,pvp_price_per_night:"",nights_payable:0,free_nights_applied:0,discount_pct_applied:0,total_net:0,total_pvp:0}}}function Ca(e,a,t){const l=Math.max(0,ga(null!=a?a:0,0)),n=Math.max(0,ga(null!=t?t:0,0));if(l<=0||n<=0||e<=0)return{freeNights:0,nightsPayable:Math.max(0,e)};const r=Math.floor(e/l),i=Math.min(e,r*n);return{freeNights:i,nightsPayable:Math.max(0,e-i)}}function wa(e,a){return ba(Math.max(0,va(e))*(1+Math.max(0,va(a))/100))}function ka(e,a=0){var t,l;const n=e?.start_date||"",r=e?.end_date||"",i=Sa(a);return{service_type:"hotel",title:"",start_date:n,end_date:r,hotel_room_type:"",hotel_regimen:"",hotel_rooms:0,hotel_rate_basis:null,hotel_regimen:"",hotel_pricing_mode:"simple",nightly_rates:[],quantity:1,green_fees_per_person:1,number_of_players:null!==(t=null!==(l=e?.players_count)&&void 0!==l?l:e?.pax_total)&&void 0!==t?t:1,total_green_fees:0,unit_cost_net:"",unit_sell_price:"",use_markup:!0,markup_pct:a,lock_sell_price:!1,notes_public:"",notes_internal:"",package_components_text:"",package_pricing_basis:"per_person",package_individual_count:0,package_individual_mode:"price",unit_cost_net_individual:"",unit_sell_price_individual:"",package_single_supplement_net:"",package_single_supplement_sell:"",display_name:"",use_manual_entry:!1,wp_object_type:null,wp_object_id:null,giav_entity_type:null,giav_entity_id:null,giav_supplier_id:ua,giav_supplier_name:pa,giav_mapping_status:"needs_review",show_supplier_picker:!1,supplier_override:!1,dates_inherited:!0,room_pricing:i,discounts:{discount_pct:0,free_nights_every:"",free_nights_count:""},giav_pricing:{giav_total_pvp:0,giav_total_net:0,giav_source:"double",giav_locked:!1}}}function xa(e,a,t){var l,n;const r={...e};r.start_date||(r.start_date=a?.start_date||""),r.end_date||(r.end_date=a?.end_date||""),r.quantity=Math.max(1,ga(r.quantity,1)),void 0!==r.hotel_rooms&&(r.hotel_rooms=Math.max(0,ga(r.hotel_rooms,0))),r.unit_cost_net=Math.max(0,va(r.unit_cost_net));const i=r.use_markup?Math.max(0,va(null!==(l=null!==(n=r.markup_pct)&&void 0!==n?n:t)&&void 0!==l?l:0)):0;if(r.markup_pct=i,r.lock_sell_price?r.unit_sell_price=Math.max(0,va(r.unit_sell_price)):r.unit_sell_price=wa(r.unit_cost_net,i),"package"===r.service_type)if(r.package_individual_mode="supplement"===r.package_individual_mode?"supplement":"price",r.package_single_supplement_net=Math.max(0,va(r.package_single_supplement_net)),r.unit_cost_net_individual=Math.max(0,va(r.unit_cost_net_individual)),r.lock_sell_price)r.unit_sell_price_individual=Math.max(0,va(r.unit_sell_price_individual)),r.package_single_supplement_sell=Math.max(0,va(r.package_single_supplement_sell));else{const e=r.unit_cost_net_individual>0?r.unit_cost_net_individual:r.unit_cost_net;r.unit_sell_price_individual=wa(e,i),r.package_single_supplement_sell=wa(r.package_single_supplement_net,i)}if("hotel"===r.service_type){const e=Na(r,a);r.hotel_nights=e;const t=function(e,a,t){var l,n,r,i,o,s,c,u,p;const d=Na(e,a),m=Math.max(0,ga(null!==(l=e.hotel_rooms)&&void 0!==l?l:0,0)),_="per_night"===e.hotel_pricing_mode?"per_night":"simple",v=e.start_date||a?.start_date||"",g=e.end_date||a?.end_date||"",h=function(e={}){var a,t,l;return{discount_pct:ha(va(null!==(a=e.discount_pct)&&void 0!==a?a:0),0,50),free_nights_every:Math.max(0,ga(null!==(t=e.free_nights_every)&&void 0!==t?t:0,0))||"",free_nights_count:Math.max(0,ga(null!==(l=e.free_nights_count)&&void 0!==l?l:0,0))||""}}(e.discounts),{freeNights:b,nightsPayable:f}=Ca(d,h.free_nights_every,h.free_nights_count),E=e.use_markup?va(null!==(n=null!==(r=e.markup_pct)&&void 0!==r?r:t)&&void 0!==n?n:0):0,y=e.room_pricing||Sa(t),N=(e,a)=>{var t,l,n;const r=y?.[e]||{},i=null!==(t=a.net_price_per_night)&&void 0!==t?t:0,o=null!==(l=a.pvp_price_per_night)&&void 0!==l?l:0,s=void 0!==r.net_price_per_night&&""!==r.net_price_per_night,c=void 0!==r.pvp_price_per_night&&""!==r.pvp_price_per_night,u=void 0!==r.margin_pct&&""!==r.margin_pct,p=void 0!==r.rooms&&""!==r.rooms;return{enabled:"boolean"==typeof r.enabled?r.enabled:a.enabled,rooms:p?Math.max(0,ga(null!==(n=r.rooms)&&void 0!==n?n:0,0)):a.rooms,pricing_basis:r.pricing_basis||a.pricing_basis,net_price_per_night:s?va(r.net_price_per_night):i,margin_pct:u?va(r.margin_pct):a.margin_pct,pvp_manual_enabled:"boolean"==typeof r.pvp_manual_enabled?r.pvp_manual_enabled:a.pvp_manual_enabled,pvp_price_per_night:c?va(r.pvp_price_per_night):o,nights_payable:0,free_nights_applied:0,discount_pct_applied:h.discount_pct,total_net:0,total_pvp:0}},S={enabled:!1,rooms:0,pricing_basis:"per_room",net_price_per_night:0,margin_pct:E,pvp_manual_enabled:!1,pvp_price_per_night:0},C={double:N("double",{enabled:!0,rooms:m>0?m:1,pricing_basis:"per_room",net_price_per_night:null!==(i=e.unit_cost_net)&&void 0!==i?i:0,margin_pct:E,pvp_manual_enabled:!!e.lock_sell_price,pvp_price_per_night:null!==(o=e.unit_sell_price)&&void 0!==o?o:0}),single:N("single",S)},w="per_night"===_?ya(e.nightly_rates||e.hotel_nightly_rates||[],v,g,null!==(s=null!==(c=C.double?.net_price_per_night)&&void 0!==c?c:e.unit_cost_net)&&void 0!==s?s:"",null!==(u=null!==(p=e.markup_pct)&&void 0!==p?p:t)&&void 0!==u?u:0):[],k="per_night"===_?function(e=[],a=0,t=0){const l=(Array.isArray(e)?e:[]).map(e=>{var a,t,l,n;return{date:e?.date,net:Math.max(0,va(null!==(a=null!==(t=e?.net_price)&&void 0!==t?t:e?.net)&&void 0!==a?a:0)),margin:Math.max(0,va(null!==(l=null!==(n=e?.margin_pct)&&void 0!==n?n:e?.margin)&&void 0!==l?l:0))}}).filter(e=>!!e.date);if(!l.length)return{netSum:0,pvpSum:0};const n=Math.max(0,ga(a,0)),r=l.map((e,a)=>({idx:a,net:e.net})).sort((e,a)=>e.net-a.net).slice(0,n).map(e=>e.idx),i=new Set(r),o=ha(va(t),0,50)/100;let s=0,c=0;return l.forEach((e,a)=>{if(i.has(a))return;const t=e.net*(1-o);s+=t,c+=t*(1+e.margin/100)}),{netSum:ba(s),pvpSum:ba(c)}}(w,b,h.discount_pct):null,x=["double","single"].map(e=>{var a,t,l;const n=C[e];if(!n.enabled)return{totalNet:0,totalPvp:0};const r=Math.max(0,ga(null!==(a=n.rooms)&&void 0!==a?a:0,0)),i="double"===e&&n.pricing_basis||"per_room",o="per_person"===i?2*r:r,s="per_night"===_?Math.max(0,null!==(t=k?.netSum)&&void 0!==t?t:0)*o:Math.max(0,n.net_price_per_night)*f*o*(1-h.discount_pct/100),c=n.pvp_manual_enabled?Math.max(0,n.pvp_price_per_night)*f*o:"per_night"===_?Math.max(0,null!==(l=k?.pvpSum)&&void 0!==l?l:0)*o:s*(1+Math.max(0,n.margin_pct)/100);return C[e]={...n,pricing_basis:i,nights_payable:f,free_nights_applied:b,discount_pct_applied:h.discount_pct,total_net:ba(s),total_pvp:ba(c)},{totalNet:ba(s),totalPvp:ba(c)}}),P=x.reduce((e,a)=>e+a.totalNet,0),M=x.reduce((e,a)=>e+a.totalPvp,0),T=["double","single"].filter(e=>C[e].enabled),A=1===T.length?T[0]:"custom",I={...e.giav_pricing,giav_total_net:ba(P),giav_total_pvp:e.giav_pricing?.giav_locked?ba(va(e.giav_pricing?.giav_total_pvp)):ba(M),giav_source:e.giav_pricing?.giav_locked?"custom":A,giav_locked:!!e.giav_pricing?.giav_locked};return{discounts:h,roomPricing:C,nightlyRates:"per_night"===_?w:null,pricingMode:_,giavPricing:I,totals:{nights:d,nightsPayable:f,freeNights:b,totalNet:ba(P),totalPvp:ba(M)}}}(r,a,i);r.room_pricing=t.roomPricing,r.discounts=t.discounts,r.giav_pricing=t.giavPricing,r.hotel_pricing_mode=t.pricingMode,"per_night"===t.pricingMode&&(r.nightly_rates=Array.isArray(t.nightlyRates)?t.nightlyRates:[]),r.line_cost_net=t.totals.totalNet,r.line_sell_price=t.giavPricing.giav_total_pvp,r.quantity=1,r.unit_cost_net=t.totals.totalNet,r.unit_sell_price=t.giavPricing.giav_total_pvp}else if("golf"===r.service_type){var o;const e=Math.max(0,ga(null!==(o=a?.players_count)&&void 0!==o?o:0,0)),t=e>0?e:1,{greenFeesPerPerson:l,totalGreenFees:n}=function(e={},a=1){var t,l,n;const r=Math.max(1,ga(a,1));let i=Math.max(0,ga(null!==(t=e.green_fees_per_person)&&void 0!==t?t:0,0)),o=Math.max(0,ga(null!==(l=e.total_green_fees)&&void 0!==l?l:0,0));const s=Math.max(0,ga(null!==(n=e.quantity)&&void 0!==n?n:0,0));return i>0?o=i*r:o>0?(i=Math.max(1,Math.round(o/r)),o=i*r):s>0?(o=s,i=Math.max(1,Math.round(o/r)),o=i*r):(i=1,o=i*r),{greenFeesPerPerson:i,totalGreenFees:o}}(r,t);r.number_of_players=e,r.green_fees_per_person=l,r.total_green_fees=n,r.quantity=n,r.line_cost_net=ba(n*r.unit_cost_net),r.line_sell_price=ba(n*r.unit_sell_price)}else if("package"===r.service_type){var s,c;const e=Math.max(1,ga(null!==(s=a?.pax_total)&&void 0!==s?s:1,1)),t="per_room"===r.package_pricing_basis?"per_room":"per_person";r.package_pricing_basis=t;const l=ha(Math.max(0,ga(null!==(c=r.package_individual_count)&&void 0!==c?c:0,0)),0,e);r.package_individual_count=l;const n=Math.max(0,e-l);if(r.unit_cost_net=Math.max(0,va(r.unit_cost_net)),r.unit_cost_net_individual=Math.max(0,va(r.unit_cost_net_individual)),r.package_individual_mode="supplement"===r.package_individual_mode?"supplement":"price",r.package_single_supplement_net=Math.max(0,va(r.package_single_supplement_net)),r.lock_sell_price)r.unit_sell_price=Math.max(0,va(r.unit_sell_price)),r.unit_sell_price_individual=Math.max(0,va(r.unit_sell_price_individual)),r.package_single_supplement_sell=Math.max(0,va(r.package_single_supplement_sell));else{r.unit_sell_price=wa(r.unit_cost_net,i);const e=r.unit_cost_net_individual>0?r.unit_cost_net_individual:r.unit_cost_net;r.unit_sell_price_individual=wa(e,i),r.package_single_supplement_sell=wa(r.package_single_supplement_net,i)}if("per_person"===t){r.quantity=e;const a=r.package_individual_mode,t="supplement"===a?r.unit_cost_net+r.package_single_supplement_net:r.unit_cost_net_individual>0?r.unit_cost_net_individual:r.unit_cost_net,i=r.package_single_supplement_sell||0,o="supplement"===a?r.unit_sell_price+i:r.unit_sell_price_individual>0?r.unit_sell_price_individual:r.unit_sell_price;r.line_cost_net=ba(n*r.unit_cost_net+l*t),r.line_sell_price=ba(n*r.unit_sell_price+l*o),r.package_pp_double=r.unit_sell_price,r.package_pp_single=o,r.package_single_supplement="supplement"===a?i:Math.max(0,o-r.unit_sell_price)}else r.quantity=Math.max(1,ga(r.quantity,1)),r.line_cost_net=ba(r.quantity*r.unit_cost_net),r.line_sell_price=ba(r.quantity*r.unit_sell_price)}else r.line_cost_net=ba(r.quantity*r.unit_cost_net),r.line_sell_price=ba(r.quantity*r.unit_sell_price);return r}function Pa({item:e,idx:a,updateItem:t,currency:l,pax:n,basics:i,globalMarkupPct:o}){var s,c,u,p,d,m,_;const v=e.room_pricing||Sa(o),g=Sa(o),h=e=>v[e]||g[e],b=Math.max(0,ga(null!==(s=h("double").rooms)&&void 0!==s?s:0,0)),f=Math.max(0,ga(null!==(c=h("single").rooms)&&void 0!==c?c:0,0)),E=(h("double").enabled?2*b:0)+(h("single").enabled?f:0),y=E-n,N=!!e.hotel_informative_quote,S=y<0?`Faltan ${Math.abs(y)} pax por asignar a habitaciones`:y>0?N?`Cotización informativa: +${y} pax en habitaciones (no bloquea).`:`Sobran ${y} pax asignados`:"",C=Math.max(0,ga(null!==(u=e.hotel_nights)&&void 0!==u?u:Na(e,i),0)),{nightsPayable:w}=Ca(C,e.discounts?.free_nights_every,e.discounts?.free_nights_count),k=function(e={}){var a,t,l;const n=Math.max(0,va(null!==(a=e.discount_pct)&&void 0!==a?a:0)),r=Math.max(0,ga(null!==(t=e.free_nights_every)&&void 0!==t?t:0,0)),i=Math.max(0,ga(null!==(l=e.free_nights_count)&&void 0!==l?l:0,0)),o=[];return n>0&&o.push(`-${ba(n)}%`),r>0&&i>0&&o.push(`+${i} gratis cada ${r}`),o.length>0?o.join(" "):"Sin descuentos"}(e.discounts),x=e.notes_public||e.notes_internal?"Ver notas":"Sin notas",P="per_night"==("per_night"===e.hotel_pricing_mode?"per_night":"simple"),M=e.start_date||i?.start_date||"",T=e.end_date||i?.end_date||"",A=(a={})=>{var t,l,n,r,i,s,c,u;const p=Array.isArray(e.nightly_rates)&&e.nightly_rates.length?e.nightly_rates[0]:null,d=null!==(t=null!==(l=null!==(n=null!==(r=a.fallbackNet)&&void 0!==r?r:p?.net_price)&&void 0!==n?n:h("double").net_price_per_night)&&void 0!==l?l:e.unit_cost_net&&C>0?ba(va(e.unit_cost_net)/C):"")&&void 0!==t?t:"",m=null!==(i=null!==(s=a.fallbackMargin)&&void 0!==s?s:p?.margin_pct)&&void 0!==i?i:null!==(c=null!==(u=e.markup_pct)&&void 0!==u?u:o)&&void 0!==c?c:0;return ya(e.nightly_rates,M,T,d,m)},I=(e,l)=>{const n=A().map((a,t)=>t===e?{...a,...l}:a);t(a,{nightly_rates:n})},R=(l,n)=>{const r=e.room_pricing||{},i={...r[l]||{},...n},o={...r,[l]:i};t(a,{room_pricing:o})},$=(l,n)=>{const r=e.discounts||{};t(a,{discounts:{...r,[l]:n}})};return(0,r.createElement)("div",{className:"service-card__hotel-panel"},(0,r.createElement)("div",{className:"service-card__subcard service-card__subcard--nightly"},(0,r.createElement)("div",{className:"service-card__hotel-nightly-toggle"},(0,r.createElement)(Ke.ToggleControl,{label:"Precio variable por noche",checked:P,onChange:()=>{if(!P){const e=A();return void t(a,{hotel_pricing_mode:"per_night",nightly_rates:e})}t(a,{hotel_pricing_mode:"simple"})}}),P&&(0,r.createElement)("div",{className:"service-card__hotel-nightly-hint"},'El neto y margen se definen por fecha. Los campos "Neto por noche" y "Margen" del modo de habitación se ignoran (salvo PVP manual).')),P&&(0,r.createElement)("details",{className:"service-card__hotel-nightly",open:!0},(0,r.createElement)("summary",{className:"service-card__section-summary"},(0,r.createElement)("span",{className:"service-card__section-summary-title"},"Desglose por noche"),(0,r.createElement)("span",{className:"service-card__section-summary-meta"},fa(M,T)," noches")),(0,r.createElement)("div",{className:"service-card__hotel-nightly-table"},(0,r.createElement)("div",{className:"service-card__hotel-nightly-row service-card__hotel-nightly-row--head"},(0,r.createElement)("div",null,"Fecha"),(0,r.createElement)("div",null,"Neto"),(0,r.createElement)("div",null,"Margen (%)")),A().map((e,a)=>{var t,l;return(0,r.createElement)("div",{key:e.date||a,className:"service-card__hotel-nightly-row"},(0,r.createElement)("div",{className:"service-card__hotel-nightly-date"},e.date),(0,r.createElement)(Ke.TextControl,{value:String(null!==(t=e.net_price)&&void 0!==t?t:""),onChange:e=>I(a,{net_price:e}),placeholder:"120"}),(0,r.createElement)(Ke.TextControl,{type:"number",min:0,value:String(null!==(l=e.margin_pct)&&void 0!==l?l:""),onChange:e=>I(a,{margin_pct:e}),placeholder:"20"}))})))),(0,r.createElement)("div",{className:"service-card__hotel-occupancy"},["double","single"].map(e=>{var a,t,n,i;const s="double"===e?"Doble":"Individual",c=h(e);return(0,r.createElement)("div",{key:e,className:"service-card__hotel-occupancy-card"},(0,r.createElement)("div",{className:"service-card__hotel-occupancy-header"},(0,r.createElement)(Ke.ToggleControl,{label:`Cotizar ${s.toLowerCase()}`,checked:!!c.enabled,onChange:()=>R(e,{enabled:!c.enabled})}),(0,r.createElement)("span",{className:"service-card__hotel-occupancy-label"},s)),c.enabled&&(0,r.createElement)("div",{className:"service-card__hotel-occupancy-body"},(0,r.createElement)(Ke.TextControl,{label:`Habitaciones ${s.toLowerCase()}`,type:"number",min:1,value:String(null!==(a=c.rooms)&&void 0!==a?a:""),onChange:a=>R(e,{rooms:a})}),"double"===e&&(0,r.createElement)(Ke.SelectControl,{label:"Precio",value:c.pricing_basis||"per_room",options:[{label:"Por habitación",value:"per_room"},{label:"Por persona",value:"per_person"}],onChange:e=>R("double",{pricing_basis:e})}),(0,r.createElement)(Ke.TextControl,{label:`Neto por noche (${s.toLowerCase()})`,value:String(null!==(t=c.net_price_per_night)&&void 0!==t?t:""),onChange:a=>R(e,{net_price_per_night:a}),placeholder:"120",disabled:P}),(0,r.createElement)("details",{className:"service-card__hotel-mode-details"},(0,r.createElement)("summary",null,"Margen y PVP"),(0,r.createElement)("div",{className:"service-card__hotel-mode-details-grid"},(0,r.createElement)(Ke.ToggleControl,{label:"PVP manual",checked:!!c.pvp_manual_enabled,onChange:()=>R(e,{pvp_manual_enabled:!c.pvp_manual_enabled})}),c.pvp_manual_enabled?(0,r.createElement)(Ke.TextControl,{label:`PVP por noche (${s.toLowerCase()})`,value:String(null!==(n=c.pvp_price_per_night)&&void 0!==n?n:""),onChange:a=>R(e,{pvp_price_per_night:a}),placeholder:"165"}):(0,r.createElement)(Ke.TextControl,{label:P?"Margen (%) (se ignora)":"Margen (%)",type:"number",min:0,value:String(null!==(i=c.margin_pct)&&void 0!==i?i:o),onChange:a=>R(e,{margin_pct:a}),disabled:P}))),(0,r.createElement)("div",{className:"service-card__hotel-total"},"Total hab. ",s.toLowerCase(),": ",l," ",ba(c.total_pvp||0).toFixed(2))))})),(0,r.createElement)("div",{className:"service-card__hotel-allocation"},(0,r.createElement)("div",{className:"service-card__hotel-allocation-text"},"Personas asignadas: ",E," de ",n),S&&(0,r.createElement)(Ke.Notice,{status:N&&y>0?"info":"warning",isDismissible:!1},S),(0,r.createElement)(Ke.ToggleControl,{label:"Cotización informativa (permitir habitaciones extra)",checked:N,onChange:e=>t(a,{hotel_informative_quote:!!e}),help:"Actívalo si estás cotizando una habitación adicional solo a efectos informativos (no bloquea si sobran pax asignados)."})),(0,r.createElement)("div",{className:"service-card__subcard"},(0,r.createElement)("details",{className:"service-card__hotel-discounts-collapse"},(0,r.createElement)("summary",{className:"service-card__section-summary"},(0,r.createElement)("span",{className:"service-card__section-summary-title"},"Descuentos"),(0,r.createElement)("span",{className:"service-card__section-summary-meta"},k)),(0,r.createElement)("div",{className:"service-card__hotel-discounts"},(0,r.createElement)("div",{className:"service-card__hotel-discounts-grid"},(0,r.createElement)(Ke.TextControl,{label:"Descuento (%)",type:"number",min:0,max:50,value:String(null!==(p=e.discounts?.discount_pct)&&void 0!==p?p:0),onChange:e=>$("discount_pct",e)}),(0,r.createElement)(Ke.TextControl,{label:"Noches gratis (cada)",type:"number",min:0,value:String(null!==(d=e.discounts?.free_nights_every)&&void 0!==d?d:""),onChange:e=>$("free_nights_every",e)}),(0,r.createElement)(Ke.TextControl,{label:"Noches gratis (cantidad)",type:"number",min:0,value:String(null!==(m=e.discounts?.free_nights_count)&&void 0!==m?m:""),onChange:e=>$("free_nights_count",e)})),C>0&&(0,r.createElement)("div",{className:"service-card__hotel-discount-summary"},"Se cobran ",w," noches de ",C)))),(0,r.createElement)("div",{className:"service-card__subcard service-card__subcard--giav"},(0,r.createElement)("div",{className:"service-card__hotel-giav"},(0,r.createElement)("div",{className:"service-card__hotel-subtitle"},"Total para GIAV"),(0,r.createElement)("div",{className:"service-card__hotel-giav-grid"},(0,r.createElement)("div",{className:"service-card__hotel-giav-total"},(0,r.createElement)("div",{className:"service-card__hotel-giav-label"},"Total alojamiento (para GIAV)"),(0,r.createElement)("div",{className:"service-card__hotel-giav-value"},l," ",ba(e.giav_pricing?.giav_total_pvp||0).toFixed(2))),(0,r.createElement)(Ke.ToggleControl,{label:"Editar total para GIAV",checked:!!e.giav_pricing?.giav_locked,onChange:()=>{const l=e.giav_pricing||{};t(a,{giav_pricing:{...l,giav_locked:!l.giav_locked}})}}),(0,r.createElement)(Ke.TextControl,{label:"Total editable",value:String(null!==(_=e.giav_pricing?.giav_total_pvp)&&void 0!==_?_:""),onChange:l=>(l=>{const n=e.giav_pricing||{};t(a,{giav_pricing:{...n,giav_total_pvp:l}})})(l),disabled:!e.giav_pricing?.giav_locked}),e.giav_pricing?.giav_locked&&(0,r.createElement)(Ke.Notice,{status:N&&y>0?"info":"warning",isDismissible:!1},"Este total se enviará a GIAV. No se recalculará automáticamente.")))),(0,r.createElement)("div",{className:"service-card__subcard"},(0,r.createElement)("details",{className:"service-card__hotel-notes"},(0,r.createElement)("summary",{className:"service-card__section-summary"},(0,r.createElement)("span",{className:"service-card__section-summary-title"},"Notas"),(0,r.createElement)("span",{className:"service-card__section-summary-meta"},x)),(0,r.createElement)("div",{className:"service-card__hotel-notes-grid"},(0,r.createElement)(Ke.TextControl,{label:"Notas para el cliente (itinerario)",value:e.notes_public||"",onChange:e=>t(a,{notes_public:e}),placeholder:"Incluye desayuno. Check-in 15:00."}),(0,r.createElement)(Ke.TextControl,{label:"Notas internas (solo uso interno)",value:e.notes_internal||"",onChange:e=>t(a,{notes_internal:e}),placeholder:"Neto negociado, release 14D."})))))}function Ma(e=[],a={}){if(!Array.isArray(e)||!e.length)return e;const t=a?.start_date||"",l=a?.end_date||"";let n=!1;const r=e.map(e=>{if(!e||!e.dates_inherited)return e;if(e.start_date===t&&e.end_date===l)return e;n=!0;const a={...e,start_date:t,end_date:l,dates_inherited:!0};if("hotel"===a.service_type&&"per_night"===a.hotel_pricing_mode){var r,i,o;const e=Array.isArray(a.nightly_rates)&&a.nightly_rates.length?a.nightly_rates[0]:null,n=null!==(r=e?.net_price)&&void 0!==r?r:"",s=null!==(i=e?.margin_pct)&&void 0!==i?i:null!==(o=a.markup_pct)&&void 0!==o?o:0;a.nightly_rates=ya(a.nightly_rates,t,l,n,s)}return a});return n?r:e}function Ta({proposalId:e,basics:a,initialItems:t=[],onBack:l,onNext:n,onDraftChange:o,requestIntentions:s=null}){var c,u;const p=a?.currency||"EUR",d=Math.max(1,ga(null!==(c=a?.pax_total)&&void 0!==c?c:1,1)),m=Math.max(0,ga(null!==(u=a?.players_count)&&void 0!==u?u:0,0)),[_,v]=(0,i.useState)(20),[g,h]=(0,i.useState)(!0),[b,f]=(0,i.useState)(""),[E,y]=(0,i.useState)(""),[N,S]=(0,i.useState)(!1),[C,w]=(0,i.useState)(null),[k,x]=(0,i.useState)(null),[P,M]=(0,i.useState)(0),[T,A]=(0,i.useState)(null),[I,R]=(0,i.useState)(!1),[$,B]=(0,i.useState)([]),L=(0,i.useRef)(null),[D,G]=(0,i.useState)(()=>(t.length?t:[ka(a,20)]).map(e=>{const t={...e},l="boolean"==typeof t.dates_inherited,n=t.start_date||a?.start_date||"",r=t.end_date||a?.end_date||"";return t.start_date||(t.start_date=n),t.end_date||(t.end_date=r),t.dates_inherited=l?t.dates_inherited:n===(a?.start_date||"")&&r===(a?.end_date||""),xa(t,a,20)})),F=(0,i.useMemo)(()=>function(e){const a=e.reduce((e,a)=>(e.cost+=a.line_cost_net||0,e.sell+=a.line_sell_price||0,e),{cost:0,sell:0}),t=ba(a.sell-a.cost),l=a.sell>0?ba(t/a.sell*100):0;return{totals_cost_net:ba(a.cost),totals_sell_price:ba(a.sell),totals_margin_abs:t,totals_margin_pct:l}}(D),[D]);(0,i.useEffect)(()=>{if(!o)return;const e=window.setTimeout(()=>{o({items:D,totals:F})},200);return()=>window.clearTimeout(e)},[D,F,o]);const q=(0,i.useMemo)(()=>{var e,t,l;const n=Math.max(0,ga(null!==(e=a?.pax_total)&&void 0!==e?e:0,0)),r=ga(null!==(t=null!==(l=a?.players_count)&&void 0!==l?l:n)&&void 0!==t?t:0,0),i=Math.min(Math.max(r,0),n),o={paxTotal:n,playersCount:i,nonPlayersCount:Math.max(0,n-i),golfTotal:0,totalDouble:0,totalSingle:0,doubleRooms:0,singleRooms:0};D.forEach(e=>{if("golf"===e.service_type&&(o.golfTotal+=va(e.line_sell_price||0)),"hotel"===e.service_type){const l=e.room_pricing||{};var a,t;l.double?.enabled&&(o.totalDouble+=va(l.double?.total_pvp||0),o.doubleRooms+=Math.max(0,ga(null!==(a=l.double?.rooms)&&void 0!==a?a:0,0))),l.single?.enabled&&(o.totalSingle+=va(l.single?.total_pvp||0),o.singleRooms+=Math.max(0,ga(null!==(t=l.single?.rooms)&&void 0!==t?t:0,0)))}});const s=va(F.totals_sell_price||0),c=s,u=o.doubleRooms>0?o.totalDouble/(2*o.doubleRooms):0,p=o.singleRooms>0?o.totalSingle/o.singleRooms:0,d=o.totalDouble||0,m=o.totalSingle||0,_=o.golfTotal||0,v=s-(d+m)-_,g=u+(o.paxTotal>0?v/o.paxTotal:0),h=o.playersCount>0?g+_/o.playersCount:null,b=o.doubleRooms>0&&o.singleRooms>0;let f=null;return b&&(f=Math.max(0,p-u)),{...o,totalTrip:s,baseTotal:c,priceNonPlayerDouble:g,pricePlayerDouble:h,supplementSingle:f,hasSingleSupplement:b}},[a?.pax_total,a?.players_count,D,F.totals_sell_price]);(0,i.useEffect)(()=>{G(e=>{const t=Ma(e,a);return t===e?e:t.map((t,l)=>t===e[l]?t:xa(t,a,_))})},[a?.start_date,a?.end_date,_,a]),(0,i.useEffect)(()=>{G(e=>e.map(e=>xa(e,a,_)))},[d]),(0,i.useEffect)(()=>{null!=P&&P>=D.length&&M(D.length?D.length-1:null)},[D.length,P]),(0,i.useEffect)(()=>{if(null==T)return;const e=document.querySelector(`[data-service-index="${T}"]`);if(!e)return;e.scrollIntoView({behavior:"smooth",block:"start"}),((e,a)=>{if(!e)return;if(!a?.service_type){const a=e.querySelector("select");if(a&&"function"==typeof a.focus)return void a.focus()}const t=e.querySelector(".service-card__grid--context input");t&&"function"==typeof t.focus?t.focus():W(e)})(e,D[T]),x(T);const a=window.setTimeout(()=>x(null),1200);return A(null),()=>window.clearTimeout(a)},[T,D]);const U=(e,t)=>{G(l=>{const n=[...l],r={...n[e],...t};return n[e]=xa(r,a,_),n})},V=(0,i.useMemo)(()=>D.map((e,t)=>(e=>{const t=[],l={};if((e.title||e.display_name||"").trim()||(t.push("Falta título"),l.title="Completa el título."),"hotel"!==e.service_type&&"golf"!==e.service_type||e.giav_supplier_id||(t.push("Falta proveedor"),l.supplier="Selecciona un proveedor."),"hotel"===e.service_type){var n,r,i;const c=e.room_pricing||{},u="per_night"===e.hotel_pricing_mode,p=!!c.double?.enabled,m=!!c.single?.enabled;p||m||(t.push("Activa doble/individual"),l.pricing="Activa doble y/o individual.");const v=(e,a)=>{var t;const l=c[e]||{};return l.enabled?ga(null!==(t=l.rooms)&&void 0!==t?t:0,0)<1?`Habitaciones ${a} < 1`:!u&&va(l.net_price_per_night)<=0?`Neto ${a} faltante`:l.pvp_manual_enabled&&va(l.pvp_price_per_night)<=0?`PVP manual ${a} faltante`:"":""};if(u){var o,s;const n=e.start_date||a?.start_date||"",r=e.end_date||a?.end_date||"",i=fa(n,r),c=ya(e.nightly_rates||[],n,r,"",null!==(o=null!==(s=e.markup_pct)&&void 0!==s?s:_)&&void 0!==o?o:0);i<=0?(t.push("Fechas hotel inválidas"),l.pricing="Revisa fechas de hotel."):c.length&&c.length===i?c.some(e=>va(e.net_price)<=0)&&(t.push("Neto por noche faltante"),l.pricing="Completa neto en todas las noches."):(t.push("Faltan noches"),l.pricing="Completa el desglose por noche.")}const g=v("double","doble"),h=v("single","individual");(g||h)&&(t.push(g||h),l.pricing="Revisa pricing de habitaciones.");const b=p?Math.max(0,ga(null!==(n=c.double?.rooms)&&void 0!==n?n:0,0)):0,f=m?Math.max(0,ga(null!==(r=c.single?.rooms)&&void 0!==r?r:0,0)):0,E=(p?2*b:0)+(m?f:0),y=!!e.hotel_informative_quote;E<d?(t.push("Faltan pax"),l.pricing="Ajusta pax doble/individual."):E>d&&!y&&(t.push("Pax no cuadra"),l.pricing="Ajusta pax doble/individual."),va(null!==(i=e.giav_pricing?.giav_total_pvp)&&void 0!==i?i:0)<=0&&(t.push("Total GIAV faltante"),l.pricing="Completa total GIAV.")}if("golf"===e.service_type&&ga(e.green_fees_per_person,1)<1&&(t.push("Green-fees faltante"),l.greenFees="Define green-fees por jugador."),"package"===e.service_type){var c;const n="per_room"===e.package_pricing_basis?"per_room":"per_person",r=Math.max(1,ga(null!==(c=a?.pax_total)&&void 0!==c?c:d,1));if("per_room"===n&&ga(e.quantity,1)<1&&(t.push("Cantidad inválida"),l.quantity="Cantidad debe ser >= 1."),"per_person"===n){var u;const a=Math.max(0,ga(null!==(u=e.package_individual_count)&&void 0!==u?u:0,0)),n="supplement"===e.package_individual_mode?"supplement":"price";a>r&&(t.push("Individual > pax"),l.packageIndiv="Personas en individual no puede superar pax total."),a>0&&("supplement"===n?va(e.package_single_supplement_sell||e.package_single_supplement_net||0)<=0&&(t.push("Suplemento individual faltante"),l.packageIndivPvp="Define suplemento individual (por persona)."):va(e.unit_sell_price_individual||e.unit_cost_net_individual||0)<=0&&(t.push("PVP individual faltante"),l.packageIndivPvp="Define precio por persona (individual)."))}}["transfer","extra"].includes(e.service_type)&&ga(e.quantity,1)<1&&(t.push("Cantidad inválida"),l.quantity="Cantidad debe ser >= 1."),va(e.unit_sell_price)<=0&&(t.push("PVP unitario faltante"),l.unitSell="Define PVP unitario.");const p=("hotel"===e.service_type||"golf"===e.service_type)&&["needs_review","missing"].includes(e.giav_mapping_status);return{issues:t,fieldErrors:l,status:t.length>0?"error":p?"pending":"completed",hasMappingWarning:p}})(e)),[D,d]),j=e=>{M(e),w(e),window.setTimeout(()=>{const a=document.querySelector(`[data-service-index="${e}"]`);a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),W(a))},50)},O=e=>{U(e,{show_supplier_picker:!D[e].show_supplier_picker})},z=e=>!!e.show_supplier_picker,H=()=>{const e=[],a=[];return V.forEach((e,t)=>{e.issues.length>0&&a.push({index:t,title:`Servicio ${t+1}`,details:e.issues.slice(0,2).join(" · ")})}),D.some(e=>"golf"===e.service_type)&&m<=0&&e.push('Define "Jugadores" en Datos básicos.'),F.totals_sell_price<=0&&e.push("El PVP total debe ser > 0."),{errors:e,serviceErrors:a}},W=e=>{if(!e)return;const a=e.querySelector("input, select, textarea, button");a&&"function"==typeof a.focus&&a.focus()},K=(0,i.useMemo)(()=>H(),[V,D,m,F.totals_sell_price]),J=K.serviceErrors.length>0||K.errors.length>0,Z=(e,{missing:a,tooltip:t}={})=>a?(0,r.createElement)("span",{className:"services-summary__value services-summary__value--missing",title:t},"—"):(0,r.createElement)("span",{className:"services-summary__value"},e);return(0,i.useEffect)(()=>{I&&(J||(f(""),B([])))},[I,J]),(0,r.createElement)(Ke.Card,{className:"services-step"},(0,r.createElement)(Ke.CardHeader,null,(0,r.createElement)("div",{className:"services-step__title"},(0,r.createElement)("strong",null,"Servicios & precios"),(0,r.createElement)("span",{className:"services-step__subtitle"},"Añade servicios con detalle, márgenes y proveedor."))),(0,r.createElement)(Ke.CardBody,{ref:L},E&&(0,r.createElement)(Ke.Notice,{status:"success",isDismissible:!0,onRemove:()=>y("")},E),s&&(0,r.createElement)("div",{className:"services-intention-banner"},(0,r.createElement)("strong",null,"Intenciones detectadas"),s.golf?.requested&&(0,r.createElement)("span",null,"Solicitud indica ",s.golf.green_fees_per_player||"—"," green-fees por jugador."),s.flights?.requested&&(0,r.createElement)("span",null,"Requiere vuelos desde ",s.flights.departure_airport||"—","."),s.package&&(0,r.createElement)("span",null,"Paquete sugerido: ",s.package),s.more_info&&(0,r.createElement)("span",null,"Más info: ",s.more_info)),(0,r.createElement)("div",{className:"services-toolbar"},(0,r.createElement)("div",{className:"services-toolbar__controls"},(0,r.createElement)(Ke.TextControl,{label:"Margen por defecto (%)",type:"number",min:0,value:String(_),onChange:e=>v(va(e))}),(0,r.createElement)(Ke.ToggleControl,{label:"Aplicar a nuevas líneas",checked:g,onChange:()=>h(e=>!e)}),(0,r.createElement)(Ke.Button,{variant:"secondary",onClick:()=>{G(e=>e.map(e=>xa({...e,markup_pct:_},a,_)))}},"Aplicar a todas")),(0,r.createElement)("div",{className:"services-toolbar__summary"},(0,r.createElement)("div",{className:"services-toolbar__label"},"PVP total"),(0,r.createElement)("div",{className:"services-toolbar__value"},p," ",F.totals_sell_price.toFixed(2)))),(0,r.createElement)("div",{className:"services-items"},D.map((e,t)=>{var l,n,i,o,s,c,u,v;const g=P===t,h=V[t]||{issues:[],status:"pending",hasMappingWarning:!1,fieldErrors:{}},b=h.status,f=(e=>{const t=e.start_date||a?.start_date||"",l=e.end_date||a?.end_date||"",n=t&&l?`${t} → ${l}`:"Fechas por definir",r=`${p} ${ba(e.line_sell_price||0).toFixed(2)}`;if("golf"===e.service_type)return`${n} · Jugadores: ${m||d} · ${r}`;if("hotel"===e.service_type)return`${n} · Pax: ${d} · ${r}`;var i;if(["transfer","extra"].includes(e.service_type))return`Cantidad: ${ga(null!==(i=e.quantity)&&void 0!==i?i:1,1)} · ${r}`;if("package"===e.service_type){var o;if("per_person"==("per_room"===e.package_pricing_basis?"per_room":"per_person")){var s;const a=Math.max(0,ga(null!==(s=e.package_individual_count)&&void 0!==s?s:0,0));return`Pax: ${d} · Individual: ${a} · ${r}`}return`Cantidad: ${ga(null!==(o=e.quantity)&&void 0!==o?o:1,1)} · ${r}`}return`${n} · ${r}`})(e),E=h.hasMappingWarning?"Proveedor GIAV pendiente":"",y=h.issues.slice(0,2).join(" · "),N=h.fieldErrors||{};return(0,r.createElement)("div",{key:t,className:`service-card service-card--status-${b} ${g?"is-open":""} ${C===t?"is-error":""} ${k===t?"is-highlighted":""}`.trim(),"data-service-index":t},(0,r.createElement)("div",{className:"service-card__header"},(0,r.createElement)("div",{className:"service-card__title"},(0,r.createElement)("div",{className:"service-card__eyebrow"},"Servicio ",t+1),(0,r.createElement)("div",{className:"service-card__name"},ma.find(a=>a.value===e.service_type)?.label||"Servicio"," ·"," ",e.title?.trim()||e.display_name?.trim()||"Sin título"),(0,r.createElement)("div",{className:"service-card__summary"},f),"pending"===b&&E&&(0,r.createElement)("div",{className:"service-card__missing"},E),"error"===b&&y&&(0,r.createElement)("div",{className:"service-card__missing"},y)),(0,r.createElement)("div",{className:"service-card__meta"},(0,r.createElement)("div",{className:`service-card__badge service-card__badge--${b}`},"completed"===b&&"✓ OK","pending"===b&&"Pendiente","error"===b&&`${h.issues.length} errores`),(0,r.createElement)(Ke.Button,{variant:"tertiary",className:"service-card__toggle",onClick:()=>M(g?null:t)},g?"Ocultar":"Ver detalle"),(0,r.createElement)("div",{className:"service-card__total"},(0,r.createElement)("span",null,"Total línea"),(0,r.createElement)("strong",null,p," ",ba(e.line_sell_price||0).toFixed(2))),(0,r.createElement)(Ke.Button,{variant:"tertiary",onClick:()=>(e=>{G(a=>a.filter((a,t)=>t!==e)),M(a=>null==a?a:a===e?Math.max(0,e-1):a>e?a-1:a)})(t),disabled:1===D.length},"Eliminar"))),g&&(0,r.createElement)("div",{className:"service-card__content"},(0,r.createElement)("div",{className:"service-card__section"},(0,r.createElement)("div",{className:"service-card__section-title"},"Selección y contexto"),(0,r.createElement)("div",{className:"service-card__grid service-card__grid--context"},(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.SelectControl,{label:"Tipo de servicio",value:e.service_type,options:ma,onChange:e=>U(t,{service_type:e})})),"hotel"===e.service_type||"golf"===e.service_type?(0,r.createElement)(r.Fragment,null,e.use_manual_entry?(0,r.createElement)("div",{className:"service-card__field "+(N.title?"is-error":"")},(0,r.createElement)(Ke.TextControl,{label:"hotel"===e.service_type?"Hotel (manual) *":"Campo de golf (manual) *",value:e.display_name||"",onChange:e=>U(t,{display_name:e,title:e}),placeholder:"hotel"===e.service_type?"Ej: Hotel X (fuera de catálogo)":"Ej: Campo Y (fuera de catálogo)"}),N.title&&(0,r.createElement)("div",{className:"service-card__field-error"},N.title)):(0,r.createElement)("div",{className:"service-card__field "+(N.title?"is-error":"")},(0,r.createElement)(sa,{label:"hotel"===e.service_type?"Hotel":"Campo de golf",type:"hotel"===e.service_type?"hotel":"golf",valueTitle:e.title,onPick:async a=>{const l="hotel"===e.service_type?"hotel":"course";U(t,{title:a.title,display_name:a.title,wp_object_type:l,wp_object_id:a.id,supplier_override:!1});try{const e=await Qe.getGiavMapping({wp_object_type:l,wp_object_id:a.id});var n,r;e?.status&&"missing"!==e.status?U(t,{giav_mapping_status:e.status,giav_entity_type:e.giav_entity_type,giav_entity_id:e.giav_entity_id,giav_supplier_id:null!==(n=e.giav_supplier_id)&&void 0!==n?n:ua,giav_supplier_name:null!==(r=e.giav_supplier_name)&&void 0!==r?r:pa}):U(t,{giav_mapping_status:"needs_review",giav_entity_type:"supplier",giav_entity_id:ua,giav_supplier_id:ua,giav_supplier_name:pa})}catch{U(t,{giav_mapping_status:"needs_review",giav_entity_type:"supplier",giav_entity_id:ua,giav_supplier_id:ua,giav_supplier_name:pa})}}}),N.title&&(0,r.createElement)("div",{className:"service-card__field-error"},N.title)),(0,r.createElement)("div",{className:"service-card__field service-card__field--toggle"},(0,r.createElement)(Ke.ToggleControl,{label:"Entrada manual (fuera de catálogo)",checked:!!e.use_manual_entry,onChange:()=>{if(e.use_manual_entry)U(t,{use_manual_entry:!1,wp_object_type:null,wp_object_id:null,show_supplier_picker:!1,giav_mapping_status:"missing",supplier_override:!1,display_name:""});else{const a=e.display_name||e.title||"";U(t,{use_manual_entry:!0,wp_object_type:"manual",wp_object_id:0,show_supplier_picker:!0,giav_entity_type:"supplier",giav_entity_id:e.giav_supplier_id||ua,giav_mapping_status:e.giav_supplier_id===ua?"needs_review":"active",giav_supplier_id:e.giav_supplier_id||ua,giav_supplier_name:e.giav_supplier_name||pa,supplier_override:!1,display_name:a,title:a})}}})),(0,r.createElement)("div",{className:"service-card__supplier"},!z(e)&&(0,r.createElement)("div",{className:"service-card__supplier-actions"},(0,r.createElement)(Ke.Button,{variant:"tertiary",onClick:()=>O(t)},"Cambiar proveedor")),z(e)&&(0,r.createElement)(r.Fragment,null,!e.use_manual_entry&&(0,r.createElement)("div",{className:"service-card__field service-card__field--toggle"},(0,r.createElement)(Ke.ToggleControl,{label:"Proveedor (opcional)",checked:!!e.show_supplier_picker,onChange:()=>O(t)})),(0,r.createElement)(ca,{selectedId:e.giav_supplier_id||ua,selectedLabel:e.giav_supplier_name||pa,disabled:!1,onPick:a=>{const l=String(a?.id||""),n=String(a?.label||"");l&&U(t,{giav_entity_type:"supplier",giav_entity_id:l,giav_supplier_id:l,giav_supplier_name:n,giav_mapping_status:l===ua?"needs_review":"active",supplier_override:!e.use_manual_entry})}}),N.supplier&&(0,r.createElement)("div",{className:"service-card__field-error"},N.supplier)))):(0,r.createElement)("div",{className:"service-card__field "+(N.title?"is-error":"")},(0,r.createElement)(Ke.TextControl,{label:"Título / descripción *",value:e.title,onChange:e=>U(t,{title:e})}),N.title&&(0,r.createElement)("div",{className:"service-card__field-error"},N.title)),"hotel"===e.service_type&&(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.TextControl,{label:"Tipo de habitación",value:e.hotel_room_type||"",onChange:e=>U(t,{hotel_room_type:e}),placeholder:"Deluxe / Sea View..."})),"hotel"===e.service_type&&(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.SelectControl,{label:"Régimen",value:e.hotel_regimen||"",options:[{label:"Seleccionar",value:""},..._a],onChange:e=>U(t,{hotel_regimen:e})})))),(0,r.createElement)("div",{className:"service-card__section"},(0,r.createElement)("div",{className:"service-card__section-title"},"Fechas y ocupación"),(0,r.createElement)("div",{className:"service-card__date-status"},(0,r.createElement)("span",{className:"service-card__date-label "+(e.dates_inherited?"is-inherited":"is-custom")},e.dates_inherited?"Fechas del viaje":"Fechas personalizadas"),!e.dates_inherited&&(0,r.createElement)(Ke.Button,{variant:"tertiary",className:"service-card__date-reset",onClick:()=>(e=>{U(e,{start_date:a?.start_date||"",end_date:a?.end_date||"",dates_inherited:!0})})(t)},"Restablecer fechas del viaje")),(0,r.createElement)("div",{className:"service-card__grid service-card__grid--dates"},(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.TextControl,{label:"Fecha inicio",type:"date",value:e.start_date,onChange:e=>((e,t)=>{G(l=>{const n=[...l],r=n[e],i=t||"",o=r.end_date&&i&&r.end_date<i?i:r.end_date;return n[e]=xa({...r,start_date:i,end_date:o,dates_inherited:!1},a,_),n}),window.setTimeout(()=>{const a=document.getElementById(`wp-travel-end-date-${e}`);if(a&&(a.focus(),"function"==typeof a.showPicker))try{a.showPicker()}catch(e){}},0)})(t,e),min:da,className:"service-card__date-start"})),(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.TextControl,{id:`wp-travel-end-date-${t}`,label:"Fecha fin",type:"date",value:e.end_date,onChange:e=>((e,a)=>U(e,{end_date:a}))(t,e),min:e.start_date||void 0})),"hotel"===e.service_type?(0,r.createElement)(r.Fragment,null,(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.TextControl,{label:"Noches",type:"number",min:0,value:String(null!==(l=e.hotel_nights)&&void 0!==l?l:Na(e,a)),onChange:e=>((e,t)=>{const l=D[e].start_date||a?.start_date;if(l){const a=Ea(l,ga(t,1));U(e,{end_date:a})}})(t,e)}))):"golf"===e.service_type?(0,r.createElement)(r.Fragment,null,(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.TextControl,{label:"Jugadores",type:"number",min:1,value:String(m||d),disabled:!0,help:"Definido en Datos basicos"})),(0,r.createElement)("div",{className:"service-card__field "+(N.greenFees?"is-error":"")},(0,r.createElement)(Ke.TextControl,{label:"Green-fees por jugador *",type:"number",min:1,value:String(null!==(n=e.green_fees_per_person)&&void 0!==n?n:""),onChange:e=>U(t,{green_fees_per_person:e})}),N.greenFees&&(0,r.createElement)("div",{className:"service-card__field-error"},N.greenFees)),(0,r.createElement)("div",{className:"service-card__golf-summary"},"Total green-fees (interno): ",ga(m||d,1)," x ",ga(e.green_fees_per_person,0)," ="," ",ga(e.total_green_fees,0))):(0,r.createElement)("div",{className:"service-card__field "+(N.quantity?"is-error":"")},(0,r.createElement)(Ke.TextControl,{label:"transfer"===e.service_type?"Cantidad (servicios)":"package"===e.service_type?"per_person"===e.package_pricing_basis?"Personas (auto)":"Cantidad (habitaciones/paquetes)":"Cantidad",type:"number",min:1,value:String(e.quantity),onChange:e=>U(t,{quantity:e}),disabled:"package"===e.service_type&&"per_person"===e.package_pricing_basis}),N.quantity&&(0,r.createElement)("div",{className:"service-card__field-error"},N.quantity)))),(0,r.createElement)("div",{className:"service-card__section service-card__section--pricing"},(0,r.createElement)("div",{className:"service-card__section-title"},"Pricing"),N.pricing&&(0,r.createElement)("div",{className:"service-card__field-error service-card__field-error--inline"},N.pricing),"hotel"===e.service_type?(0,r.createElement)(Pa,{item:e,idx:t,updateItem:U,currency:p,pax:d,basics:a,globalMarkupPct:_}):(0,r.createElement)("div",{className:"service-card__pricing"},"package"===e.service_type&&(0,r.createElement)(r.Fragment,null,(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.SelectControl,{label:"Precio del paquete",value:e.package_pricing_basis||"per_person",options:[{label:"Por persona",value:"per_person"},{label:"Por habitación / paquete",value:"per_room"}],onChange:e=>U(t,{package_pricing_basis:e})})),"per_room"!==e.package_pricing_basis&&(0,r.createElement)("div",{className:"service-card__field "+(N.packageIndiv?"is-error":"")},(0,r.createElement)(Ke.TextControl,{label:"Personas en individual",type:"number",min:0,value:String(null!==(i=e.package_individual_count)&&void 0!==i?i:0),onChange:e=>U(t,{package_individual_count:e}),help:"Solo si hay viajeros en habitación individual."}),N.packageIndiv&&(0,r.createElement)("div",{className:"service-card__field-error"},N.packageIndiv)),"per_room"!==e.package_pricing_basis&&(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.SelectControl,{label:"Precio en individual",value:e.package_individual_mode||"price",options:[{label:"Precio por persona (individual)",value:"price"},{label:"Suplemento sobre doble (por persona)",value:"supplement"}],onChange:e=>U(t,{package_individual_mode:e}),help:"Indica si el hotel da un precio absoluto en individual o un suplemento sobre la doble."}))),(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.TextControl,{label:"Coste neto (unit.)",value:String(e.unit_cost_net),onChange:e=>U(t,{unit_cost_net:e}),placeholder:"120"})),"package"===e.service_type&&"per_room"!==e.package_pricing_basis&&"supplement"!==e.package_individual_mode&&(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.TextControl,{label:"Coste neto (indiv.)",value:String(null!==(o=e.unit_cost_net_individual)&&void 0!==o?o:""),onChange:e=>U(t,{unit_cost_net_individual:e}),placeholder:"150",help:"Opcional. Precio absoluto en individual. Si se deja vacío, se usará el neto unitario."})),"package"===e.service_type&&"per_room"!==e.package_pricing_basis&&"supplement"===e.package_individual_mode&&(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.TextControl,{label:"Suplemento neto (indiv.)",value:String(null!==(s=e.package_single_supplement_net)&&void 0!==s?s:""),onChange:e=>U(t,{package_single_supplement_net:e}),placeholder:"30",help:"Opcional. Suplemento por persona en individual sobre el neto de doble."})),(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.ToggleControl,{label:"Usar margen",checked:!!e.use_markup,onChange:()=>U(t,{use_markup:!e.use_markup})})),e.use_markup&&(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.TextControl,{label:"Margen (%)",type:"number",min:0,value:String(null!==(c=e.markup_pct)&&void 0!==c?c:_),onChange:e=>U(t,{markup_pct:e})})),(0,r.createElement)("div",{className:"service-card__field"},(0,r.createElement)(Ke.ToggleControl,{label:"PVP manual",checked:!!e.lock_sell_price,onChange:()=>U(t,{lock_sell_price:!e.lock_sell_price})})),(0,r.createElement)("div",{className:"service-card__field "+(N.unitSell?"is-error":"")},(0,r.createElement)(Ke.TextControl,{label:"PVP (unit.)",value:String(e.unit_sell_price),onChange:e=>U(t,{unit_sell_price:e}),placeholder:"165",disabled:!e.lock_sell_price}),N.unitSell&&(0,r.createElement)("div",{className:"service-card__field-error"},N.unitSell)),"package"===e.service_type&&"per_room"!==e.package_pricing_basis&&"supplement"!==e.package_individual_mode&&(0,r.createElement)("div",{className:"service-card__field "+(N.packageIndivPvp?"is-error":"")},(0,r.createElement)(Ke.TextControl,{label:"PVP (indiv.)",value:String(null!==(u=e.unit_sell_price_individual)&&void 0!==u?u:""),onChange:e=>U(t,{unit_sell_price_individual:e}),placeholder:"210",disabled:!e.lock_sell_price,help:"Informativo. Solo aplica si hay viajeros en individual."}),N.packageIndivPvp&&(0,r.createElement)("div",{className:"service-card__field-error"},N.packageIndivPvp)),"package"===e.service_type&&"per_room"!==e.package_pricing_basis&&"supplement"===e.package_individual_mode&&(0,r.createElement)("div",{className:"service-card__field "+(N.packageIndivPvp?"is-error":"")},(0,r.createElement)(Ke.TextControl,{label:"Suplemento PVP (indiv.)",value:String(null!==(v=e.package_single_supplement_sell)&&void 0!==v?v:""),onChange:e=>U(t,{package_single_supplement_sell:e}),placeholder:"45",disabled:!e.lock_sell_price,help:"Informativo. Suplemento por persona en individual sobre la doble."}),N.packageIndivPvp&&(0,r.createElement)("div",{className:"service-card__field-error"},N.packageIndivPvp)))),"package"===e.service_type&&(0,r.createElement)("div",{className:"service-card__section service-card__section--package"},(0,r.createElement)("div",{className:"service-card__section-title"},"Detalle del paquete"),(0,r.createElement)("div",{className:"service-card__package"},(0,r.createElement)(Ke.TextareaControl,{label:"Incluye (una línea por ítem)",value:e.package_components_text||"",onChange:e=>U(t,{package_components_text:e}),rows:4,placeholder:"3 noches\n2 green-fees\nDesayuno incluido"}))),"hotel"!==e.service_type&&(0,r.createElement)("div",{className:"service-card__section service-card__section--notes"},(0,r.createElement)("div",{className:"service-card__section-title"},"Notas"),(0,r.createElement)("details",{className:"service-card__notes-details"},(0,r.createElement)("summary",null,"Mostrar notas"),(0,r.createElement)("div",{className:"service-card__notes"},(0,r.createElement)(Ke.TextControl,{label:"Notas para el cliente (itinerario)",value:e.notes_public||"",onChange:e=>U(t,{notes_public:e}),placeholder:"Incluye desayuno. Check-in 15:00."}),(0,r.createElement)(Ke.TextControl,{label:"Notas internas (solo uso interno)",value:e.notes_internal||"",onChange:e=>U(t,{notes_internal:e}),placeholder:"Neto negociado, release 14D."}))))))})),(0,r.createElement)("div",{className:"services-add"},(0,r.createElement)(Ke.Button,{variant:"secondary",onClick:()=>{const e=D.length-1,t=e>=0?V[e]:null;("error"!==t?.status||window.confirm("Tienes un servicio incompleto. ¿Crear otro igualmente?"))&&G(e=>{const t=[...e,ka(a,_)],l=t.length-1;return M(l),A(l),t})}},"+ Añadir servicio")),(0,r.createElement)("div",{className:"services-summary"},(0,r.createElement)("div",null,(0,r.createElement)("div",{className:"services-summary__label"},"Total viaje"),Z(`${p} ${ba(q.totalTrip).toFixed(2)}`,{missing:F.totals_sell_price<=0,tooltip:"Completa servicios para calcular."}),(0,r.createElement)("div",{className:"services-summary__meta"},"Jugadores: ",q.playersCount," | No jugadores: ",q.nonPlayersCount)),q.playersCount>0&&(0,r.createElement)("div",null,(0,r.createElement)("div",{className:"services-summary__label"},"Precio jugador en doble"),Z(`${p} ${ba(q.pricePlayerDouble||0).toFixed(2)}`,{missing:q.playersCount<=0,tooltip:"Completa jugadores y servicios para calcular."})),q.nonPlayersCount>0&&(0,r.createElement)("div",null,(0,r.createElement)("div",{className:"services-summary__label"},"Precio no jugador en doble"),Z(`${p} ${ba(q.priceNonPlayerDouble||0).toFixed(2)}`,{missing:q.nonPlayersCount<=0,tooltip:"Completa no jugadores para calcular."})),q.hasSingleSupplement&&(0,r.createElement)("div",null,(0,r.createElement)("div",{className:"services-summary__label"},"Suplemento individual"),Z(`${p} ${ba(q.supplementSingle||0).toFixed(2)}`,{missing:!q.hasSingleSupplement,tooltip:"Completa habitaciones para calcular."}))),(0,r.createElement)("div",{className:"services-footer"},(b||I&&$.length>0)&&(0,r.createElement)("div",{className:"services-footer__errors"},(0,r.createElement)("div",{className:"services-footer__errors-header"},(0,r.createElement)("span",null,"Error summary"),(0,r.createElement)(Ke.Button,{variant:"link",onClick:()=>{L.current&&L.current.scrollIntoView({behavior:"smooth",block:"start"})}},"Ver arriba")),b&&(0,r.createElement)("div",{className:"services-footer__errors-message"},b),(0,r.createElement)("ul",null,($.length>0?$:K.serviceErrors).slice(0,3).map(e=>(0,r.createElement)("li",{key:e.index},(0,r.createElement)("button",{type:"button",onClick:()=>j(e.index)},e.title,": ",e.details)))),K.serviceErrors.length>3&&(0,r.createElement)("div",{className:"services-footer__errors-more"},"+",K.serviceErrors.length-3," más")),(0,r.createElement)("div",{className:"services-footer__bar"},(0,r.createElement)("div",{className:"services-footer__left"},(0,r.createElement)(Ke.Button,{variant:"secondary",onClick:l},"Volver"),e&&(0,r.createElement)(Ke.Button,{variant:"secondary",onClick:async()=>{if(e){y(""),S(!0);try{await Qe.updateProposal(e,a),y("Cambios guardados.")}catch(e){f(e?.message||"Error guardando datos básicos.")}finally{S(!1)}}},disabled:N},"Guardar datos básicos")),(0,r.createElement)("div",{className:"services-footer__summary"},(0,r.createElement)("span",null,"Total viaje"),(0,r.createElement)("strong",null,p," ",ba(q.totalTrip).toFixed(2))),(0,r.createElement)("div",{className:"services-footer__right"},(0,r.createElement)(Ke.Button,{variant:"primary",onClick:()=>{const{errors:e,serviceErrors:a}=H();if(R(!0),a.length>0||e.length>0){const t=a.length>0?`Faltan datos en ${a.length} servicios. Te llevo al primero.`:e[0];return f(t),B(a),void((e,a)=>{if(e.length>0)j(e[0].index);else if(a.length>0){w(null);const e=document.querySelector(".services-step");e&&(e.scrollIntoView({behavior:"smooth",block:"start"}),W(e))}})(a,e)}f(""),B([]),w(null),n({items:D,totals:F})},disabled:J&&I,title:J?"Completa los campos obligatorios para continuar.":""},b?"Revisa los campos marcados":"Continuar"))))))}const Aa="wp_travel_giav_proposal_id",Ia=()=>"undefined"!=typeof window&&void 0!==window.sessionStorage;function Ra(e){const a=parseFloat(e);return Number.isFinite(a)?Math.round(100*(a+Number.EPSILON))/100:0}function $a(e){const a=parseFloat(String(e).replace(",","."));return Number.isFinite(a)?a:0}function Ba(e,a=0){const t=parseInt(e,10);return Number.isFinite(t)?t:a}const La=[{key:"double",capacity:2},{key:"single",capacity:1}];function Da(e,a,t=!1){const l="single"===e?"Habitaciones individuales":"Habitaciones dobles",n=t?`${l} adicionales`:l;return a>0?`${n} (${a} hab.)`:n}function Ga(e,a,t,l){let n=a;return t>0&&(n+=` — Precio estimado por habitación: ${function(e,a){return`${a||"EUR"} ${Ra(e).toFixed(2)}`}(t,l)}`),e&&(n=`${e}: ${n}`),n}function Fa({proposalId:e,basics:a,items:t,totals:l,onBack:n,onSent:o,onProposalCreated:s,mode:c="create",versionNumber:u=1}){const[p,d]=(0,i.useState)(!1),[m,_]=(0,i.useState)(""),[v,g]=(0,i.useState)(""),[h,b]=(0,i.useState)(!1),f="undefined"!=typeof window&&window.CASANOVA_GESTION_RESERVAS?"wp-travel-giav-portal":"wp-travel-giav-admin",E=(0,i.useMemo)(()=>{const e={crm_customer_id:null,first_name:a.first_name,last_name:a.last_name,customer_name:De(a.first_name,a.last_name,a.customer_name),customer_email:a.customer_email,customer_country:a.customer_country,customer_language:a.customer_language,proposal_title:a.proposal_title,start_date:a.start_date,end_date:a.end_date,pax_total:a.pax_total,players_count:a.players_count,currency:a.currency,status:"sent"},n=(t||[]).map((e,a)=>{var t,l,n,r,i,o,s,c,u,p,d,m,_,v,g,h,b,f,E,y,N,S,C,w,k,x,P,M,T,A;return{day_index:null!==(t=e.day_index)&&void 0!==t?t:null,service_type:e.service_type,wp_object_type:null!==(l=e.wp_object_type)&&void 0!==l?l:null,wp_object_id:null!==(n=e.wp_object_id)&&void 0!==n?n:null,giav_entity_type:null!==(r=e.giav_entity_type)&&void 0!==r?r:null,giav_entity_id:null!==(i=e.giav_entity_id)&&void 0!==i?i:null,giav_supplier_id:null!==(o=e.giav_supplier_id)&&void 0!==o?o:null,giav_supplier_name:null!==(s=e.giav_supplier_name)&&void 0!==s?s:null,supplier_source:null!==(c=e.supplier_source)&&void 0!==c?c:null,supplier_resolution_chain:Array.isArray(e.supplier_resolution_chain)?e.supplier_resolution_chain:[],preflight_ok:null!==(u=e.preflight_ok)&&void 0!==u?u:null,warnings:Array.isArray(e.warnings)?e.warnings:[],blocking:Array.isArray(e.blocking)?e.blocking:[],supplier_override:!!e.supplier_override,title:null!==(p=e.title)&&void 0!==p?p:`Item ${a+1}`,display_name:null!==(d=e.display_name)&&void 0!==d?d:null,start_date:e.start_date||null,end_date:e.end_date||null,quantity:null!==(m=e.quantity)&&void 0!==m?m:1,pax_quantity:null!==(_=e.pax_quantity)&&void 0!==_?_:null,hotel_rate_basis:null!==(v=e.hotel_rate_basis)&&void 0!==v?v:null,hotel_nights:null!==(g=e.hotel_nights)&&void 0!==g?g:null,hotel_rooms:null!==(h=e.hotel_rooms)&&void 0!==h?h:null,hotel_room_type:null!==(b=e.hotel_room_type)&&void 0!==b?b:"",hotel_regimen:null!==(f=e.hotel_regimen)&&void 0!==f?f:"",hotel_informative_quote:!!e.hotel_informative_quote,hotel_pricing_mode:null!==(E=null!==(y=e.hotel_pricing_mode)&&void 0!==y?y:e.hotel_rate_mode)&&void 0!==E?E:"simple",nightly_rates:Array.isArray(e.nightly_rates)?e.nightly_rates:Array.isArray(e.hotel_nightly_rates)?e.hotel_nightly_rates:null,room_pricing:null!==(N=e.room_pricing)&&void 0!==N?N:null,discounts:null!==(S=e.discounts)&&void 0!==S?S:null,giav_pricing:null!==(C=e.giav_pricing)&&void 0!==C?C:null,package_components:Array.isArray(e.package_components)?e.package_components:[],package_components_text:null!==(w=e.package_components_text)&&void 0!==w?w:"",green_fees_per_person:null!==(k=e.green_fees_per_person)&&void 0!==k?k:null,number_of_players:null!==(x=e.number_of_players)&&void 0!==x?x:null,total_green_fees:null!==(P=e.total_green_fees)&&void 0!==P?P:null,unit_cost_net:Ra(e.unit_cost_net),unit_sell_price:Ra(e.unit_sell_price),line_cost_net:Ra(e.line_cost_net),line_sell_price:Ra(e.line_sell_price),use_markup:!!e.use_markup,markup_pct:Ra(null!==(M=e.markup_pct)&&void 0!==M?M:0),lock_sell_price:!!e.lock_sell_price,notes_public:null!==(T=e.notes_public)&&void 0!==T?T:"",notes_internal:null!==(A=e.notes_internal)&&void 0!==A?A:""}}),r=l||{totals_cost_net:0,totals_sell_price:0,totals_margin_abs:0,totals_margin_pct:0};return{header:e,items:n,totals:{totals_cost_net:Ra(r.totals_cost_net),totals_sell_price:Ra(r.totals_sell_price),totals_margin_abs:Ra(r.totals_margin_abs),totals_margin_pct:Ra(r.totals_margin_pct)},template_id:null,terms_version:null,metadata:{created_at:(new Date).toISOString(),created_by:null,source:f,schema_version:"v2"}}},[a,t,l]),y=E?.header||{},N=De(y.first_name,y.last_name,y.customer_name),S=E?.totals||{},C=Array.isArray(E?.items)?E.items:[],w=(0,i.useMemo)(()=>{let e=0,a=0;return C.forEach(t=>{const l=Array.isArray(t?.warnings)?t.warnings:[],n=Array.isArray(t?.blocking)?t.blocking:[];e+=l.length,a+=n.length}),{warningCount:e,blockingCount:a}},[C]),k=w.blockingCount>0?"error":w.warningCount>0?"warning":"success",x=w.blockingCount>0?`Hay ${w.blockingCount} servicios con errores`:w.warningCount>0?`Hay ${w.warningCount} avisos en servicios`:"Servicios listos para enviar",P=(0,i.useMemo)(()=>{var e,a,t;const l=Math.max(0,Ba(null!==(e=y?.pax_total)&&void 0!==e?e:0,0)),n=Ba(null!==(a=null!==(t=y?.players_count)&&void 0!==t?t:l)&&void 0!==a?a:0,0),r=Math.min(Math.max(n,0),l),i={paxTotal:l,playersCount:r,nonPlayersCount:Math.max(0,l-r),golfTotal:0,totalDouble:0,totalSingle:0,doubleRooms:0,singleRooms:0};C.forEach(e=>{if("golf"===e.service_type&&(i.golfTotal+=$a(e.line_sell_price||0)),"hotel"===e.service_type){const l=e.room_pricing||{};var a,t;l.double?.enabled&&(i.totalDouble+=$a(l.double?.total_pvp||0),i.doubleRooms+=Math.max(0,Ba(null!==(a=l.double?.rooms)&&void 0!==a?a:0,0))),l.single?.enabled&&(i.totalSingle+=$a(l.single?.total_pvp||0),i.singleRooms+=Math.max(0,Ba(null!==(t=l.single?.rooms)&&void 0!==t?t:0,0)))}});const o=$a(S?.totals_sell_price||0),s=o,c=i.doubleRooms>0?i.totalDouble/(2*i.doubleRooms):0,u=i.singleRooms>0?i.totalSingle/i.singleRooms:0,p=o-(i.totalDouble+i.totalSingle)-i.golfTotal,d=i.paxTotal>0?p/i.paxTotal:0,m=i.doubleRooms>0?"double":i.singleRooms>0?"single":"double",_=("double"===m?c:u)+d,v=i.playersCount>0?_+i.golfTotal/i.playersCount:null,g=i.doubleRooms>0&&i.singleRooms>0;let h=null;return g&&(h=Math.max(0,u-c)),{...i,totalTrip:o,baseTotal:s,baseRoomType:m,priceNonPlayerBase:_,pricePlayerBase:v,supplementSingle:h,hasSingleSupplement:g}},[y?.pax_total,y?.players_count,C,S?.totals_sell_price]),{includeRoomLines:M,informativeExtras:T}=(0,i.useMemo)(()=>{const e=[],a=[],t=Math.max(0,P.paxTotal),l=y.currency||"EUR";return C.forEach((n,r)=>{if("hotel"!==n.service_type)return;const i=n.display_name||n.title||"Alojamiento",o=function(e={},a=0){let t=Math.max(0,a);const l={types:{},hasExtra:!1};return La.forEach(({key:a,capacity:n})=>{var r,i;const o=e[a]||{},s=Boolean(o.enabled)?Math.max(0,Ba(null!==(r=o.rooms)&&void 0!==r?r:0,0)):0,c=$a(null!==(i=o.total_pvp)&&void 0!==i?i:0),u=s>0?c/s:0;let p=0,d=0;for(let e=0;e<s;e+=1)t>0?(p+=1,t-=n):d+=1;d>0&&(l.hasExtra=!0),l.types[a]={rooms:s,needed:p,extra:d,capacity:n,perRoomPrice:u,totalPvp:c}}),l}(n.room_pricing||{},t),s=o.types.double||{needed:0,extra:0,rooms:0,perRoomPrice:0},c=o.types.single||{needed:0,extra:0,rooms:0,perRoomPrice:0},u=(a,t)=>{e.push({key:`${r}-${a}`,text:i?`${i} · ${t}`:t})};n.hotel_informative_quote?(s.needed>0&&u("double-needed",Da("double",s.needed)),c.needed>0&&u("single-needed",Da("single",c.needed)),o.hasExtra&&(s.extra>0&&a.push({key:`${r}-double-extra`,text:Ga(i,Da("double",s.extra,!0),s.perRoomPrice,l)}),c.extra>0&&a.push({key:`${r}-single-extra`,text:Ga(i,Da("single",c.extra,!0),c.perRoomPrice,l)}))):(s.rooms>0&&u("double-total",Da("double",s.rooms)),c.rooms>0&&u("single-total",Da("single",c.rooms)))}),{includeRoomLines:e,informativeExtras:a}},[C,P.paxTotal,y.currency]),A=Boolean(y.customer_email),I="edit"===c?"Guardar nueva versión":A?"Compartir propuesta":"Crear enlace público",R=()=>{const a=e&&Number(e)>0?Number(e):null;if(a)return a;const t=(()=>{try{const e=window.location.search||"";if(!e)return null;const a=new URLSearchParams(e),t=["proposal_id","id","proposalId","proposalId"];for(let e of t){const t=a.get(e);if(t){const e=parseInt(t,10);if(Number.isFinite(e)&&e>0)return e}}}catch(e){}return null})();if(t)return t;return function(){if(!Ia())return null;const e=window.sessionStorage.getItem(Aa);if(!e)return null;const a=parseInt(e,10);return Number.isFinite(a)&&a>0?a:null}()||null},$=e=>{const a=String(e||"es").trim();if(!a)return"es";const t=a.split(/[-_]/)[0]||a;return t?t.slice(0,2):"es"},B=async()=>{const e=R();if(e&&Number.isFinite(e)&&e>0)return e;if(!a)return null;const t=(()=>{var e,t;const l=De(a.first_name,a.last_name,a.customer_name);return{...a,customer_name:l,customer_language:$(a.customer_language),pax_total:Math.max(1,Ba(null!==(e=a.pax_total)&&void 0!==e?e:1,1)),players_count:Math.max(0,Ba(null!==(t=a.players_count)&&void 0!==t?t:0,0)),customer_country:a.customer_country?String(a.customer_country).toUpperCase():""}})(),l=await Qe.createProposal(t),n=Number(l?.proposal_id||0);return n>0?(s?.({proposalId:n,basics:t}),n):null},L=async()=>{d(!0),_("");const e=await B();try{"undefined"!=typeof process&&process&&process.env}catch(e){}if(!e||Number(e)<=0)return d(!1),void _("No se pudo continuar: falta el identificador de propuesta válido (proposalId).");try{const a=await Qe.createProposalVersion(e,E,u);o({versionId:a.version_id,publicToken:a.public_token,publicUrl:a.public_url,status:a.status,snapshot:E})}catch(e){_(e?.message||"Error guardando la versión.")}finally{d(!1)}},D=async()=>{d(!0),_("");const e=await B();if(!e||Number(e)<=0)return d(!1),void _("No se pudo compartir: falta el identificador de propuesta válido (proposalId).");if(window.confirm("¿Marcar como enviada y generar enlace público? (Esto no envía emails automáticamente)"))try{const a=await Qe.sendProposal(e,E,u);o({versionId:a.version_id,publicToken:a.public_token,publicUrl:a.public_url,status:a.status||"sent",snapshot:E})}catch(e){_(e?.message||"Error compartiendo la propuesta.")}finally{d(!1)}else d(!1)};return(0,r.createElement)(Ke.Card,null,(0,r.createElement)(Ke.CardHeader,null,(0,r.createElement)("strong",null,"Preview y envío")),(0,r.createElement)(Ke.CardBody,null,v&&(0,r.createElement)(Ke.Notice,{status:"success",isDismissible:!0,onRemove:()=>g("")},v),m&&(0,r.createElement)(Ke.Notice,{status:"error",isDismissible:!0,onRemove:()=>_("")},m),(0,r.createElement)(Ke.Notice,{status:k,isDismissible:!1},x),(0,r.createElement)(Ke.Notice,{status:"info",isDismissible:!1},"El cliente vera solo el total del paquete. El desglose por lineas queda guardado internamente en la version."),(0,r.createElement)("div",{className:"proposal-preview"},(0,r.createElement)("div",{className:"proposal-preview__header"},(0,r.createElement)("div",{className:"proposal-preview__name"},N||"—"),(0,r.createElement)("div",{className:"proposal-preview__meta"},y.start_date," - ",y.end_date," | Pax: ",y.pax_total," | Moneda: ",y.currency)),(0,r.createElement)("div",{className:"proposal-preview__includes"},(0,r.createElement)("div",{className:"proposal-preview__includes-title"},"Incluye"),M.length>0&&(0,r.createElement)("div",{className:"proposal-preview__includes-lines"},M.map(e=>(0,r.createElement)("div",{key:e.key,className:"proposal-preview__includes-line"},e.text))),(0,r.createElement)("div",{className:"preview-items"},C.map((e,a)=>{const t=Array.isArray(e?.warnings)?e.warnings:[],l=Array.isArray(e?.blocking)?e.blocking:[],n=e.display_name||e.title||`Item ${a+1}`,i=e.giav_supplier_name||"Proveedor no especificado",o=l.length>0,s=t.length>0;return(0,r.createElement)("div",{key:a,className:"preview-item"},(0,r.createElement)("div",{className:"preview-item__main"},(0,r.createElement)("div",{className:"preview-item__title"},(0,r.createElement)("strong",null,e.service_type?.toUpperCase())," - ",n),(0,r.createElement)("div",{className:"preview-item__supplier"},"Proveedor: ",i),"hotel"===e.service_type&&e.hotel_room_type?(0,r.createElement)("div",{className:"preview-item__meta"},"Habitacion: ",e.hotel_room_type):null,"package"===e.service_type&&e.package_components_text?(0,r.createElement)("div",{className:"preview-item__meta"},"Incluye: ",e.package_components_text.split("\n").filter(Boolean).join(", ")):null,"package"===e.service_type&&"per_person"===(e.package_pricing_basis||"per_person")?((a,t,l,n,i,o)=>{const s=y.currency||"EUR";if("per_room"==("per_room"===e.package_pricing_basis?"per_room":"per_person")){var c,u,p,d,m,_;const a=$a(null!==(c=null!==(u=e.package_room_double)&&void 0!==u?u:e.unit_sell_price)&&void 0!==c?c:0),t="supplement"===e.package_single_room_mode?"supplement":"price",l=$a(null!==(p=null!==(d=e.package_room_single)&&void 0!==d?d:e.unit_sell_price_single_room)&&void 0!==p?p:0),n=$a(null!==(m=null!==(_=e.package_room_single_supplement)&&void 0!==_?_:e.package_single_room_supplement_sell)&&void 0!==m?m:0),i=l>0||"supplement"===t&&n>0;return(0,r.createElement)("div",{className:"preview-item__meta"},"Precio paquete por habitación (doble): ",s," ",Ra(a).toFixed(2),i&&(0,r.createElement)(r.Fragment,null," · ","supplement"===t?`Suplemento habitación individual: ${s} ${Ra(n).toFixed(2)}`:`Precio habitación individual: ${s} ${Ra(l).toFixed(2)}`))}const v=$a(null!==(a=null!==(t=e.package_pp_double)&&void 0!==t?t:e.unit_sell_price)&&void 0!==a?a:0),g="supplement"===e.package_individual_mode?"supplement":"price",h=$a(null!==(l=null!==(n=e.package_single_supplement)&&void 0!==n?n:e.package_single_supplement_sell)&&void 0!==l?l:0),b="supplement"===g?v+h:$a(null!==(i=null!==(o=e.package_pp_single)&&void 0!==o?o:e.unit_sell_price_individual)&&void 0!==i?i:0),f=b>0&&("supplement"!==g||h>=0),E=f?Math.max(0,b-v):null;return(0,r.createElement)("div",{className:"preview-item__meta"},"Precio paquete por persona (doble): ",s," ",Ra(v).toFixed(2),f&&(0,r.createElement)(r.Fragment,null," · ","supplement"===g?`Suplemento individual: ${s} ${Ra(E||0).toFixed(2)}`:`Precio en individual: ${s} ${Ra(b).toFixed(2)}`))})():null,o&&(0,r.createElement)("div",{className:"preview-item__blocking"},(0,r.createElement)("span",{className:"preview-item__badge preview-item__badge--error"},"Error"),"Este servicio impide la confirmacion."),o&&(0,r.createElement)("details",{className:"preview-item__details"},(0,r.createElement)("summary",null,"Ver motivos"),(0,r.createElement)("ul",null,l.map((e,a)=>(0,r.createElement)("li",{key:a},e?.message||"Revision requerida")))),s&&(0,r.createElement)("details",{className:"preview-item__details"},(0,r.createElement)("summary",null,(0,r.createElement)("span",{className:"preview-item__badge preview-item__badge--warning"},"Aviso"),"Ver avisos (",t.length,")"),(0,r.createElement)("ul",null,t.map((e,a)=>(0,r.createElement)("li",{key:a},e?.message||"Aviso"))))))})),T.length>0&&(0,r.createElement)("div",{className:"proposal-preview__informative-block"},(0,r.createElement)("div",{className:"proposal-preview__informative-title"},"Cotización informativa"),(0,r.createElement)("div",{className:"proposal-preview__informative-lines"},T.map(e=>(0,r.createElement)("div",{key:e.key,className:"proposal-preview__informative-line"},e.text))))),(0,r.createElement)("div",{className:"proposal-preview__totals"},(0,r.createElement)("div",{className:"proposal-preview__totals-label"},"Total viaje"),(0,r.createElement)("div",{className:"proposal-preview__totals-value"},y.currency," ",Ra(P.totalTrip).toFixed(2)),P.playersCount>0&&(0,r.createElement)("div",{className:"proposal-preview__totals-line"},"Precio jugador en ","single"===P.baseRoomType?"individual":"doble",": ",y.currency," ",Ra(P.pricePlayerBase||0).toFixed(2)),(0,r.createElement)("div",{className:"proposal-preview__totals-line"},"Precio no jugador en ","single"===P.baseRoomType?"individual":"doble",": ",y.currency," ",Ra(P.priceNonPlayerBase||0).toFixed(2)),P.hasSingleSupplement&&(0,r.createElement)("div",{className:"proposal-preview__totals-line"},"Suplemento individual: ",y.currency," ",Ra(P.supplementSingle||0).toFixed(2)),(0,r.createElement)("div",{className:"proposal-preview__totals-note"},P.hasSingleSupplement?"Precios por persona. El suplemento individual aplica por persona alojada en habitación individual.":"single"===P.baseRoomType?"Precios por persona en habitación individual.":"Precios por persona en habitación doble."))),(0,r.createElement)("div",{className:"proposal-preview__actions"},(0,r.createElement)(Ke.Button,{variant:"secondary",onClick:n,disabled:p},"Volver"),R()&&(0,r.createElement)(Ke.Button,{variant:"secondary",onClick:async()=>{const e=R();if(e){g(""),b(!0);try{await Qe.updateProposal(e,a||{}),g("Cambios guardados.")}catch(e){_(e?.message||"Error guardando datos básicos.")}finally{b(!1)}}},disabled:p||h},"Guardar datos básicos"),"edit"===c?(0,r.createElement)(r.Fragment,null,(0,r.createElement)(Ke.Button,{variant:"secondary",onClick:L,disabled:p},"Guardar nueva versión"),(0,r.createElement)(Ke.Button,{variant:"primary",onClick:D,disabled:p},"Compartir propuesta")):(0,r.createElement)(r.Fragment,null,A&&(0,r.createElement)(Ke.Button,{variant:"secondary",onClick:L,disabled:p},"Guardar borrador"),(0,r.createElement)(Ke.Button,{variant:"primary",onClick:A?D:L,disabled:p},I)),p&&(0,r.createElement)(Ke.Spinner,null))))}const qa={draft:"Borrador",sent:"Enviada",accepted:"Aceptada",queued:"En cola",synced:"Sincronizada",error:"Error",revoked:"Revocada",lost:"Perdida"},Ua=e=>{const a=String(e||"").trim();return a?"es"===a?"es_ES":"en"===a?"en_US":a:"es_ES"},Va=e=>{if(!e)return"-";const a=String(e),t=a.includes("T")?a:a.replace(" ","T"),l=new Date(t);return Number.isNaN(l.getTime())?e:new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(l)};function ja({onExit:e,mode:a="create",initialProposal:t=null,initialSnapshot:l=null,nextVersionNumber:n=1,showStepper:o=!1}){const[s,c]=(0,i.useState)(1),[u,p]=(0,i.useState)(t?.id||null),[d,m]=(0,i.useState)(t?.status||"draft"),[_]=(0,i.useState)(t?.accepted_at||""),[v]=(0,i.useState)(t?.proposal_token||""),[g,h]=(0,i.useState)(t?.public_url||""),[b,f]=(0,i.useState)(null),[E,y]=(0,i.useState)(!1),N="undefined"!=typeof window&&!!window.CASANOVA_GESTION_RESERVAS,S=(0,i.useMemo)(()=>{if(!t&&!l)return null;const e=l?.header||{},a=e.customer_name||"",n=t?.customer_name||"",r=Ge(a),i=Ge(n),o=(e.first_name||r.firstName,e.last_name||r.lastName,e.first_name||t?.first_name||r.firstName||i.firstName||""),s=e.last_name||t?.last_name||r.lastName||i.lastName||"";return{proposal_title:e.proposal_title||t?.proposal_title||"",first_name:o,last_name:s,customer_name:De(o,s,e.customer_name||t?.customer_name||""),customer_email:e.customer_email||t?.customer_email||"",customer_country:e.customer_country||t?.customer_country||"",customer_language:Ua(e.customer_language||t?.customer_language||"es_ES"),start_date:e.start_date||t?.start_date||"",end_date:e.end_date||t?.end_date||"",pax_total:e.pax_total||t?.pax_total||1,currency:e.currency||t?.currency||"EUR"}},[t,l]),[C,w]=(0,i.useState)(S),k=(0,i.useMemo)(()=>{const e=t?.source_meta_json;if(e)try{const a=JSON.parse(e);if(a?.intentions)return a.intentions}catch(e){}return l?.intentions||null},[t?.source_meta_json,l?.intentions]),[x,P]=(0,i.useState)(l?.items||[]),[M,T]=(0,i.useState)(l?.totals||null),[A,I]=(0,i.useState)(null),[R,$]=(0,i.useState)(null);(0,i.useEffect)(()=>{var e;e=u,Ia()&&(e&&Number.isFinite(e)&&e>0?window.sessionStorage.setItem(Aa,String(Math.floor(e))):window.sessionStorage.removeItem(Aa))},[u]),(0,i.useEffect)(()=>()=>{Ia()&&window.sessionStorage.removeItem(Aa)},[]);let B=null;if(1===s)B=(0,r.createElement)(oa,{initialValues:C||{customer_language:"es_ES",currency:"EUR",pax_total:1},onNext:({basics:e})=>{w(e),P(a=>Ma(a,e)),c(2)},onCreated:({proposalId:e,basics:a})=>{p(e),w(a),P(e=>Ma(e,a)),c(2)},proposalId:u});else if(2===s)B=(0,r.createElement)(Ta,{proposalId:u,basics:C,initialItems:x,onDraftChange:({items:e,totals:a})=>{P(e),T(a)},onBack:()=>c(1),onNext:({items:e,totals:a})=>{P(e),T(a),c(3)},requestIntentions:k});else if(3===s)B=(0,r.createElement)(Fa,{proposalId:u,basics:C,items:x,totals:M,mode:a,versionNumber:n,onBack:()=>c(2),onSent:({versionId:e,snapshot:a,publicUrl:t,publicToken:l,status:n})=>{$(e),I(a||null),t&&h(t),l&&f(l),n&&m(n),c(4)},onProposalCreated:({proposalId:e,basics:a})=>{e&&Number.isFinite(e)&&p(e),a&&w(a)}});else if(4===s){const t=g||((e,a)=>{if(!e)return"";const t=`${window.location.origin}/travel-proposal/${e}/`;return a?`${window.location.origin}/travel-proposal/${e}/v/${a}/`:t})(v,b),l=qa[d]||d||"-",n=_?`Aceptada el ${Va(_)}`:"Pendiente",i=(({email:e,name:a,publicUrl:t})=>{if(!e||!t)return"";const l=`${a?`Hola ${a},`:"Hola,"}\n\nAquí tienes el enlace a tu propuesta:\n${t}\n\nQuedamos a tu disposición para cualquier duda.`;return`mailto:${e}?subject=${encodeURIComponent("Tu propuesta de viaje")}&body=${encodeURIComponent(l)}`})({email:C?.customer_email,name:C?.customer_name,publicUrl:t}),o=(e=>{if("undefined"==typeof window)return"";const a=window.CASANOVA_GESTION_RESERVAS;return a?.pageBase&&e?`${a.pageBase.replace(/\/$/,"")}#/propuesta/${e}`:""})(u)||((e={})=>{const a=new URL(window.location.href);return a.searchParams.set("page","travel_proposals"),a.searchParams.delete("proposal_id"),a.searchParams.delete("action"),Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t?a.searchParams.set(e,t):a.searchParams.delete(e)}),a.toString()})({proposal_id:u}),s=N?"Ver detalle en portal":"Ir al repositorio / ver detalle",c=async()=>{await async function(e){if(!e)return!1;try{if(navigator.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0}catch(e){}const a=document.createElement("textarea");a.value=e,a.style.position="fixed",a.style.top="-1000px",document.body.appendChild(a),a.focus(),a.select();const t=document.execCommand("copy");return document.body.removeChild(a),t}(t)&&(y(!0),window.setTimeout(()=>y(!1),1500))};B=(0,r.createElement)(Ke.Card,null,(0,r.createElement)(Ke.CardHeader,null,(0,r.createElement)("strong",null,"Preview y compartir")),(0,r.createElement)(Ke.CardBody,null,(0,r.createElement)(Ke.Notice,{status:"success",isDismissible:!1},"edit"===a?"Nueva versión creada:":"Propuesta compartida (marcada como enviada). Versión creada:"," ",(0,r.createElement)("strong",null,R)),"accepted"===d&&_?(0,r.createElement)(Ke.Notice,{status:"info",isDismissible:!1},"Aceptada el ",Va(_),"."):null,(0,r.createElement)("div",{className:"proposal-wizard__final-meta"},(0,r.createElement)("div",null,(0,r.createElement)("strong",null,"Estado:")," ",l),(0,r.createElement)("div",null,(0,r.createElement)("strong",null,"Aceptacion:")," ",n),(0,r.createElement)("div",null,(0,r.createElement)("strong",null,"GIAV:")," El expediente se creara tras la aceptacion del cliente.")),(0,r.createElement)("div",{className:"proposal-wizard__final-actions"},"accepted"!==d?(0,r.createElement)(Ke.Button,{variant:"primary",onClick:c,disabled:!t},E?"Enlace copiado":"Copiar enlace publico"):null,i?(0,r.createElement)(Ke.Button,{variant:"secondary",onClick:()=>window.location.assign(i)},"Preparar email al cliente"):null,t?(0,r.createElement)(Ke.Button,{variant:"link",href:t,target:"_blank",rel:"noopener noreferrer"},"Abrir vista publica"):null,o?(0,r.createElement)(Ke.Button,{variant:"link",href:o},s):null,(0,r.createElement)(Ke.Button,{variant:"tertiary",onClick:e},"Salir"))))}if(!B)return null;if(!o)return B;const L=s>3?3:s;return(0,r.createElement)("div",{className:"proposal-wizard"},(0,r.createElement)("div",{className:"proposal-wizard__stepper"},[{title:"Datos basicos",subtitle:"Identidad y fechas"},{title:"Servicios y precios",subtitle:"Hotel, golf y extras"},{title:"Vista previa y envio",subtitle:"Resumen final"}].map((e,a)=>{const t=a+1,l=L===t?"is-active":L>t?"is-complete":"is-upcoming";return(0,r.createElement)("div",{key:e.title,className:`proposal-wizard__step ${l}`.trim()},(0,r.createElement)("div",{className:"proposal-wizard__step-index"},t),(0,r.createElement)("div",{className:"proposal-wizard__step-text"},(0,r.createElement)("div",{className:"proposal-wizard__step-title"},e.title),(0,r.createElement)("div",{className:"proposal-wizard__step-subtitle"},e.subtitle)))})),(0,r.createElement)("div",{className:"proposal-wizard__content"},B))}const Oa=({mode:e="create"})=>{const a=ee(),{proposalId:t}=ae(),l=t?parseInt(t,10):null,n="edit"===e&&Number.isFinite(l),o=n?`Editar propuesta #${l}`:"Nueva propuesta",s=n?`#${l}`:"Nueva propuesta",[c,u]=(0,i.useState)(null),[p,d]=(0,i.useState)(!1),[m,_]=(0,i.useState)("");(0,i.useEffect)(()=>{if(!n||!l)return u(null),void _("");let e=!0;return(async()=>{d(!0),_("");try{const a=await Qe.getProposalDetail(l);e&&u(a)}catch(a){e&&_(a?.message||"No se pudo cargar la propuesta.")}finally{e&&d(!1)}})(),()=>{e=!1}},[n,l]);const v=(0,i.useMemo)(()=>n&&c?.proposal?{initialProposal:c.proposal,initialSnapshot:c.current_snapshot,nextVersionNumber:c.next_version_number||1,mode:"edit"}:null,[c,n]);return(0,r.createElement)("div",{className:"casanova-portal-section casanova-portal-section--wizard"},(0,r.createElement)("header",{className:"casanova-portal-section__header"},(0,r.createElement)("div",null,(0,r.createElement)("div",{className:"casanova-portal-breadcrumbs"},(0,r.createElement)(xe,{to:"/proposals"},"Propuestas"),(0,r.createElement)("span",null,"/"),(0,r.createElement)("span",null,s)),(0,r.createElement)("h2",null,o),(0,r.createElement)("p",null,"Completa los pasos para crear o actualizar la propuesta.")),(0,r.createElement)("div",{className:"casanova-portal-section__actions"},(0,r.createElement)(xe,{className:"button-secondary",to:"/proposals"},"Volver al listado"))),p?(0,r.createElement)("div",{className:"casanova-portal__loading"},"Cargando..."):null,m?(0,r.createElement)("div",{className:"casanova-portal-section__notice"},m):null,p||n&&!v?null:(0,r.createElement)("div",{className:"casanova-portal-wizard"},(0,r.createElement)(ja,{showStepper:!0,onExit:()=>a("/proposals"),...v||{}})))},za=18,Ha={eye:(0,r.createElement)(()=>(0,r.createElement)("svg",{viewBox:"0 0 24 24",fill:"none",width:za,height:za,"aria-hidden":"true"},(0,r.createElement)("path",{d:"M12 5C7 5 3.1 8.5 2 11.5c1.1 3 5 6.5 10 6.5s8.9-3.5 10-6.5C20.9 8.5 17 5 12 5z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.createElement)("circle",{cx:"12",cy:"12",r:"3.2",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"})),null),document:(0,r.createElement)(()=>(0,r.createElement)("svg",{viewBox:"0 0 24 24",fill:"none",width:za,height:za,"aria-hidden":"true"},(0,r.createElement)("path",{d:"M6 3h7l5 5v13a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.createElement)("path",{d:"M13 3v5h5",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})),null),pencil:(0,r.createElement)(()=>(0,r.createElement)("svg",{viewBox:"0 0 24 24",fill:"none",width:za,height:za,"aria-hidden":"true"},(0,r.createElement)("path",{d:"M4 20h3l11-11-3-3L4 17v3z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.createElement)("path",{d:"M14 4l6 6",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"})),null),arrow:(0,r.createElement)(()=>(0,r.createElement)("svg",{viewBox:"0 0 24 24",fill:"none",width:za,height:za,"aria-hidden":"true"},(0,r.createElement)("path",{d:"M4 12h14",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}),(0,r.createElement)("path",{d:"M12 6l6 6-6 6",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})),null),copy:(0,r.createElement)(()=>(0,r.createElement)("svg",{viewBox:"0 0 24 24",fill:"none",width:za,height:za,"aria-hidden":"true"},(0,r.createElement)("path",{d:"M9 4h10a1 1 0 0 1 1 1v12",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.createElement)("rect",{x:"5",y:"8",width:"10",height:"12",rx:"1",stroke:"currentColor",strokeWidth:"1.6"}),(0,r.createElement)("path",{d:"M9 10h-3a2 2 0 0 0-2 2v6h6",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})),null)};function Wa({icon:e,label:a,tooltip:t,onClick:l,disabled:n=!1,className:i=""}){const o=Ha[e]||e;return(0,r.createElement)("button",{type:"button",className:`casanova-action-icon ${n?"is-disabled":""} ${i}`.trim(),onClick:l,disabled:n,title:t||a,"aria-label":t||a},o)}function Ka({request:e,proposal:a,isConverting:t,onConvert:l}){const n=ee(),i=a?.id,o=a&&["draft","sent"].includes(a.status),s=(0,r.useCallback)(()=>{n(`/requests/${e.id}`)},[n,e.id]),c=(0,r.useCallback)(()=>{i&&n(`/propuesta/${i}`)},[n,i]),u=(0,r.useCallback)(()=>{i&&n(`/propuesta/${i}/editar`)},[n,i]);return(0,r.createElement)("div",{className:"casanova-action-icons"},(0,r.createElement)(Wa,{icon:"eye",label:"Ver solicitud",tooltip:"Ver solicitud",onClick:s}),i&&(0,r.createElement)(r.Fragment,null,(0,r.createElement)(Wa,{icon:"document",label:"Ver propuesta",tooltip:"Ver propuesta",onClick:c}),(0,r.createElement)(Wa,{icon:"pencil",label:"Editar propuesta",tooltip:"Editar propuesta",onClick:u,disabled:!o})),(0,r.createElement)(Wa,{icon:"arrow",label:"Convertir solicitud",tooltip:"Convertir solicitud",className:"casanova-action-icon--primary",onClick:()=>l(e.id),disabled:t===e.id}))}const Ja={new:"Nueva",contacted:"Contactado",quoting:"Cotizando",proposal_sent:"Propuesta enviada",won:"Ganada",lost:"Perdida",archived:"Archivada"},Za=[{value:"",label:"Todos los estados"},...Object.entries(Ja).map(([e,a])=>({value:e,label:a}))],Ya=[{value:"",label:"Todos los idiomas"},{value:"es",label:"Español"},{value:"en",label:"English"}];function Qa(){const[e,a]=(0,i.useState)([]),[t,l]=(0,i.useState)(!1),[n,o]=(0,i.useState)(null),[s,c]=(0,i.useState)({search:"",status:"",lang:"",page:1}),[u,p]=(0,i.useState)({total_pages:1}),[d,m]=(0,i.useState)(null),_=(0,i.useCallback)(async()=>{l(!0),o(null);try{const e=await Ae.Ay.listRequests({search:s.search,status:s.status,lang:s.lang,page:s.page,perPage:20});a(e.items||[]),p({total_pages:e.total_pages||1,page:e.page||1})}catch(e){o({type:"error",message:e.message||"No se pudo cargar las solicitudes."}),a([])}finally{l(!1)}},[s]);(0,i.useEffect)(()=>{_()},[_]);const v=(0,i.useCallback)(async e=>{m(e),o(null);try{const a=await Ae.Ay.convertRequest(e);if(a?.edit_url)return void window.location.assign(a.edit_url);if(a?.redirect_url)return void window.location.assign(a.redirect_url);o({type:"success",message:"Propuesta creada correctamente."}),await _()}catch(e){o({type:"error",message:e.message||"No se pudo convertir la solicitud."})}finally{m(null)}},[_]),g=(e,a)=>{c(t=>({...t,[e]:a,page:"page"===e?a:1}))},h=(0,i.useMemo)(()=>e.map(e=>{const a=e.mapped||{},t=e.intentions||{},l=((e={})=>[e.first_name||e.nombre||"",e.last_name||e.apellido||""].filter(Boolean).join(" ")||(e.customer_name?e.customer_name:"Sin nombre"))(a),n=t.golf?.green_fees_per_player,i=t.flights,o=a.pax_total||(a.jugadores||0)+(a.no_jugadores||0),s=e.proposal;return(0,r.createElement)("div",{key:e.id,className:"casanova-portal-table__row casanova-portal-table__row--item"},(0,r.createElement)("span",null,(e=>{if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})})(e.created_at)),(0,r.createElement)("span",null,l),(0,r.createElement)("span",null,a.email||"—"),(0,r.createElement)("span",null,a.fecha_llegada||"—"," - ",a.fecha_regreso||"—"),(0,r.createElement)("span",null,o),(0,r.createElement)("span",null,(0,r.createElement)("span",{className:`status-chip status-chip--${(e.status||"new").replace(/[^a-z0-9_-]/gi,"-")}`},Ja[e.status]||e.status||"Nueva")),(0,r.createElement)("span",null,n?`${n} GF/jug`:"—",i?.requested?(0,r.createElement)("div",{style:{fontSize:11,color:"#6b7280"}},"Vuelos desde ",i.departure_airport||"—"):null),(0,r.createElement)("span",{className:"casanova-portal-table__actions"},(0,r.createElement)(Ka,{request:e,proposal:s,isConverting:d,onConvert:v})))}),[e,d,v]);return(0,r.createElement)("div",{className:"casanova-portal-section"},(0,r.createElement)("header",{className:"casanova-portal-section__header"},(0,r.createElement)("div",null,(0,r.createElement)("h2",null,"Solicitudes recibidas"),(0,r.createElement)("p",null,"Monitorea Gravity Forms, califica el estado y convierte en propuestas."))),(0,r.createElement)("div",{className:"casanova-portal-filters"},(0,r.createElement)("label",{className:"casanova-portal-filter"},(0,r.createElement)("span",null,"Buscar"),(0,r.createElement)("input",{type:"search",value:s.search,onChange:e=>g("search",e.target.value),placeholder:"Nombre, email o ID"})),(0,r.createElement)("label",{className:"casanova-portal-filter"},(0,r.createElement)("span",null,"Estado"),(0,r.createElement)("select",{value:s.status,onChange:e=>g("status",e.target.value)},Za.map(e=>(0,r.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,r.createElement)("label",{className:"casanova-portal-filter"},(0,r.createElement)("span",null,"Idioma"),(0,r.createElement)("select",{value:s.lang,onChange:e=>g("lang",e.target.value)},Ya.map(e=>(0,r.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,r.createElement)("div",{className:"casanova-portal-filters__actions"},(0,r.createElement)("button",{className:"button-secondary",onClick:()=>_(),disabled:t},"Refrescar"))),n?(0,r.createElement)("div",{className:"casanova-portal-section__notice "+("success"===n.type?"casanova-portal-section__notice--success":"")},n.message):null,(0,r.createElement)("div",{className:"casanova-portal-table"},(0,r.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--header"},(0,r.createElement)("span",null,"Fecha"),(0,r.createElement)("span",null,"Nombre"),(0,r.createElement)("span",null,"Email"),(0,r.createElement)("span",null,"Fechas"),(0,r.createElement)("span",null,"PAX"),(0,r.createElement)("span",null,"Estado"),(0,r.createElement)("span",null,"Intenciones"),(0,r.createElement)("span",null,"Acciones")),t?(0,r.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--loading"},"Cargando solicitudes..."):null,t||h.length?null:(0,r.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--empty"},"No hay solicitudes que coincidan."),!t&&h),(0,r.createElement)("div",{className:"casanova-portal-filters",style:{justifyContent:"space-between"}},(0,r.createElement)("button",{className:"button-secondary",onClick:()=>g("page",Math.max(1,s.page-1)),disabled:s.page<=1},"Anterior"),(0,r.createElement)("span",{style:{alignSelf:"center"}},"Pagina ",s.page," de ",u.total_pages||1),(0,r.createElement)("button",{className:"button-secondary",onClick:()=>g("page",s.page+1),disabled:s.page>=(u.total_pages||1)},"Siguiente")))}const Xa=[{value:"",label:"Selecciona un estado"},...Object.entries({new:"Nueva",contacted:"Contactado",quoting:"Cotizando",proposal_sent:"Propuesta enviada",won:"Ganada",lost:"Perdida",archived:"Archivada"}).map(([e,a])=>({value:e,label:a}))],et={draft:"Borrador",sent:"Enviada",accepted:"Aceptada",queued:"En cola",synced:"Sincronizada",error:"Error",revoked:"Revocada",lost:"Perdida"},at=["draft","sent"];function tt(){const{requestId:e}=ae(),a=ee(),[t,l]=(0,i.useState)(null),[n,o]=(0,i.useState)(!1),[s,c]=(0,i.useState)(""),[u,p]=(0,i.useState)(""),[d,m]=(0,i.useState)(""),[_,v]=(0,i.useState)(null),[g,h]=(0,i.useState)(!1),[b,f]=(0,i.useState)(!1),E=async()=>{if(e){o(!0),c("");try{const a=await Ae.Ay.getRequest(e);l(a.request),p(a.request?.status||""),m(a.request?.notes||"")}catch(e){c(e.message||"No se pudo cargar la solicitud.")}finally{o(!1)}}else c("Solicitud inválida.")};(0,i.useEffect)(()=>{E()},[e]);const y=(0,i.useMemo)(()=>{const e=t?.intentions;if(!e)return null;const a=[];return e.golf?.requested&&a.push(`Green-fees por jugador: ${e.golf.green_fees_per_player||"—"}.`),e.flights?.requested&&a.push(`Requiere vuelos desde ${e.flights.departure_airport||"—"}.`),0===a.length&&e.package&&a.push(`Paquete: ${e.package}.`),a},[t?.intentions]);return n?(0,r.createElement)("div",{className:"casanova-portal-section"},"Cargando solicitud…"):s?(0,r.createElement)("div",{className:"casanova-portal-section"},(0,r.createElement)("div",{className:"casanova-portal-section__notice casanova-portal-section__notice--error"},s)):t?(0,r.createElement)("div",{className:"casanova-portal-section"},(0,r.createElement)("header",{className:"casanova-portal-detail__header"},(0,r.createElement)("div",null,(0,r.createElement)("p",{className:"casanova-portal__eyebrow"},"Solicitud #",t.entry_id),(0,r.createElement)("h2",null,((e={})=>[e.first_name||e.nombre||"",e.last_name||e.apellido||""].filter(Boolean).join(" ")||(e.customer_name?e.customer_name:"Sin nombre"))(t.mapped)),(0,r.createElement)("p",null,t.mapped?.email||"—"," · ",t.mapped?.telefono||"—")),(0,r.createElement)("div",{className:"casanova-portal-detail__actions"},(0,r.createElement)("button",{type:"button",className:"button-secondary",onClick:()=>a("/requests")},"Volver al listado"),t.proposal?.public_url?(0,r.createElement)("a",{className:"button-secondary",href:t.proposal.public_url,target:"_blank",rel:"noreferrer"},"Abrir propuesta"):null)),_&&(0,r.createElement)("div",{className:"casanova-portal-section__notice "+("success"===_.type?"casanova-portal-section__notice--success":"")},_.text),y&&y.length>0&&(0,r.createElement)("div",{className:"casanova-portal-section__notice casanova-portal-section__notice--success"},"Solicitud indica: ",y.join(" ")),(0,r.createElement)("div",{className:"casanova-portal-requests-detail"},(0,r.createElement)("div",{className:"casanova-portal-card"},(0,r.createElement)("h3",null,"Resumen"),(0,r.createElement)("p",null,"Fechas: ",t.mapped?.fecha_llegada||"—"," – ",t.mapped?.fecha_regreso||"—"),(0,r.createElement)("p",null,"Jugadores: ",t.mapped?.jugadores||0),(0,r.createElement)("p",null,"No jugadores: ",t.mapped?.no_jugadores||0),(0,r.createElement)("p",null,"Green-fees por jugador: ",t.mapped?.green_fees_per_player||"—"),(0,r.createElement)("p",null,"Solicita vuelos: ",t.intentions?.flights?.requested?"Sí":"No"),(0,r.createElement)("p",null,"Más info: ",t.mapped?.more_info||"—")),(0,r.createElement)("div",{className:"casanova-portal-card"},(0,r.createElement)("h3",null,"Estado CRM"),(0,r.createElement)("label",{htmlFor:"request-status",className:"casanova-portal-filter"},(0,r.createElement)("span",null,"Estado"),(0,r.createElement)("select",{id:"request-status",value:u,onChange:e=>p(e.target.value)},Xa.map(e=>(0,r.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,r.createElement)("label",{className:"casanova-portal-filter"},(0,r.createElement)("span",null,"Notas"),(0,r.createElement)("textarea",{value:d,onChange:e=>m(e.target.value),rows:"4",style:{width:"100%",borderRadius:10,border:"1px solid #cbd5f5",padding:10,fontSize:14}})),(0,r.createElement)("div",{className:"casanova-portal-detail__actions-row"},(0,r.createElement)("button",{type:"button",className:"button-primary",onClick:async()=>{if(u){h(!0),v(null);try{await Ae.Ay.updateRequestStatus(e,{status:u,notes:d}),v({type:"success",text:"Estado actualizado."}),await E()}catch(e){v({type:"error",text:e.message||"No se pudo actualizar."})}finally{h(!1)}}else v({type:"error",text:"Selecciona un estado."})},disabled:g||t.status===u},g?"Guardando…":"Actualizar estado"),(0,r.createElement)("button",{type:"button",className:"button-primary",onClick:async()=>{f(!0),v(null);try{const a=await Ae.Ay.convertRequest(e);if(a?.edit_url)return void window.location.assign(a.edit_url);if(a?.redirect_url)return void window.location.assign(a.redirect_url);v({type:"success",text:"Propuesta creada correctamente."}),await E()}catch(e){v({type:"error",text:e.message||"No se pudo convertir."})}finally{f(!1)}},disabled:b},b?"Convirtiendo…":"Crear propuesta"))),t.linked_proposals?.length>0&&(0,r.createElement)("div",{className:"casanova-portal-card"},(0,r.createElement)("h3",null,"Propuestas generadas"),(0,r.createElement)("div",{className:"casanova-portal-requests-detail__proposals"},t.linked_proposals.map(e=>{const t=et[e.status]||e.status||"Sin estado",l=e.updated_at||e.created_at,n=at.includes(e.status);return(0,r.createElement)("div",{key:e.id,className:"casanova-portal-requests-detail__proposal-row"},(0,r.createElement)("div",{className:"casanova-portal-requests-detail__proposal-info"},(0,r.createElement)("strong",null,"#",e.id),(0,r.createElement)("span",null,e.proposal_title||e.client_name||"Propuesta"),(0,r.createElement)("small",{className:"casanova-portal-requests-detail__proposal-meta"},t," · ",(e=>{if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString("es-ES",{dateStyle:"medium",timeStyle:"short"})})(l))),(0,r.createElement)("div",{className:"casanova-action-icons"},(0,r.createElement)(Wa,{icon:"document",label:"Ver propuesta",tooltip:"Ver propuesta",onClick:()=>a(`/propuesta/${e.id}`)}),(0,r.createElement)(Wa,{icon:"pencil",label:"Editar propuesta",tooltip:"Editar propuesta",onClick:()=>a(`/propuesta/${e.id}/editar`),disabled:!n})))}))))):null}const lt=(0,r.lazy)(()=>n.e(432).then(n.bind(n,432))),nt=()=>(0,r.createElement)(r.Suspense,{fallback:(0,r.createElement)("div",{className:"casanova-portal__loading"},"Cargando dashboard...")},(0,r.createElement)(lt,null)),rt=({children:e,config:a})=>(0,r.createElement)("div",{className:"casanova-portal"},(0,r.createElement)("header",{className:"casanova-portal__header"},(0,r.createElement)("div",{className:"casanova-portal__header-main"},(0,r.createElement)("div",null,(0,r.createElement)("p",{className:"casanova-portal__eyebrow"},"Portal de propuestas"),(0,r.createElement)("h1",null,"Gestión de reservas")),(0,r.createElement)("div",{className:"casanova-portal__user"},(0,r.createElement)("div",{className:"casanova-portal__user-meta"},(0,r.createElement)("span",null,a.currentUser?.displayName||"Administrador"),(0,r.createElement)("small",null,a.currentUser?.email||"")),a.logoutUrl?(0,r.createElement)("div",{className:"casanova-portal__user-actions"},(0,r.createElement)("a",{className:"casanova-portal__logout",href:a.logoutUrl},"Cerrar sesión")):null)),(0,r.createElement)("p",{className:"casanova-portal__subtitle"},"Monitorea versiones, revisa estados y sincroniza con GIAV.")),(0,r.createElement)("div",{className:"casanova-portal__body"},(0,r.createElement)("aside",{className:"casanova-portal__sidebar"},(0,r.createElement)("div",{className:"casanova-portal__branding"},(0,r.createElement)("span",{className:"casanova-portal__branding-icon"},"CG"),(0,r.createElement)("div",null,(0,r.createElement)("strong",null,"Casanova"),(0,r.createElement)("small",null,"Gestión premium"))),(0,r.createElement)("nav",{className:"casanova-portal__nav"},(0,r.createElement)(Pe,{to:"/dashboard",className:({isActive:e})=>"casanova-portal__nav-link "+(e?"casanova-portal__nav-link--active":"")},"Dashboard"),(0,r.createElement)(Pe,{to:"/proposals",className:({isActive:e})=>"casanova-portal__nav-link "+(e?"casanova-portal__nav-link--active":"")},"Listado de propuestas"),(0,r.createElement)(Pe,{to:"/requests",className:({isActive:e})=>"casanova-portal__nav-link "+(e?"casanova-portal__nav-link--active":"")},"Solicitudes recibidas")),(0,r.createElement)("div",{className:"casanova-portal__status"},(0,r.createElement)("span",null,"Base de datos"),(0,r.createElement)("strong",{className:a.flags?.dbHealthy?"status-chip--ok":"status-chip--warning"},a.flags?.dbHealthy?"OK":"Revisar"))),(0,r.createElement)("section",{className:"casanova-portal__content"},e))),it=()=>{const e=window.CASANOVA_GESTION_RESERVAS;return e?(0,r.createElement)(Ce,null,(0,r.createElement)(rt,{config:e},(0,r.createElement)(ve,null,(0,r.createElement)(me,{path:"/",element:(0,r.createElement)(de,{to:"/proposals",replace:!0})}),(0,r.createElement)(me,{path:"/dashboard",element:(0,r.createElement)(nt,null)}),(0,r.createElement)(me,{path:"/proposals",element:(0,r.createElement)(je,null)}),(0,r.createElement)(me,{path:"/requests",element:(0,r.createElement)(Qa,null)}),(0,r.createElement)(me,{path:"/requests/:requestId",element:(0,r.createElement)(tt,null)}),(0,r.createElement)(me,{path:"/nueva",element:(0,r.createElement)(Oa,{mode:"create"})}),(0,r.createElement)(me,{path:"/propuesta/:proposalId",element:(0,r.createElement)(We,null)}),(0,r.createElement)(me,{path:"/propuesta/:proposalId/editar",element:(0,r.createElement)(Oa,{mode:"edit"})}),(0,r.createElement)(me,{path:"/proposals/:proposalId",element:(0,r.createElement)(We,null)}),(0,r.createElement)(me,{path:"/proposals/:proposalId/edit",element:(0,r.createElement)(Oa,{mode:"edit"})}),(0,r.createElement)(me,{path:"*",element:(0,r.createElement)(de,{to:"/proposals",replace:!0})})))):(0,r.createElement)("div",{className:"casanova-portal__loading"},"Cargando configuración...")},ot=document.getElementById("casanova-gestion-reservas-app");ot&&(0,i.createRoot)(ot).render((0,r.createElement)(it,null))})();