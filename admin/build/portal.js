(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var l in t)e.o(t,l)&&!e.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:t[l]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.React,t=window.wp.element,l=window.ReactDOM;function r(){return r=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},r.apply(this,arguments)}var n;!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(n||(n={}));const o="popstate";function i(e,a){if(!1===e||null==e)throw new Error(a)}function s(e,a){if(!e){"undefined"!=typeof console&&console.warn(a);try{throw new Error(a)}catch(e){}}}function c(e,a){return{usr:e.state,key:e.key,idx:a}}function u(e,a,t,l){return void 0===t&&(t=null),r({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof a?d(a):a,{state:t,key:a&&a.key||l||Math.random().toString(36).substr(2,8)})}function p(e){let{pathname:a="/",search:t="",hash:l=""}=e;return t&&"?"!==t&&(a+="?"===t.charAt(0)?t:"?"+t),l&&"#"!==l&&(a+="#"===l.charAt(0)?l:"#"+l),a}function d(e){let a={};if(e){let t=e.indexOf("#");t>=0&&(a.hash=e.substr(t),e=e.substr(0,t));let l=e.indexOf("?");l>=0&&(a.search=e.substr(l),e=e.substr(0,l)),e&&(a.pathname=e)}return a}var m;function v(e,a,t){return void 0===t&&(t="/"),function(e,a,t,l){let r=T(("string"==typeof a?d(a):a).pathname||"/",t);if(null==r)return null;let n=_(e);!function(e){e.sort((e,a)=>e.score!==a.score?a.score-e.score:function(e,a){return e.length===a.length&&e.slice(0,-1).every((e,t)=>e===a[t])?e[e.length-1]-a[a.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),a.routesMeta.map(e=>e.childrenIndex)))}(n);let o=null;for(let e=0;null==o&&e<n.length;++e){let a=P(r);o=w(n[e],a,l)}return o}(e,a,t,!1)}function _(e,a,t,l){void 0===a&&(a=[]),void 0===t&&(t=[]),void 0===l&&(l="");let r=(e,r,n)=>{let o={relativePath:void 0===n?e.path||"":n,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};o.relativePath.startsWith("/")&&(i(o.relativePath.startsWith(l),'Absolute route path "'+o.relativePath+'" nested under path "'+l+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(l.length));let s=B([l,o.relativePath]),c=t.concat(o);e.children&&e.children.length>0&&(i(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),_(e.children,a,c,s)),(null!=e.path||e.index)&&a.push({path:s,score:C(s,e.index),routesMeta:c})};return e.forEach((e,a)=>{var t;if(""!==e.path&&null!=(t=e.path)&&t.includes("?"))for(let t of g(e.path))r(e,a,t);else r(e,a)}),a}function g(e){let a=e.split("/");if(0===a.length)return[];let[t,...l]=a,r=t.endsWith("?"),n=t.replace(/\?$/,"");if(0===l.length)return r?[n,""]:[n];let o=g(l.join("/")),i=[];return i.push(...o.map(e=>""===e?n:[n,e].join("/"))),r&&i.push(...o),i.map(a=>e.startsWith("/")&&""===a?"/":a)}!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(m||(m={})),new Set(["lazy","caseSensitive","path","id","index","children"]);const h=/^:[\w-]+$/,b=3,E=2,f=1,y=10,N=-2,S=e=>"*"===e;function C(e,a){let t=e.split("/"),l=t.length;return t.some(S)&&(l+=N),a&&(l+=E),t.filter(e=>!S(e)).reduce((e,a)=>e+(h.test(a)?b:""===a?f:y),l)}function w(e,a,t){void 0===t&&(t=!1);let{routesMeta:l}=e,r={},n="/",o=[];for(let e=0;e<l.length;++e){let i=l[e],s=e===l.length-1,c="/"===n?a:a.slice(n.length)||"/",u=x({path:i.relativePath,caseSensitive:i.caseSensitive,end:s},c),p=i.route;if(!u&&s&&t&&!l[l.length-1].route.index&&(u=x({path:i.relativePath,caseSensitive:i.caseSensitive,end:!1},c)),!u)return null;Object.assign(r,u.params),o.push({params:r,pathname:B([n,u.pathname]),pathnameBase:G(B([n,u.pathnameBase])),route:p}),"/"!==u.pathnameBase&&(n=B([n,u.pathnameBase]))}return o}function x(e,a){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[t,l]=function(e,a,t){void 0===a&&(a=!1),void 0===t&&(t=!0),s("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let l=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,a,t)=>(l.push({paramName:a,isOptional:null!=t}),t?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(l.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))"),[new RegExp(r,a?void 0:"i"),l]}(e.path,e.caseSensitive,e.end),r=a.match(t);if(!r)return null;let n=r[0],o=n.replace(/(.)\/+$/,"$1"),i=r.slice(1);return{params:l.reduce((e,a,t)=>{let{paramName:l,isOptional:r}=a;if("*"===l){let e=i[t]||"";o=n.slice(0,n.length-e.length).replace(/(.)\/+$/,"$1")}const s=i[t];return e[l]=r&&!s?void 0:(s||"").replace(/%2F/g,"/"),e},{}),pathname:n,pathnameBase:o,pattern:e}}function P(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(a){return s(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+a+")."),e}}function T(e,a){if("/"===a)return e;if(!e.toLowerCase().startsWith(a.toLowerCase()))return null;let t=a.endsWith("/")?a.length-1:a.length,l=e.charAt(t);return l&&"/"!==l?null:e.slice(t)||"/"}const k=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function M(e,a){let t=a.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?t.length>1&&t.pop():"."!==e&&t.push(e)}),t.length>1?t.join("/"):"/"}function A(e,a,t,l){return"Cannot include a '"+e+"' character in a manually specified `to."+a+"` field ["+JSON.stringify(l)+"].  Please separate it out to the `to."+t+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function I(e,a){let t=function(e){return e.filter((e,a)=>0===a||e.route.path&&e.route.path.length>0)}(e);return a?t.map((e,a)=>a===t.length-1?e.pathname:e.pathnameBase):t.map(e=>e.pathnameBase)}function R(e,a,t,l){let n;void 0===l&&(l=!1),"string"==typeof e?n=d(e):(n=r({},e),i(!n.pathname||!n.pathname.includes("?"),A("?","pathname","search",n)),i(!n.pathname||!n.pathname.includes("#"),A("#","pathname","hash",n)),i(!n.search||!n.search.includes("#"),A("#","search","hash",n)));let o,c=""===e||""===n.pathname,u=c?"/":n.pathname;if(null==u)o=t;else{let e=a.length-1;if(!l&&u.startsWith("..")){let a=u.split("/");for(;".."===a[0];)a.shift(),e-=1;n.pathname=a.join("/")}o=e>=0?a[e]:"/"}let p=function(e,a){void 0===a&&(a="/");let t,{pathname:l,search:r="",hash:n=""}="string"==typeof e?d(e):e;if(l)if(o=l,k.test(o))t=l;else{if(l.includes("//")){let e=l;l=l.replace(/\/\/+/g,"/"),s(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+l)}t=l.startsWith("/")?M(l.substring(1),"/"):M(l,a)}else t=a;var o;return{pathname:t,search:$(r),hash:D(n)}}(n,o),m=u&&"/"!==u&&u.endsWith("/"),v=(c||"."===u)&&t.endsWith("/");return p.pathname.endsWith("/")||!m&&!v||(p.pathname+="/"),p}const B=e=>e.join("/").replace(/\/\/+/g,"/"),G=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),$=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",D=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;const L=["post","put","patch","delete"],U=(new Set(L),["get",...L]);function F(){return F=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},F.apply(this,arguments)}new Set(U),new Set([301,302,303,307,308]),new Set([307,308]),Symbol("deferred");const V=a.createContext(null),O=a.createContext(null),j=a.createContext(null),H=a.createContext(null),q=a.createContext({outlet:null,matches:[],isDataRoute:!1}),W=a.createContext(null);function K(){return null!=a.useContext(H)}function z(){return K()||i(!1),a.useContext(H).location}function J(e){a.useContext(j).static||a.useLayoutEffect(e)}function Z(){let{isDataRoute:e}=a.useContext(q);return e?function(){let{router:e}=function(){let e=a.useContext(V);return e||i(!1),e}(re.UseNavigateStable),t=oe(ne.UseNavigateStable),l=a.useRef(!1);return J(()=>{l.current=!0}),a.useCallback(function(a,r){void 0===r&&(r={}),l.current&&("number"==typeof a?e.navigate(a):e.navigate(a,F({fromRouteId:t},r)))},[e,t])}():function(){K()||i(!1);let e=a.useContext(V),{basename:t,future:l,navigator:r}=a.useContext(j),{matches:n}=a.useContext(q),{pathname:o}=z(),s=JSON.stringify(I(n,l.v7_relativeSplatPath)),c=a.useRef(!1);return J(()=>{c.current=!0}),a.useCallback(function(a,l){if(void 0===l&&(l={}),!c.current)return;if("number"==typeof a)return void r.go(a);let n=R(a,JSON.parse(s),o,"path"===l.relative);null==e&&"/"!==t&&(n.pathname="/"===n.pathname?t:B([t,n.pathname])),(l.replace?r.replace:r.push)(n,l.state,l)},[t,r,s,o,e])}()}function Y(){let{matches:e}=a.useContext(q),t=e[e.length-1];return t?t.params:{}}function Q(e,t){let{relative:l}=void 0===t?{}:t,{future:r}=a.useContext(j),{matches:n}=a.useContext(q),{pathname:o}=z(),i=JSON.stringify(I(n,r.v7_relativeSplatPath));return a.useMemo(()=>R(e,JSON.parse(i),o,"path"===l),[e,i,o,l])}function X(e,t,l,r){K()||i(!1);let{navigator:o}=a.useContext(j),{matches:s}=a.useContext(q),c=s[s.length-1],u=c?c.params:{},p=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let m,_=z();if(t){var g;let e="string"==typeof t?d(t):t;"/"===p||(null==(g=e.pathname)?void 0:g.startsWith(p))||i(!1),m=e}else m=_;let h=m.pathname||"/",b=h;if("/"!==p){let e=p.replace(/^\//,"").split("/");b="/"+h.replace(/^\//,"").split("/").slice(e.length).join("/")}let E=v(e,{pathname:b}),f=function(e,t,l,r){var n;if(void 0===t&&(t=[]),void 0===l&&(l=null),void 0===r&&(r=null),null==e){var o;if(!l)return null;if(l.errors)e=l.matches;else{if(!(null!=(o=r)&&o.v7_partialHydration&&0===t.length&&!l.initialized&&l.matches.length>0))return null;e=l.matches}}let s=e,c=null==(n=l)?void 0:n.errors;if(null!=c){let e=s.findIndex(e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id]));e>=0||i(!1),s=s.slice(0,Math.min(s.length,e+1))}let u=!1,p=-1;if(l&&r&&r.v7_partialHydration)for(let e=0;e<s.length;e++){let a=s[e];if((a.route.HydrateFallback||a.route.hydrateFallbackElement)&&(p=e),a.route.id){let{loaderData:e,errors:t}=l,r=a.route.loader&&void 0===e[a.route.id]&&(!t||void 0===t[a.route.id]);if(a.route.lazy||r){u=!0,s=p>=0?s.slice(0,p+1):[s[0]];break}}}return s.reduceRight((e,r,n)=>{let o,i=!1,d=null,m=null;var v;l&&(o=c&&r.route.id?c[r.route.id]:void 0,d=r.route.errorElement||ae,u&&(p<0&&0===n?(ie[v="route-fallback"]||(ie[v]=!0),i=!0,m=null):p===n&&(i=!0,m=r.route.hydrateFallbackElement||null)));let _=t.concat(s.slice(0,n+1)),g=()=>{let t;return t=o?d:i?m:r.route.Component?a.createElement(r.route.Component,null):r.route.element?r.route.element:e,a.createElement(le,{match:r,routeContext:{outlet:e,matches:_,isDataRoute:null!=l},children:t})};return l&&(r.route.ErrorBoundary||r.route.errorElement||0===n)?a.createElement(te,{location:l.location,revalidation:l.revalidation,component:d,error:o,children:g(),routeContext:{outlet:null,matches:_,isDataRoute:!0}}):g()},null)}(E&&E.map(e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:B([p,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?p:B([p,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),s,l,r);return t&&f?a.createElement(H.Provider,{value:{location:F({pathname:"/",search:"",hash:"",state:null,key:"default"},m),navigationType:n.Pop}},f):f}function ee(){let e=function(){var e;let t=a.useContext(W),l=function(){let e=a.useContext(O);return e||i(!1),e}(ne.UseRouteError),r=oe(ne.UseRouteError);return void 0!==t?t:null==(e=l.errors)?void 0:e[r]}(),t=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),l=e instanceof Error?e.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return a.createElement(a.Fragment,null,a.createElement("h2",null,"Unexpected Application Error!"),a.createElement("h3",{style:{fontStyle:"italic"}},t),l?a.createElement("pre",{style:r},l):null,null)}const ae=a.createElement(ee,null);class te extends a.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,a){return a.location!==e.location||"idle"!==a.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:a.error,location:a.location,revalidation:e.revalidation||a.revalidation}}componentDidCatch(e,a){console.error("React Router caught the following error during render",e,a)}render(){return void 0!==this.state.error?a.createElement(q.Provider,{value:this.props.routeContext},a.createElement(W.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function le(e){let{routeContext:t,match:l,children:r}=e,n=a.useContext(V);return n&&n.static&&n.staticContext&&(l.route.errorElement||l.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=l.route.id),a.createElement(q.Provider,{value:t},r)}var re=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(re||{}),ne=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ne||{});function oe(e){let t=function(){let e=a.useContext(q);return e||i(!1),e}(),l=t.matches[t.matches.length-1];return l.route.id||i(!1),l.route.id}const ie={};function se(e){let{to:t,replace:l,state:r,relative:n}=e;K()||i(!1);let{future:o,static:s}=a.useContext(j),{matches:c}=a.useContext(q),{pathname:u}=z(),p=Z(),d=R(t,I(c,o.v7_relativeSplatPath),u,"path"===n),m=JSON.stringify(d);return a.useEffect(()=>p(JSON.parse(m),{replace:l,state:r,relative:n}),[p,m,n,l,r]),null}function ce(e){i(!1)}function ue(e){let{basename:t="/",children:l=null,location:r,navigationType:o=n.Pop,navigator:s,static:c=!1,future:u}=e;K()&&i(!1);let p=t.replace(/^\/*/,"/"),m=a.useMemo(()=>({basename:p,navigator:s,static:c,future:F({v7_relativeSplatPath:!1},u)}),[p,u,s,c]);"string"==typeof r&&(r=d(r));let{pathname:v="/",search:_="",hash:g="",state:h=null,key:b="default"}=r,E=a.useMemo(()=>{let e=T(v,p);return null==e?null:{location:{pathname:e,search:_,hash:g,state:h,key:b},navigationType:o}},[p,v,_,g,h,b,o]);return null==E?null:a.createElement(j.Provider,{value:m},a.createElement(H.Provider,{children:l,value:E}))}function pe(e){let{children:a,location:t}=e;return X(de(a),t)}function de(e,t){void 0===t&&(t=[]);let l=[];return a.Children.forEach(e,(e,r)=>{if(!a.isValidElement(e))return;let n=[...t,r];if(e.type===a.Fragment)return void l.push.apply(l,de(e.props.children,n));e.type!==ce&&i(!1),e.props.index&&e.props.children&&i(!1);let o={id:e.props.id||n.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=de(e.props.children,n)),l.push(o)}),l}function me(){return me=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},me.apply(this,arguments)}function ve(e,a){if(null==e)return{};var t,l,r={},n=Object.keys(e);for(l=0;l<n.length;l++)t=n[l],a.indexOf(t)>=0||(r[t]=e[t]);return r}function _e(e){return void 0===e&&(e=""),new URLSearchParams("string"==typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((a,t)=>{let l=e[t];return a.concat(Array.isArray(l)?l.map(e=>[t,e]):[[t,l]])},[]))}a.startTransition,new Promise(()=>{}),a.Component,new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const ge=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],he=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"];try{window.__reactRouterVersion="6"}catch(e){}const be=a.createContext({isTransitioning:!1});new Map;const Ee=a.startTransition;function fe(e){let{basename:t,children:l,future:m,window:v}=e,_=a.useRef();var g;null==_.current&&(_.current=(void 0===(g={window:v,v5Compat:!0})&&(g={}),function(e,a,t,l){void 0===l&&(l={});let{window:s=document.defaultView,v5Compat:d=!1}=l,m=s.history,v=n.Pop,_=null,g=h();function h(){return(m.state||{idx:null}).idx}function b(){v=n.Pop;let e=h(),a=null==e?null:e-g;g=e,_&&_({action:v,location:f.location,delta:a})}function E(e){let a="null"!==s.location.origin?s.location.origin:s.location.href,t="string"==typeof e?e:p(e);return t=t.replace(/ $/,"%20"),i(a,"No window.location.(origin|href) available to create URL for href: "+t),new URL(t,a)}null==g&&(g=0,m.replaceState(r({},m.state,{idx:g}),""));let f={get action(){return v},get location(){return e(s,m)},listen(e){if(_)throw new Error("A history only accepts one active listener");return s.addEventListener(o,b),_=e,()=>{s.removeEventListener(o,b),_=null}},createHref:e=>a(s,e),createURL:E,encodeLocation(e){let a=E(e);return{pathname:a.pathname,search:a.search,hash:a.hash}},push:function(e,a){v=n.Push;let l=u(f.location,e,a);t&&t(l,e),g=h()+1;let r=c(l,g),o=f.createHref(l);try{m.pushState(r,"",o)}catch(e){if(e instanceof DOMException&&"DataCloneError"===e.name)throw e;s.location.assign(o)}d&&_&&_({action:v,location:f.location,delta:1})},replace:function(e,a){v=n.Replace;let l=u(f.location,e,a);t&&t(l,e),g=h();let r=c(l,g),o=f.createHref(l);m.replaceState(r,"",o),d&&_&&_({action:v,location:f.location,delta:0})},go:e=>m.go(e)};return f}(function(e,a){let{pathname:t="/",search:l="",hash:r=""}=d(e.location.hash.substr(1));return t.startsWith("/")||t.startsWith(".")||(t="/"+t),u("",{pathname:t,search:l,hash:r},a.state&&a.state.usr||null,a.state&&a.state.key||"default")},function(e,a){let t=e.document.querySelector("base"),l="";if(t&&t.getAttribute("href")){let a=e.location.href,t=a.indexOf("#");l=-1===t?a:a.slice(0,t)}return l+"#"+("string"==typeof a?a:p(a))},function(e,a){s("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")},g)));let h=_.current,[b,E]=a.useState({action:h.action,location:h.location}),{v7_startTransition:f}=m||{},y=a.useCallback(e=>{f&&Ee?Ee(()=>E(e)):E(e)},[E,f]);return a.useLayoutEffect(()=>h.listen(y),[h,y]),a.useEffect(()=>{return null==(e=m)||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!a||a.v7_relativeSplatPath),void(a&&(a.v7_fetcherPersist,a.v7_normalizeFormMethod,a.v7_partialHydration,a.v7_skipActionErrorRevalidation));var e,a},[m]),a.createElement(ue,{basename:t,children:l,location:b.location,navigationType:b.action,navigator:h,future:m})}l.flushSync,a.useId;const ye="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,Ne=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Se=a.forwardRef(function(e,t){let l,{onClick:r,relative:n,reloadDocument:o,replace:s,state:c,target:u,to:d,preventScrollReset:m,viewTransition:v}=e,_=ve(e,ge),{basename:g}=a.useContext(j),h=!1;if("string"==typeof d&&Ne.test(d)&&(l=d,ye))try{let e=new URL(window.location.href),a=d.startsWith("//")?new URL(e.protocol+d):new URL(d),t=T(a.pathname,g);a.origin===e.origin&&null!=t?d=t+a.search+a.hash:h=!0}catch(e){}let b=function(e,t){let{relative:l}=void 0===t?{}:t;K()||i(!1);let{basename:r,navigator:n}=a.useContext(j),{hash:o,pathname:s,search:c}=Q(e,{relative:l}),u=s;return"/"!==r&&(u="/"===s?r:B([r,s])),n.createHref({pathname:u,search:c,hash:o})}(d,{relative:n}),E=function(e,t){let{target:l,replace:r,state:n,preventScrollReset:o,relative:i,viewTransition:s}=void 0===t?{}:t,c=Z(),u=z(),d=Q(e,{relative:i});return a.useCallback(a=>{if(function(e,a){return!(0!==e.button||a&&"_self"!==a||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(a,l)){a.preventDefault();let t=void 0!==r?r:p(u)===p(d);c(e,{replace:t,state:n,preventScrollReset:o,relative:i,viewTransition:s})}},[u,c,d,r,n,l,e,o,i,s])}(d,{replace:s,state:c,target:u,preventScrollReset:m,relative:n,viewTransition:v});return a.createElement("a",me({},_,{href:l||b,onClick:h||o?r:function(e){r&&r(e),e.defaultPrevented||E(e)},ref:t,target:u}))}),Ce=a.forwardRef(function(e,t){let{"aria-current":l="page",caseSensitive:r=!1,className:n="",end:o=!1,style:s,to:c,viewTransition:u,children:p}=e,d=ve(e,he),m=Q(c,{relative:d.relative}),v=z(),_=a.useContext(O),{navigator:g,basename:h}=a.useContext(j),b=null!=_&&function(e,t){void 0===t&&(t={});let l=a.useContext(be);null==l&&i(!1);let{basename:r}=function(){let e=a.useContext(V);return e||i(!1),e}(we.useViewTransitionState),n=Q(e,{relative:t.relative});if(!l.isTransitioning)return!1;let o=T(l.currentLocation.pathname,r)||l.currentLocation.pathname,s=T(l.nextLocation.pathname,r)||l.nextLocation.pathname;return null!=x(n.pathname,s)||null!=x(n.pathname,o)}(m)&&!0===u,E=g.encodeLocation?g.encodeLocation(m).pathname:m.pathname,f=v.pathname,y=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;r||(f=f.toLowerCase(),y=y?y.toLowerCase():null,E=E.toLowerCase()),y&&h&&(y=T(y,h)||y);const N="/"!==E&&E.endsWith("/")?E.length-1:E.length;let S,C=f===E||!o&&f.startsWith(E)&&"/"===f.charAt(N),w=null!=y&&(y===E||!o&&y.startsWith(E)&&"/"===y.charAt(E.length)),P={isActive:C,isPending:w,isTransitioning:b},k=C?l:void 0;S="function"==typeof n?n(P):[n,C?"active":null,w?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let M="function"==typeof s?s(P):s;return a.createElement(Se,me({},d,{"aria-current":k,className:S,ref:t,style:M,to:c,viewTransition:u}),"function"==typeof p?p(P):p)});var we,xe;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(we||(we={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(xe||(xe={}));const Pe=window.wp.apiFetch;var Te=e.n(Pe);const ke=window.CASANOVA_GESTION_RESERVAS||{},Me=(ke.restUrl||`${window.location.origin}/wp-json/travel/v1`).replace(/\/$/,""),Ae=(()=>{let e=!1;return()=>{if(e)return;const a=ke.restUrl?ke.restUrl.replace(/\/travel\/v1\/?$/,"/"):ke.apiUrl?ke.apiUrl.replace(/\/travel\/v1\/?$/,"/"):`${window.location.origin}/wp-json/`;a&&Te().use(Te().createRootURLMiddleware(a)),ke.nonce&&Te().use(Te().createNonceMiddleware(ke.nonce)),e=!0}})(),Ie=async(e,a={})=>{const t={"X-WP-Nonce":ke.nonce||"",...a.headers},l={method:a.method||"GET",credentials:"include",headers:t};void 0!==a.body&&(t["Content-Type"]="application/json",l.body=JSON.stringify(a.body));const r=await fetch((e=>{const a=e.replace(/^\/+/,"");return new URL(a,`${Me}/`).toString()})(e),l);return(async e=>{const a=-1!==(e.headers.get("content-type")||"").indexOf("application/json")?await e.json():null;if(e.ok)return a;const t=new Error(a?.message||"No se pudo completar la solicitud");throw t.status=e.status,t})(r)},Re=async(e={})=>{var a,t;const l=await Ie(((e={})=>{var a,t;const l=new URLSearchParams,r=(e,a)=>{null!=a&&""!==a&&l.set(e,String(a))};return r("q",e.search),r("status",e.status),r("sort",e.sortBy||"updated_at"),r("order",e.order||"desc"),r("page",null!==(a=e.page)&&void 0!==a?a:1),r("per_page",null!==(t=e.perPage)&&void 0!==t?t:50),`proposals?${l.toString()}`})(e)),r=Array.isArray(l?.items)?l.items:[];return{items:r,total:"number"==typeof l?.total?l.total:r.length,page:null!==(a=l?.page)&&void 0!==a?a:1,per_page:null!==(t=l?.per_page)&&void 0!==t?t:50}},Be=e=>Ie(`proposals/${e}/detail`),Ge=async e=>e?(Ae(),Te()({path:`/travel/v1/versions/${e}/giav-preflight`,method:"GET"})):Promise.reject(new Error("Versión inválida")),$e=async e=>e?(Ae(),Te()({path:`/travel/v1/proposals/${e}/giav-retry`,method:"POST"})):Promise.reject(new Error("ID de propuesta inválido"));function De(e){return(0,a.createElement)("svg",{viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",...e},(0,a.createElement)("path",{d:"M12 20h9",stroke:"currentColor",strokeLinecap:"round"}),(0,a.createElement)("path",{d:"M16.5 3.5a2.1 2.1 0 0 1 3 3L8 18l-4 1 1-4L16.5 3.5Z",stroke:"currentColor",strokeLinejoin:"round"}))}function Le(e){return(0,a.createElement)("svg",{viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",...e},(0,a.createElement)("path",{d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z",stroke:"currentColor"}),(0,a.createElement)("path",{d:"M3 12h18",stroke:"currentColor",strokeLinecap:"round"}),(0,a.createElement)("path",{d:"M12 3c2.8 3 4.2 6 4.2 9s-1.4 6-4.2 9c-2.8-3-4.2-6-4.2-9S9.2 6 12 3Z",stroke:"currentColor",strokeLinejoin:"round"}))}function Ue(e){return(0,a.createElement)("svg",{viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",...e},(0,a.createElement)("path",{d:"M10 13a5 5 0 0 0 7.1 0l1.4-1.4a5 5 0 0 0-7.1-7.1L10.6 4",stroke:"currentColor",strokeLinecap:"round"}),(0,a.createElement)("path",{d:"M14 11a5 5 0 0 0-7.1 0L5.5 12.4a5 5 0 0 0 7.1 7.1L13.4 20",stroke:"currentColor",strokeLinecap:"round"}))}function Fe({proposal:e}){const t=e?.public_url||"",l=(0,a.useMemo)(()=>`/propuesta/${e?.id}/editar`,[e?.id]),r="undefined"!=typeof navigator&&!!navigator.clipboard,n=!t||!r,o=t?r?"Copiar enlace":"Tu navegador no permite copiar al portapapeles":"No hay enlace público disponible";return(0,a.createElement)("div",{className:"cg-row-actions-inline"},(0,a.createElement)(Se,{to:l,className:"cg-row-actions-inline__icon",title:"Editar propuesta","aria-label":"Editar propuesta"},(0,a.createElement)(De,{className:"cg-row-actions-inline__svg"})),t?(0,a.createElement)("a",{href:t,target:"_blank",rel:"noreferrer",className:"cg-row-actions-inline__icon",title:"Vista pública","aria-label":"Vista pública"},(0,a.createElement)(Le,{className:"cg-row-actions-inline__svg"})):(0,a.createElement)("button",{type:"button",className:"cg-row-actions-inline__icon cg-row-actions-inline__icon--disabled",disabled:!0,title:"No hay vista pública disponible","aria-label":"Vista pública no disponible"},(0,a.createElement)(Le,{className:"cg-row-actions-inline__svg"})),(0,a.createElement)("button",{type:"button",className:"cg-row-actions-inline__icon",onClick:async()=>{if(t&&r)try{await navigator.clipboard.writeText(t)}catch(e){}},disabled:n,title:o,"aria-label":o},(0,a.createElement)(Ue,{className:"cg-row-actions-inline__svg"})))}const Ve={draft:"Borrador",sent:"Enviada",accepted:"Aceptada",queued:"En cola",synced:"Sincronizada",error:"Error",revoked:"Revocada",lost:"Perdida"},Oe=[{value:"all",label:"Todos los estados"},...Object.entries(Ve).map(([e,a])=>({value:e,label:a}))],je=[{key:"id",label:"ID"},{key:"proposal_title",label:"Título"},{key:"customer_name",label:"Cliente"},{key:"author_name",label:"Autor"},{key:"status",label:"Estado"},{key:"updated_at",label:"Última actualización"},{key:"totals_sell_price",label:"Total"}],He=({column:e,sortBy:t,order:l})=>{const r=t===e?l:"none";return(0,a.createElement)("span",{className:`casanova-portal-table__sort-icon is-${r}`,"aria-hidden":"true"})},qe=()=>{const[e,l]=function(e){let t=a.useRef(_e(e)),l=a.useRef(!1),r=z(),n=a.useMemo(()=>function(e,a){let t=_e(e);return a&&a.forEach((e,l)=>{t.has(l)||a.getAll(l).forEach(e=>{t.append(l,e)})}),t}(r.search,l.current?null:t.current),[r.search]),o=Z(),i=a.useCallback((e,a)=>{const t=_e("function"==typeof e?e(n):e);l.current=!0,o("?"+t,a)},[o,n]);return[n,i]}(),r=je.map(e=>e.key),n=e.get("q")||"",o=e.get("status")||"all",i=e.get("sort")||"updated_at",s=(e.get("order")||"desc").toLowerCase(),c=e=>r.includes(e)?e:"updated_at",[u,p]=(0,t.useState)(n),[d,m]=(0,t.useState)(n),[v,_]=(0,t.useState)(o),[g,h]=(0,t.useState)(c(i)),[b,E]=(0,t.useState)("asc"===s?"asc":"desc"),[f,y]=(0,t.useState)([]),[N,S]=(0,t.useState)(!1),[C,w]=(0,t.useState)(""),x=(0,t.useCallback)(async()=>{S(!0),w("");try{const e=await Re({search:d,status:"all"!==v?v:void 0,sortBy:g,order:b});y(e.items)}catch(e){w(e.message||"No se pudo cargar el listado.")}finally{S(!1)}},[d,v,g,b]);return(0,t.useEffect)(()=>{const e=setTimeout(()=>{m(u.trim())},350);return()=>clearTimeout(e)},[u]),(0,t.useEffect)(()=>{const e={};d&&(e.q=d),v&&"all"!==v&&(e.status=v),g&&(e.sort=g),b&&(e.order=b),l(e,{replace:!0}),x()},[d,v,g,b,x,l]),(0,a.createElement)("div",{className:"casanova-portal-section"},(0,a.createElement)("header",{className:"casanova-portal-section__header"},(0,a.createElement)("div",null,(0,a.createElement)("h2",null,"Repositorio de propuestas"),(0,a.createElement)("p",null,"Revisa estados, clientes y detalles sin salir del portal.")),(0,a.createElement)("div",{className:"casanova-portal-section__actions"},(0,a.createElement)(Se,{className:"button-secondary",to:"/nueva"},"Nueva propuesta"),(0,a.createElement)("button",{className:"button-primary",onClick:x,disabled:N},"Refrescar"))),(0,a.createElement)("div",{className:"casanova-portal-filters"},(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Buscar"),(0,a.createElement)("input",{type:"search",value:u,onChange:e=>p(e.target.value),placeholder:"Cliente, email, token o ID"})),(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Estado"),(0,a.createElement)("select",{value:v,onChange:e=>_(e.target.value)},Oe.map(e=>(0,a.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Ordenar por"),(0,a.createElement)("select",{value:g,onChange:e=>h(c(e.target.value))},je.map(e=>(0,a.createElement)("option",{key:e.key,value:e.key},e.label)))),(0,a.createElement)("label",{className:"casanova-portal-filter"},(0,a.createElement)("span",null,"Orden"),(0,a.createElement)("select",{value:b,onChange:e=>E("asc"===e.target.value?"asc":"desc")},(0,a.createElement)("option",{value:"desc"},"Descendente"),(0,a.createElement)("option",{value:"asc"},"Ascendente"))),(0,a.createElement)("div",{className:"casanova-portal-filters__actions"},(0,a.createElement)("button",{className:"button-secondary",onClick:()=>{p(""),_("all"),h("updated_at"),E("desc")}},"Limpiar filtros"))),C?(0,a.createElement)("div",{className:"casanova-portal-section__notice"},(0,a.createElement)("span",null,C)):null,(0,a.createElement)("div",{className:"casanova-portal-table"},(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--header"},je.map(e=>(0,a.createElement)("span",{key:e.key},(0,a.createElement)("button",{type:"button",className:"casanova-portal-table__sort-button",onClick:()=>(e=>{g!==e?(h(e),E("desc")):E(e=>"asc"===e?"desc":"asc")})(e.key)},e.label,(0,a.createElement)(He,{column:e.key,sortBy:g,order:b})))),(0,a.createElement)("span",null,"Acciones")),N?(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--loading"},"Cargando propuestas…"):null,N||0!==f.length?null:(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--empty"},"No hay propuestas que coincidan con los filtros seleccionados."),!N&&f.map(e=>{var t;return(0,a.createElement)("div",{key:e.id,className:"casanova-portal-table__row casanova-portal-table__row--item"},(0,a.createElement)("span",null,"#",e.id),(0,a.createElement)("span",null,e.display_title||e.proposal_title||"Propuesta sin título"),(0,a.createElement)("span",null,e.customer_name||e.customer_email||"—"),(0,a.createElement)("span",null,e.author_name||"—"),(0,a.createElement)("span",null,(0,a.createElement)("span",{className:`status-chip status-chip--${(e.status||"draft").replace(/[^a-z0-9_-]/gi,"-")}`},Ve[e.status]||e.status||"—")),(0,a.createElement)("span",null,(e=>{if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString("es-ES",{dateStyle:"medium",timeStyle:"short"})})(e.updated_at)),(0,a.createElement)("span",null,((e,a)=>{if(null==e)return"—";const t=Number(e);return Number.isNaN(t)?String(e):new Intl.NumberFormat("es-ES",{style:"currency",currency:a||"EUR",maximumFractionDigits:2}).format(t)})(null!==(t=e.current_version_total)&&void 0!==t?t:e.totals_sell_price,e.currency)),(0,a.createElement)("span",{className:"casanova-portal-table__actions"},(0,a.createElement)(Se,{className:"button-secondary casanova-portal-table__action",to:`/propuesta/${e.id}`},"Ver detalle"),(0,a.createElement)(Fe,{proposal:e})))})))},We={admin:"Admin",client:"Cliente"},Ke={none:"No iniciado",pending:"En proceso",ok:"Creado",error:"Error"},ze=e=>{if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString("es-ES",{dateStyle:"medium",timeStyle:"short"})};function Je(){var e;const{proposalId:l}=Y(),r=Z(),[n,o]=(0,t.useState)(null),[i,s]=(0,t.useState)(!1),[c,u]=(0,t.useState)(""),[p,d]=(0,t.useState)(""),[m,v]=(0,t.useState)(""),[_,g]=(0,t.useState)(!1),[h,b]=(0,t.useState)(""),[E,f]=(0,t.useState)(!1),[y,N]=(0,t.useState)(!1),[S,C]=(0,t.useState)(""),w=async()=>{s(!0),u("");try{const e=await Be(l);o(e)}catch(e){u(e?.message||"No se pudo cargar la propuesta.")}finally{s(!1)}};(0,t.useEffect)(()=>{if(!l)return o(null),void u("Propuesta no encontrada.");w()},[l]),(0,t.useEffect)(()=>{const e=n?.proposal?.current_version_id;b(e?String(e):"")},[n?.proposal?.current_version_id]),(0,t.useEffect)(()=>{let e=!1;const a=n?.proposal?.accepted_version_id;if(a)return Ge(a).then(()=>{e||C("")}).catch(a=>{e||(503===(a?.data?.status||a?.status)||(a?.message||a?.data?.message||"").includes("DB"))&&C("La base de datos no está actualizada. Ejecuta migraciones.")}),()=>{e=!0};C("")},[n?.proposal?.accepted_version_id]);const x=n?.proposal,P=n?.versions||[];(0,t.useEffect)(()=>{x&&(x.public_url||n?.current_snapshot?.public_url)&&g(!1)},[x?.public_url]);const T=P.find(e=>Number(e.id)===Number(x?.accepted_version_id)),k=P.find(e=>String(e.id)===h),M=[{value:"",label:"Selecciona una versión"}].concat(P.map(e=>{var a;return{value:String(e.id),label:`#${null!==(a=e.version_number)&&void 0!==a?a:e.id} · ${ze(e.created_at)}`}})),A="confirmed"===x?.confirmation_status?"Confirmada":"pending"===x?.confirmation_status?"Pendiente":"-",I="accepted"===x?.status,R=x?.giav_sync_status||"none",B=Ke[R]||R||"-",G=Boolean(x?.giav_expediente_id),$="pending"===R,D="error"===R,L=[{label:"ID cliente",value:x?.giav_client_id},{label:"ID expediente",value:x?.giav_expediente_id},{label:"ID reserva PQ",value:x?.giav_pq_reserva_id}].filter(e=>e.value),U=async()=>{if(x){N(!0),d(""),v("");try{await $e(x.id),v("error"===x.giav_sync_status?"Solicitud de reintento en GIAV enviada correctamente.":"Expediente solicitado en GIAV."),await w()}catch(e){d(e?.message||"No se pudo crear el expediente en GIAV.")}finally{N(!1)}}};return i&&!x?(0,a.createElement)("div",{className:"casanova-portal-section"},"Cargando detalle…"):c&&!x?(0,a.createElement)("div",{className:"casanova-portal-section"},(0,a.createElement)("div",{className:"casanova-portal-section__notice"},c)):x?(0,a.createElement)("div",{className:"casanova-portal-section"},(0,a.createElement)("header",{className:"casanova-portal-detail__header"},(0,a.createElement)("div",null,(0,a.createElement)("p",{className:"casanova-portal__eyebrow"},"Propuesta #",x.id),(0,a.createElement)("h2",null,x.proposal_title||"Nueva propuesta"),(0,a.createElement)("p",null,x.customer_name," · ",x.customer_email)),(0,a.createElement)("div",{className:"casanova-portal-detail__actions"},(0,a.createElement)("button",{type:"button",className:"button-secondary",onClick:()=>{const e=x.public_url||n?.current_snapshot?.public_url;e&&window.open(e,"_blank","noopener,noreferrer")},disabled:!x.public_url&&!n?.current_snapshot?.public_url},"Abrir vista pública"),(0,a.createElement)("button",{type:"button",className:"button-secondary",onClick:async()=>{const e=x?.public_url||n?.current_snapshot?.public_url;if(e)try{await navigator.clipboard.writeText(e),g(!0),window.setTimeout(()=>g(!1),1500)}catch(e){console.error(e)}},disabled:!x.public_url&&!n?.current_snapshot?.public_url},_?"Copiado":"Copiar enlace"),(0,a.createElement)("button",{type:"button",className:"button-primary",onClick:()=>r("/proposals")},"Volver al listado"))),p&&(0,a.createElement)("div",{className:"casanova-portal-section__notice casanova-portal-section__notice--error"},p),m&&(0,a.createElement)("div",{className:"casanova-portal-section__notice casanova-portal-section__notice--success"},m),(0,a.createElement)("div",{className:"casanova-portal-detail__grid"},(0,a.createElement)("div",{className:"casanova-portal-card"},(0,a.createElement)("h3",null,"Resumen"),(0,a.createElement)("p",null,"Fechas: ",x.start_date||"—"," — ",x.end_date||"—"),(0,a.createElement)("p",null,"Estado: ",x.status||"—"),(0,a.createElement)("p",null,"PAX: ",x.pax_total||0),(0,a.createElement)("p",null,"Jugadores: ",x.players_count||0),(0,a.createElement)("p",null,"Total estimado:"," ",n?.current_version?.totals_sell_price?`${n.current_version.totals_sell_price} ${x.currency||""}`:"—")),(0,a.createElement)("div",{className:"casanova-portal-card"},(0,a.createElement)("h3",null,"Aceptación"),(0,a.createElement)("p",{className:"proposal-detail__helper"},"Estado: ",x.confirmation_status?x.confirmation_status:"Pendiente"),I?(0,a.createElement)("div",{className:"proposal-detail__grid"},(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"proposal-detail__label"},"Versión aceptada"),(0,a.createElement)("div",{className:"proposal-detail__value"},T?`#${null!==(e=T.version_number)&&void 0!==e?e:T.id}`:x.accepted_version_id||"—")),(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"proposal-detail__label"},"Aceptada por"),(0,a.createElement)("div",{className:"proposal-detail__value"},We[x.accepted_by]||x.accepted_by||"—")),(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"proposal-detail__label"},"Fecha de aceptación"),(0,a.createElement)("div",{className:"proposal-detail__value"},ze(x.accepted_at))),(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"proposal-detail__label"},"Confirmación"),(0,a.createElement)("div",{className:"proposal-detail__value"},A))):(0,a.createElement)("div",{className:"proposal-detail__block"},(0,a.createElement)("label",{htmlFor:"proposal-accept-version",className:"proposal-detail__label"},"Versión a aceptar"),(0,a.createElement)("select",{id:"proposal-accept-version",className:"proposal-detail__select",value:h,onChange:e=>b(e.target.value),disabled:E||0===M.length},M.map(e=>(0,a.createElement)("option",{key:e.value,value:e.value},e.label))),(0,a.createElement)("div",{className:"proposal-detail__button-row"},(0,a.createElement)("button",{type:"button",className:"button-primary",onClick:async()=>{if(!x?.id)return void d("No se encontró la propuesta.");if(!k?.id)return void d("Selecciona una versión para aceptar.");const e=k.version_number?`#${k.version_number}`:`#${k.id}`;if(window.confirm(`¿Confirmas que la versión ${e} se marcará como aceptada? Esta acción no se puede deshacer fácilmente.`)){f(!0),d(""),v("");try{await(async(e,a)=>e?a?(Ae(),Te()({path:`/travel/v1/proposals/${e}/accept`,method:"POST",data:{version_id:a}})):Promise.reject(new Error("Selecciona una versión a aceptar")):Promise.reject(new Error("ID de propuesta inválido")))(x.id,k.id),v(`Versión ${e} marcada como aceptada.`),await w()}catch(e){d(e?.message||"No se pudo marcar como aceptada.")}finally{f(!1)}}},disabled:E||!k},E?"Procesando…":"Marcar como aceptada")))),(0,a.createElement)("div",{className:"casanova-portal-card"},(0,a.createElement)("h3",null,"Integración GIAV"),(0,a.createElement)("div",{className:"proposal-detail__section-title"},(0,a.createElement)("span",{className:"proposal-detail__pill proposal-detail__pill--"+("ok"===R?"success":"error"===R?"danger":"pending"===R?"warning":"neutral")},B)),(0,a.createElement)("div",{className:"proposal-detail__block"},L.length>0?(0,a.createElement)("div",{className:"proposal-detail__grid"},L.map(e=>(0,a.createElement)("div",{key:e.label},(0,a.createElement)("div",{className:"proposal-detail__label"},e.label),(0,a.createElement)("div",{className:"proposal-detail__value"},e.value))),x.giav_sync_updated_at&&(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"proposal-detail__label"},"Última actualización"),(0,a.createElement)("div",{className:"proposal-detail__value"},ze(x.giav_sync_updated_at)))):(0,a.createElement)("p",{className:"proposal-detail__helper"},"Aún no hay identificadores de GIAV vinculados."),x.giav_sync_error&&(0,a.createElement)("div",{className:"proposal-detail__error"},(0,a.createElement)("strong",null,"Error:")," ",x.giav_sync_error),(0,a.createElement)("div",{className:"proposal-detail__cta"},I?D&&!G?(0,a.createElement)("button",{type:"button",className:"button-primary",disabled:y||Boolean(S),onClick:U,title:S||"Se reintentará la creación del expediente en GIAV y se actualizará el estado."},y?"Creando…":"Reintentar GIAV"):G||$?$?(0,a.createElement)("span",{className:"proposal-detail__helper"},"En proceso de creación en GIAV."):(0,a.createElement)("span",{className:"proposal-detail__helper"},"Expediente creado y sincronizado."):(0,a.createElement)("button",{type:"button",className:"button-primary",disabled:y||Boolean(S),onClick:U,title:S||"Crear expediente en GIAV. Esta acción puede tardar varios segundos."},y?"Creando…":"Crear expediente en GIAV"):(0,a.createElement)("span",{className:"proposal-detail__helper"},"Necesitas aceptar una versión antes de crear expediente en GIAV."),S&&(0,a.createElement)("p",{className:"proposal-detail__helper"},S))))),(0,a.createElement)("div",{className:"casanova-portal-detail__actions-row"},(0,a.createElement)("button",{type:"button",className:"button-primary",onClick:()=>r("/proposals")},"Editar propuesta"),(0,a.createElement)("button",{type:"button",className:"button-secondary",onClick:()=>{window.open(((e={})=>{const a=new URL(window.location.href);return a.searchParams.set("page","travel_proposals"),a.searchParams.delete("proposal_id"),a.searchParams.delete("action"),Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t?a.searchParams.set(e,t):a.searchParams.delete(e)}),a.toString()})({proposal_id:l,action:"edit"}),"_blank")}},"Abrir wizard en wp-admin")),(0,a.createElement)("div",{className:"casanova-portal-card"},(0,a.createElement)("h3",null,"Versiones"),(0,a.createElement)("div",{className:"casanova-portal-table"},(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--header"},(0,a.createElement)("span",null,"Versión"),(0,a.createElement)("span",null,"Fecha"),(0,a.createElement)("span",null,"Total"),(0,a.createElement)("span",null,"Publicación")),P.length?P.map(e=>{var t,l;return(0,a.createElement)("div",{key:e.id,className:"casanova-portal-table__row"},(0,a.createElement)("span",null,null!==(t=e.version_number)&&void 0!==t?t:e.id),(0,a.createElement)("span",null,ze(e.created_at)),(0,a.createElement)("span",null,null!==(l=e.totals_sell_price)&&void 0!==l?l:"—"),(0,a.createElement)("span",null,e.public_url?(0,a.createElement)("a",{href:e.public_url,target:"_blank",rel:"noreferrer"},"Vista pública"):"—"))}):(0,a.createElement)("div",{className:"casanova-portal-table__row casanova-portal-table__row--empty"},"No hay versiones registradas.")))):null}const Ze=window.wp.components,Ye=window.WP_TRAVEL_GIAV||window.CASANOVA_GESTION_RESERVAS||{};if(!Te().__WP_TRAVEL_GIAV_CONFIGURED){const e=Ye.nonce||"",a=(e=>{if(e.wpRestRoot)return e.wpRestRoot;const a=e.apiUrl||e.restUrl;return a?a.replace(/\/travel\/v1\/?$/,"/"):"/wp-json/"})(Ye);a&&Te().use(Te().createRootURLMiddleware(a)),e&&Te().use(Te().createNonceMiddleware(e)),Te().__WP_TRAVEL_GIAV_CONFIGURED=!0}const Qe={createProposal:e=>Te()({path:"/travel/v1/proposals",method:"POST",data:e}),listProposals:({orderBy:e="updated_at",order:a="desc",limit:t=50,offset:l=0,search:r,author:n,page:o,per_page:i}={})=>{const s=new URLSearchParams;return s.set("order_by",e),s.set("order",a),s.set("limit",t),s.set("offset",l),void 0!==r&&s.set("search",r),void 0!==n&&s.set("author",n),void 0!==o&&s.set("page",o),void 0!==i&&s.set("per_page",i),Te()({path:`/travel/v1/proposals?${s.toString()}`,method:"GET"})},getProposal:e=>Te()({path:`/travel/v1/proposals/${e}`,method:"GET"}),getProposalDetail:e=>Te()({path:`/travel/v1/proposals/${e}/detail`,method:"GET"}),updateProposal:(e,a)=>Te()({path:`/travel/v1/proposals/${e}`,method:"PUT",data:a}),deleteProposal:e=>Te()({path:`/travel/v1/proposals/${e}`,method:"DELETE"}),bulkDeleteProposals:e=>Te()({path:"/travel/v1/proposals/bulk-delete",method:"POST",data:{ids:e}}),sendProposal:(e,a,t)=>Te()({path:`/travel/v1/proposals/${e}/send`,method:"POST",data:{snapshot:a,version_number:t}}),createProposalVersion:(e,a,t)=>Te()({path:`/travel/v1/proposals/${e}/versions`,method:"POST",data:{snapshot:a,version_number:t}}),setCurrentVersion:(e,a)=>Te()({path:`/travel/v1/proposals/${e}/current-version`,method:"POST",data:{version_id:a}}),acceptProposal:(e,a)=>Te()({path:`/travel/v1/proposals/${e}/accept`,method:"POST",data:{version_id:a}}),retryGiavSync:e=>Te()({path:`/travel/v1/proposals/${e}/giav-retry`,method:"POST"}),searchCatalog:({type:e,q:a})=>Te()({path:`/travel/v1/catalog/search?type=${encodeURIComponent(e)}&q=${encodeURIComponent(a||"")}`,method:"GET"}),getGiavMapping:({wp_object_type:e,wp_object_id:a})=>Te()({path:`/travel/v1/giav-mapping?wp_object_type=${encodeURIComponent(e)}&wp_object_id=${encodeURIComponent(a)}`,method:"GET"}),listGiavMappings:({type:e,q:a,limit:t=50,offset:l=0})=>Te()({path:`/travel/v1/giav-mapping/list?type=${encodeURIComponent(e)}&q=${encodeURIComponent(a||"")}&limit=${encodeURIComponent(t)}&offset=${encodeURIComponent(l)}`,method:"GET"}),upsertGiavMapping:e=>Te()({path:"/travel/v1/giav-mapping/upsert",method:"POST",data:e}),batchUpsertGiavMappings:({wp_object_type:e,giav_supplier_id:a,items:t,status:l="active",match_type:r="batch"})=>Te()({path:"/travel/v1/giav-mapping/batch-upsert",method:"POST",data:{wp_object_type:e,giav_supplier_id:a,items:t,status:l,match_type:r}}),searchGiavProviders:async({q:e,pageSize:a=20,pageIndex:t=0,includeDisabled:l=!1})=>{const r=await Te()({path:`/travel/v1/giav/providers/search?q=${encodeURIComponent(e)}&pageSize=${encodeURIComponent(a)}&pageIndex=${encodeURIComponent(t)}&includeDisabled=${encodeURIComponent(l)}`,method:"GET"});return{items:(Array.isArray(r)?r:Array.isArray(r?.items)?r.items:[]).map(e=>{var a,t,l,r,n,o,i,s;return{id:String(null!==(a=null!==(t=null!==(l=null!==(r=e.id)&&void 0!==r?r:e.ID)&&void 0!==l?l:e.Id)&&void 0!==t?t:e.proveedorId)&&void 0!==a?a:""),label:String(null!==(n=null!==(o=null!==(i=null!==(s=e.label)&&void 0!==s?s:e.NombreAlias)&&void 0!==i?i:e.Nombre)&&void 0!==o?o:e.title)&&void 0!==n?n:""),raw:e}}).filter(e=>e.id&&e.label)}},giavPreflight:e=>Te()({path:`/travel/v1/versions/${e}/giav-preflight`,method:"GET"}),confirmGiav:e=>Te()({path:`/travel/v1/versions/${e}/confirm`,method:"POST"})},Xe=[{label:"Español",value:"es"},{label:"English",value:"en"}],ea=[{label:"EUR",value:"EUR"},{label:"USD",value:"USD"},{label:"GBP",value:"GBP"}],aa=[{value:"AF",label:"Afghanistan (AF)"},{value:"AL",label:"Albania (AL)"},{value:"DZ",label:"Algeria (DZ)"},{value:"AS",label:"American Samoa (AS)"},{value:"AD",label:"Andorra (AD)"},{value:"AO",label:"Angola (AO)"},{value:"AI",label:"Anguilla (AI)"},{value:"AQ",label:"Antarctica (AQ)"},{value:"AG",label:"Antigua and Barbuda (AG)"},{value:"AR",label:"Argentina (AR)"},{value:"AM",label:"Armenia (AM)"},{value:"AW",label:"Aruba (AW)"},{value:"AU",label:"Australia (AU)"},{value:"AT",label:"Austria (AT)"},{value:"AZ",label:"Azerbaijan (AZ)"},{value:"BS",label:"Bahamas (BS)"},{value:"BH",label:"Bahrain (BH)"},{value:"BD",label:"Bangladesh (BD)"},{value:"BB",label:"Barbados (BB)"},{value:"BY",label:"Belarus (BY)"},{value:"BE",label:"Belgium (BE)"},{value:"BZ",label:"Belize (BZ)"},{value:"BJ",label:"Benin (BJ)"},{value:"BM",label:"Bermuda (BM)"},{value:"BT",label:"Bhutan (BT)"},{value:"BO",label:"Bolivia (BO)"},{value:"BQ",label:"Bonaire, Sint Eustatius and Saba (BQ)"},{value:"BA",label:"Bosnia and Herzegovina (BA)"},{value:"BW",label:"Botswana (BW)"},{value:"BV",label:"Bouvet Island (BV)"},{value:"BR",label:"Brazil (BR)"},{value:"IO",label:"British Indian Ocean Territory (IO)"},{value:"BN",label:"Brunei (BN)"},{value:"BG",label:"Bulgaria (BG)"},{value:"BF",label:"Burkina Faso (BF)"},{value:"BI",label:"Burundi (BI)"},{value:"KH",label:"Cambodia (KH)"},{value:"CM",label:"Cameroon (CM)"},{value:"CA",label:"Canada (CA)"},{value:"CV",label:"Cape Verde (CV)"},{value:"KY",label:"Cayman Islands (KY)"},{value:"CF",label:"Central African Republic (CF)"},{value:"TD",label:"Chad (TD)"},{value:"CL",label:"Chile (CL)"},{value:"CN",label:"China (CN)"},{value:"CX",label:"Christmas Island (CX)"},{value:"CC",label:"Cocos (Keeling) Islands (CC)"},{value:"CO",label:"Colombia (CO)"},{value:"KM",label:"Comoros (KM)"},{value:"CG",label:"Congo (CG)"},{value:"CD",label:"Congo (Democratic Republic) (CD)"},{value:"CK",label:"Cook Islands (CK)"},{value:"CR",label:"Costa Rica (CR)"},{value:"CI",label:"Côte d’Ivoire (CI)"},{value:"HR",label:"Croatia (HR)"},{value:"CU",label:"Cuba (CU)"},{value:"CW",label:"Curaçao (CW)"},{value:"CY",label:"Cyprus (CY)"},{value:"CZ",label:"Czechia (CZ)"},{value:"DK",label:"Denmark (DK)"},{value:"DJ",label:"Djibouti (DJ)"},{value:"DM",label:"Dominica (DM)"},{value:"DO",label:"Dominican Republic (DO)"},{value:"EC",label:"Ecuador (EC)"},{value:"EG",label:"Egypt (EG)"},{value:"SV",label:"El Salvador (SV)"},{value:"GQ",label:"Equatorial Guinea (GQ)"},{value:"ER",label:"Eritrea (ER)"},{value:"EE",label:"Estonia (EE)"},{value:"ET",label:"Ethiopia (ET)"},{value:"FK",label:"Falkland Islands (FK)"},{value:"FO",label:"Faroe Islands (FO)"},{value:"FJ",label:"Fiji (FJ)"},{value:"FI",label:"Finland (FI)"},{value:"FR",label:"France (FR)"},{value:"GF",label:"French Guiana (GF)"},{value:"PF",label:"French Polynesia (PF)"},{value:"TF",label:"French Southern Territories (TF)"},{value:"GA",label:"Gabon (GA)"},{value:"GM",label:"Gambia (GM)"},{value:"GE",label:"Georgia (GE)"},{value:"DE",label:"Germany (DE)"},{value:"GH",label:"Ghana (GH)"},{value:"GI",label:"Gibraltar (GI)"},{value:"GR",label:"Greece (GR)"},{value:"GL",label:"Greenland (GL)"},{value:"GD",label:"Grenada (GD)"},{value:"GP",label:"Guadeloupe (GP)"},{value:"GU",label:"Guam (GU)"},{value:"GT",label:"Guatemala (GT)"},{value:"GG",label:"Guernsey (GG)"},{value:"GN",label:"Guinea (GN)"},{value:"GW",label:"Guinea-Bissau (GW)"},{value:"GY",label:"Guyana (GY)"},{value:"HT",label:"Haiti (HT)"},{value:"HM",label:"Heard Island and McDonald Islands (HM)"},{value:"HN",label:"Honduras (HN)"},{value:"HK",label:"Hong Kong (HK)"},{value:"HU",label:"Hungary (HU)"},{value:"IS",label:"Iceland (IS)"},{value:"IN",label:"India (IN)"},{value:"ID",label:"Indonesia (ID)"},{value:"IR",label:"Iran (IR)"},{value:"IQ",label:"Iraq (IQ)"},{value:"IE",label:"Ireland (IE)"},{value:"IM",label:"Isle of Man (IM)"},{value:"IL",label:"Israel (IL)"},{value:"IT",label:"Italy (IT)"},{value:"JM",label:"Jamaica (JM)"},{value:"JP",label:"Japan (JP)"},{value:"JE",label:"Jersey (JE)"},{value:"JO",label:"Jordan (JO)"},{value:"KZ",label:"Kazakhstan (KZ)"},{value:"KE",label:"Kenya (KE)"},{value:"KI",label:"Kiribati (KI)"},{value:"KP",label:"Korea (North) (KP)"},{value:"KR",label:"Korea (South) (KR)"},{value:"KW",label:"Kuwait (KW)"},{value:"KG",label:"Kyrgyzstan (KG)"},{value:"LA",label:"Laos (LA)"},{value:"LV",label:"Latvia (LV)"},{value:"LB",label:"Lebanon (LB)"},{value:"LS",label:"Lesotho (LS)"},{value:"LR",label:"Liberia (LR)"},{value:"LY",label:"Libya (LY)"},{value:"LI",label:"Liechtenstein (LI)"},{value:"LT",label:"Lithuania (LT)"},{value:"LU",label:"Luxembourg (LU)"},{value:"MO",label:"Macao (MO)"},{value:"MG",label:"Madagascar (MG)"},{value:"MW",label:"Malawi (MW)"},{value:"MY",label:"Malaysia (MY)"},{value:"MV",label:"Maldives (MV)"},{value:"ML",label:"Mali (ML)"},{value:"MT",label:"Malta (MT)"},{value:"MH",label:"Marshall Islands (MH)"},{value:"MQ",label:"Martinique (MQ)"},{value:"MR",label:"Mauritania (MR)"},{value:"MU",label:"Mauritius (MU)"},{value:"YT",label:"Mayotte (YT)"},{value:"MX",label:"Mexico (MX)"},{value:"FM",label:"Micronesia (FM)"},{value:"MD",label:"Moldova (MD)"},{value:"MC",label:"Monaco (MC)"},{value:"MN",label:"Mongolia (MN)"},{value:"ME",label:"Montenegro (ME)"},{value:"MS",label:"Montserrat (MS)"},{value:"MA",label:"Morocco (MA)"},{value:"MZ",label:"Mozambique (MZ)"},{value:"MM",label:"Myanmar (MM)"},{value:"NA",label:"Namibia (NA)"},{value:"NR",label:"Nauru (NR)"},{value:"NP",label:"Nepal (NP)"},{value:"NL",label:"Netherlands (NL)"},{value:"NC",label:"New Caledonia (NC)"},{value:"NZ",label:"New Zealand (NZ)"},{value:"NI",label:"Nicaragua (NI)"},{value:"NE",label:"Niger (NE)"},{value:"NG",label:"Nigeria (NG)"},{value:"NU",label:"Niue (NU)"},{value:"NF",label:"Norfolk Island (NF)"},{value:"MK",label:"North Macedonia (MK)"},{value:"MP",label:"Northern Mariana Islands (MP)"},{value:"NO",label:"Norway (NO)"},{value:"OM",label:"Oman (OM)"},{value:"PK",label:"Pakistan (PK)"},{value:"PW",label:"Palau (PW)"},{value:"PS",label:"Palestine (PS)"},{value:"PA",label:"Panama (PA)"},{value:"PG",label:"Papua New Guinea (PG)"},{value:"PY",label:"Paraguay (PY)"},{value:"PE",label:"Peru (PE)"},{value:"PH",label:"Philippines (PH)"},{value:"PN",label:"Pitcairn (PN)"},{value:"PL",label:"Poland (PL)"},{value:"PT",label:"Portugal (PT)"},{value:"PR",label:"Puerto Rico (PR)"},{value:"QA",label:"Qatar (QA)"},{value:"RE",label:"Réunion (RE)"},{value:"RO",label:"Romania (RO)"},{value:"RU",label:"Russia (RU)"},{value:"RW",label:"Rwanda (RW)"},{value:"BL",label:"Saint Barthélemy (BL)"},{value:"SH",label:"Saint Helena (SH)"},{value:"KN",label:"Saint Kitts and Nevis (KN)"},{value:"LC",label:"Saint Lucia (LC)"},{value:"MF",label:"Saint Martin (MF)"},{value:"PM",label:"Saint Pierre and Miquelon (PM)"},{value:"VC",label:"Saint Vincent and the Grenadines (VC)"},{value:"WS",label:"Samoa (WS)"},{value:"SM",label:"San Marino (SM)"},{value:"ST",label:"São Tomé and Príncipe (ST)"},{value:"SA",label:"Saudi Arabia (SA)"},{value:"SN",label:"Senegal (SN)"},{value:"RS",label:"Serbia (RS)"},{value:"SC",label:"Seychelles (SC)"},{value:"SL",label:"Sierra Leone (SL)"},{value:"SG",label:"Singapore (SG)"},{value:"SX",label:"Sint Maarten (SX)"},{value:"SK",label:"Slovakia (SK)"},{value:"SI",label:"Slovenia (SI)"},{value:"SB",label:"Solomon Islands (SB)"},{value:"SO",label:"Somalia (SO)"},{value:"ZA",label:"South Africa (ZA)"},{value:"GS",label:"South Georgia and the South Sandwich Islands (GS)"},{value:"SS",label:"South Sudan (SS)"},{value:"ES",label:"Spain (ES)"},{value:"LK",label:"Sri Lanka (LK)"},{value:"SD",label:"Sudan (SD)"},{value:"SR",label:"Suriname (SR)"},{value:"SJ",label:"Svalbard and Jan Mayen (SJ)"},{value:"SE",label:"Sweden (SE)"},{value:"CH",label:"Switzerland (CH)"},{value:"SY",label:"Syria (SY)"},{value:"TW",label:"Taiwan (TW)"},{value:"TJ",label:"Tajikistan (TJ)"},{value:"TZ",label:"Tanzania (TZ)"},{value:"TH",label:"Thailand (TH)"},{value:"TL",label:"Timor-Leste (TL)"},{value:"TG",label:"Togo (TG)"},{value:"TK",label:"Tokelau (TK)"},{value:"TO",label:"Tonga (TO)"},{value:"TT",label:"Trinidad and Tobago (TT)"},{value:"TN",label:"Tunisia (TN)"},{value:"TR",label:"Turkey (TR)"},{value:"TM",label:"Turkmenistan (TM)"},{value:"TC",label:"Turks and Caicos Islands (TC)"},{value:"TV",label:"Tuvalu (TV)"},{value:"UG",label:"Uganda (UG)"},{value:"UA",label:"Ukraine (UA)"},{value:"AE",label:"United Arab Emirates (AE)"},{value:"GB",label:"United Kingdom (GB)"},{value:"US",label:"United States (US)"},{value:"UM",label:"United States Minor Outlying Islands (UM)"},{value:"UY",label:"Uruguay (UY)"},{value:"UZ",label:"Uzbekistan (UZ)"},{value:"VU",label:"Vanuatu (VU)"},{value:"VA",label:"Vatican City (VA)"},{value:"VE",label:"Venezuela (VE)"},{value:"VN",label:"Vietnam (VN)"},{value:"VG",label:"Virgin Islands (British) (VG)"},{value:"VI",label:"Virgin Islands (US) (VI)"},{value:"WF",label:"Wallis and Futuna (WF)"},{value:"EH",label:"Western Sahara (EH)"},{value:"YE",label:"Yemen (YE)"},{value:"ZM",label:"Zambia (ZM)"},{value:"ZW",label:"Zimbabwe (ZW)"}];function ta(){return(new Date).toISOString().slice(0,10)}function la({id:e,label:l,value:r,onChange:n,className:o="",fieldRef:i}){const[s,c]=(0,t.useState)(!1),[u,p]=(0,t.useState)(null),d=function(e){if(!e)return"";const[a,t,l]=e.split("-");return a&&t&&l?`${l}/${t}/${a}`:e}(r);return(0,a.createElement)("div",{className:`proposal-basics__field ${o}`.trim(),ref:e=>{"function"==typeof i&&i(e)}},(0,a.createElement)(Ze.TextControl,{id:e,label:l,value:d,onClick:e=>{p(e.currentTarget),c(!0)},onFocus:e=>{p(e.currentTarget),c(!0)},readOnly:!0,placeholder:"DD/MM/AAAA"}),s&&u&&(0,a.createElement)(Ze.Popover,{anchor:u,placement:"bottom-start",className:"proposal-basics__date-popover",onClose:()=>{c(!1),p(null)}},(0,a.createElement)(Ze.DatePicker,{currentDate:r||ta(),onChange:e=>{const a=function(e){if(!e)return"";if(e instanceof Date&&!Number.isNaN(e.getTime()))return e.toISOString().slice(0,10);if("string"==typeof e){if(e.includes("/")){const[a,t,l]=e.split("/");if(a&&t&&l)return`${l.padStart(4,"0")}-${t.padStart(2,"0")}-${a.padStart(2,"0")}`}return e.slice(0,10)}return""}(e);a&&n(a),c(!1)}})))}function ra({initialValues:e={},onCreated:l,onNext:r,proposalId:n}){var o;const i=(0,t.useMemo)(()=>{var a,t;return{proposal_title:"",customer_name:"",customer_email:"",customer_country:"",customer_language:"es",start_date:ta(),end_date:ta(),pax_total:1,players_count:null!==(a=null!==(t=e.players_count)&&void 0!==t?t:e.pax_total)&&void 0!==a?a:1,currency:"EUR",...e}},[e]),[s,c]=(0,t.useState)(i),[u,p]=(0,t.useState)(!1),[d,m]=(0,t.useState)(""),[v,_]=(0,t.useState)(""),[g,h]=(0,t.useState)(""),b=(0,t.useRef)({});(0,t.useEffect)(()=>{c(e=>({...e,...i}))},[i]),(0,t.useEffect)(()=>(window.fillProposalBasics=(e={})=>{c(a=>({...a,proposal_title:"string"==typeof e.title?e.title:a.proposal_title,customer_name:"string"==typeof e.name?e.name:a.customer_name,customer_email:"string"==typeof e.email?e.email:a.customer_email,customer_country:"string"==typeof e.country?e.country.toUpperCase():a.customer_country,customer_language:"string"==typeof e.language?e.language:a.customer_language}))},()=>{delete window.fillProposalBasics}),[]);const E=e=>a=>{c(t=>({...t,[e]:a})),_(a=>a===e?"":a)},f=e=>a=>{a&&(b.current[e]=a)},y=(0,t.useMemo)(()=>{if(!g)return aa;const e=g.toLowerCase();return aa.filter(a=>a.label.toLowerCase().includes(e)||a.value.toLowerCase().includes(e))},[g]),N=parseInt(s.pax_total,10),S=parseInt(s.players_count,10),C=Number.isFinite(N)?Math.max(0,N-(Number.isFinite(S)?S:0)):0;return(0,a.createElement)(Ze.Card,null,(0,a.createElement)(Ze.CardHeader,null,(0,a.createElement)("strong",null,"Datos básicos")),(0,a.createElement)(Ze.CardBody,null,d&&(0,a.createElement)(Ze.Notice,{status:"error",isDismissible:!0,onRemove:()=>{m(""),_("")}},d),(0,a.createElement)("div",{className:"proposal-basics"},(0,a.createElement)("div",{className:"proposal-basics__section"},(0,a.createElement)("div",{className:"proposal-basics__section-title"},"Identidad de la propuesta"),(0,a.createElement)("div",{className:"proposal-basics__grid"},(0,a.createElement)("div",{className:("proposal-basics__field proposal-basics__field--full "+("proposal_title"===v?"is-error":"")).trim(),ref:f("proposal_title")},(0,a.createElement)(Ze.TextControl,{label:"Título de la propuesta",value:s.proposal_title,onChange:E("proposal_title"),placeholder:"Escapada a la Costa del Sol"})),(0,a.createElement)("div",{className:("proposal-basics__field "+("customer_name"===v?"is-error":"")).trim(),ref:f("customer_name")},(0,a.createElement)(Ze.TextControl,{label:"Nombre del cliente *",value:s.customer_name,onChange:E("customer_name"),placeholder:"John Smith"})),(0,a.createElement)("div",{className:("proposal-basics__field "+("customer_email"===v?"is-error":"")).trim(),ref:f("customer_email")},(0,a.createElement)(Ze.TextControl,{label:"Email",value:s.customer_email,onChange:E("customer_email"),placeholder:"john@email.com"})))),(0,a.createElement)("div",{className:"proposal-basics__section"},(0,a.createElement)("div",{className:"proposal-basics__section-title"},"Fechas y pasajeros"),(0,a.createElement)("div",{className:"proposal-basics__grid proposal-basics__grid--dates"},(0,a.createElement)(la,{label:"Fecha inicio *",value:s.start_date,onChange:e=>{c(a=>{const t={...a,start_date:e};return t.end_date&&e&&t.end_date<e&&(t.end_date=e),t}),window.setTimeout(()=>{const e=document.getElementById("wp-travel-end-date");if(e&&(e.focus(),"function"==typeof e.showPicker))try{e.showPicker()}catch(e){}},0)},className:"start_date"===v?"is-error":"",fieldRef:f("start_date")}),(0,a.createElement)("div",{className:"proposal-basics__date-arrow","aria-hidden":"true"},"→"),(0,a.createElement)(la,{id:"wp-travel-end-date",label:"Fecha fin *",value:s.end_date,onChange:e=>{c(a=>a.start_date&&e&&e<a.start_date?{...a,end_date:a.start_date}:{...a,end_date:e})},className:"end_date"===v?"is-error":"",fieldRef:f("end_date")}),(0,a.createElement)("div",{className:("proposal-basics__field proposal-basics__field--pax "+("pax_total"===v?"is-error":"")).trim(),ref:f("pax_total")},(0,a.createElement)(Ze.TextControl,{label:"Pax *",type:"number",min:1,value:String(s.pax_total),onChange:E("pax_total")})),(0,a.createElement)("div",{className:("proposal-basics__field proposal-basics__field--pax "+("players_count"===v?"is-error":"")).trim(),ref:f("players_count")},(0,a.createElement)(Ze.TextControl,{label:"Jugadores",type:"number",min:0,value:String(null!==(o=s.players_count)&&void 0!==o?o:""),onChange:E("players_count"),help:`No jugadores: ${C}`})))),(0,a.createElement)("div",{className:"proposal-basics__section"},(0,a.createElement)("div",{className:"proposal-basics__section-title"},"Preferencias"),(0,a.createElement)("div",{className:"proposal-basics__grid"},(0,a.createElement)("div",{className:("proposal-basics__field "+("customer_language"===v?"is-error":"")).trim(),ref:f("customer_language")},(0,a.createElement)(Ze.SelectControl,{label:"Idioma",value:s.customer_language,options:Xe,onChange:E("customer_language")})),(0,a.createElement)("div",{className:("proposal-basics__field "+("customer_country"===v?"is-error":"")).trim(),ref:f("customer_country")},(0,a.createElement)(Ze.ComboboxControl,{label:"País",value:s.customer_country,options:y,onFilterValueChange:h,onChange:e=>E("customer_country")(e?e.toUpperCase():""),placeholder:"Busca país o código"})),(0,a.createElement)("div",{className:("proposal-basics__field "+("currency"===v?"is-error":"")).trim(),ref:f("currency")},(0,a.createElement)(Ze.SelectControl,{label:"Moneda",value:s.currency,options:ea,onChange:E("currency")}))))),(0,a.createElement)("div",{className:"proposal-basics__actions"},(0,a.createElement)(Ze.Button,{variant:"primary",onClick:async()=>{const e=(()=>{if(!s.customer_name?.trim())return{message:"El nombre del cliente es obligatorio.",field:"customer_name"};if(!s.start_date)return{message:"La fecha de inicio es obligatoria.",field:"start_date"};if(!s.end_date)return{message:"La fecha de fin es obligatoria.",field:"end_date"};if(s.end_date<s.start_date)return{message:"La fecha fin no puede ser anterior a la fecha inicio.",field:"end_date"};const e=parseInt(s.pax_total,10);if(Number.isNaN(e)||e<1)return{message:"Pax debe ser un numero >= 1.",field:"pax_total"};const a=parseInt(s.players_count,10);return Number.isNaN(a)||a<0?{message:"Jugadores debe ser un numero >= 0.",field:"players_count"}:a>e?{message:"Jugadores no puede ser mayor que Pax.",field:"players_count"}:s.customer_email&&!/^\S+@\S+\.\S+$/.test(s.customer_email)?{message:"El email no parece valido (si lo rellenas, que sea correcto).",field:"customer_email"}:s.customer_country&&2!==s.customer_country.length?{message:"Pais debe ser ISO2 (2 letras) o vacio.",field:"customer_country"}:null})();if(e)return m(e.message),_(e.field||""),void(e=>{const a=b.current[e];if(!a)return;a.scrollIntoView({behavior:"smooth",block:"center"});const t=a.querySelector("input, select, textarea, button");t&&"function"==typeof t.focus&&t.focus()})(e.field);p(!0),m("");const a={...s,pax_total:parseInt(s.pax_total,10),players_count:Math.max(0,parseInt(s.players_count,10)),customer_country:s.customer_country?s.customer_country.toUpperCase():""};try{if(n)return await Qe.updateProposal(n,a),void r?.({basics:a});const e=await Qe.createProposal(a);l?.({proposalId:e.proposal_id,basics:a})}catch(e){m(e?.message||"Error creando la propuesta.")}finally{p(!1)}},disabled:u},d?"Revisa los campos marcados":"Continuar"),u&&(0,a.createElement)(Ze.Spinner,null))))}function na({label:e,type:l,valueTitle:r,onPick:n}){const[o,i]=(0,t.useState)(r||""),[s,c]=(0,t.useState)(!1),[u,p]=(0,t.useState)(!1),[d,m]=(0,t.useState)([]);return(0,t.useEffect)(()=>{i(r||"")},[r]),(0,t.useEffect)(()=>{if(!s)return;let e=!0;return p(!0),Qe.searchCatalog({type:l,q:o}).then(a=>e&&m(Array.isArray(a)?a:[])).catch(()=>e&&m([])).finally(()=>e&&p(!1)),()=>{e=!1}},[o,s,l]),(0,a.createElement)("div",{style:{position:"relative",width:"100%",maxWidth:320,minWidth:0}},(0,a.createElement)(Ze.TextControl,{label:e,value:o,onChange:e=>{i(e),c(!0)},onFocus:()=>c(!0),placeholder:"hotel"===l?"Buscar hotel…":"Buscar campo…"}),s&&(0,a.createElement)("div",{style:{position:"absolute",zIndex:30,background:"#fff",border:"1px solid #ddd",borderRadius:8,width:"100%",maxHeight:220,overflow:"auto",boxShadow:"0 6px 18px rgba(0,0,0,.08)"}},u&&(0,a.createElement)("div",{style:{padding:8}},(0,a.createElement)(Ze.Spinner,null)),!u&&0===d.length&&(0,a.createElement)("div",{style:{padding:8,fontSize:12,opacity:.6}},"Sin resultados"),!u&&d.map(e=>(0,a.createElement)("button",{key:e.id,type:"button",onClick:()=>{n(e),c(!1)},style:{display:"block",width:"100%",padding:"8px 10px",border:0,background:"transparent",textAlign:"left",cursor:"pointer"}},e.title))))}function oa({valueId:e,valueLabel:t,onSelect:l,disabled:r=!1,placeholder:n="Buscar proveedor en GIAV..."}){const[o,i]=(0,a.useState)(t||""),[s,c]=(0,a.useState)([]),[u,p]=(0,a.useState)(!1),[d,m]=(0,a.useState)(!1),[v,_]=(0,a.useState)(""),g=(0,a.useRef)(null);(0,a.useEffect)(()=>{t&&t!==o&&i(t)},[t]);return(0,a.createElement)("div",{style:{position:"relative"}},(0,a.createElement)("input",{type:"text",value:o,onChange:e=>{return a=e.target.value,i(a),p(!0),clearTimeout(g.current),void(g.current=setTimeout(()=>(async e=>{const a=(e||"").trim();if(a.length<2)return c([]),_(""),void p(!1);m(!0),_("");try{const e=await Qe.searchGiavProviders({q:a,pageSize:20,pageIndex:0,includeDisabled:!1}),t=(Array.isArray(e)?e:Array.isArray(e?.items)?e.items:[]).map(e=>{var a,t,l,r,n,o,i,s;return{id:String(null!==(a=null!==(t=null!==(l=null!==(r=e.id)&&void 0!==r?r:e.Id)&&void 0!==l?l:e.ID)&&void 0!==t?t:e.proveedorId)&&void 0!==a?a:""),label:String(null!==(n=null!==(o=null!==(i=null!==(s=e.label)&&void 0!==s?s:e.NombreAlias)&&void 0!==i?i:e.Nombre)&&void 0!==o?o:e.title)&&void 0!==n?n:"")}}).filter(e=>e.id&&e.label);c(t),p(t.length>0)}catch(e){_(e?.message||"Error buscando proveedores en GIAV"),c([]),p(!1)}finally{m(!1)}})(a),250));var a},onFocus:()=>{s.length>0&&p(!0)},placeholder:n,disabled:r,style:{width:"100%"}}),(0,a.createElement)("div",{style:{fontSize:12,marginTop:6,opacity:.8}},e?(0,a.createElement)(a.Fragment,null,"ID seleccionado: ",(0,a.createElement)("strong",null,e)):null,d?(0,a.createElement)("span",{style:{marginLeft:10}},"Buscando…"):null,v?(0,a.createElement)("span",{style:{marginLeft:10,color:"crimson"}},v):null),u&&s.length>0&&(0,a.createElement)("div",{style:{position:"absolute",zIndex:20,top:"100%",left:0,right:0,background:"#fff",border:"1px solid #ddd",borderTop:"none",maxHeight:260,overflow:"auto"}},s.map(e=>(0,a.createElement)("div",{key:e.id,onMouseDown:a=>{a.preventDefault(),(e=>{i(e.label),p(!1),c([]),_(""),l?.(e)})(e)},style:{padding:"10px 12px",cursor:"pointer",borderBottom:"1px solid #f0f0f0"}},(0,a.createElement)("div",{style:{fontWeight:600}},e.label),(0,a.createElement)("div",{style:{fontSize:12,opacity:.75}},"ID: ",e.id)))))}const ia="1734698",sa="Proveedores varios",ca=[{label:"Hotel",value:"hotel"},{label:"Golf",value:"golf"},{label:"Transfer",value:"transfer"},{label:"Extra",value:"extra"},{label:"Paquete",value:"package"}],ua=[{label:"Alojamiento y Desayuno",value:"AD"},{label:"Solo Alojamiento",value:"SA"},{label:"Media Pensión",value:"MP"},{label:"Pensión Completa",value:"PC"},{label:"Todo Incluido",value:"TI"},{label:"Según Programa",value:"SP"}];function pa(e){const a=parseFloat(String(e).replace(",","."));return Number.isFinite(a)?a:0}function da(e,a=1){const t=parseInt(e,10);return Number.isFinite(t)?t:a}function ma(e){return Math.round(100*(e+Number.EPSILON))/100}function va(e,a){return function(e,a){if(!e||!a)return 0;const t=new Date(`${e}T00:00:00`),l=new Date(`${a}T00:00:00`)-t;return!Number.isFinite(l)||l<=0?0:Math.round(l/864e5)}(e.start_date||a?.start_date||"",e.end_date||a?.end_date||"")}function _a(e=0){return{double:{enabled:!0,rooms:1,pricing_basis:"per_room",net_price_per_night:"",margin_pct:e,pvp_manual_enabled:!1,pvp_price_per_night:"",nights_payable:0,free_nights_applied:0,discount_pct_applied:0,total_net:0,total_pvp:0},single:{enabled:!1,rooms:0,pricing_basis:"per_room",net_price_per_night:"",margin_pct:e,pvp_manual_enabled:!1,pvp_price_per_night:"",nights_payable:0,free_nights_applied:0,discount_pct_applied:0,total_net:0,total_pvp:0}}}function ga(e,a,t){const l=Math.max(0,da(null!=a?a:0,0)),r=Math.max(0,da(null!=t?t:0,0));if(l<=0||r<=0||e<=0)return{freeNights:0,nightsPayable:Math.max(0,e)};const n=Math.floor(e/l),o=Math.min(e,n*r);return{freeNights:o,nightsPayable:Math.max(0,e-o)}}function ha(e,a=0){var t,l;const r=e?.start_date||"",n=e?.end_date||"",o=_a(a);return{service_type:"hotel",title:"",start_date:r,end_date:n,hotel_room_type:"",hotel_regimen:"",hotel_rooms:0,hotel_rate_basis:null,hotel_regimen:"",quantity:1,green_fees_per_person:1,number_of_players:null!==(t=null!==(l=e?.players_count)&&void 0!==l?l:e?.pax_total)&&void 0!==t?t:1,total_green_fees:0,unit_cost_net:"",unit_sell_price:"",use_markup:!0,markup_pct:a,lock_sell_price:!1,notes_public:"",notes_internal:"",package_components_text:"",display_name:"",use_manual_entry:!1,wp_object_type:null,wp_object_id:null,giav_entity_type:null,giav_entity_id:null,giav_supplier_id:ia,giav_supplier_name:sa,giav_mapping_status:"needs_review",show_supplier_picker:!1,supplier_override:!1,dates_inherited:!0,room_pricing:o,discounts:{discount_pct:0,free_nights_every:"",free_nights_count:""},giav_pricing:{giav_total_pvp:0,giav_total_net:0,giav_source:"double",giav_locked:!1}}}function ba(e,a,t){var l,r;const n={...e};n.start_date||(n.start_date=a?.start_date||""),n.end_date||(n.end_date=a?.end_date||""),n.quantity=Math.max(1,da(n.quantity,1)),void 0!==n.hotel_rooms&&(n.hotel_rooms=Math.max(0,da(n.hotel_rooms,0))),n.unit_cost_net=Math.max(0,pa(n.unit_cost_net));const o=n.use_markup?Math.max(0,pa(null!==(l=null!==(r=n.markup_pct)&&void 0!==r?r:t)&&void 0!==l?l:0)):0;var i,s;if(n.markup_pct=o,n.lock_sell_price?n.unit_sell_price=Math.max(0,pa(n.unit_sell_price)):n.unit_sell_price=(i=n.unit_cost_net,s=o,ma(Math.max(0,pa(i))*(1+Math.max(0,pa(s))/100))),"hotel"===n.service_type){const e=va(n,a);n.hotel_nights=e;const t=function(e,a,t){var l,r,n,o,i;const s=va(e,a),c=Math.max(0,da(null!==(l=e.hotel_rooms)&&void 0!==l?l:0,0)),u=function(e={}){var a,t,l,r;return{discount_pct:(r=pa(null!==(a=e.discount_pct)&&void 0!==a?a:0),Number.isFinite(r)?Math.min(50,Math.max(0,r)):0),free_nights_every:Math.max(0,da(null!==(t=e.free_nights_every)&&void 0!==t?t:0,0))||"",free_nights_count:Math.max(0,da(null!==(l=e.free_nights_count)&&void 0!==l?l:0,0))||""}}(e.discounts),{freeNights:p,nightsPayable:d}=ga(s,u.free_nights_every,u.free_nights_count),m=e.use_markup?pa(null!==(r=null!==(n=e.markup_pct)&&void 0!==n?n:t)&&void 0!==r?r:0):0,v=e.room_pricing||_a(t),_=(e,a)=>{var t,l,r;const n=v?.[e]||{},o=null!==(t=a.net_price_per_night)&&void 0!==t?t:0,i=null!==(l=a.pvp_price_per_night)&&void 0!==l?l:0,s=void 0!==n.net_price_per_night&&""!==n.net_price_per_night,c=void 0!==n.pvp_price_per_night&&""!==n.pvp_price_per_night,p=void 0!==n.margin_pct&&""!==n.margin_pct,d=void 0!==n.rooms&&""!==n.rooms;return{enabled:"boolean"==typeof n.enabled?n.enabled:a.enabled,rooms:d?Math.max(0,da(null!==(r=n.rooms)&&void 0!==r?r:0,0)):a.rooms,pricing_basis:n.pricing_basis||a.pricing_basis,net_price_per_night:s?pa(n.net_price_per_night):o,margin_pct:p?pa(n.margin_pct):a.margin_pct,pvp_manual_enabled:"boolean"==typeof n.pvp_manual_enabled?n.pvp_manual_enabled:a.pvp_manual_enabled,pvp_price_per_night:c?pa(n.pvp_price_per_night):i,nights_payable:0,free_nights_applied:0,discount_pct_applied:u.discount_pct,total_net:0,total_pvp:0}},g={enabled:!1,rooms:0,pricing_basis:"per_room",net_price_per_night:0,margin_pct:m,pvp_manual_enabled:!1,pvp_price_per_night:0},h={double:_("double",{enabled:!0,rooms:c>0?c:1,pricing_basis:"per_room",net_price_per_night:null!==(o=e.unit_cost_net)&&void 0!==o?o:0,margin_pct:m,pvp_manual_enabled:!!e.lock_sell_price,pvp_price_per_night:null!==(i=e.unit_sell_price)&&void 0!==i?i:0}),single:_("single",g)},b=["double","single"].map(e=>{var a;const t=h[e];if(!t.enabled)return{totalNet:0,totalPvp:0};const l=Math.max(0,da(null!==(a=t.rooms)&&void 0!==a?a:0,0)),r="double"===e&&t.pricing_basis||"per_room",n="per_person"===r?2*l:l,o=Math.max(0,t.net_price_per_night)*d*n*(1-u.discount_pct/100),i=t.pvp_manual_enabled?Math.max(0,t.pvp_price_per_night)*d*n:o*(1+Math.max(0,t.margin_pct)/100);return h[e]={...t,pricing_basis:r,nights_payable:d,free_nights_applied:p,discount_pct_applied:u.discount_pct,total_net:ma(o),total_pvp:ma(i)},{totalNet:ma(o),totalPvp:ma(i)}}),E=b.reduce((e,a)=>e+a.totalNet,0),f=b.reduce((e,a)=>e+a.totalPvp,0),y=["double","single"].filter(e=>h[e].enabled),N=1===y.length?y[0]:"custom",S={...e.giav_pricing,giav_total_net:ma(E),giav_total_pvp:e.giav_pricing?.giav_locked?ma(pa(e.giav_pricing?.giav_total_pvp)):ma(f),giav_source:e.giav_pricing?.giav_locked?"custom":N,giav_locked:!!e.giav_pricing?.giav_locked};return{discounts:u,roomPricing:h,giavPricing:S,totals:{nights:s,nightsPayable:d,freeNights:p,totalNet:ma(E),totalPvp:ma(f)}}}(n,a,o);n.room_pricing=t.roomPricing,n.discounts=t.discounts,n.giav_pricing=t.giavPricing,n.line_cost_net=t.totals.totalNet,n.line_sell_price=t.giavPricing.giav_total_pvp,n.quantity=1,n.unit_cost_net=t.totals.totalNet,n.unit_sell_price=t.giavPricing.giav_total_pvp}else if("golf"===n.service_type){var c;const e=Math.max(0,da(null!==(c=a?.players_count)&&void 0!==c?c:0,0)),t=e>0?e:1,{greenFeesPerPerson:l,totalGreenFees:r}=function(e={},a=1){var t,l,r;const n=Math.max(1,da(a,1));let o=Math.max(0,da(null!==(t=e.green_fees_per_person)&&void 0!==t?t:0,0)),i=Math.max(0,da(null!==(l=e.total_green_fees)&&void 0!==l?l:0,0));const s=Math.max(0,da(null!==(r=e.quantity)&&void 0!==r?r:0,0));return o>0?i=o*n:i>0?(o=Math.max(1,Math.round(i/n)),i=o*n):s>0?(i=s,o=Math.max(1,Math.round(i/n)),i=o*n):(o=1,i=o*n),{greenFeesPerPerson:o,totalGreenFees:i}}(n,t);n.number_of_players=e,n.green_fees_per_person=l,n.total_green_fees=r,n.quantity=r,n.line_cost_net=ma(r*n.unit_cost_net),n.line_sell_price=ma(r*n.unit_sell_price)}else n.line_cost_net=ma(n.quantity*n.unit_cost_net),n.line_sell_price=ma(n.quantity*n.unit_sell_price);return n}function Ea({item:e,idx:t,updateItem:l,currency:r,pax:n,basics:o,globalMarkupPct:i}){var s,c,u,p,d,m,v;const _=e.room_pricing||_a(i),g=_a(i),h=e=>_[e]||g[e],b=Math.max(0,da(null!==(s=h("double").rooms)&&void 0!==s?s:0,0)),E=Math.max(0,da(null!==(c=h("single").rooms)&&void 0!==c?c:0,0)),f=(h("double").enabled?2*b:0)+(h("single").enabled?E:0),y=f-n,N=y<0?`Faltan ${Math.abs(y)} pax por asignar a habitaciones`:y>0?`Sobran ${y} pax asignados`:"",S=Math.max(0,da(null!==(u=e.hotel_nights)&&void 0!==u?u:va(e,o),0)),{nightsPayable:C}=ga(S,e.discounts?.free_nights_every,e.discounts?.free_nights_count),w=function(e={}){var a,t,l;const r=Math.max(0,pa(null!==(a=e.discount_pct)&&void 0!==a?a:0)),n=Math.max(0,da(null!==(t=e.free_nights_every)&&void 0!==t?t:0,0)),o=Math.max(0,da(null!==(l=e.free_nights_count)&&void 0!==l?l:0,0)),i=[];return r>0&&i.push(`-${ma(r)}%`),n>0&&o>0&&i.push(`+${o} gratis cada ${n}`),i.length>0?i.join(" "):"Sin descuentos"}(e.discounts),x=e.notes_public||e.notes_internal?"Ver notas":"Sin notas",P=(a,r)=>{const n=e.room_pricing||{},o={...n[a]||{},...r},i={...n,[a]:o};l(t,{room_pricing:i})},T=(a,r)=>{const n=e.discounts||{};l(t,{discounts:{...n,[a]:r}})};return(0,a.createElement)("div",{className:"service-card__hotel-panel"},(0,a.createElement)("div",{className:"service-card__hotel-occupancy"},["double","single"].map(e=>{var t,l,n,o;const s="double"===e?"Doble":"Individual",c=h(e);return(0,a.createElement)("div",{key:e,className:"service-card__hotel-occupancy-card"},(0,a.createElement)("div",{className:"service-card__hotel-occupancy-header"},(0,a.createElement)(Ze.ToggleControl,{label:`Cotizar ${s.toLowerCase()}`,checked:!!c.enabled,onChange:()=>P(e,{enabled:!c.enabled})}),(0,a.createElement)("span",{className:"service-card__hotel-occupancy-label"},s)),c.enabled&&(0,a.createElement)("div",{className:"service-card__hotel-occupancy-body"},(0,a.createElement)(Ze.TextControl,{label:`Habitaciones ${s.toLowerCase()}`,type:"number",min:1,value:String(null!==(t=c.rooms)&&void 0!==t?t:""),onChange:a=>P(e,{rooms:a})}),"double"===e&&(0,a.createElement)(Ze.SelectControl,{label:"Precio",value:c.pricing_basis||"per_room",options:[{label:"Por habitación",value:"per_room"},{label:"Por persona",value:"per_person"}],onChange:e=>P("double",{pricing_basis:e})}),(0,a.createElement)(Ze.TextControl,{label:`Neto por noche (${s.toLowerCase()})`,value:String(null!==(l=c.net_price_per_night)&&void 0!==l?l:""),onChange:a=>P(e,{net_price_per_night:a}),placeholder:"120"}),(0,a.createElement)("details",{className:"service-card__hotel-mode-details"},(0,a.createElement)("summary",null,"Margen y PVP"),(0,a.createElement)("div",{className:"service-card__hotel-mode-details-grid"},(0,a.createElement)(Ze.ToggleControl,{label:"PVP manual",checked:!!c.pvp_manual_enabled,onChange:()=>P(e,{pvp_manual_enabled:!c.pvp_manual_enabled})}),c.pvp_manual_enabled?(0,a.createElement)(Ze.TextControl,{label:`PVP por noche (${s.toLowerCase()})`,value:String(null!==(n=c.pvp_price_per_night)&&void 0!==n?n:""),onChange:a=>P(e,{pvp_price_per_night:a}),placeholder:"165"}):(0,a.createElement)(Ze.TextControl,{label:"Margen (%)",type:"number",min:0,value:String(null!==(o=c.margin_pct)&&void 0!==o?o:i),onChange:a=>P(e,{margin_pct:a})}))),(0,a.createElement)("div",{className:"service-card__hotel-total"},"Total hab. ",s.toLowerCase(),": ",r," ",ma(c.total_pvp||0).toFixed(2))))})),(0,a.createElement)("div",{className:"service-card__hotel-allocation"},(0,a.createElement)("div",{className:"service-card__hotel-allocation-text"},"Personas asignadas: ",f," de ",n),N&&(0,a.createElement)(Ze.Notice,{status:"warning",isDismissible:!1},N)),(0,a.createElement)("div",{className:"service-card__subcard"},(0,a.createElement)("details",{className:"service-card__hotel-discounts-collapse"},(0,a.createElement)("summary",{className:"service-card__section-summary"},(0,a.createElement)("span",{className:"service-card__section-summary-title"},"Descuentos"),(0,a.createElement)("span",{className:"service-card__section-summary-meta"},w)),(0,a.createElement)("div",{className:"service-card__hotel-discounts"},(0,a.createElement)("div",{className:"service-card__hotel-discounts-grid"},(0,a.createElement)(Ze.TextControl,{label:"Descuento (%)",type:"number",min:0,max:50,value:String(null!==(p=e.discounts?.discount_pct)&&void 0!==p?p:0),onChange:e=>T("discount_pct",e)}),(0,a.createElement)(Ze.TextControl,{label:"Noches gratis (cada)",type:"number",min:0,value:String(null!==(d=e.discounts?.free_nights_every)&&void 0!==d?d:""),onChange:e=>T("free_nights_every",e)}),(0,a.createElement)(Ze.TextControl,{label:"Noches gratis (cantidad)",type:"number",min:0,value:String(null!==(m=e.discounts?.free_nights_count)&&void 0!==m?m:""),onChange:e=>T("free_nights_count",e)})),S>0&&(0,a.createElement)("div",{className:"service-card__hotel-discount-summary"},"Se cobran ",C," noches de ",S)))),(0,a.createElement)("div",{className:"service-card__subcard service-card__subcard--giav"},(0,a.createElement)("div",{className:"service-card__hotel-giav"},(0,a.createElement)("div",{className:"service-card__hotel-subtitle"},"Total para GIAV"),(0,a.createElement)("div",{className:"service-card__hotel-giav-grid"},(0,a.createElement)("div",{className:"service-card__hotel-giav-total"},(0,a.createElement)("div",{className:"service-card__hotel-giav-label"},"Total alojamiento (para GIAV)"),(0,a.createElement)("div",{className:"service-card__hotel-giav-value"},r," ",ma(e.giav_pricing?.giav_total_pvp||0).toFixed(2))),(0,a.createElement)(Ze.ToggleControl,{label:"Editar total para GIAV",checked:!!e.giav_pricing?.giav_locked,onChange:()=>{const a=e.giav_pricing||{};l(t,{giav_pricing:{...a,giav_locked:!a.giav_locked}})}}),(0,a.createElement)(Ze.TextControl,{label:"Total editable",value:String(null!==(v=e.giav_pricing?.giav_total_pvp)&&void 0!==v?v:""),onChange:a=>(a=>{const r=e.giav_pricing||{};l(t,{giav_pricing:{...r,giav_total_pvp:a}})})(a),disabled:!e.giav_pricing?.giav_locked}),e.giav_pricing?.giav_locked&&(0,a.createElement)(Ze.Notice,{status:"warning",isDismissible:!1},"Este total se enviará a GIAV. No se recalculará automáticamente.")))),(0,a.createElement)("div",{className:"service-card__subcard"},(0,a.createElement)("details",{className:"service-card__hotel-notes"},(0,a.createElement)("summary",{className:"service-card__section-summary"},(0,a.createElement)("span",{className:"service-card__section-summary-title"},"Notas"),(0,a.createElement)("span",{className:"service-card__section-summary-meta"},x)),(0,a.createElement)("div",{className:"service-card__hotel-notes-grid"},(0,a.createElement)(Ze.TextControl,{label:"Notas para el cliente (itinerario)",value:e.notes_public||"",onChange:e=>l(t,{notes_public:e}),placeholder:"Incluye desayuno. Check-in 15:00."}),(0,a.createElement)(Ze.TextControl,{label:"Notas internas (solo uso interno)",value:e.notes_internal||"",onChange:e=>l(t,{notes_internal:e}),placeholder:"Neto negociado, release 14D."})))))}function fa(e=[],a={}){if(!Array.isArray(e)||!e.length)return e;const t=a?.start_date||"",l=a?.end_date||"";let r=!1;const n=e.map(e=>e&&e.dates_inherited?e.start_date===t&&e.end_date===l?e:(r=!0,{...e,start_date:t,end_date:l,dates_inherited:!0}):e);return r?n:e}function ya({basics:e,initialItems:l=[],onBack:r,onNext:n,onDraftChange:o}){var i,s;const c=e?.currency||"EUR",u=Math.max(1,da(null!==(i=e?.pax_total)&&void 0!==i?i:1,1)),p=Math.max(0,da(null!==(s=e?.players_count)&&void 0!==s?s:0,0)),[d,m]=(0,t.useState)(20),[v,_]=(0,t.useState)(!0),[g,h]=(0,t.useState)(""),[b,E]=(0,t.useState)(null),[f,y]=(0,t.useState)(null),[N,S]=(0,t.useState)(0),[C,w]=(0,t.useState)(null),[x,P]=(0,t.useState)(!1),[T,k]=(0,t.useState)([]),M=(0,t.useRef)(null),[A,I]=(0,t.useState)(()=>(l.length?l:[ha(e,20)]).map(a=>{const t={...a},l="boolean"==typeof t.dates_inherited,r=t.start_date||e?.start_date||"",n=t.end_date||e?.end_date||"";return t.start_date||(t.start_date=r),t.end_date||(t.end_date=n),t.dates_inherited=l?t.dates_inherited:r===(e?.start_date||"")&&n===(e?.end_date||""),ba(t,e,20)})),R=(0,t.useMemo)(()=>function(e){const a=e.reduce((e,a)=>(e.cost+=a.line_cost_net||0,e.sell+=a.line_sell_price||0,e),{cost:0,sell:0}),t=ma(a.sell-a.cost),l=a.sell>0?ma(t/a.sell*100):0;return{totals_cost_net:ma(a.cost),totals_sell_price:ma(a.sell),totals_margin_abs:t,totals_margin_pct:l}}(A),[A]);(0,t.useEffect)(()=>{if(!o)return;const e=window.setTimeout(()=>{o({items:A,totals:R})},200);return()=>window.clearTimeout(e)},[A,R,o]);const B=(0,t.useMemo)(()=>{var a,t,l;const r=Math.max(0,da(null!==(a=e?.pax_total)&&void 0!==a?a:0,0)),n=da(null!==(t=null!==(l=e?.players_count)&&void 0!==l?l:r)&&void 0!==t?t:0,0),o=Math.min(Math.max(n,0),r),i={paxTotal:r,playersCount:o,nonPlayersCount:Math.max(0,r-o),golfTotal:0,totalDouble:0,totalSingle:0,doubleRooms:0,singleRooms:0};A.forEach(e=>{if("golf"===e.service_type&&(i.golfTotal+=pa(e.line_sell_price||0)),"hotel"===e.service_type){const l=e.room_pricing||{};var a,t;l.double?.enabled&&(i.totalDouble+=pa(l.double?.total_pvp||0),i.doubleRooms+=Math.max(0,da(null!==(a=l.double?.rooms)&&void 0!==a?a:0,0))),l.single?.enabled&&(i.totalSingle+=pa(l.single?.total_pvp||0),i.singleRooms+=Math.max(0,da(null!==(t=l.single?.rooms)&&void 0!==t?t:0,0)))}});const s=pa(R.totals_sell_price||0),c=s,u=i.doubleRooms>0?i.totalDouble/(2*i.doubleRooms):0,p=i.singleRooms>0?i.totalSingle/i.singleRooms:0,d=i.totalDouble||0,m=i.totalSingle||0,v=i.golfTotal||0,_=s-(d+m)-v,g=u+(i.paxTotal>0?_/i.paxTotal:0),h=i.playersCount>0?g+v/i.playersCount:null,b=i.doubleRooms>0&&i.singleRooms>0;let E=null;return b&&(E=Math.max(0,p-u)),{...i,totalTrip:s,baseTotal:c,priceNonPlayerDouble:g,pricePlayerDouble:h,supplementSingle:E,hasSingleSupplement:b}},[e?.pax_total,e?.players_count,A,R.totals_sell_price]);(0,t.useEffect)(()=>{I(a=>{const t=fa(a,e);return t===a?a:t.map((t,l)=>t===a[l]?t:ba(t,e,d))})},[e?.start_date,e?.end_date,d,e]),(0,t.useEffect)(()=>{I(a=>a.map(a=>ba(a,e,d)))},[u]),(0,t.useEffect)(()=>{null!=N&&N>=A.length&&S(A.length?A.length-1:null)},[A.length,N]),(0,t.useEffect)(()=>{if(null==C)return;const e=document.querySelector(`[data-service-index="${C}"]`);if(!e)return;e.scrollIntoView({behavior:"smooth",block:"start"}),((e,a)=>{if(!e)return;if(!a?.service_type){const a=e.querySelector("select");if(a&&"function"==typeof a.focus)return void a.focus()}const t=e.querySelector(".service-card__grid--context input");t&&"function"==typeof t.focus?t.focus():V(e)})(e,A[C]),y(C);const a=window.setTimeout(()=>y(null),1200);return w(null),()=>window.clearTimeout(a)},[C,A]);const G=(a,t)=>{I(l=>{const r=[...l],n={...r[a],...t};return r[a]=ba(n,e,d),r})},$=(0,t.useMemo)(()=>A.map((e,a)=>(e=>{const a=[],t={};if((e.title||e.display_name||"").trim()||(a.push("Falta título"),t.title="Completa el título."),"hotel"!==e.service_type&&"golf"!==e.service_type||e.giav_supplier_id||(a.push("Falta proveedor"),t.supplier="Selecciona un proveedor."),"hotel"===e.service_type){var l,r,n;const o=e.room_pricing||{},i=!!o.double?.enabled,s=!!o.single?.enabled;i||s||(a.push("Activa doble/individual"),t.pricing="Activa doble y/o individual.");const c=(e,a)=>{var t;const l=o[e]||{};return l.enabled?da(null!==(t=l.rooms)&&void 0!==t?t:0,0)<1?`Habitaciones ${a} < 1`:pa(l.net_price_per_night)<=0?`Neto ${a} faltante`:l.pvp_manual_enabled&&pa(l.pvp_price_per_night)<=0?`PVP manual ${a} faltante`:"":""},p=c("double","doble"),d=c("single","individual");(p||d)&&(a.push(p||d),t.pricing="Revisa pricing de habitaciones.");const m=i?Math.max(0,da(null!==(l=o.double?.rooms)&&void 0!==l?l:0,0)):0,v=s?Math.max(0,da(null!==(r=o.single?.rooms)&&void 0!==r?r:0,0)):0;(i?2*m:0)+(s?v:0)!==u&&(a.push("Pax no cuadra"),t.pricing="Ajusta pax doble/individual."),pa(null!==(n=e.giav_pricing?.giav_total_pvp)&&void 0!==n?n:0)<=0&&(a.push("Total GIAV faltante"),t.pricing="Completa total GIAV.")}"golf"===e.service_type&&da(e.green_fees_per_person,1)<1&&(a.push("Green-fees faltante"),t.greenFees="Define green-fees por jugador."),["transfer","extra","package"].includes(e.service_type)&&da(e.quantity,1)<1&&(a.push("Cantidad inválida"),t.quantity="Cantidad debe ser >= 1."),pa(e.unit_sell_price)<=0&&(a.push("PVP unitario faltante"),t.unitSell="Define PVP unitario.");const o=("hotel"===e.service_type||"golf"===e.service_type)&&["needs_review","missing"].includes(e.giav_mapping_status);return{issues:a,fieldErrors:t,status:a.length>0?"error":o?"pending":"completed",hasMappingWarning:o}})(e)),[A,u]),D=e=>{S(e),E(e),window.setTimeout(()=>{const a=document.querySelector(`[data-service-index="${e}"]`);a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),V(a))},50)},L=e=>{G(e,{show_supplier_picker:!A[e].show_supplier_picker})},U=e=>!!e.show_supplier_picker,F=()=>{const e=[],a=[];return $.forEach((e,t)=>{e.issues.length>0&&a.push({index:t,title:`Servicio ${t+1}`,details:e.issues.slice(0,2).join(" · ")})}),A.some(e=>"golf"===e.service_type)&&p<=0&&e.push('Define "Jugadores" en Datos básicos.'),R.totals_sell_price<=0&&e.push("El PVP total debe ser > 0."),{errors:e,serviceErrors:a}},V=e=>{if(!e)return;const a=e.querySelector("input, select, textarea, button");a&&"function"==typeof a.focus&&a.focus()},O=(0,t.useMemo)(()=>F(),[$,A,p,R.totals_sell_price]),j=O.serviceErrors.length>0||O.errors.length>0,H=(e,{missing:t,tooltip:l}={})=>t?(0,a.createElement)("span",{className:"services-summary__value services-summary__value--missing",title:l},"—"):(0,a.createElement)("span",{className:"services-summary__value"},e);return(0,t.useEffect)(()=>{x&&(j||(h(""),k([])))},[x,j]),(0,a.createElement)(Ze.Card,{className:"services-step"},(0,a.createElement)(Ze.CardHeader,null,(0,a.createElement)("div",{className:"services-step__title"},(0,a.createElement)("strong",null,"Servicios & precios"),(0,a.createElement)("span",{className:"services-step__subtitle"},"Añade servicios con detalle, márgenes y proveedor."))),(0,a.createElement)(Ze.CardBody,{ref:M},(0,a.createElement)("div",{className:"services-toolbar"},(0,a.createElement)("div",{className:"services-toolbar__controls"},(0,a.createElement)(Ze.TextControl,{label:"Margen por defecto (%)",type:"number",min:0,value:String(d),onChange:e=>m(pa(e))}),(0,a.createElement)(Ze.ToggleControl,{label:"Aplicar a nuevas líneas",checked:v,onChange:()=>_(e=>!e)}),(0,a.createElement)(Ze.Button,{variant:"secondary",onClick:()=>{I(a=>a.map(a=>ba({...a,markup_pct:d},e,d)))}},"Aplicar a todas")),(0,a.createElement)("div",{className:"services-toolbar__summary"},(0,a.createElement)("div",{className:"services-toolbar__label"},"PVP total"),(0,a.createElement)("div",{className:"services-toolbar__value"},c," ",R.totals_sell_price.toFixed(2)))),(0,a.createElement)("div",{className:"services-items"},A.map((t,l)=>{var r,n,o;const i=N===l,s=$[l]||{issues:[],status:"pending",hasMappingWarning:!1,fieldErrors:{}},m=s.status,v=(a=>{const t=a.start_date||e?.start_date||"",l=a.end_date||e?.end_date||"",r=t&&l?`${t} → ${l}`:"Fechas por definir",n=`${c} ${ma(a.line_sell_price||0).toFixed(2)}`;return"golf"===a.service_type?`${r} · Jugadores: ${p||u} · ${n}`:"hotel"===a.service_type?`${r} · Pax: ${u} · ${n}`:["transfer","extra","package"].includes(a.service_type)?`Cantidad: ${da(null!==(o=a.quantity)&&void 0!==o?o:1,1)} · ${n}`:`${r} · ${n}`;var o})(t),_=s.hasMappingWarning?"Proveedor GIAV pendiente":"",g=s.issues.slice(0,2).join(" · "),h=s.fieldErrors||{};return(0,a.createElement)("div",{key:l,className:`service-card service-card--status-${m} ${i?"is-open":""} ${b===l?"is-error":""} ${f===l?"is-highlighted":""}`.trim(),"data-service-index":l},(0,a.createElement)("div",{className:"service-card__header"},(0,a.createElement)("div",{className:"service-card__title"},(0,a.createElement)("div",{className:"service-card__eyebrow"},"Servicio ",l+1),(0,a.createElement)("div",{className:"service-card__name"},ca.find(e=>e.value===t.service_type)?.label||"Servicio"," ·"," ",t.title?.trim()||t.display_name?.trim()||"Sin título"),(0,a.createElement)("div",{className:"service-card__summary"},v),"pending"===m&&_&&(0,a.createElement)("div",{className:"service-card__missing"},_),"error"===m&&g&&(0,a.createElement)("div",{className:"service-card__missing"},g)),(0,a.createElement)("div",{className:"service-card__meta"},(0,a.createElement)("div",{className:`service-card__badge service-card__badge--${m}`},"completed"===m&&"✓ OK","pending"===m&&"Pendiente","error"===m&&`${s.issues.length} errores`),(0,a.createElement)(Ze.Button,{variant:"tertiary",className:"service-card__toggle",onClick:()=>S(i?null:l)},i?"Ocultar":"Ver detalle"),(0,a.createElement)("div",{className:"service-card__total"},(0,a.createElement)("span",null,"Total línea"),(0,a.createElement)("strong",null,c," ",ma(t.line_sell_price||0).toFixed(2))),(0,a.createElement)(Ze.Button,{variant:"tertiary",onClick:()=>(e=>{I(a=>a.filter((a,t)=>t!==e)),S(a=>null==a?a:a===e?Math.max(0,e-1):a>e?a-1:a)})(l),disabled:1===A.length},"Eliminar"))),i&&(0,a.createElement)("div",{className:"service-card__content"},(0,a.createElement)("div",{className:"service-card__section"},(0,a.createElement)("div",{className:"service-card__section-title"},"Selección y contexto"),(0,a.createElement)("div",{className:"service-card__grid service-card__grid--context"},(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.SelectControl,{label:"Tipo de servicio",value:t.service_type,options:ca,onChange:e=>G(l,{service_type:e})})),"hotel"===t.service_type||"golf"===t.service_type?(0,a.createElement)(a.Fragment,null,t.use_manual_entry?(0,a.createElement)("div",{className:"service-card__field "+(h.title?"is-error":"")},(0,a.createElement)(Ze.TextControl,{label:"hotel"===t.service_type?"Hotel (manual) *":"Campo de golf (manual) *",value:t.display_name||"",onChange:e=>G(l,{display_name:e,title:e}),placeholder:"hotel"===t.service_type?"Ej: Hotel X (fuera de cat├ílogo)":"Ej: Campo Y (fuera de cat├ílogo)"}),h.title&&(0,a.createElement)("div",{className:"service-card__field-error"},h.title)):(0,a.createElement)("div",{className:"service-card__field "+(h.title?"is-error":"")},(0,a.createElement)(na,{label:"hotel"===t.service_type?"Hotel":"Campo de golf",type:"hotel"===t.service_type?"hotel":"golf",valueTitle:t.title,onPick:async e=>{const a="hotel"===t.service_type?"hotel":"course";G(l,{title:e.title,display_name:e.title,wp_object_type:a,wp_object_id:e.id,supplier_override:!1});try{const t=await Qe.getGiavMapping({wp_object_type:a,wp_object_id:e.id});var r,n;t?.status&&"missing"!==t.status?G(l,{giav_mapping_status:t.status,giav_entity_type:t.giav_entity_type,giav_entity_id:t.giav_entity_id,giav_supplier_id:null!==(r=t.giav_supplier_id)&&void 0!==r?r:ia,giav_supplier_name:null!==(n=t.giav_supplier_name)&&void 0!==n?n:sa}):G(l,{giav_mapping_status:"needs_review",giav_entity_type:"supplier",giav_entity_id:ia,giav_supplier_id:ia,giav_supplier_name:sa})}catch{G(l,{giav_mapping_status:"needs_review",giav_entity_type:"supplier",giav_entity_id:ia,giav_supplier_id:ia,giav_supplier_name:sa})}}}),h.title&&(0,a.createElement)("div",{className:"service-card__field-error"},h.title)),(0,a.createElement)("div",{className:"service-card__field service-card__field--toggle"},(0,a.createElement)(Ze.ToggleControl,{label:"Entrada manual (fuera de catálogo)",checked:!!t.use_manual_entry,onChange:()=>{if(t.use_manual_entry)G(l,{use_manual_entry:!1,wp_object_type:null,wp_object_id:null,show_supplier_picker:!1,giav_mapping_status:"missing",supplier_override:!1,display_name:""});else{const e=t.display_name||t.title||"";G(l,{use_manual_entry:!0,wp_object_type:"manual",wp_object_id:0,show_supplier_picker:!0,giav_entity_type:"supplier",giav_entity_id:t.giav_supplier_id||ia,giav_mapping_status:t.giav_supplier_id===ia?"needs_review":"active",giav_supplier_id:t.giav_supplier_id||ia,giav_supplier_name:t.giav_supplier_name||sa,supplier_override:!1,display_name:e,title:e})}}})),(0,a.createElement)("div",{className:"service-card__supplier"},!U(t)&&(0,a.createElement)("div",{className:"service-card__supplier-actions"},(0,a.createElement)(Ze.Button,{variant:"tertiary",onClick:()=>L(l)},"Cambiar proveedor")),U(t)&&(0,a.createElement)(a.Fragment,null,!t.use_manual_entry&&(0,a.createElement)("div",{className:"service-card__field service-card__field--toggle"},(0,a.createElement)(Ze.ToggleControl,{label:"Proveedor (opcional)",checked:!!t.show_supplier_picker,onChange:()=>L(l)})),(0,a.createElement)(oa,{selectedId:t.giav_supplier_id||ia,selectedLabel:t.giav_supplier_name||sa,disabled:!1,onPick:e=>{const a=String(e?.id||""),r=String(e?.label||"");a&&G(l,{giav_entity_type:"supplier",giav_entity_id:a,giav_supplier_id:a,giav_supplier_name:r,giav_mapping_status:a===ia?"needs_review":"active",supplier_override:!t.use_manual_entry})}}),h.supplier&&(0,a.createElement)("div",{className:"service-card__field-error"},h.supplier)))):(0,a.createElement)("div",{className:"service-card__field "+(h.title?"is-error":"")},(0,a.createElement)(Ze.TextControl,{label:"T├¡tulo / descripci├│n *",value:t.title,onChange:e=>G(l,{title:e})}),h.title&&(0,a.createElement)("div",{className:"service-card__field-error"},h.title)),"hotel"===t.service_type&&(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.TextControl,{label:"Tipo de habitación",value:t.hotel_room_type||"",onChange:e=>G(l,{hotel_room_type:e}),placeholder:"Deluxe / Sea View..."})),"hotel"===t.service_type&&(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.SelectControl,{label:"Régimen",value:t.hotel_regimen||"",options:[{label:"Seleccionar",value:""},...ua],onChange:e=>G(l,{hotel_regimen:e})})))),(0,a.createElement)("div",{className:"service-card__section"},(0,a.createElement)("div",{className:"service-card__section-title"},"Fechas y ocupación"),(0,a.createElement)("div",{className:"service-card__date-status"},(0,a.createElement)("span",{className:"service-card__date-label "+(t.dates_inherited?"is-inherited":"is-custom")},t.dates_inherited?"Fechas del viaje":"Fechas personalizadas"),!t.dates_inherited&&(0,a.createElement)(Ze.Button,{variant:"tertiary",className:"service-card__date-reset",onClick:()=>(a=>{G(a,{start_date:e?.start_date||"",end_date:e?.end_date||"",dates_inherited:!0})})(l)},"Restablecer fechas del viaje")),(0,a.createElement)("div",{className:"service-card__grid service-card__grid--dates"},(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.TextControl,{label:"Fecha inicio",type:"date",value:t.start_date,onChange:a=>((a,t)=>{I(l=>{const r=[...l],n=r[a],o=t||"",i=n.end_date&&o&&n.end_date<o?o:n.end_date;return r[a]=ba({...n,start_date:o,end_date:i,dates_inherited:!1},e,d),r}),window.setTimeout(()=>{const e=document.getElementById(`wp-travel-end-date-${a}`);if(e&&(e.focus(),"function"==typeof e.showPicker))try{e.showPicker()}catch(e){}},0)})(l,a)})),(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.TextControl,{id:`wp-travel-end-date-${l}`,label:"Fecha fin",type:"date",value:t.end_date,onChange:e=>((e,a)=>G(e,{end_date:a}))(l,e),min:t.start_date||void 0})),"hotel"===t.service_type?(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.TextControl,{label:"Noches",type:"number",min:0,value:String(null!==(r=t.hotel_nights)&&void 0!==r?r:va(t,e)),onChange:a=>((a,t)=>{const l=A[a].start_date||e?.start_date;if(l){const e=function(e,a){if(!e)return"";const t=new Date(`${e}T00:00:00`);return Number.isFinite(t.getTime())?(t.setDate(t.getDate()+Math.max(0,a)),t.toISOString().slice(0,10)):""}(l,da(t,1));G(a,{end_date:e})}})(l,a)}))):"golf"===t.service_type?(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.TextControl,{label:"Jugadores",type:"number",min:1,value:String(p||u),disabled:!0,help:"Definido en Datos basicos"})),(0,a.createElement)("div",{className:"service-card__field "+(h.greenFees?"is-error":"")},(0,a.createElement)(Ze.TextControl,{label:"Green-fees por jugador *",type:"number",min:1,value:String(null!==(n=t.green_fees_per_person)&&void 0!==n?n:""),onChange:e=>G(l,{green_fees_per_person:e})}),h.greenFees&&(0,a.createElement)("div",{className:"service-card__field-error"},h.greenFees)),(0,a.createElement)("div",{className:"service-card__golf-summary"},"Total green-fees (interno): ",da(p||u,1)," x ",da(t.green_fees_per_person,0)," ="," ",da(t.total_green_fees,0))):(0,a.createElement)("div",{className:"service-card__field "+(h.quantity?"is-error":"")},(0,a.createElement)(Ze.TextControl,{label:"transfer"===t.service_type?"Cantidad (servicios)":"package"===t.service_type?"Cantidad (paquetes)":"Cantidad",type:"number",min:1,value:String(t.quantity),onChange:e=>G(l,{quantity:e})}),h.quantity&&(0,a.createElement)("div",{className:"service-card__field-error"},h.quantity)))),(0,a.createElement)("div",{className:"service-card__section service-card__section--pricing"},(0,a.createElement)("div",{className:"service-card__section-title"},"Pricing"),h.pricing&&(0,a.createElement)("div",{className:"service-card__field-error service-card__field-error--inline"},h.pricing),"hotel"===t.service_type?(0,a.createElement)(Ea,{item:t,idx:l,updateItem:G,currency:c,pax:u,basics:e,globalMarkupPct:d}):(0,a.createElement)("div",{className:"service-card__pricing"},(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.TextControl,{label:"Coste neto (unit.)",value:String(t.unit_cost_net),onChange:e=>G(l,{unit_cost_net:e}),placeholder:"120"})),(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.ToggleControl,{label:"Usar margen",checked:!!t.use_markup,onChange:()=>G(l,{use_markup:!t.use_markup})})),t.use_markup&&(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.TextControl,{label:"Margen (%)",type:"number",min:0,value:String(null!==(o=t.markup_pct)&&void 0!==o?o:d),onChange:e=>G(l,{markup_pct:e})})),(0,a.createElement)("div",{className:"service-card__field"},(0,a.createElement)(Ze.ToggleControl,{label:"PVP manual",checked:!!t.lock_sell_price,onChange:()=>G(l,{lock_sell_price:!t.lock_sell_price})})),(0,a.createElement)("div",{className:"service-card__field "+(h.unitSell?"is-error":"")},(0,a.createElement)(Ze.TextControl,{label:"PVP (unit.)",value:String(t.unit_sell_price),onChange:e=>G(l,{unit_sell_price:e}),placeholder:"165",disabled:!t.lock_sell_price}),h.unitSell&&(0,a.createElement)("div",{className:"service-card__field-error"},h.unitSell)))),"package"===t.service_type&&(0,a.createElement)("div",{className:"service-card__section service-card__section--package"},(0,a.createElement)("div",{className:"service-card__section-title"},"Detalle del paquete"),(0,a.createElement)("div",{className:"service-card__package"},(0,a.createElement)(Ze.TextControl,{label:"Incluye (una l├¡nea por item)",value:t.package_components_text||"",onChange:e=>G(l,{package_components_text:e}),placeholder:"3 noches\n2 green-fees\nDesayuno incluido"}))),"hotel"!==t.service_type&&(0,a.createElement)("div",{className:"service-card__section service-card__section--notes"},(0,a.createElement)("div",{className:"service-card__section-title"},"Notas"),(0,a.createElement)("details",{className:"service-card__notes-details"},(0,a.createElement)("summary",null,"Mostrar notas"),(0,a.createElement)("div",{className:"service-card__notes"},(0,a.createElement)(Ze.TextControl,{label:"Notas para el cliente (itinerario)",value:t.notes_public||"",onChange:e=>G(l,{notes_public:e}),placeholder:"Incluye desayuno. Check-in 15:00."}),(0,a.createElement)(Ze.TextControl,{label:"Notas internas (solo uso interno)",value:t.notes_internal||"",onChange:e=>G(l,{notes_internal:e}),placeholder:"Neto negociado, release 14D."}))))))})),(0,a.createElement)("div",{className:"services-add"},(0,a.createElement)(Ze.Button,{variant:"secondary",onClick:()=>{const a=A.length-1,t=a>=0?$[a]:null;("error"!==t?.status||window.confirm("Tienes un servicio incompleto. ¿Crear otro igualmente?"))&&I(a=>{const t=[...a,ha(e,d)],l=t.length-1;return S(l),w(l),t})}},"+ Añadir servicio")),(0,a.createElement)("div",{className:"services-summary"},(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"services-summary__label"},"Total viaje"),H(`${c} ${ma(B.totalTrip).toFixed(2)}`,{missing:R.totals_sell_price<=0,tooltip:"Completa servicios para calcular."}),(0,a.createElement)("div",{className:"services-summary__meta"},"Jugadores: ",B.playersCount," | No jugadores: ",B.nonPlayersCount)),B.playersCount>0&&(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"services-summary__label"},"Precio jugador en doble"),H(`${c} ${ma(B.pricePlayerDouble||0).toFixed(2)}`,{missing:B.playersCount<=0,tooltip:"Completa jugadores y servicios para calcular."})),B.nonPlayersCount>0&&(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"services-summary__label"},"Precio no jugador en doble"),H(`${c} ${ma(B.priceNonPlayerDouble||0).toFixed(2)}`,{missing:B.nonPlayersCount<=0,tooltip:"Completa no jugadores para calcular."})),B.hasSingleSupplement&&(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"services-summary__label"},"Suplemento individual"),H(`${c} ${ma(B.supplementSingle||0).toFixed(2)}`,{missing:!B.hasSingleSupplement,tooltip:"Completa habitaciones para calcular."}))),(0,a.createElement)("div",{className:"services-footer"},(g||x&&T.length>0)&&(0,a.createElement)("div",{className:"services-footer__errors"},(0,a.createElement)("div",{className:"services-footer__errors-header"},(0,a.createElement)("span",null,"Error summary"),(0,a.createElement)(Ze.Button,{variant:"link",onClick:()=>{M.current&&M.current.scrollIntoView({behavior:"smooth",block:"start"})}},"Ver arriba")),g&&(0,a.createElement)("div",{className:"services-footer__errors-message"},g),(0,a.createElement)("ul",null,(T.length>0?T:O.serviceErrors).slice(0,3).map(e=>(0,a.createElement)("li",{key:e.index},(0,a.createElement)("button",{type:"button",onClick:()=>D(e.index)},e.title,": ",e.details)))),O.serviceErrors.length>3&&(0,a.createElement)("div",{className:"services-footer__errors-more"},"+",O.serviceErrors.length-3," más")),(0,a.createElement)("div",{className:"services-footer__bar"},(0,a.createElement)("div",{className:"services-footer__left"},(0,a.createElement)(Ze.Button,{variant:"secondary",onClick:r},"Volver")),(0,a.createElement)("div",{className:"services-footer__summary"},(0,a.createElement)("span",null,"Total viaje"),(0,a.createElement)("strong",null,c," ",ma(B.totalTrip).toFixed(2))),(0,a.createElement)("div",{className:"services-footer__right"},(0,a.createElement)(Ze.Button,{variant:"primary",onClick:()=>{const{errors:e,serviceErrors:a}=F();if(P(!0),a.length>0||e.length>0){const t=a.length>0?`Faltan datos en ${a.length} servicios. Te llevo al primero.`:e[0];return h(t),k(a),void((e,a)=>{if(e.length>0)D(e[0].index);else if(a.length>0){E(null);const e=document.querySelector(".services-step");e&&(e.scrollIntoView({behavior:"smooth",block:"start"}),V(e))}})(a,e)}h(""),k([]),E(null),n({items:A,totals:R})},disabled:j&&x,title:j?"Completa los campos obligatorios para continuar.":""},g?"Revisa los campos marcados":"Continuar"))))))}function Na(e){const a=parseFloat(e);return Number.isFinite(a)?Math.round(100*(a+Number.EPSILON))/100:0}function Sa(e){const a=parseFloat(String(e).replace(",","."));return Number.isFinite(a)?a:0}function Ca(e,a=0){const t=parseInt(e,10);return Number.isFinite(t)?t:a}function wa({proposalId:e,basics:l,items:r,totals:n,onBack:o,onSent:i,mode:s="create",versionNumber:c=1}){const[u,p]=(0,t.useState)(!1),[d,m]=(0,t.useState)(""),v="undefined"!=typeof window&&window.CASANOVA_GESTION_RESERVAS?"wp-travel-giav-portal":"wp-travel-giav-admin",_=(0,t.useMemo)(()=>{const e={crm_customer_id:null,customer_name:l.customer_name,customer_email:l.customer_email,customer_country:l.customer_country,customer_language:l.customer_language,proposal_title:l.proposal_title,start_date:l.start_date,end_date:l.end_date,pax_total:l.pax_total,players_count:l.players_count,currency:l.currency,status:"sent"},a=(r||[]).map((e,a)=>{var t,l,r,n,o,i,s,c,u,p,d,m,v,_,g,h,b,E,f,y,N,S,C,w,x,P,T,k;return{day_index:null!==(t=e.day_index)&&void 0!==t?t:null,service_type:e.service_type,wp_object_type:null!==(l=e.wp_object_type)&&void 0!==l?l:null,wp_object_id:null!==(r=e.wp_object_id)&&void 0!==r?r:null,giav_entity_type:null!==(n=e.giav_entity_type)&&void 0!==n?n:null,giav_entity_id:null!==(o=e.giav_entity_id)&&void 0!==o?o:null,giav_supplier_id:null!==(i=e.giav_supplier_id)&&void 0!==i?i:null,giav_supplier_name:null!==(s=e.giav_supplier_name)&&void 0!==s?s:null,supplier_source:null!==(c=e.supplier_source)&&void 0!==c?c:null,supplier_resolution_chain:Array.isArray(e.supplier_resolution_chain)?e.supplier_resolution_chain:[],preflight_ok:null!==(u=e.preflight_ok)&&void 0!==u?u:null,warnings:Array.isArray(e.warnings)?e.warnings:[],blocking:Array.isArray(e.blocking)?e.blocking:[],supplier_override:!!e.supplier_override,title:null!==(p=e.title)&&void 0!==p?p:`Item ${a+1}`,display_name:null!==(d=e.display_name)&&void 0!==d?d:null,start_date:e.start_date||null,end_date:e.end_date||null,quantity:null!==(m=e.quantity)&&void 0!==m?m:1,pax_quantity:null!==(v=e.pax_quantity)&&void 0!==v?v:null,hotel_rate_basis:null!==(_=e.hotel_rate_basis)&&void 0!==_?_:null,hotel_nights:null!==(g=e.hotel_nights)&&void 0!==g?g:null,hotel_rooms:null!==(h=e.hotel_rooms)&&void 0!==h?h:null,hotel_room_type:null!==(b=e.hotel_room_type)&&void 0!==b?b:"",hotel_regimen:null!==(E=e.hotel_regimen)&&void 0!==E?E:"",room_pricing:null!==(f=e.room_pricing)&&void 0!==f?f:null,discounts:null!==(y=e.discounts)&&void 0!==y?y:null,giav_pricing:null!==(N=e.giav_pricing)&&void 0!==N?N:null,package_components:Array.isArray(e.package_components)?e.package_components:[],package_components_text:null!==(S=e.package_components_text)&&void 0!==S?S:"",green_fees_per_person:null!==(C=e.green_fees_per_person)&&void 0!==C?C:null,number_of_players:null!==(w=e.number_of_players)&&void 0!==w?w:null,total_green_fees:null!==(x=e.total_green_fees)&&void 0!==x?x:null,unit_cost_net:Na(e.unit_cost_net),unit_sell_price:Na(e.unit_sell_price),line_cost_net:Na(e.line_cost_net),line_sell_price:Na(e.line_sell_price),use_markup:!!e.use_markup,markup_pct:Na(null!==(P=e.markup_pct)&&void 0!==P?P:0),lock_sell_price:!!e.lock_sell_price,notes_public:null!==(T=e.notes_public)&&void 0!==T?T:"",notes_internal:null!==(k=e.notes_internal)&&void 0!==k?k:""}}),t=n||{totals_cost_net:0,totals_sell_price:0,totals_margin_abs:0,totals_margin_pct:0};return{header:e,items:a,totals:{totals_cost_net:Na(t.totals_cost_net),totals_sell_price:Na(t.totals_sell_price),totals_margin_abs:Na(t.totals_margin_abs),totals_margin_pct:Na(t.totals_margin_pct)},template_id:null,terms_version:null,metadata:{created_at:(new Date).toISOString(),created_by:null,source:v,schema_version:"v2"}}},[l,r,n]),g=_?.header||{},h=_?.totals||{},b=Array.isArray(_?.items)?_.items:[],E=(0,t.useMemo)(()=>{let e=0,a=0;return b.forEach(t=>{const l=Array.isArray(t?.warnings)?t.warnings:[],r=Array.isArray(t?.blocking)?t.blocking:[];e+=l.length,a+=r.length}),{warningCount:e,blockingCount:a}},[b]),f=E.blockingCount>0?"error":E.warningCount>0?"warning":"success",y=E.blockingCount>0?`Hay ${E.blockingCount} servicios con errores`:E.warningCount>0?`Hay ${E.warningCount} avisos en servicios`:"Servicios listos para enviar",N=(0,t.useMemo)(()=>{var e,a,t;const l=Math.max(0,Ca(null!==(e=g?.pax_total)&&void 0!==e?e:0,0)),r=Ca(null!==(a=null!==(t=g?.players_count)&&void 0!==t?t:l)&&void 0!==a?a:0,0),n=Math.min(Math.max(r,0),l),o={paxTotal:l,playersCount:n,nonPlayersCount:Math.max(0,l-n),golfTotal:0,totalDouble:0,totalSingle:0,doubleRooms:0,singleRooms:0};b.forEach(e=>{if("golf"===e.service_type&&(o.golfTotal+=Sa(e.line_sell_price||0)),"hotel"===e.service_type){const l=e.room_pricing||{};var a,t;l.double?.enabled&&(o.totalDouble+=Sa(l.double?.total_pvp||0),o.doubleRooms+=Math.max(0,Ca(null!==(a=l.double?.rooms)&&void 0!==a?a:0,0))),l.single?.enabled&&(o.totalSingle+=Sa(l.single?.total_pvp||0),o.singleRooms+=Math.max(0,Ca(null!==(t=l.single?.rooms)&&void 0!==t?t:0,0)))}});const i=Sa(h?.totals_sell_price||0),s=i,c=o.doubleRooms>0?o.totalDouble/(2*o.doubleRooms):0,u=o.singleRooms>0?o.totalSingle/o.singleRooms:0,p=i-(o.totalDouble+o.totalSingle)-o.golfTotal,d=c+(o.paxTotal>0?p/o.paxTotal:0),m=o.playersCount>0?d+o.golfTotal/o.playersCount:null,v=o.doubleRooms>0&&o.singleRooms>0;let _=null;return v&&(_=Math.max(0,u-c)),{...o,totalTrip:i,baseTotal:s,priceNonPlayerDouble:d,pricePlayerDouble:m,supplementSingle:_,hasSingleSupplement:v}},[g?.pax_total,g?.players_count,b,h?.totals_sell_price]),S="edit"===s?"Guardar nueva versión":g.customer_email?"Enviar propuesta":"Crear enlace";return(0,a.createElement)(Ze.Card,null,(0,a.createElement)(Ze.CardHeader,null,(0,a.createElement)("strong",null,"Preview y envío")),(0,a.createElement)(Ze.CardBody,null,d&&(0,a.createElement)(Ze.Notice,{status:"error",isDismissible:!0,onRemove:()=>m("")},d),(0,a.createElement)(Ze.Notice,{status:f,isDismissible:!1},y),(0,a.createElement)(Ze.Notice,{status:"info",isDismissible:!1},"El cliente vera solo el total del paquete. El desglose por lineas queda guardado internamente en la version."),(0,a.createElement)("div",{className:"proposal-preview"},(0,a.createElement)("div",{className:"proposal-preview__header"},(0,a.createElement)("div",{className:"proposal-preview__name"},g.customer_name),(0,a.createElement)("div",{className:"proposal-preview__meta"},g.start_date," - ",g.end_date," | Pax: ",g.pax_total," | Moneda: ",g.currency)),(0,a.createElement)("div",{className:"proposal-preview__includes"},(0,a.createElement)("div",{className:"proposal-preview__includes-title"},"Incluye"),(0,a.createElement)("div",{className:"preview-items"},b.map((e,t)=>{const l=Array.isArray(e?.warnings)?e.warnings:[],r=Array.isArray(e?.blocking)?e.blocking:[],n=e.display_name||e.title||`Item ${t+1}`,o=e.giav_supplier_name||"Proveedor no especificado",i=r.length>0,s=l.length>0;return(0,a.createElement)("div",{key:t,className:"preview-item"},(0,a.createElement)("div",{className:"preview-item__main"},(0,a.createElement)("div",{className:"preview-item__title"},(0,a.createElement)("strong",null,e.service_type?.toUpperCase())," - ",n),(0,a.createElement)("div",{className:"preview-item__supplier"},"Proveedor: ",o),"hotel"===e.service_type&&e.hotel_room_type?(0,a.createElement)("div",{className:"preview-item__meta"},"Habitacion: ",e.hotel_room_type):null,"package"===e.service_type&&e.package_components_text?(0,a.createElement)("div",{className:"preview-item__meta"},"Incluye: ",e.package_components_text.split("\n").filter(Boolean).join(", ")):null,i&&(0,a.createElement)("div",{className:"preview-item__blocking"},(0,a.createElement)("span",{className:"preview-item__badge preview-item__badge--error"},"Error"),"Este servicio impide la confirmacion."),i&&(0,a.createElement)("details",{className:"preview-item__details"},(0,a.createElement)("summary",null,"Ver motivos"),(0,a.createElement)("ul",null,r.map((e,t)=>(0,a.createElement)("li",{key:t},e?.message||"Revision requerida")))),s&&(0,a.createElement)("details",{className:"preview-item__details"},(0,a.createElement)("summary",null,(0,a.createElement)("span",{className:"preview-item__badge preview-item__badge--warning"},"Aviso"),"Ver avisos (",l.length,")"),(0,a.createElement)("ul",null,l.map((e,t)=>(0,a.createElement)("li",{key:t},e?.message||"Aviso"))))))}))),(0,a.createElement)("div",{className:"proposal-preview__totals"},(0,a.createElement)("div",{className:"proposal-preview__totals-label"},"Total viaje"),(0,a.createElement)("div",{className:"proposal-preview__totals-value"},g.currency," ",Na(N.totalTrip).toFixed(2)),N.playersCount>0&&(0,a.createElement)("div",{className:"proposal-preview__totals-line"},"Precio jugador en doble: ",g.currency," ",Na(N.pricePlayerDouble||0).toFixed(2)),(0,a.createElement)("div",{className:"proposal-preview__totals-line"},"Precio no jugador en doble: ",g.currency," ",Na(N.priceNonPlayerDouble||0).toFixed(2)),N.hasSingleSupplement&&(0,a.createElement)("div",{className:"proposal-preview__totals-line"},"Suplemento individual: ",g.currency," ",Na(N.supplementSingle||0).toFixed(2)),(0,a.createElement)("div",{className:"proposal-preview__totals-note"},"Precios por persona. El suplemento individual aplica por persona alojada en habitacion individual."))),(0,a.createElement)("div",{className:"proposal-preview__actions"},(0,a.createElement)(Ze.Button,{variant:"secondary",onClick:o,disabled:u},"Volver"),(0,a.createElement)(Ze.Button,{variant:"primary",onClick:async()=>{p(!0),m("");const a=function(){const a=e&&Number(e)>0?Number(e):null;if(a)return a;return(()=>{try{const e=window.location.search||"";if(!e)return null;const a=new URLSearchParams(e),t=["proposal_id","id","proposalId","proposalId"];for(let e of t){const t=a.get(e);if(t){const e=parseInt(t,10);if(Number.isFinite(e)&&e>0)return e}}}catch(e){}return null})()||null}();try{"undefined"!=typeof process&&process&&process.env}catch(e){}if(!a||Number(a)<=0)return p(!1),void m("No se pudo enviar: falta el identificador de propuesta válido (proposalId).");if("Enviar propuesta"!==S||window.confirm("Confirmar envio de la propuesta?"))try{const e="edit"===s?await Qe.createProposalVersion(a,_,c):await Qe.sendProposal(a,_,c);i({versionId:e.version_id,publicToken:e.public_token,publicUrl:e.public_url,status:e.status,snapshot:_})}catch(e){m(e?.message||"Error enviando la propuesta.")}finally{p(!1)}else p(!1)},disabled:u},S),u&&(0,a.createElement)(Ze.Spinner,null))))}const xa={draft:"Borrador",sent:"Enviada",accepted:"Aceptada",queued:"En cola",synced:"Sincronizada",error:"Error",revoked:"Revocada",lost:"Perdida"},Pa=e=>{if(!e)return"-";const a=String(e),t=a.includes("T")?a:a.replace(" ","T"),l=new Date(t);return Number.isNaN(l.getTime())?e:new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(l)};function Ta({onExit:e,mode:l="create",initialProposal:r=null,initialSnapshot:n=null,nextVersionNumber:o=1,showStepper:i=!1}){const[s,c]=(0,t.useState)(1),[u,p]=(0,t.useState)(r?.id||null),[d,m]=(0,t.useState)(r?.status||"draft"),[v]=(0,t.useState)(r?.accepted_at||""),[_]=(0,t.useState)(r?.proposal_token||""),[g,h]=(0,t.useState)(r?.public_url||""),[b,E]=(0,t.useState)(null),[f,y]=(0,t.useState)(!1),N="undefined"!=typeof window&&!!window.CASANOVA_GESTION_RESERVAS,S=(0,t.useMemo)(()=>{if(!r&&!n)return null;const e=n?.header||{};return{proposal_title:e.proposal_title||r?.proposal_title||"",customer_name:e.customer_name||r?.customer_name||"",customer_email:e.customer_email||r?.customer_email||"",customer_country:e.customer_country||r?.customer_country||"",customer_language:e.customer_language||r?.customer_language||"en",start_date:e.start_date||r?.start_date||"",end_date:e.end_date||r?.end_date||"",pax_total:e.pax_total||r?.pax_total||1,currency:e.currency||r?.currency||"EUR"}},[r,n]),[C,w]=(0,t.useState)(S),[x,P]=(0,t.useState)(n?.items||[]),[T,k]=(0,t.useState)(n?.totals||null),[M,A]=(0,t.useState)(null),[I,R]=(0,t.useState)(null);let B=null;if(1===s)B=(0,a.createElement)(ra,{initialValues:C||{customer_language:"en",currency:"EUR",pax_total:1},onNext:({basics:e})=>{w(e),P(a=>fa(a,e)),c(2)},onCreated:({proposalId:e,basics:a})=>{p(e),w(a),P(e=>fa(e,a)),c(2)},proposalId:u});else if(2===s)B=(0,a.createElement)(ya,{basics:C,initialItems:x,onDraftChange:({items:e,totals:a})=>{P(e),k(a)},onBack:()=>c(1),onNext:({items:e,totals:a})=>{P(e),k(a),c(3)}});else if(3===s)B=(0,a.createElement)(wa,{proposalId:u,basics:C,items:x,totals:T,mode:l,versionNumber:o,onBack:()=>c(2),onSent:({versionId:e,snapshot:a,publicUrl:t,publicToken:l,status:r})=>{R(e),A(a||null),t&&h(t),l&&E(l),r&&m(r),c(4)}});else if(4===s){const t=g||((e,a)=>{if(!e)return"";const t=`${window.location.origin}/travel-proposal/${e}/`;return a?`${window.location.origin}/travel-proposal/${e}/v/${a}/`:t})(_,b),r=xa[d]||d||"-",n=v?`Aceptada el ${Pa(v)}`:"Pendiente",o=(({email:e,name:a,publicUrl:t})=>{if(!e||!t)return"";const l=`${a?`Hola ${a},`:"Hola,"}\n\nAquí tienes el enlace a tu propuesta:\n${t}\n\nQuedamos a tu disposición para cualquier duda.`;return`mailto:${e}?subject=${encodeURIComponent("Tu propuesta de viaje")}&body=${encodeURIComponent(l)}`})({email:C?.customer_email,name:C?.customer_name,publicUrl:t}),i=(e=>{if("undefined"==typeof window)return"";const a=window.CASANOVA_GESTION_RESERVAS;return a?.pageBase&&e?`${a.pageBase.replace(/\/$/,"")}#/propuesta/${e}`:""})(u)||((e={})=>{const a=new URL(window.location.href);return a.searchParams.set("page","travel_proposals"),a.searchParams.delete("proposal_id"),a.searchParams.delete("action"),Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t?a.searchParams.set(e,t):a.searchParams.delete(e)}),a.toString()})({proposal_id:u}),s=N?"Ver detalle en portal":"Ir al repositorio / ver detalle",c=async()=>{await async function(e){if(!e)return!1;try{if(navigator.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0}catch(e){}const a=document.createElement("textarea");a.value=e,a.style.position="fixed",a.style.top="-1000px",document.body.appendChild(a),a.focus(),a.select();const t=document.execCommand("copy");return document.body.removeChild(a),t}(t)&&(y(!0),window.setTimeout(()=>y(!1),1500))};B=(0,a.createElement)(Ze.Card,null,(0,a.createElement)(Ze.CardHeader,null,(0,a.createElement)("strong",null,"Preview y envio")),(0,a.createElement)(Ze.CardBody,null,(0,a.createElement)(Ze.Notice,{status:"success",isDismissible:!1},"edit"===l?"Nueva version creada:":"Propuesta enviada. Version creada:"," ",(0,a.createElement)("strong",null,I)),"accepted"===d&&v?(0,a.createElement)(Ze.Notice,{status:"info",isDismissible:!1},"Aceptada el ",Pa(v),"."):null,(0,a.createElement)("div",{className:"proposal-wizard__final-meta"},(0,a.createElement)("div",null,(0,a.createElement)("strong",null,"Estado:")," ",r),(0,a.createElement)("div",null,(0,a.createElement)("strong",null,"Aceptacion:")," ",n),(0,a.createElement)("div",null,(0,a.createElement)("strong",null,"GIAV:")," El expediente se creara tras la aceptacion del cliente.")),(0,a.createElement)("div",{className:"proposal-wizard__final-actions"},"accepted"!==d?(0,a.createElement)(Ze.Button,{variant:"primary",onClick:c,disabled:!t},f?"Enlace copiado":"Copiar enlace publico"):null,o?(0,a.createElement)(Ze.Button,{variant:"secondary",onClick:()=>window.location.assign(o)},"Enviar email al cliente"):null,t?(0,a.createElement)(Ze.Button,{variant:"link",href:t,target:"_blank",rel:"noopener noreferrer"},"Abrir vista publica"):null,i?(0,a.createElement)(Ze.Button,{variant:"link",href:i},s):null,(0,a.createElement)(Ze.Button,{variant:"tertiary",onClick:e},"Salir"))))}if(!B)return null;if(!i)return B;const G=s>3?3:s;return(0,a.createElement)("div",{className:"proposal-wizard"},(0,a.createElement)("div",{className:"proposal-wizard__stepper"},[{title:"Datos basicos",subtitle:"Identidad y fechas"},{title:"Servicios y precios",subtitle:"Hotel, golf y extras"},{title:"Vista previa y envio",subtitle:"Resumen final"}].map((e,t)=>{const l=t+1,r=G===l?"is-active":G>l?"is-complete":"is-upcoming";return(0,a.createElement)("div",{key:e.title,className:`proposal-wizard__step ${r}`.trim()},(0,a.createElement)("div",{className:"proposal-wizard__step-index"},l),(0,a.createElement)("div",{className:"proposal-wizard__step-text"},(0,a.createElement)("div",{className:"proposal-wizard__step-title"},e.title),(0,a.createElement)("div",{className:"proposal-wizard__step-subtitle"},e.subtitle)))})),(0,a.createElement)("div",{className:"proposal-wizard__content"},B))}const ka=({mode:e="create"})=>{const l=Z(),{proposalId:r}=Y(),n=r?parseInt(r,10):null,o="edit"===e&&Number.isFinite(n),i=o?`Editar propuesta #${n}`:"Nueva propuesta",s=o?`#${n}`:"Nueva propuesta",[c,u]=(0,t.useState)(null),[p,d]=(0,t.useState)(!1),[m,v]=(0,t.useState)("");(0,t.useEffect)(()=>{if(!o||!n)return u(null),void v("");let e=!0;return(async()=>{d(!0),v("");try{const a=await Qe.getProposalDetail(n);e&&u(a)}catch(a){e&&v(a?.message||"No se pudo cargar la propuesta.")}finally{e&&d(!1)}})(),()=>{e=!1}},[o,n]);const _=(0,t.useMemo)(()=>o&&c?.proposal?{initialProposal:c.proposal,initialSnapshot:c.current_snapshot,nextVersionNumber:c.next_version_number||1,mode:"edit"}:null,[c,o]);return(0,a.createElement)("div",{className:"casanova-portal-section casanova-portal-section--wizard"},(0,a.createElement)("header",{className:"casanova-portal-section__header"},(0,a.createElement)("div",null,(0,a.createElement)("div",{className:"casanova-portal-breadcrumbs"},(0,a.createElement)(Se,{to:"/proposals"},"Propuestas"),(0,a.createElement)("span",null,"/"),(0,a.createElement)("span",null,s)),(0,a.createElement)("h2",null,i),(0,a.createElement)("p",null,"Completa los pasos para crear o actualizar la propuesta.")),(0,a.createElement)("div",{className:"casanova-portal-section__actions"},(0,a.createElement)(Se,{className:"button-secondary",to:"/proposals"},"Volver al listado"))),p?(0,a.createElement)("div",{className:"casanova-portal__loading"},"Cargando..."):null,m?(0,a.createElement)("div",{className:"casanova-portal-section__notice"},m):null,p||o&&!_?null:(0,a.createElement)("div",{className:"casanova-portal-wizard"},(0,a.createElement)(Ta,{showStepper:!0,onExit:()=>l("/proposals"),..._||{}})))},Ma=({children:e,config:t})=>(0,a.createElement)("div",{className:"casanova-portal"},(0,a.createElement)("header",{className:"casanova-portal__header"},(0,a.createElement)("div",{className:"casanova-portal__header-main"},(0,a.createElement)("div",null,(0,a.createElement)("p",{className:"casanova-portal__eyebrow"},"Portal de propuestas"),(0,a.createElement)("h1",null,"Gestión de reservas")),(0,a.createElement)("div",{className:"casanova-portal__user"},(0,a.createElement)("div",{className:"casanova-portal__user-meta"},(0,a.createElement)("span",null,t.currentUser?.displayName||"Administrador"),(0,a.createElement)("small",null,t.currentUser?.email||"")),t.logoutUrl?(0,a.createElement)("div",{className:"casanova-portal__user-actions"},(0,a.createElement)("a",{className:"casanova-portal__logout",href:t.logoutUrl},"Cerrar sesión")):null)),(0,a.createElement)("p",{className:"casanova-portal__subtitle"},"Monitorea versiones, revisa estados y sincroniza con GIAV.")),(0,a.createElement)("div",{className:"casanova-portal__body"},(0,a.createElement)("aside",{className:"casanova-portal__sidebar"},(0,a.createElement)("div",{className:"casanova-portal__branding"},(0,a.createElement)("span",{className:"casanova-portal__branding-icon"},"CG"),(0,a.createElement)("div",null,(0,a.createElement)("strong",null,"Casanova"),(0,a.createElement)("small",null,"Gestión premium"))),(0,a.createElement)("nav",{className:"casanova-portal__nav"},(0,a.createElement)(Ce,{to:"/proposals",className:({isActive:e})=>"casanova-portal__nav-link "+(e?"casanova-portal__nav-link--active":"")},"Listado de propuestas")),(0,a.createElement)("div",{className:"casanova-portal__status"},(0,a.createElement)("span",null,"Base de datos"),(0,a.createElement)("strong",{className:t.flags?.dbHealthy?"status-chip--ok":"status-chip--warning"},t.flags?.dbHealthy?"OK":"Revisar"))),(0,a.createElement)("section",{className:"casanova-portal__content"},e))),Aa=()=>{const e=window.CASANOVA_GESTION_RESERVAS;return e?(0,a.createElement)(fe,null,(0,a.createElement)(Ma,{config:e},(0,a.createElement)(pe,null,(0,a.createElement)(ce,{path:"/",element:(0,a.createElement)(se,{to:"/proposals",replace:!0})}),(0,a.createElement)(ce,{path:"/proposals",element:(0,a.createElement)(qe,null)}),(0,a.createElement)(ce,{path:"/nueva",element:(0,a.createElement)(ka,{mode:"create"})}),(0,a.createElement)(ce,{path:"/propuesta/:proposalId",element:(0,a.createElement)(Je,null)}),(0,a.createElement)(ce,{path:"/propuesta/:proposalId/editar",element:(0,a.createElement)(ka,{mode:"edit"})}),(0,a.createElement)(ce,{path:"/proposals/:proposalId",element:(0,a.createElement)(Je,null)}),(0,a.createElement)(ce,{path:"/proposals/:proposalId/edit",element:(0,a.createElement)(ka,{mode:"edit"})}),(0,a.createElement)(ce,{path:"*",element:(0,a.createElement)(se,{to:"/proposals",replace:!0})})))):(0,a.createElement)("div",{className:"casanova-portal__loading"},"Cargando configuración...")},Ia=document.getElementById("casanova-gestion-reservas-app");Ia&&(0,t.createRoot)(Ia).render((0,a.createElement)(Aa,null))})();